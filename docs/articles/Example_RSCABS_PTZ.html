<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PTZ • drcHelper</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="PTZ">
<meta property="og:description" content="drcHelper">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">drcHelper</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Introduction.html">Introduction</a>
    </li>
    <li>
      <a href="../articles/Tutorial_drc_Helpers.html">Example Usage of drcHelper</a>
    </li>
    <li>
      <a href="../articles/Count_Data.html">Count Data</a>
    </li>
    <li>
      <a href="../articles/EFSA-Criteria.html">EFSA Criteria</a>
    </li>
    <li>
      <a href="../articles/Example_RSCABS_PTZ.html">PTZ</a>
    </li>
    <li>
      <a href="../articles/Examples%20using%20NLS.html">Using nls to fit arbitrary dose-response models</a>
    </li>
    <li>
      <a href="../articles/Examples_MCP.html">Examples of NOEC Derivation by MCP</a>
    </li>
    <li>
      <a href="../articles/Examples_drc.html">Examples_drc</a>
    </li>
    <li>
      <a href="../articles/Examples_oecd201.html">Examples_oecd201</a>
    </li>
    <li>
      <a href="../articles/Examples_using_drda.html">Examples using drda</a>
    </li>
    <li>
      <a href="../articles/Fitting-a-biphasic-dose-reponse-model.html">Fitting a biphasic dose-reponse model</a>
    </li>
    <li>
      <a href="../articles/MQJT.html">MQJT</a>
    </li>
    <li>
      <a href="../articles/Ordinal-Data.html">An example: RSCABS for Histopath Data</a>
    </li>
    <li>
      <a href="../articles/Quantal-Data.html">Quantal Data</a>
    </li>
    <li>
      <a href="../articles/TSK_method.html"> Spearman-Karber method</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>PTZ</h1>
                        <h4 data-toc-skip class="author">Zhenglei
Gao</h4>
            
            <h4 data-toc-skip class="date">2023-04-11</h4>
      
      
      <div class="hidden name"><code>Example_RSCABS_PTZ.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<p>Allen Olmstead Ecotoxicologist</p>
<p>For the public consultation period on the EU <strong>prothioconazole
endocrine assessment</strong>, one of the studies of focus in the FSTRA
(fish short term reproduction assay). In particular there was a question
concerning the histopathology results (female oocyte atresia,
specifically) and whether they were statistically significant. In our
report, there is no formal statistical analysis of the data. I was asked
about the availability of approaches for this based on my past
postdoctoral experience at the EPA lab that developed many of the
endocrine assays. For histopath endpoints, the EPA used a Rao-Scott
Cochran-Armitage Trend Test By Slices (RSCABS, described in attached
paper).</p>
<p>Using this RSCABS procedure, I looked at the female oocyte atresia
data in R. The attached Excel file has the data and the other attached
pdf has my notes on this analysis. However, validation is needed if we
are to proceed with this approach in any external purpose.</p>
</div>
<div class="section level2">
<h2 id="rscabs">RSCABS<a class="anchor" aria-label="anchor" href="#rscabs"></a>
</h2>
<p>RSCABS: designed to analyze histopathological results from standard
toxicology experiments, for example the MEOGRT.</p>
<p>Steps in the testing procedure:</p>
<p>1.The Cochran-Armitage (CA) trend test was used to test a set of
organisms for an increase in the presences (score &gt; 0) or absence
(score = 0) of an effect with an increase in the dose concentration of
the treatments. 2. The Rao-Scott (RS) adjustment controls for the
similarity in each experiment unit / apparatus (<em>e.g.</em>, fish
tank) by calculating an adjustment to the CA test statistic from
correlation of organisms within each apparatuses. 3. The by slices (BS)
part allows for testing at each severity score (<em>e.g.</em>, from 1 to
5) instead of just presences or absence. By slices works by splitting
the severity scores associated with an endpoint into
<strong>two</strong> groups based on the severity score being tested.
The RSCA test statistic is calculated based on these two groups. 4.
Carry out a step-down procedure by excluding the highest treatment level
in the analysis and recalculate the RSCA test statistic until the test
stats is not significant or there is only control group left.</p>
</div>
<div class="section level2">
<h2 id="eda">EDA<a class="anchor" aria-label="anchor" href="#eda"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat_ptz</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 20 × 9</span></span></span>
<span><span class="co">##    tmt   tank     S0    S1    S3    S2  S0_1  S0_2 total</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> C     5A        2     1     1     0     3     3     4</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> C     5B        3     1     0     0     4     4     4</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> C     5C        3     0     0     0     3     3     3</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> C     5D        2     0     1     0     2     2     3</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> SC    4A        1     3     0     0     4     4     4</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> SC    4B        1     1     2     0     2     2     4</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> SC    4C        1     3     0     0     4     4     4</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> SC    4D        3     0     1     0     3     3     4</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> T1    3A        4     0     0     0     4     4     4</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> T1    3B        2     2     0     0     4     4     4</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">11</span> T1    3C        4     0     0     0     4     4     4</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">12</span> T1    3D        3     0     1     0     3     3     4</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">13</span> T2    2A        3     0     0     1     3     4     4</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">14</span> T2    2B        2     0     1     1     2     3     4</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">15</span> T2    2C        1     2     0     0     3     3     3</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">16</span> T2    2D        3     0     1     0     3     3     4</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">17</span> T3    1A        1     1     2     0     2     2     4</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">18</span> T3    1B        4     0     0     0     4     4     4</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">19</span> T3    1C        2     1     1     0     3     3     4</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">20</span> T3    1D        1     0     3     0     1     1     4</span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ptz</span> <span class="op">&lt;-</span> <span class="va">dat_ptz</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">tmt</span>,<span class="va">tank</span>,<span class="va">S0</span>,<span class="va">S1</span>,<span class="va">S2</span>,<span class="va">S3</span><span class="op">)</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">S0</span>,<span class="va">S1</span>,<span class="va">S2</span>,<span class="va">S2</span>,<span class="va">S3</span><span class="op">)</span>,names_to <span class="op">=</span> <span class="st">"Score"</span>,values_to <span class="op">=</span> <span class="st">"count"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">ptz</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">tmt</span>,y<span class="op">=</span><span class="va">count</span>,color<span class="op">=</span><span class="va">Score</span>,fill<span class="op">=</span><span class="va">Score</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>,position <span class="op">=</span> <span class="st">"stack"</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_d</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="Example_RSCABS_PTZ_files/figure-html/unnamed-chunk-1-1.png" width="700"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ptz</span> <span class="op">&lt;-</span> <span class="va">ptz</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>trt<span class="op">=</span><span class="va">tmt</span><span class="op">)</span></span>
<span><span class="va">ptz</span><span class="op">$</span><span class="va">trt</span><span class="op">[</span><span class="va">ptz</span><span class="op">$</span><span class="va">trt</span><span class="op">==</span><span class="st">"SC"</span> <span class="op">|</span> <span class="va">ptz</span><span class="op">$</span><span class="va">trt</span><span class="op">==</span><span class="st">"C"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"PC"</span> </span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">ptz</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">trt</span>,y<span class="op">=</span><span class="va">count</span>,color<span class="op">=</span><span class="va">Score</span>,fill<span class="op">=</span><span class="va">Score</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>,position <span class="op">=</span> <span class="st">"stack"</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_d</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="Example_RSCABS_PTZ_files/figure-html/unnamed-chunk-1-2.png" width="700"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">ptz</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">tmt</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>total<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span>,freq<span class="op">=</span><span class="va">count</span><span class="op">/</span><span class="va">total</span><span class="op">)</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">tmt</span>,y<span class="op">=</span><span class="va">freq</span>,color<span class="op">=</span><span class="va">Score</span>,fill<span class="op">=</span><span class="va">Score</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>,position <span class="op">=</span> <span class="st">"stack"</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_d</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="Example_RSCABS_PTZ_files/figure-html/unnamed-chunk-1-3.png" width="700"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">ptz</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">trt</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>total<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span>,freq<span class="op">=</span><span class="va">count</span><span class="op">/</span><span class="va">total</span><span class="op">)</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">trt</span>,y<span class="op">=</span><span class="va">freq</span>,color<span class="op">=</span><span class="va">Score</span>,fill<span class="op">=</span><span class="va">Score</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>,position <span class="op">=</span> <span class="st">"stack"</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_d</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="Example_RSCABS_PTZ_files/figure-html/unnamed-chunk-1-4.png" width="700"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">slice2</span> <span class="op">&lt;-</span> <span class="va">dat_ptz</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>S2_3<span class="op">=</span><span class="va">total</span><span class="op">-</span><span class="va">S0_1</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">tmt</span>,<span class="va">tank</span>,<span class="va">S0_1</span>,<span class="va">S2_3</span><span class="op">)</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">S0_1</span>,<span class="va">S2_3</span><span class="op">)</span>,names_to <span class="op">=</span> <span class="st">"Score"</span>,values_to <span class="op">=</span> <span class="st">"count"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="va">slice2</span> <span class="op">&lt;-</span> <span class="va">slice2</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>trt<span class="op">=</span><span class="va">tmt</span><span class="op">)</span></span>
<span><span class="va">slice2</span><span class="op">$</span><span class="va">trt</span><span class="op">[</span><span class="va">slice2</span><span class="op">$</span><span class="va">trt</span><span class="op">==</span><span class="st">"SC"</span> <span class="op">|</span> <span class="va">slice2</span><span class="op">$</span><span class="va">trt</span><span class="op">==</span><span class="st">"C"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"PC"</span> </span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">slice2</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">tmt</span>,y<span class="op">=</span><span class="va">count</span>,color<span class="op">=</span><span class="va">Score</span>,fill<span class="op">=</span><span class="va">Score</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>,position <span class="op">=</span> <span class="st">"stack"</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_d</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="Example_RSCABS_PTZ_files/figure-html/unnamed-chunk-1-5.png" width="700"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">slice2</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">trt</span>,y<span class="op">=</span><span class="va">count</span>,color<span class="op">=</span><span class="va">Score</span>,fill<span class="op">=</span><span class="va">Score</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>,position <span class="op">=</span> <span class="st">"stack"</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_d</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="Example_RSCABS_PTZ_files/figure-html/unnamed-chunk-1-6.png" width="700"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">slice2</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">tmt</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>total<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span>,freq<span class="op">=</span><span class="va">count</span><span class="op">/</span><span class="va">total</span><span class="op">)</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">tmt</span>,y<span class="op">=</span><span class="va">freq</span>,color<span class="op">=</span><span class="va">Score</span>,fill<span class="op">=</span><span class="va">Score</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>,position <span class="op">=</span> <span class="st">"stack"</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_d</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="Example_RSCABS_PTZ_files/figure-html/unnamed-chunk-1-7.png" width="700"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">slice2</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">trt</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>total<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span>,freq<span class="op">=</span><span class="va">count</span><span class="op">/</span><span class="va">total</span><span class="op">)</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">trt</span>,y<span class="op">=</span><span class="va">freq</span>,color<span class="op">=</span><span class="va">Score</span>,fill<span class="op">=</span><span class="va">Score</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>,position <span class="op">=</span> <span class="st">"stack"</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_d</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="Example_RSCABS_PTZ_files/figure-html/unnamed-chunk-1-8.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="r-script">R script<a class="anchor" aria-label="anchor" href="#r-script"></a>
</h2>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># fucntion to generate the Rao Scott adjusted values</span></span>
<span><span class="va">get_RS_adj_val</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">group</span>, <span class="va">replicate</span>, <span class="va">affected</span>, <span class="va">total</span><span class="op">)</span> <span class="op">{</span></span>
<span><span class="co"># create data frame from input vectors</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>grp <span class="op">=</span> <span class="va">group</span>, rep <span class="op">=</span> <span class="va">replicate</span>, aff <span class="op">=</span> <span class="va">affected</span>, tot <span class="op">=</span> <span class="va">total</span><span class="op">)</span></span>
<span><span class="co"># create aggregates by dose levels</span></span>
<span><span class="va">agg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">dat</span>, <span class="va">grp</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">aff</span><span class="op">)</span>, n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">tot</span><span class="op">)</span>, m <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>p_hat <span class="op">=</span> <span class="va">x</span><span class="op">/</span><span class="va">n</span>,</span>
<span>b <span class="op">=</span> <span class="va">p_hat</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">p_hat</span><span class="op">)</span><span class="op">/</span><span class="va">n</span><span class="op">)</span></span>
<span><span class="co"># add aggregates to original data frame</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">dat</span>, <span class="va">agg</span>, by <span class="op">=</span> <span class="st">"grp"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>r2 <span class="op">=</span> <span class="op">(</span><span class="va">aff</span> <span class="op">-</span> <span class="va">tot</span><span class="op">*</span><span class="va">p_hat</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="co"># square of residuals</span></span>
<span><span class="co"># calculate subgroup variances</span></span>
<span><span class="va">subgrp_var</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">dat</span>, <span class="va">grp</span>, <span class="va">m</span>, <span class="va">n</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>sum_r2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">r2</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>v <span class="op">=</span> <span class="va">m</span><span class="op">*</span><span class="va">sum_r2</span><span class="op">/</span><span class="va">n</span><span class="op">^</span><span class="fl">2</span><span class="op">/</span><span class="op">(</span><span class="va">m</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">agg</span><span class="op">$</span><span class="va">v</span> <span class="op">&lt;-</span> <span class="va">subgrp_var</span><span class="op">$</span><span class="va">v</span></span>
<span><span class="co"># calculate adjusted n and x values</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">agg</span>, D <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">v</span><span class="op">/</span><span class="va">b</span> <span class="op">&lt;</span> <span class="fl">1</span>, <span class="fl">1</span>, <span class="va">v</span><span class="op">/</span><span class="va">b</span><span class="op">)</span>,</span>
<span>n_tilde <span class="op">=</span> <span class="va">n</span><span class="op">/</span><span class="va">D</span>,</span>
<span>x_tilde <span class="op">=</span> <span class="va">x</span><span class="op">/</span><span class="va">D</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co"># function to run the Cochran-Armitage test with adjusted x and n values.</span></span>
<span><span class="va">get_CA_Z</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">adj_x</span>, <span class="va">adj_n</span><span class="op">)</span> <span class="op">{</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">adj_x</span><span class="op">)</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">adj_n</span><span class="op">)</span></span>
<span><span class="va">d_bar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">d</span><span class="op">*</span><span class="va">adj_n</span><span class="op">)</span><span class="op">/</span><span class="va">N</span></span>
<span><span class="va">p_bar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">adj_x</span><span class="op">)</span><span class="op">/</span><span class="va">N</span></span>
<span><span class="va">num</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">adj_x</span><span class="op">*</span><span class="va">d</span><span class="op">)</span> <span class="op">-</span> <span class="va">N</span><span class="op">*</span><span class="va">p_bar</span><span class="op">*</span><span class="va">d_bar</span></span>
<span><span class="va">den</span> <span class="op">&lt;-</span> <span class="va">p_bar</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">p_bar</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">adj_n</span><span class="op">*</span><span class="op">(</span><span class="va">d</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">-</span> <span class="va">N</span><span class="op">*</span><span class="va">d_bar</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">num</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">den</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co"># wrapper function for running RSCA test</span></span>
<span><span class="va">run_RSCA</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">group</span>, <span class="va">replicate</span>, <span class="va">affected</span>, <span class="va">total</span><span class="op">)</span> <span class="op">{</span></span>
<span><span class="va">interm_values</span> <span class="op">&lt;-</span> <span class="fu">get_RS_adj_val</span><span class="op">(</span><span class="va">group</span>, <span class="va">replicate</span>, <span class="va">affected</span>, <span class="va">total</span><span class="op">)</span></span>
<span><span class="va">Z</span> <span class="op">&lt;-</span> <span class="fu">get_CA_Z</span><span class="op">(</span><span class="va">interm_values</span><span class="op">$</span><span class="va">x_tilde</span>, <span class="va">interm_values</span><span class="op">$</span><span class="va">n_tilde</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>interm_values <span class="op">=</span> <span class="va">interm_values</span>, Z <span class="op">=</span> <span class="va">Z</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"dat_ptz"</span><span class="op">)</span></span>
<span><span class="co">#summarize data</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/lm.ridge.html" class="external-link">select</a></span><span class="op">(</span><span class="va">dat_ptz</span>, <span class="va">tmt</span>, <span class="va">tank</span>, <span class="va">S0</span>, <span class="va">S1</span>, <span class="va">S2</span>, <span class="va">S3</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">tmt</th>
<th align="left">tank</th>
<th align="right">S0</th>
<th align="right">S1</th>
<th align="right">S2</th>
<th align="right">S3</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">C</td>
<td align="left">5A</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">C</td>
<td align="left">5B</td>
<td align="right">3</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">C</td>
<td align="left">5C</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">C</td>
<td align="left">5D</td>
<td align="right">2</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">SC</td>
<td align="left">4A</td>
<td align="right">1</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">SC</td>
<td align="left">4B</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">SC</td>
<td align="left">4C</td>
<td align="right">1</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">SC</td>
<td align="left">4D</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">T1</td>
<td align="left">3A</td>
<td align="right">4</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">T1</td>
<td align="left">3B</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">T1</td>
<td align="left">3C</td>
<td align="right">4</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">T1</td>
<td align="left">3D</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">T2</td>
<td align="left">2A</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">T2</td>
<td align="left">2B</td>
<td align="right">2</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">T2</td>
<td align="left">2C</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">T2</td>
<td align="left">2D</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">T3</td>
<td align="left">1A</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">T3</td>
<td align="left">1B</td>
<td align="right">4</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">T3</td>
<td align="left">1C</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">T3</td>
<td align="left">1D</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">3</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create control only data set</span></span>
<span><span class="va">cdat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">dat_ptz</span>, <span class="va">tmt</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"C"</span>, <span class="st">"SC"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Slice S1</span></span>
<span><span class="va">ctrl_s1_p</span> <span class="op">&lt;-</span> <span class="fu">run_RSCA</span><span class="op">(</span><span class="va">cdat</span><span class="op">$</span><span class="va">tmt</span>, <span class="va">cdat</span><span class="op">$</span><span class="va">tank</span>, <span class="va">cdat</span><span class="op">$</span><span class="va">S0</span>, <span class="va">cdat</span><span class="op">$</span><span class="va">total</span><span class="op">)</span><span class="op">$</span><span class="va">Z</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">pnorm</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span><span class="fu">`-`</span><span class="op">(</span><span class="fl">1</span>, <span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span><span class="fu">`*`</span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co"># slice S2</span></span>
<span><span class="va">ctrl_s2_p</span> <span class="op">&lt;-</span> <span class="fu">run_RSCA</span><span class="op">(</span><span class="va">cdat</span><span class="op">$</span><span class="va">tmt</span>, <span class="va">cdat</span><span class="op">$</span><span class="va">tank</span>, <span class="va">cdat</span><span class="op">$</span><span class="va">S0_1</span>, <span class="va">cdat</span><span class="op">$</span><span class="va">total</span><span class="op">)</span><span class="op">$</span><span class="va">Z</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">pnorm</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span><span class="fu">`-`</span><span class="op">(</span><span class="fl">1</span>, <span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span><span class="fu">`*`</span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># slice S3</span></span>
<span><span class="va">ctrl_s3_p</span> <span class="op">&lt;-</span> <span class="fu">run_RSCA</span><span class="op">(</span><span class="va">cdat</span><span class="op">$</span><span class="va">tmt</span>, <span class="va">cdat</span><span class="op">$</span><span class="va">tank</span>, <span class="va">cdat</span><span class="op">$</span><span class="va">S0_2</span>, <span class="va">cdat</span><span class="op">$</span><span class="va">total</span><span class="op">)</span><span class="op">$</span><span class="va">Z</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">pnorm</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span><span class="fu">`-`</span><span class="op">(</span><span class="fl">1</span>, <span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span><span class="fu">`*`</span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co"># combine control treatments</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">dat_ptz</span>, tmt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">tmt</span> <span class="op">==</span> <span class="st">"SC"</span>, <span class="st">"C"</span>, <span class="va">tmt</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># summary data frame</span></span>
<span><span class="va">dat_sum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">dat</span>, <span class="va">tmt</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="va">S0</span><span class="op">:</span><span class="va">total</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Slice S1</span></span>
<span><span class="va">s1_p</span> <span class="op">&lt;-</span> <span class="fu">run_RSCA</span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">tmt</span>, <span class="va">dat</span><span class="op">$</span><span class="va">tank</span>, <span class="va">dat</span><span class="op">$</span><span class="va">total</span><span class="op">-</span><span class="va">dat</span><span class="op">$</span><span class="va">S0</span>, <span class="va">dat</span><span class="op">$</span><span class="va">total</span><span class="op">)</span><span class="op">$</span><span class="va">Z</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">pnorm</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">dat1</span><span class="op">&lt;-</span> <span class="va">dat_ptz</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span><span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">tmt</span><span class="op">!=</span><span class="st">"SC"</span><span class="op">)</span></span>
<span><span class="va">dat2</span> <span class="op">&lt;-</span>  <span class="va">dat_ptz</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span><span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">tmt</span><span class="op">!=</span><span class="st">"C"</span><span class="op">)</span></span>
<span><span class="va">s1c_p</span> <span class="op">&lt;-</span> <span class="fu">run_RSCA</span><span class="op">(</span><span class="va">dat1</span><span class="op">$</span><span class="va">tmt</span>, <span class="va">dat1</span><span class="op">$</span><span class="va">tank</span>, <span class="va">dat1</span><span class="op">$</span><span class="va">S0</span>, <span class="va">dat1</span><span class="op">$</span><span class="va">total</span><span class="op">)</span><span class="op">$</span><span class="va">Z</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">pnorm</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">s1c_p</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.11</span></span></code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s1sc_p</span> <span class="op">&lt;-</span> <span class="fu">run_RSCA</span><span class="op">(</span><span class="va">dat2</span><span class="op">$</span><span class="va">tmt</span>, <span class="va">dat2</span><span class="op">$</span><span class="va">tank</span>, <span class="va">dat2</span><span class="op">$</span><span class="va">S0</span>, <span class="va">dat2</span><span class="op">$</span><span class="va">total</span><span class="op">)</span><span class="op">$</span><span class="va">Z</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">pnorm</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">s1sc_p</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.74</span></span></code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># table for slice 1</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">dat_sum</span>, `S1-S3` <span class="op">=</span> <span class="va">total</span> <span class="op">-</span> <span class="va">S0</span>,</span>
<span>Percent <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">`S1-S3`</span><span class="op">/</span><span class="va">total</span><span class="op">*</span><span class="fl">100</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">tmt</span>, <span class="va">S0</span>, <span class="va">`S1-S3`</span>, <span class="va">Percent</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">tmt</th>
<th align="right">S0</th>
<th align="right">S1-S3</th>
<th align="right">Percent</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">C</td>
<td align="right">16</td>
<td align="right">14</td>
<td align="right">47</td>
</tr>
<tr class="even">
<td align="left">T1</td>
<td align="right">13</td>
<td align="right">3</td>
<td align="right">19</td>
</tr>
<tr class="odd">
<td align="left">T2</td>
<td align="right">9</td>
<td align="right">6</td>
<td align="right">40</td>
</tr>
<tr class="even">
<td align="left">T3</td>
<td align="right">8</td>
<td align="right">8</td>
<td align="right">50</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># slice S2</span></span>
<span><span class="va">s2_p</span> <span class="op">&lt;-</span> <span class="fu">run_RSCA</span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">tmt</span>, <span class="va">dat</span><span class="op">$</span><span class="va">tank</span>, <span class="va">dat</span><span class="op">$</span><span class="va">S0_1</span>, <span class="va">dat</span><span class="op">$</span><span class="va">total</span><span class="op">)</span><span class="op">$</span><span class="va">Z</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">pnorm</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">run_RSCA</span><span class="op">(</span><span class="va">dat1</span><span class="op">$</span><span class="va">tmt</span>, <span class="va">dat1</span><span class="op">$</span><span class="va">tank</span>, <span class="va">dat1</span><span class="op">$</span><span class="va">S0_1</span>, <span class="va">dat1</span><span class="op">$</span><span class="va">total</span><span class="op">)</span><span class="op">$</span><span class="va">Z</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">pnorm</a></span><span class="op">(</span><span class="op">)</span> </span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.04713206</span></span></code></pre>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">run_RSCA</span><span class="op">(</span><span class="va">dat2</span><span class="op">$</span><span class="va">tmt</span>, <span class="va">dat2</span><span class="op">$</span><span class="va">tank</span>, <span class="va">dat2</span><span class="op">$</span><span class="va">S0_1</span>, <span class="va">dat2</span><span class="op">$</span><span class="va">total</span><span class="op">)</span><span class="op">$</span><span class="va">Z</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">pnorm</a></span><span class="op">(</span><span class="op">)</span> </span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.07900702</span></span></code></pre>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># table for slice 2</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">dat_sum</span>, `S0-S1` <span class="op">=</span> <span class="va">S0</span> <span class="op">+</span> <span class="va">S1</span>, `S2-S3` <span class="op">=</span> <span class="va">S2</span> <span class="op">+</span> <span class="va">S3</span>,</span>
<span>Percent <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">`S2-S3`</span><span class="op">/</span><span class="va">total</span><span class="op">*</span><span class="fl">100</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/lm.ridge.html" class="external-link">select</a></span><span class="op">(</span><span class="va">tmt</span>, <span class="va">`S0-S1`</span>, <span class="va">`S2-S3`</span>, <span class="va">Percent</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">tmt</th>
<th align="right">S0-S1</th>
<th align="right">S2-S3</th>
<th align="right">Percent</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">C</td>
<td align="right">25</td>
<td align="right">5</td>
<td align="right">17</td>
</tr>
<tr class="even">
<td align="left">T1</td>
<td align="right">15</td>
<td align="right">1</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">T2</td>
<td align="right">11</td>
<td align="right">4</td>
<td align="right">27</td>
</tr>
<tr class="even">
<td align="left">T3</td>
<td align="right">10</td>
<td align="right">6</td>
<td align="right">38</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># slice S3</span></span>
<span><span class="va">s3_p</span> <span class="op">&lt;-</span> <span class="fu">run_RSCA</span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">tmt</span>, <span class="va">dat</span><span class="op">$</span><span class="va">tank</span>, <span class="va">dat</span><span class="op">$</span><span class="va">S0_2</span>, <span class="va">dat</span><span class="op">$</span><span class="va">total</span><span class="op">)</span><span class="op">$</span><span class="va">Z</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">pnorm</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">run_RSCA</span><span class="op">(</span><span class="va">dat1</span><span class="op">$</span><span class="va">tmt</span>, <span class="va">dat1</span><span class="op">$</span><span class="va">tank</span>, <span class="va">dat1</span><span class="op">$</span><span class="va">S0_2</span>, <span class="va">dat1</span><span class="op">$</span><span class="va">total</span><span class="op">)</span><span class="op">$</span><span class="va">Z</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">pnorm</a></span><span class="op">(</span><span class="op">)</span> </span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.08706086</span></span></code></pre>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">run_RSCA</span><span class="op">(</span><span class="va">dat2</span><span class="op">$</span><span class="va">tmt</span>, <span class="va">dat2</span><span class="op">$</span><span class="va">tank</span>, <span class="va">dat2</span><span class="op">$</span><span class="va">S0_2</span>, <span class="va">dat2</span><span class="op">$</span><span class="va">total</span><span class="op">)</span><span class="op">$</span><span class="va">Z</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">pnorm</a></span><span class="op">(</span><span class="op">)</span> </span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.1304879</span></span></code></pre>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># table for slice 3</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">dat_sum</span>, `S0-S2` <span class="op">=</span> <span class="va">S0</span> <span class="op">+</span> <span class="va">S1</span> <span class="op">+</span> <span class="va">S2</span>,</span>
<span>Percent <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">S3</span><span class="op">/</span><span class="va">total</span><span class="op">*</span><span class="fl">100</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/lm.ridge.html" class="external-link">select</a></span><span class="op">(</span><span class="va">tmt</span>, <span class="va">`S0-S2`</span>, <span class="va">S3</span>, <span class="va">Percent</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">tmt</th>
<th align="right">S0-S2</th>
<th align="right">S3</th>
<th align="right">Percent</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">C</td>
<td align="right">25</td>
<td align="right">5</td>
<td align="right">17</td>
</tr>
<tr class="even">
<td align="left">T1</td>
<td align="right">15</td>
<td align="right">1</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">T2</td>
<td align="right">13</td>
<td align="right">2</td>
<td align="right">13</td>
</tr>
<tr class="even">
<td align="left">T3</td>
<td align="right">10</td>
<td align="right">6</td>
<td align="right">38</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s1_p</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.484</span></span></code></pre>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s2_p</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.072</span></span></code></pre>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s3_p</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.161</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="check-with-runrscabs">Check with runRSCABS<a class="anchor" aria-label="anchor" href="#check-with-runrscabs"></a>
</h2>
<ul>
<li><p>Data: A standard data set in the tall format. Every row indicates
an organism. The data set must contain columns for the treatment level
and every tested histological endpoint.</p></li>
<li><p>Treatment: The name of the column that contains the information
about the treatment level. Increasing values indicate higher
treatments.</p></li>
<li><p>Replicate: The name of the column that contains the information
about the replicate structure. If the replicate is not specified this
will default to running “CA” as the test type.</p></li>
<li><p>Effects: The endpoint to be tested. Defaults to all columns that
have integers less then 20. The analysis assumes that higher scores
indicate a worse outcome.</p></li>
<li><p>test.type: Indicate the type of analysis to be performed. Use
“RS” to select the Rao-Scott adjustment to the Cochran-Armitage test and
“CA” to ignore the adjustment.</p></li>
</ul>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">genIndividual</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">Score</span>,<span class="va">count</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">count</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Score1<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"S"</span>,<span class="st">""</span>,<span class="va">Score</span><span class="op">)</span>,<span class="va">count</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="kw">else</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">ptz1</span> <span class="op">&lt;-</span> <span class="va">ptz</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>individual<span class="op">=</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">map2</a></span><span class="op">(</span><span class="va">Score</span>,<span class="va">count</span>,<span class="va">genIndividual</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">individual</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ptz1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">ptz1</span><span class="op">)</span></span>
<span><span class="va">ptz2</span> <span class="op">&lt;-</span> <span class="va">ptz1</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"trt"</span>,<span class="st">"tank"</span>,<span class="st">"Score1"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">ptz2</span><span class="op">$</span><span class="va">trt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">ptz2</span><span class="op">$</span><span class="va">trt</span><span class="op">)</span></span>
<span><span class="va">ptz2</span><span class="op">$</span><span class="va">Score1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">ptz2</span><span class="op">$</span><span class="va">Score1</span><span class="op">)</span></span>
<span><span class="va">ptz2</span><span class="op">$</span><span class="va">S2</span> <span class="op">&lt;-</span> <span class="va">ptz2</span><span class="op">$</span><span class="va">Score1</span><span class="op">+</span><span class="fl">5</span></span>
<span><span class="fu"><a href="../reference/runRSCABS.html">runRSCABS</a></span><span class="op">(</span><span class="va">ptz2</span>,<span class="st">'trt'</span>,<span class="st">'tank'</span>,test.type<span class="op">=</span><span class="st">'RS'</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##     Effect Treatment R.Score   Statistic    P.Value Signif</span></span>
<span><span class="co">## 1  Score11         4       1 -0.03982353 0.48411691      .</span></span>
<span><span class="co">## 2  Score11         4       1 -0.03982353 0.48411691      .</span></span>
<span><span class="co">## 3  Score12         4       2  1.45886196 0.07230155      .</span></span>
<span><span class="co">## 4  Score12         4       2  1.45886196 0.07230155      .</span></span>
<span><span class="co">## 5  Score13         4       3  0.99006850 0.16107032      .</span></span>
<span><span class="co">## 6  Score13         4       3  0.99006850 0.16107032      .</span></span>
<span><span class="co">## 7      S26         4       6 -0.03982353 0.48411691      .</span></span>
<span><span class="co">## 8      S26         4       6 -0.03982353 0.48411691      .</span></span>
<span><span class="co">## 9      S27         4       7  1.45886196 0.07230155      .</span></span>
<span><span class="co">## 10     S27         4       7  1.45886196 0.07230155      .</span></span>
<span><span class="co">## 11     S28         4       8  0.99006850 0.16107032      .</span></span>
<span><span class="co">## 12     S28         4       8  0.99006850 0.16107032      .</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="alternative-approach">Alternative Approach<a class="anchor" aria-label="anchor" href="#alternative-approach"></a>
</h2>
<div class="section level3">
<h3 id="a-nonparametric-approach-based-on-relative-effect-size">1. A nonparametric approach based on relative effect size<a class="anchor" aria-label="anchor" href="#a-nonparametric-approach-based-on-relative-effect-size"></a>
</h3>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">nparcomp</span><span class="op">)</span></span>
<span><span class="va">res1</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/nparcomp/man/nparcomp.html" class="external-link">nparcomp</a></span><span class="op">(</span><span class="va">Score1</span> <span class="op">~</span> <span class="va">trt</span>, data<span class="op">=</span><span class="va">ptz2</span>, asy.method <span class="op">=</span> <span class="st">"mult.t"</span>,</span>
<span>type <span class="op">=</span> <span class="st">"Dunnett"</span>, info <span class="op">=</span> <span class="cn">FALSE</span>,plot.simci <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">res1</span><span class="op">)</span> <span class="co"># Reveal the adjusted p-values</span></span>
<span><span class="va">res1</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/nparcomp/man/nparcomp.html" class="external-link">nparcomp</a></span><span class="op">(</span><span class="va">Score1</span> <span class="op">~</span> <span class="va">trt</span>, data<span class="op">=</span><span class="va">ptz2</span>, asy.method <span class="op">=</span> <span class="st">"mult.t"</span>,</span>
<span>type <span class="op">=</span> <span class="st">"Williams"</span>,alternative <span class="op">=</span> <span class="st">"greater"</span>,info <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">res1</span><span class="op">)</span> <span class="co"># Reveal the adjusted p-values</span></span>
<span></span>
<span><span class="va">plot.nparcomp.zg</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> </span>
<span><span class="op">{</span></span>
<span>  <span class="va">nc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">connames</span><span class="op">)</span></span>
<span>  <span class="va">text.Ci</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">input</span><span class="op">$</span><span class="va">conf.level</span> <span class="op">*</span> <span class="fl">100</span>, <span class="st">"%"</span>, <span class="st">"Simultaneous Confidence Intervals"</span><span class="op">)</span></span>
<span>  <span class="va">Lowerp</span> <span class="op">&lt;-</span> <span class="st">"|"</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">Analysis</span><span class="op">$</span><span class="va">Estimator</span>, <span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">nc</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fl">15</span>, </span>
<span>    axes <span class="op">=</span> <span class="cn">FALSE</span>, xlab <span class="op">=</span> <span class="st">""</span>, ylab <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">Analysis</span><span class="op">$</span><span class="va">Lower</span>, <span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">nc</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span>, pch <span class="op">=</span> <span class="va">Lowerp</span>, font <span class="op">=</span> <span class="fl">2</span>, cex <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">Analysis</span><span class="op">$</span><span class="va">Upper</span>, <span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">nc</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span>, pch <span class="op">=</span> <span class="va">Lowerp</span>, font <span class="op">=</span> <span class="fl">2</span>, cex <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fl">0.5</span>, lty <span class="op">=</span> <span class="fl">3</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">ss</span> <span class="kw">in</span> <span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">nc</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html" class="external-link">polygon</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">Analysis</span><span class="op">$</span><span class="va">Lower</span><span class="op">[</span><span class="va">ss</span><span class="op">]</span>, <span class="va">x</span><span class="op">$</span><span class="va">Analysis</span><span class="op">$</span><span class="va">Upper</span><span class="op">[</span><span class="va">ss</span><span class="op">]</span><span class="op">)</span>, </span>
<span>      y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">ss</span>, <span class="va">ss</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">1</span>, at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">2</span>, at <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">nc</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"tmp"</span>,<span class="va">x</span><span class="op">$</span><span class="va">connames</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shinydashboard/man/box.html" class="external-link">box</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span>main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">text.Ci</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Type of Contrast:"</span>, <span class="va">x</span><span class="op">$</span><span class="va">input</span><span class="op">$</span><span class="va">type</span><span class="op">)</span>, </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Method:"</span>, <span class="va">x</span><span class="op">$</span><span class="va">AsyMethod</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>oma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">7</span>,<span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span>,mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">3</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="fu">plot.nparcomp.zg</span><span class="op">(</span><span class="va">res1</span><span class="op">)</span> <span class="co"># Plot simultaneous confidence limits</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="simple-transformation-model">2. Simple transformation model<a class="anchor" aria-label="anchor" href="#simple-transformation-model"></a>
</h3>
</div>
<div class="section level3">
<h3 id="glm">3. GLM<a class="anchor" aria-label="anchor" href="#glm"></a>
</h3>
</div>
<div class="section level3">
<h3 id="cumulative-link-model">4. Cumulative link model<a class="anchor" aria-label="anchor" href="#cumulative-link-model"></a>
</h3>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/runehaubo/ordinal" class="external-link">ordinal</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">ptz3</span> <span class="op">&lt;-</span> <span class="va">ptz2</span></span>
<span><span class="va">ptz3</span><span class="op">$</span><span class="va">trt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">ptz3</span><span class="op">$</span><span class="va">trt</span><span class="op">)</span></span>
<span><span class="va">ptz3</span><span class="op">$</span><span class="va">Score1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">ptz2</span><span class="op">$</span><span class="va">Score1</span><span class="op">)</span></span>
<span><span class="va">modCLM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ordinal/man/clm.html" class="external-link">clm</a></span><span class="op">(</span><span class="va">Score1</span> <span class="op">~</span> <span class="va">trt</span>, data<span class="op">=</span><span class="va">ptz3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">propCI</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">modCLM</span>, level<span class="op">=</span><span class="fl">1</span><span class="op">-</span><span class="fl">0.05</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="co"># Bonferroni odds ratio CI</span></span></code></pre></div>
<p>A new permutation test for analyzing histopathologic findings with
severity based on their decomposition into multiple correlated
proportions for multiple Dunnett or Williams-type contrasts is
presented. The focus is on problem-adequate interpretation and use for
small ni designs with possibly reduced variance in the control. An
asymptotic variant for simple quasilinear models is also available,
allowing a wide class of possible dose-response dependencies to be
evaluated. Due to the use of the CRAN packages coin, tukeytrend and
multcomp, the evaluation of real data is relatively easy. The next
future work is simulation for small ni designs with different data
conditions up to zero-variance in the control.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="http://coin.r-forge.r-project.org" class="external-link">"coin"</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required package: survival</span></span></code></pre>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="http://multcomp.R-forge.R-project.org" class="external-link">"multcomp"</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required package: mvtnorm</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: TH.data</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'TH.data'</span></span></code></pre>
<pre><code><span><span class="co">## The following object is masked from 'package:MASS':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     geyser</span></span></code></pre>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Co1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/pkg/coin/man/Transformations.html" class="external-link">trafo</a></span><span class="op">(</span><span class="va">data</span>, factor_trafo <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="op">~</span><span class="va">x</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/multcomp/man/contrMat.html" class="external-link">contrMat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="st">"Dunnett"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ptz2</span> <span class="op">&lt;-</span> <span class="va">ptz2</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>EP1<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">Score1</span><span class="op">&gt;</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span>,EP2<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">Score1</span><span class="op">&gt;</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span>,EP3<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">Score1</span><span class="op">&gt;</span><span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Codu</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/coin/man/IndependenceTest.html" class="external-link">independence_test</a></span><span class="op">(</span><span class="va">EP1</span> <span class="op">+</span><span class="va">EP2</span><span class="op">+</span><span class="va">EP3</span><span class="op">~</span> <span class="va">trt</span>, data <span class="op">=</span> <span class="va">ptz2</span>, teststat <span class="op">=</span> <span class="st">"maximum"</span>,</span>
<span>distribution <span class="op">=</span> <span class="st">"approximate"</span>, xtrafo<span class="op">=</span><span class="va">Co1</span>, alternative<span class="op">=</span><span class="st">"greater"</span><span class="op">)</span></span>
<span><span class="va">Codu</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/coin/man/IndependenceTest.html" class="external-link">independence_test</a></span><span class="op">(</span><span class="va">EP1</span> <span class="op">+</span><span class="va">EP2</span><span class="op">+</span><span class="va">EP3</span><span class="op">~</span> <span class="va">trt</span>, data <span class="op">=</span> <span class="va">ptz2</span>, teststat <span class="op">=</span> <span class="st">"maximum"</span>,</span>
<span>distribution <span class="op">=</span> <span class="st">"approximate"</span>, xtrafo<span class="op">=</span><span class="va">Co1</span>, alternative<span class="op">=</span><span class="st">"less"</span><span class="op">)</span></span>
<span><span class="va">pvalCODU</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/coin/man/pvalue-methods.html" class="external-link">pvalue</a></span><span class="op">(</span><span class="va">Codu</span>, method<span class="op">=</span><span class="st">"single-step"</span><span class="op">)</span></span>
<span><span class="va">pvalCODU</span></span></code></pre></div>
<pre><code><span><span class="co">##            EP1    EP2    EP3</span></span>
<span><span class="co">## T1 - PC 0.2116 0.7569 0.6812</span></span>
<span><span class="co">## T2 - PC 0.6440 0.9817 0.8595</span></span>
<span><span class="co">## T3 - PC 0.8492 0.9986 0.9979</span></span></code></pre>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CoW</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/pkg/coin/man/Transformations.html" class="external-link">trafo</a></span><span class="op">(</span><span class="va">data</span>, factor_trafo <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="op">~</span><span class="va">x</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/multcomp/man/contrMat.html" class="external-link">contrMat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="st">"Williams"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Cowi</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/coin/man/IndependenceTest.html" class="external-link">independence_test</a></span><span class="op">(</span><span class="va">EP1</span> <span class="op">+</span><span class="va">EP2</span><span class="op">+</span><span class="va">EP3</span><span class="op">~</span> <span class="va">trt</span>, data <span class="op">=</span> <span class="va">ptz2</span>, teststat <span class="op">=</span> <span class="st">"maximum"</span>,</span>
<span>distribution <span class="op">=</span> <span class="st">"approximate"</span>, xtrafo<span class="op">=</span><span class="va">CoW</span>, alternative<span class="op">=</span><span class="st">"greater"</span><span class="op">)</span></span>
<span><span class="va">pvalCOWI</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/coin/man/pvalue-methods.html" class="external-link">pvalue</a></span><span class="op">(</span><span class="va">Cowi</span>, method<span class="op">=</span><span class="st">"single-step"</span><span class="op">)</span></span>
<span><span class="va">pvalCOWI</span></span></code></pre></div>
<pre><code><span><span class="co">##        EP1    EP2    EP3</span></span>
<span><span class="co">## C 1 0.8069 0.2185 0.2484</span></span>
<span><span class="co">## C 2 0.8631 0.2731 0.4650</span></span>
<span><span class="co">## C 3 0.9581 0.5024 0.6493</span></span></code></pre>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">exampleHistData</span><span class="op">)</span></span>
<span><span class="va">subIndex</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">exampleHistData</span><span class="op">$</span><span class="va">Generation</span><span class="op">==</span><span class="st">"F1"</span> <span class="op">&amp;</span></span>
<span><span class="va">exampleHistData</span><span class="op">$</span><span class="va">Genotypic_Sex</span><span class="op">==</span><span class="st">"Male"</span> <span class="op">&amp;</span></span>
<span><span class="va">exampleHistData</span><span class="op">$</span><span class="va">Age</span><span class="op">==</span><span class="st">"8_wk"</span><span class="op">)</span></span>
<span><span class="va">LH</span><span class="op">&lt;-</span><span class="va">exampleHistData</span><span class="op">[</span><span class="va">subIndex</span>, <span class="op">]</span></span>
<span><span class="va">lh</span><span class="op">&lt;-</span><span class="va">LH</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">6</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">lh</span><span class="op">$</span><span class="va">Gon</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">lh</span><span class="op">$</span><span class="va">Gon_Phenotype</span><span class="op">)</span></span>
<span><span class="va">lh</span><span class="op">$</span><span class="va">EP1</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">lh</span><span class="op">$</span><span class="va">Gon</span> <span class="op">&gt;</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">lh</span><span class="op">$</span><span class="va">EP2</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">lh</span><span class="op">$</span><span class="va">Gon</span> <span class="op">&gt;</span><span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">lh</span><span class="op">$</span><span class="va">EP3</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">lh</span><span class="op">$</span><span class="va">Gon</span> <span class="op">&gt;</span><span class="fl">3</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">lh</span><span class="op">$</span><span class="va">treat</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">lh</span><span class="op">$</span><span class="va">Treatment</span><span class="op">)</span></span>
<span><span class="va">lhh</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="va">lh</span><span class="op">[</span><span class="va">lh</span><span class="op">$</span><span class="va">treat</span><span class="op">!=</span><span class="fl">6</span>, <span class="op">]</span><span class="op">)</span></span>
<span><span class="va">Lhh</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="va">lhh</span><span class="op">[</span><span class="va">lhh</span><span class="op">$</span><span class="va">treat</span><span class="op">!=</span><span class="fl">3</span>, <span class="op">]</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="http://coin.r-forge.r-project.org" class="external-link">"coin"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="http://multcomp.R-forge.R-project.org" class="external-link">"multcomp"</a></span><span class="op">)</span></span>
<span><span class="va">Co1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/pkg/coin/man/Transformations.html" class="external-link">trafo</a></span><span class="op">(</span><span class="va">data</span>, factor_trafo <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="op">~</span><span class="va">x</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/multcomp/man/contrMat.html" class="external-link">contrMat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="st">"Dunnett"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Codu</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/coin/man/IndependenceTest.html" class="external-link">independence_test</a></span><span class="op">(</span><span class="va">EP1</span> <span class="op">+</span><span class="va">EP2</span><span class="op">+</span><span class="va">EP3</span><span class="op">~</span> <span class="va">treat</span>, data <span class="op">=</span> <span class="va">Lhh</span>, teststat <span class="op">=</span> <span class="st">"maximum"</span>,</span>
<span>distribution <span class="op">=</span> <span class="st">"approximate"</span>, xtrafo<span class="op">=</span><span class="va">Co1</span>, alternative<span class="op">=</span><span class="st">"greater"</span><span class="op">)</span></span>
<span><span class="va">pvalCODU</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/coin/man/pvalue-methods.html" class="external-link">pvalue</a></span><span class="op">(</span><span class="va">Codu</span>, method<span class="op">=</span><span class="st">"single-step"</span><span class="op">)</span></span>
<span><span class="va">pvalCODU</span></span></code></pre></div>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CoW</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/pkg/coin/man/Transformations.html" class="external-link">trafo</a></span><span class="op">(</span><span class="va">data</span>, factor_trafo <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="op">~</span><span class="va">x</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/multcomp/man/contrMat.html" class="external-link">contrMat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="st">"Williams"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Cowi</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/coin/man/IndependenceTest.html" class="external-link">independence_test</a></span><span class="op">(</span><span class="va">EP1</span> <span class="op">+</span><span class="va">EP2</span><span class="op">+</span><span class="va">EP3</span><span class="op">~</span> <span class="va">treat</span>, data <span class="op">=</span> <span class="va">Lhh</span>, teststat <span class="op">=</span> <span class="st">"maximum"</span>,</span>
<span>distribution <span class="op">=</span> <span class="st">"approximate"</span>, xtrafo<span class="op">=</span><span class="va">CoW</span>, alternative<span class="op">=</span><span class="st">"greater"</span><span class="op">)</span></span>
<span><span class="va">pvalCOWI</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/coin/man/pvalue-methods.html" class="external-link">pvalue</a></span><span class="op">(</span><span class="va">Cowi</span>, method<span class="op">=</span><span class="st">"single-step"</span><span class="op">)</span></span>
<span><span class="va">pvalCOWI</span></span></code></pre></div>
<p>Monotone increasing trends exist for any category, whereas the
strongest for 1, (2,3,5).</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Adu</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/coin/man/IndependenceTest.html" class="external-link">independence_test</a></span><span class="op">(</span><span class="va">Gon</span><span class="op">+</span><span class="va">EP1</span> <span class="op">+</span><span class="va">EP2</span><span class="op">+</span><span class="va">EP3</span><span class="op">~</span> <span class="va">treat</span>, data <span class="op">=</span> <span class="va">Lhh</span>, teststat <span class="op">=</span> <span class="st">"maximum"</span>,</span>
<span>distribution <span class="op">=</span> <span class="st">"approximate"</span>, xtrafo<span class="op">=</span><span class="va">Co1</span>, alternative<span class="op">=</span><span class="st">"greater"</span><span class="op">)</span></span>
<span><span class="va">pvalADU</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/coin/man/pvalue-methods.html" class="external-link">pvalue</a></span><span class="op">(</span><span class="va">Adu</span>, method<span class="op">=</span><span class="st">"single-step"</span><span class="op">)</span></span>
<span><span class="va">pvalADU</span></span></code></pre></div>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="http://coin.r-forge.r-project.org" class="external-link">"coin"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="http://multcomp.R-forge.R-project.org" class="external-link">"multcomp"</a></span><span class="op">)</span></span>
<span><span class="va">green</span><span class="op">$</span><span class="va">treat</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">green</span><span class="op">$</span><span class="va">Dose</span><span class="op">)</span></span>
<span><span class="va">Co1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/pkg/coin/man/Transformations.html" class="external-link">trafo</a></span><span class="op">(</span><span class="va">data</span>, factor_trafo <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="op">~</span><span class="va">x</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/multcomp/man/contrMat.html" class="external-link">contrMat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="st">"Dunnett"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">gCodu</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/coin/man/IndependenceTest.html" class="external-link">independence_test</a></span><span class="op">(</span><span class="va">S12</span> <span class="op">+</span><span class="va">S23</span><span class="op">~</span> <span class="va">treat</span>, data <span class="op">=</span> <span class="va">green</span>, teststat <span class="op">=</span> <span class="st">"maximum"</span>,</span>
<span>distribution <span class="op">=</span> <span class="st">"approximate"</span>, xtrafo<span class="op">=</span><span class="va">Co1</span>, alternative<span class="op">=</span><span class="st">"greater"</span><span class="op">)</span></span>
<span><span class="va">pvalGCODU</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/coin/man/pvalue-methods.html" class="external-link">pvalue</a></span><span class="op">(</span><span class="va">gCodu</span>, method<span class="op">=</span><span class="st">"single-step"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="validation-by-sas">Validation by SAS<a class="anchor" aria-label="anchor" href="#validation-by-sas"></a>
</h2>
<pre><code>[Yesterday 20:11] Chen Meng

Hi Zhenglei, I was able to verify the last two p-values 0.072 and 0.161.
[Yesterday 20:11] Chen Meng
however for the first one, the p-value generated by SAS is 0.484</code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Zhenglei Gao.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
