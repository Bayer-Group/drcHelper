<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Equivalence Testing • drcHelper</title>
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Equivalence Testing">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">drcHelper</a>

    <small class="nav-text text-default me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.0.4.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-get-started" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Get Started</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-get-started">
<li><a class="dropdown-item" href="../articles/Introduction.html">Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/drcHelper.html">Example ECx Helper Functions Usage</a></li>
    <li><a class="dropdown-item" href="../articles/Dunnetts_Test_for_Data_with_Hierarchical_Structure.html">Example NOEC Helper Functions Usage</a></li>
    <li><a class="dropdown-item" href="../articles/Examples_drc.html">Using DRC and BMD</a></li>
    <li><a class="dropdown-item" href="../articles/Examples_oecd201.html">Example DRC - OECD 201</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-regulatory-stats" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Regulatory Stats</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-regulatory-stats">
<li><a class="dropdown-item" href="../articles/NOEC_Methods.html">NOEC Calculations</a></li>
    <li><a class="dropdown-item" href="../articles/Limit-Test.html">Limit Test Calculations</a></li>
    <li><a class="dropdown-item" href="../articles/EFSA-Criteria.html">EFSA Criteria and Other Reliability Criteria</a></li>
    <li><a class="dropdown-item" href="../articles/Example_RSCABS.html">RSCABS</a></li>
    <li><a class="dropdown-item" href="../articles/Trend-Testing.html">Trend Testing</a></li>
    <li><a class="dropdown-item" href="../articles/NOEC_ECx_BMD.html">NOEC ECx and BMD</a></li>
  </ul>
</li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/core_statistical_methods.html">Core Statistical Methods Overview</a></li>
    <li><a class="dropdown-item" href="../articles/Quantal-Data.html">Quantal Data Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/Ordinal-Data.html">Ordinal Data Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/Count_Data.html">Count Data Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/LMM-GLMM-and-GAMM.html">LMM, GLMM, and GAMM Models</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/advanced_topics.html">Advanced Topics Overview</a></li>
    <li><a class="dropdown-item" href="../articles/Normality-Check.html">Normality Checks</a></li>
    <li><a class="dropdown-item" href="../articles/Binomial_Extra_Variance.html">Binomial Extra Variance</a></li>
    <li><a class="dropdown-item" href="../articles/Equivalence-Testing.html">Equivalence Testing</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/alternative_methods.html">Alternative Methods Overview</a></li>
    <li><a class="dropdown-item" href="../articles/Examples%20using%20NLS.html">NLS Examples</a></li>
    <li><a class="dropdown-item" href="../articles/Examples_using_drda.html">DRDA Examples</a></li>
    <li><a class="dropdown-item" href="../articles/TSK_method.html">TSK Method</a></li>
    <li><a class="dropdown-item" href="../articles/MQJT.html">MQJT</a></li>
    <li><a class="dropdown-item" href="../articles/Advanced_Fitting-a-biphasic-dose-reponse-model.html">Biphasic Dose Response Models</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-validation" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Validation</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-validation">
<li><a class="dropdown-item" href="../articles/System_Testing.html">System Testing</a></li>
    <li><a class="dropdown-item" href="../articles/val_ED_plus.html">ED Calculation Consistency</a></li>
    <li><a class="dropdown-item" href="../articles/TSK-and-Probit-Models.html">TSK and Probit Model</a></li>
    <li><a class="dropdown-item" href="../articles/Verification_which_JT.html">Which JT test to use</a></li>
    <li><a class="dropdown-item" href="../articles/Test-Guidelines.html">Study Types and Templates</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Bayer-Group/drcHelper/issues/new?template=Blank+issue" aria-label="New Issue"><span class="fa fa-bug"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Bayer-Group/drcHelper" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Equivalence Testing</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Bayer-Group/drcHelper/blob/main/vignettes/articles/Equivalence-Testing.Rmd" class="external-link"><code>vignettes/articles/Equivalence-Testing.Rmd</code></a></small>
      <div class="d-none name"><code>Equivalence-Testing.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bayer-group.github.io/drcHelper/index.html">drcHelper</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<p>In a nutshell, an equivalence test is conducted if you want to
provide strong support for the absence of a meaningful effect. A often
used procedure is two onse-sided tests. It means you need to be able to
reject two null hypothesis to conclude equivalence with some confidence.
Interestingly, we will be still using the same confidence intervals as
in difference testing, but need to use the 90% CI and need this CI to be
completely included in the predefined range of “no meaningful
differences”.</p>
<p>It should be noted that studies designed under the difference testing
framework would not be suitable for direct switch to equivalence test,
the power requirement is just different. Even though we are using a
narrower CI (from 95% to 90%), we need the entire CI fit inside the
predefined bounds, on the other hand, a difference test just require the
point of zero falling into the CI. Therefore, we would need a much
tighter CI so that the full length fits within.</p>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Equivalence testing is a statistical testing approach used to
determine whether two treatments or interventions produce effects that
are practically the same within a predefined margin of difference. This
method is particularly useful in fields like pharmaceuticals, where
demonstrating that a new drug is not worse than an existing one by more
than a specified margin is crucial.</p>
<p>Equivalence testing is closely related to difference testing. While
the latter focuses on identifying whether a difference exists by
controlling the false positive error, the former aims to show that any
difference is within a predefined acceptable range, by controlling the
false negative error in the difference testing scenario.</p>
<p>he design and interpretation of equivalence tests can be more complex
than traditional difference tests, requiring careful consideration of
the equivalence margin, which could be so called biologically relevant
effect size.</p>
<p>The null and alternative hypotheses in equivalence tests are</p>
<p><span class="math display">\[
H_0: | \mu_1 - \mu_0 | &gt; \Delta
\]</span> <span class="math display">\[
H_1: | \mu_1 - \mu_0 | \leq \Delta
\]</span> where <span class="math inline">\(\mu_1\)</span> and <span class="math inline">\(\mu_0\)</span> are the means of the two
treatments, and <span class="math inline">\(\Delta\)</span> is the
equivalence margin.</p>
<p>There are also non-inferiority or non-superiority cases, where the
nulls are <span class="math inline">\(\mu_1 - \mu_0 &lt;= -
\Delta\)</span> or <span class="math inline">\(\mu_1 - \mu_0 &gt;
\Delta\)</span></p>
<p>Sometimes the tests can be formulated on standardized differences or
means. Depending on how you frame the problem, the multiplicative model
for ratios-to-control comparisons could be used. Related approach is
available</p>
<p>The <span class="math inline">\(\alpha\)</span> level in equivalence
testing is the probability of making a Type I error, which occurs when
the null hypothesis is incorrectly rejected. This means concluding that
the treatments are equivalent when they are not.</p>
<p>The <span class="math inline">\(\beta\)</span> in difference testing
is the probability of making a Type II error, which occurs when the null
hypothesis is not rejected when it should be. This means failing to
detect a difference (concluding equivalence) when one actually
exists.</p>
<p>In equivalence testing, a low alpha level is crucial to ensure that
the conclusion of equivalence is reliable. Conversely, in difference
testing, a low beta level is important to ensure that a true difference
is detected.</p>
<p>On the other hand, the <span class="math inline">\(\alpha\)</span>
level in difference testing is playing similarly a complementary role to
the <span class="math inline">\(\beta\)</span> in equivalence
testing.</p>
</div>
<div class="section level2">
<h2 id="the-confusion">The Confusion<a class="anchor" aria-label="anchor" href="#the-confusion"></a>
</h2>
<p>If thinking from the confidence interval (CI) direction, the
equivalence testing uses the 90% CI for confidence level of 95% (<span class="math inline">\(\alpha = 0.05\)</span>). We illustrate it
here.</p>
<p>The switch from 95% to 90% confidence intervals in equivalence
testing is actually a simple mathematical approach to maintain an
overall 5% Type I error rate (95% confidence) in our conclusion about
equivalence.</p>
<ol style="list-style-type: decimal">
<li><p>In equivalence testing, we need to show that BOTH the upper and
lower bounds of our confidence interval fall within our predefined zone
of indifference.</p></li>
<li><p>When we use a 90% confidence interval, we have:</p></li>
</ol>
<ul>
<li>5% error probability in the upper tail</li>
<li>5% error probability in the lower tail</li>
<li>(Because 100% - 90% = 10%, split equally between two tails)</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li>For equivalence to be concluded, we need both bounds to fall within
our zone of indifference. The probability of this happening by chance
(if the treatments aren’t truly equivalent) is approximately 5%
because:</li>
</ol>
<ul>
<li>We multiply the probability of success for each bound (0.95 × 0.95 ≈
0.90)</li>
<li>This gives us 95% confidence in our overall conclusion about
equivalence</li>
</ul>
<p>So while we’re using a 90% confidence interval as our tool, the end
result gives us 95% confidence in our conclusion about equivalence. This
approach effectively controls the overall Type I error rate at the
traditional 5% level, maintaining the statistical rigor we expect in
hypothesis testing.</p>
<p>This is why equivalence testing protocols specifically call for 90%
confidence intervals - it’s not a reduction in our confidence standards,
but rather a mathematical adjustment to achieve the desired 95%
confidence in our final conclusion about equivalence.</p>
</div>
<div class="section level2">
<h2 id="impacts-of-changing-from-difference-to-equivalence-testing">Impacts of changing from difference to equivalence testing<a class="anchor" aria-label="anchor" href="#impacts-of-changing-from-difference-to-equivalence-testing"></a>
</h2>
<ul>
<li>Equivalence testing often requires larger sample sizes to achieve
sufficient power, which can be resource-intensive.</li>
<li>The design and interpretation of equivalence tests can be more
complex than traditional difference tests, requiring careful
consideration of the “equivalence margin”.</li>
</ul>
<div class="section level3">
<h3 id="hypothetical-examples">Hypothetical Examples<a class="anchor" aria-label="anchor" href="#hypothetical-examples"></a>
</h3>
<p>I will simulate a dose response</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bayer-group.github.io/drcHelper/index.html">drcHelper</a></span><span class="op">)</span></span>
<span><span class="va">n_doses</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="va">dose_range</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">20</span><span class="op">)</span></span>
<span><span class="co">## Define a threshold dose response</span></span>
<span><span class="va">threshold_idx</span>  <span class="op">&lt;-</span>  <span class="fl">3</span> <span class="co">## kind of global</span></span>
<span><span class="va">doses</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="va">dose_range</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">dose_range</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, length.out <span class="op">=</span> <span class="va">n_doses</span><span class="op">)</span></span>
<span><span class="va">response_fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dose</span>, <span class="va">max_effect</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">base_response</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">base_response</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">dose</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">threshold_dose</span> <span class="op">&lt;-</span> <span class="va">doses</span><span class="op">[</span><span class="va">threshold_idx</span><span class="op">]</span></span>
<span>  <span class="va">high_doses</span> <span class="op">&lt;-</span> <span class="va">dose</span> <span class="op">&gt;=</span> <span class="va">threshold_dose</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">high_doses</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">max_high_dose</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">doses</span><span class="op">)</span></span>
<span>    <span class="va">relative_position</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">dose</span><span class="op">[</span><span class="va">high_doses</span><span class="op">]</span> <span class="op">-</span> <span class="va">threshold_dose</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">max_high_dose</span> <span class="op">-</span> <span class="va">threshold_dose</span><span class="op">)</span></span>
<span>    <span class="va">result</span><span class="op">[</span><span class="va">high_doses</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">base_response</span> <span class="op">-</span> <span class="va">relative_position</span> <span class="op">*</span> <span class="va">max_effect</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="va">max_effect</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="va">sim_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_dose_response.html">simulate_dose_response</a></span><span class="op">(</span></span>
<span>  n_doses <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  dose_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">20</span><span class="op">)</span>,</span>
<span>  m_tanks <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  var_tank <span class="op">=</span> <span class="fl">3</span>,  <span class="co"># Pass the dose-specific variances, note here it should be a vector instead of a singe number.</span></span>
<span>  include_individuals <span class="op">=</span> <span class="cn">FALSE</span>,  <span class="co"># Tank-level data only</span></span>
<span>  response_function <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">dose</span><span class="op">)</span> <span class="fu">response_fn</span><span class="op">(</span><span class="va">dose</span>, <span class="va">max_effect</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/get_theme.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/prelimPlot3.html">prelimPlot3</a></span><span class="op">(</span><span class="va">sim_data</span><span class="op">)</span></span></code></pre></div>
<p><img src="Equivalence-Testing_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">Response</span><span class="op">~</span><span class="va">Dose</span>, data<span class="op">=</span><span class="va">sim_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Dose<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">Dose</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; lm(formula = Response ~ Dose, data = sim_data %&gt;% dplyr::mutate(Dose = factor(Dose)))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residuals:</span></span>
<span><span class="co">#&gt;     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">#&gt; -3.5719 -1.1151  0.0437  1.1540  4.5715 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept)  99.2355     0.6003 165.302  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; Dose5         0.4550     0.8490   0.536   0.5947    </span></span>
<span><span class="co">#&gt; Dose10        0.5505     0.8490   0.648   0.5200    </span></span>
<span><span class="co">#&gt; Dose15       -1.4720     0.8490  -1.734   0.0898 .  </span></span>
<span><span class="co">#&gt; Dose20       -4.0345     0.8490  -4.752 2.09e-05 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual standard error: 1.898 on 45 degrees of freedom</span></span>
<span><span class="co">#&gt; Multiple R-squared:  0.4789, Adjusted R-squared:  0.4325 </span></span>
<span><span class="co">#&gt; F-statistic: 10.34 on 4 and 45 DF,  p-value: 5.039e-06</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://multcomp.R-forge.R-project.org" class="external-link">multcomp</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/multcomp/man/glht.html" class="external-link">glht</a></span><span class="op">(</span><span class="va">mod</span>,linfct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/multcomp/man/glht.html" class="external-link">mcp</a></span><span class="op">(</span>Dose<span class="op">=</span><span class="st">"Dunnett"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Simultaneous Tests for General Linear Hypotheses</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Multiple Comparisons of Means: Dunnett Contrasts</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fit: lm(formula = Response ~ Dose, data = sim_data %&gt;% dplyr::mutate(Dose = factor(Dose)))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Linear Hypotheses:</span></span>
<span><span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; 5 - 0 == 0    0.4550     0.8490   0.536    0.954    </span></span>
<span><span class="co">#&gt; 10 - 0 == 0   0.5505     0.8490   0.648    0.915    </span></span>
<span><span class="co">#&gt; 15 - 0 == 0  -1.4720     0.8490  -1.734    0.258    </span></span>
<span><span class="co">#&gt; 20 - 0 == 0  -4.0345     0.8490  -4.752   &lt;0.001 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; (Adjusted p values reported -- single-step method)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/multcomp/man/glht.html" class="external-link">glht</a></span><span class="op">(</span><span class="va">mod</span>,linfct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/multcomp/man/glht.html" class="external-link">mcp</a></span><span class="op">(</span>Dose<span class="op">=</span><span class="st">"Dunnett"</span><span class="op">)</span>, alternative<span class="op">=</span><span class="st">"greater"</span>, rhs<span class="op">=</span><span class="op">-</span><span class="fl">10</span> <span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Simultaneous Tests for General Linear Hypotheses</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Multiple Comparisons of Means: Dunnett Contrasts</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fit: lm(formula = Response ~ Dose, data = sim_data %&gt;% dplyr::mutate(Dose = factor(Dose)))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Linear Hypotheses:</span></span>
<span><span class="co">#&gt;               Estimate Std. Error t value Pr(&gt;t)    </span></span>
<span><span class="co">#&gt; 5 - 0 &lt;= -10    0.4550     0.8490  12.315 &lt;1e-08 ***</span></span>
<span><span class="co">#&gt; 10 - 0 &lt;= -10   0.5505     0.8490  12.427 &lt;1e-08 ***</span></span>
<span><span class="co">#&gt; 15 - 0 &lt;= -10  -1.4720     0.8490  10.045 &lt;1e-08 ***</span></span>
<span><span class="co">#&gt; 20 - 0 &lt;= -10  -4.0345     0.8490   7.026 &lt;1e-08 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; (Adjusted p values reported -- single-step method)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/multcomp/man/glht.html" class="external-link">glht</a></span><span class="op">(</span><span class="va">mod</span>,linfct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/multcomp/man/glht.html" class="external-link">mcp</a></span><span class="op">(</span>Dose<span class="op">=</span><span class="st">"Dunnett"</span><span class="op">)</span>, alternative<span class="op">=</span><span class="st">"less"</span>, rhs<span class="op">=</span> <span class="fl">10</span> <span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Simultaneous Tests for General Linear Hypotheses</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Multiple Comparisons of Means: Dunnett Contrasts</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fit: lm(formula = Response ~ Dose, data = sim_data %&gt;% dplyr::mutate(Dose = factor(Dose)))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Linear Hypotheses:</span></span>
<span><span class="co">#&gt;              Estimate Std. Error t value Pr(&lt;t)    </span></span>
<span><span class="co">#&gt; 5 - 0 &gt;= 10    0.4550     0.8490  -11.24 &lt;1e-10 ***</span></span>
<span><span class="co">#&gt; 10 - 0 &gt;= 10   0.5505     0.8490  -11.13 &lt;1e-10 ***</span></span>
<span><span class="co">#&gt; 15 - 0 &gt;= 10  -1.4720     0.8490  -13.51 &lt;1e-10 ***</span></span>
<span><span class="co">#&gt; 20 - 0 &gt;= 10  -4.0345     0.8490  -16.53 &lt;1e-10 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; (Adjusted p values reported -- single-step method)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/multcomp/man/glht.html" class="external-link">glht</a></span><span class="op">(</span><span class="va">mod</span>,linfct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/multcomp/man/glht.html" class="external-link">mcp</a></span><span class="op">(</span>Dose<span class="op">=</span><span class="st">"Dunnett"</span><span class="op">)</span><span class="op">)</span>,level<span class="op">=</span><span class="fl">0.9</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Simultaneous Confidence Intervals</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Multiple Comparisons of Means: Dunnett Contrasts</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fit: lm(formula = Response ~ Dose, data = sim_data %&gt;% dplyr::mutate(Dose = factor(Dose)))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Quantile = 2.2218</span></span>
<span><span class="co">#&gt; 90% family-wise confidence level</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Linear Hypotheses:</span></span>
<span><span class="co">#&gt;             Estimate lwr     upr    </span></span>
<span><span class="co">#&gt; 5 - 0 == 0   0.4550  -1.4314  2.3413</span></span>
<span><span class="co">#&gt; 10 - 0 == 0  0.5505  -1.3359  2.4368</span></span>
<span><span class="co">#&gt; 15 - 0 == 0 -1.4720  -3.3583  0.4144</span></span>
<span><span class="co">#&gt; 20 - 0 == 0 -4.0345  -5.9209 -2.1482</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">max_effect</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="va">sim_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_dose_response.html">simulate_dose_response</a></span><span class="op">(</span></span>
<span>  n_doses <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  dose_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">20</span><span class="op">)</span>,</span>
<span>  m_tanks <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  var_tank <span class="op">=</span> <span class="fl">3</span>,  <span class="co"># Pass the dose-specific variances, note here it should be a vector instead of a singe number.</span></span>
<span>  include_individuals <span class="op">=</span> <span class="cn">FALSE</span>,  <span class="co"># Tank-level data only</span></span>
<span>  response_function <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">dose</span><span class="op">)</span> <span class="fu">response_fn</span><span class="op">(</span><span class="va">dose</span>, <span class="va">max_effect</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/get_theme.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/prelimPlot3.html">prelimPlot3</a></span><span class="op">(</span><span class="va">sim_data</span><span class="op">)</span></span></code></pre></div>
<p><img src="Equivalence-Testing_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">Response</span><span class="op">~</span><span class="va">Dose</span>, data<span class="op">=</span><span class="va">sim_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Dose<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">Dose</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; lm(formula = Response ~ Dose, data = sim_data %&gt;% dplyr::mutate(Dose = factor(Dose)))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residuals:</span></span>
<span><span class="co">#&gt;     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">#&gt; -4.2513 -1.0514 -0.0348  0.9322  3.7530 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept)  99.5264     0.5884 169.154  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; Dose5         0.9532     0.8321   1.146    0.258    </span></span>
<span><span class="co">#&gt; Dose10        0.8564     0.8321   1.029    0.309    </span></span>
<span><span class="co">#&gt; Dose15       -4.5858     0.8321  -5.511 1.65e-06 ***</span></span>
<span><span class="co">#&gt; Dose20       -8.4936     0.8321 -10.208 2.72e-13 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual standard error: 1.861 on 45 degrees of freedom</span></span>
<span><span class="co">#&gt; Multiple R-squared:  0.8167, Adjusted R-squared:  0.8004 </span></span>
<span><span class="co">#&gt; F-statistic: 50.13 on 4 and 45 DF,  p-value: 5.108e-16</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://multcomp.R-forge.R-project.org" class="external-link">multcomp</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/multcomp/man/glht.html" class="external-link">glht</a></span><span class="op">(</span><span class="va">mod</span>,linfct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/multcomp/man/glht.html" class="external-link">mcp</a></span><span class="op">(</span>Dose<span class="op">=</span><span class="st">"Dunnett"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Simultaneous Tests for General Linear Hypotheses</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Multiple Comparisons of Means: Dunnett Contrasts</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fit: lm(formula = Response ~ Dose, data = sim_data %&gt;% dplyr::mutate(Dose = factor(Dose)))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Linear Hypotheses:</span></span>
<span><span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; 5 - 0 == 0    0.9532     0.8321   1.146    0.611    </span></span>
<span><span class="co">#&gt; 10 - 0 == 0   0.8564     0.8321   1.029    0.693    </span></span>
<span><span class="co">#&gt; 15 - 0 == 0  -4.5858     0.8321  -5.511   &lt;1e-04 ***</span></span>
<span><span class="co">#&gt; 20 - 0 == 0  -8.4936     0.8321 -10.208   &lt;1e-04 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; (Adjusted p values reported -- single-step method)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/multcomp/man/glht.html" class="external-link">glht</a></span><span class="op">(</span><span class="va">mod</span>,linfct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/multcomp/man/glht.html" class="external-link">mcp</a></span><span class="op">(</span>Dose<span class="op">=</span><span class="st">"Dunnett"</span><span class="op">)</span>, alternative<span class="op">=</span><span class="st">"greater"</span>, rhs<span class="op">=</span><span class="op">-</span><span class="fl">10</span> <span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Simultaneous Tests for General Linear Hypotheses</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Multiple Comparisons of Means: Dunnett Contrasts</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fit: lm(formula = Response ~ Dose, data = sim_data %&gt;% dplyr::mutate(Dose = factor(Dose)))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Linear Hypotheses:</span></span>
<span><span class="co">#&gt;               Estimate Std. Error t value Pr(&gt;t)    </span></span>
<span><span class="co">#&gt; 5 - 0 &lt;= -10    0.9532     0.8321  13.163 &lt;0.001 ***</span></span>
<span><span class="co">#&gt; 10 - 0 &lt;= -10   0.8564     0.8321  13.047 &lt;0.001 ***</span></span>
<span><span class="co">#&gt; 15 - 0 &lt;= -10  -4.5858     0.8321   6.507 &lt;0.001 ***</span></span>
<span><span class="co">#&gt; 20 - 0 &lt;= -10  -8.4936     0.8321   1.810  0.113    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; (Adjusted p values reported -- single-step method)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/multcomp/man/glht.html" class="external-link">glht</a></span><span class="op">(</span><span class="va">mod</span>,linfct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/multcomp/man/glht.html" class="external-link">mcp</a></span><span class="op">(</span>Dose<span class="op">=</span><span class="st">"Dunnett"</span><span class="op">)</span>, alternative<span class="op">=</span><span class="st">"less"</span>, rhs<span class="op">=</span> <span class="fl">10</span> <span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Simultaneous Tests for General Linear Hypotheses</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Multiple Comparisons of Means: Dunnett Contrasts</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fit: lm(formula = Response ~ Dose, data = sim_data %&gt;% dplyr::mutate(Dose = factor(Dose)))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Linear Hypotheses:</span></span>
<span><span class="co">#&gt;              Estimate Std. Error t value Pr(&lt;t)    </span></span>
<span><span class="co">#&gt; 5 - 0 &gt;= 10    0.9532     0.8321  -10.87 &lt;1e-10 ***</span></span>
<span><span class="co">#&gt; 10 - 0 &gt;= 10   0.8564     0.8321  -10.99 &lt;1e-10 ***</span></span>
<span><span class="co">#&gt; 15 - 0 &gt;= 10  -4.5858     0.8321  -17.53 &lt;1e-10 ***</span></span>
<span><span class="co">#&gt; 20 - 0 &gt;= 10  -8.4936     0.8321  -22.23 &lt;1e-10 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; (Adjusted p values reported -- single-step method)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/multcomp/man/glht.html" class="external-link">glht</a></span><span class="op">(</span><span class="va">mod</span>,linfct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/multcomp/man/glht.html" class="external-link">mcp</a></span><span class="op">(</span>Dose<span class="op">=</span><span class="st">"Dunnett"</span><span class="op">)</span><span class="op">)</span>,level<span class="op">=</span><span class="fl">0.9</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Simultaneous Confidence Intervals</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Multiple Comparisons of Means: Dunnett Contrasts</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fit: lm(formula = Response ~ Dose, data = sim_data %&gt;% dplyr::mutate(Dose = factor(Dose)))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Quantile = 2.2223</span></span>
<span><span class="co">#&gt; 90% family-wise confidence level</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Linear Hypotheses:</span></span>
<span><span class="co">#&gt;             Estimate lwr      upr     </span></span>
<span><span class="co">#&gt; 5 - 0 == 0    0.9532  -0.8960   2.8024</span></span>
<span><span class="co">#&gt; 10 - 0 == 0   0.8564  -0.9928   2.7056</span></span>
<span><span class="co">#&gt; 15 - 0 == 0  -4.5858  -6.4350  -2.7366</span></span>
<span><span class="co">#&gt; 20 - 0 == 0  -8.4936 -10.3428  -6.6444</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">max_effect</span> <span class="op">&lt;-</span> <span class="fl">15</span></span>
<span><span class="va">threshold_idx</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span> <span class="va">response_fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dose</span>, <span class="va">max_effect</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">base_response</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span>      <span class="va">mid_dose</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">dose_range</span><span class="op">)</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">base_response</span> <span class="op">-</span> <span class="va">max_effect</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="op">(</span><span class="op">(</span><span class="va">dose</span> <span class="op">-</span> <span class="va">mid_dose</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="va">mid_dose</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="co">## Here I need a change.</span></span>
<span> <span class="op">}</span></span>
<span>  <span class="va">response_fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dose</span>, <span class="va">lower</span> <span class="op">=</span> <span class="fl">100</span>, <span class="va">upper</span> <span class="op">=</span> <span class="fl">0</span>, <span class="va">ED50</span> <span class="op">=</span> <span class="fl">10</span>, <span class="va">slope</span> <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">lower</span> <span class="op">+</span> <span class="op">(</span><span class="va">upper</span> <span class="op">-</span> <span class="va">lower</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">slope</span> <span class="op">*</span> <span class="op">(</span><span class="va">dose</span> <span class="op">-</span> <span class="va">ED50</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">456</span><span class="op">)</span></span>
<span><span class="va">sim_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_dose_response.html">simulate_dose_response</a></span><span class="op">(</span></span>
<span>  n_doses <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  dose_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">20</span><span class="op">)</span>,</span>
<span>  m_tanks <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  var_tank <span class="op">=</span> <span class="fl">20</span>,  <span class="co"># Pass the dose-specific variances, note here it should be a vector instead of a singe number.</span></span>
<span>  include_individuals <span class="op">=</span> <span class="cn">FALSE</span>,  <span class="co"># Tank-level data only</span></span>
<span>  response_function <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">dose</span><span class="op">)</span> <span class="fu">response_fn</span><span class="op">(</span><span class="va">dose</span>, <span class="va">max_effect</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/get_theme.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim_data</span> <span class="op">&lt;-</span><span class="va">sim_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Dose <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">Dose</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/prelimPlot3.html">prelimPlot3</a></span><span class="op">(</span><span class="va">sim_data</span><span class="op">)</span></span></code></pre></div>
<p><img src="Equivalence-Testing_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">Response</span><span class="op">~</span><span class="va">Dose</span>, data<span class="op">=</span><span class="va">sim_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Dose</span> <span class="op">&lt;=</span><span class="fl">15</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>            <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Dose<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">Dose</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; lm(formula = Response ~ Dose, data = sim_data %&gt;% dplyr::filter(Dose &lt;= </span></span>
<span><span class="co">#&gt;     15) %&gt;% dplyr::mutate(Dose = factor(Dose)))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residuals:</span></span>
<span><span class="co">#&gt;     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">#&gt; -7.8720 -3.3567  0.5979  3.1387  5.9788 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept)   13.189      1.945   6.780 2.31e-07 ***</span></span>
<span><span class="co">#&gt; Dose2.22       3.771      2.751   1.371  0.18140    </span></span>
<span><span class="co">#&gt; Dose4.44       3.182      2.751   1.157  0.25722    </span></span>
<span><span class="co">#&gt; Dose6.67       8.351      2.751   3.036  0.00514 ** </span></span>
<span><span class="co">#&gt; Dose8.89      -4.986      2.751  -1.812  0.08065 .  </span></span>
<span><span class="co">#&gt; Dose11.11     -8.814      2.751  -3.204  0.00337 ** </span></span>
<span><span class="co">#&gt; Dose13.33    -15.047      2.751  -5.469 7.70e-06 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual standard error: 4.35 on 28 degrees of freedom</span></span>
<span><span class="co">#&gt; Multiple R-squared:  0.7893, Adjusted R-squared:  0.7441 </span></span>
<span><span class="co">#&gt; F-statistic: 17.48 on 6 and 28 DF,  p-value: 2.64e-08</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://multcomp.R-forge.R-project.org" class="external-link">multcomp</a></span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/multcomp/man/glht.html" class="external-link">glht</a></span><span class="op">(</span><span class="va">mod</span>,linfct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/multcomp/man/glht.html" class="external-link">mcp</a></span><span class="op">(</span>Dose<span class="op">=</span><span class="st">"Dunnett"</span><span class="op">)</span>, alternative<span class="op">=</span><span class="st">"greater"</span>, rhs<span class="op">=</span><span class="op">-</span><span class="fl">10</span> <span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Simultaneous Tests for General Linear Hypotheses</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Multiple Comparisons of Means: Dunnett Contrasts</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fit: lm(formula = Response ~ Dose, data = sim_data %&gt;% dplyr::filter(Dose &lt;= </span></span>
<span><span class="co">#&gt;     15) %&gt;% dplyr::mutate(Dose = factor(Dose)))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Linear Hypotheses:</span></span>
<span><span class="co">#&gt;                  Estimate Std. Error t value Pr(&gt;t)    </span></span>
<span><span class="co">#&gt; 2.22 - 0 &lt;= -10     3.771      2.751   5.005 &lt;0.001 ***</span></span>
<span><span class="co">#&gt; 4.44 - 0 &lt;= -10     3.182      2.751   4.791 &lt;0.001 ***</span></span>
<span><span class="co">#&gt; 6.67 - 0 &lt;= -10     8.351      2.751   6.670 &lt;0.001 ***</span></span>
<span><span class="co">#&gt; 8.89 - 0 &lt;= -10    -4.986      2.751   1.822  0.149    </span></span>
<span><span class="co">#&gt; 11.11 - 0 &lt;= -10   -8.814      2.751   0.431  0.709    </span></span>
<span><span class="co">#&gt; 13.33 - 0 &lt;= -10  -15.047      2.751  -1.834  0.999    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; (Adjusted p values reported -- single-step method)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/multcomp/man/glht.html" class="external-link">glht</a></span><span class="op">(</span><span class="va">mod</span>,linfct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/multcomp/man/glht.html" class="external-link">mcp</a></span><span class="op">(</span>Dose<span class="op">=</span><span class="st">"Dunnett"</span><span class="op">)</span>, alternative<span class="op">=</span><span class="st">"less"</span>, rhs<span class="op">=</span> <span class="fl">10</span> <span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Simultaneous Tests for General Linear Hypotheses</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Multiple Comparisons of Means: Dunnett Contrasts</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fit: lm(formula = Response ~ Dose, data = sim_data %&gt;% dplyr::filter(Dose &lt;= </span></span>
<span><span class="co">#&gt;     15) %&gt;% dplyr::mutate(Dose = factor(Dose)))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Linear Hypotheses:</span></span>
<span><span class="co">#&gt;                 Estimate Std. Error t value Pr(&lt;t)    </span></span>
<span><span class="co">#&gt; 2.22 - 0 &gt;= 10     3.771      2.751  -2.264 0.0667 .  </span></span>
<span><span class="co">#&gt; 4.44 - 0 &gt;= 10     3.182      2.751  -2.478 0.0431 *  </span></span>
<span><span class="co">#&gt; 6.67 - 0 &gt;= 10     8.351      2.751  -0.599 0.6369    </span></span>
<span><span class="co">#&gt; 8.89 - 0 &gt;= 10    -4.986      2.751  -5.447 &lt;0.001 ***</span></span>
<span><span class="co">#&gt; 11.11 - 0 &gt;= 10   -8.814      2.751  -6.839 &lt;0.001 ***</span></span>
<span><span class="co">#&gt; 13.33 - 0 &gt;= 10  -15.047      2.751  -9.104 &lt;0.001 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; (Adjusted p values reported -- single-step method)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/multcomp/man/glht.html" class="external-link">glht</a></span><span class="op">(</span><span class="va">mod</span>,linfct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/multcomp/man/glht.html" class="external-link">mcp</a></span><span class="op">(</span>Dose<span class="op">=</span><span class="st">"Dunnett"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Simultaneous Tests for General Linear Hypotheses</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Multiple Comparisons of Means: Dunnett Contrasts</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fit: lm(formula = Response ~ Dose, data = sim_data %&gt;% dplyr::filter(Dose &lt;= </span></span>
<span><span class="co">#&gt;     15) %&gt;% dplyr::mutate(Dose = factor(Dose)))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Linear Hypotheses:</span></span>
<span><span class="co">#&gt;                Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; 2.22 - 0 == 0     3.771      2.751   1.371   0.5692    </span></span>
<span><span class="co">#&gt; 4.44 - 0 == 0     3.182      2.751   1.157   0.7183    </span></span>
<span><span class="co">#&gt; 6.67 - 0 == 0     8.351      2.751   3.036   0.0248 *  </span></span>
<span><span class="co">#&gt; 8.89 - 0 == 0    -4.986      2.751  -1.812   0.3011    </span></span>
<span><span class="co">#&gt; 11.11 - 0 == 0   -8.814      2.751  -3.204   0.0167 *  </span></span>
<span><span class="co">#&gt; 13.33 - 0 == 0  -15.047      2.751  -5.469   &lt;0.001 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; (Adjusted p values reported -- single-step method)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/multcomp/man/glht.html" class="external-link">glht</a></span><span class="op">(</span><span class="va">mod</span>,linfct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/multcomp/man/glht.html" class="external-link">mcp</a></span><span class="op">(</span>Dose<span class="op">=</span><span class="st">"Dunnett"</span><span class="op">)</span><span class="op">)</span>,level<span class="op">=</span><span class="fl">0.9</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Simultaneous Confidence Intervals</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Multiple Comparisons of Means: Dunnett Contrasts</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fit: lm(formula = Response ~ Dose, data = sim_data %&gt;% dplyr::filter(Dose &lt;= </span></span>
<span><span class="co">#&gt;     15) %&gt;% dplyr::mutate(Dose = factor(Dose)))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Quantile = 2.4082</span></span>
<span><span class="co">#&gt; 90% family-wise confidence level</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Linear Hypotheses:</span></span>
<span><span class="co">#&gt;                Estimate lwr      upr     </span></span>
<span><span class="co">#&gt; 2.22 - 0 == 0    3.7705  -2.8548  10.3958</span></span>
<span><span class="co">#&gt; 4.44 - 0 == 0    3.1819  -3.4434   9.8072</span></span>
<span><span class="co">#&gt; 6.67 - 0 == 0    8.3512   1.7259  14.9765</span></span>
<span><span class="co">#&gt; 8.89 - 0 == 0   -4.9864 -11.6116   1.6389</span></span>
<span><span class="co">#&gt; 11.11 - 0 == 0  -8.8137 -15.4390  -2.1884</span></span>
<span><span class="co">#&gt; 13.33 - 0 == 0 -15.0467 -21.6720  -8.4214</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="an-example-using-chick-weights-dataset">An example using chick weights dataset<a class="anchor" aria-label="anchor" href="#an-example-using-chick-weights-dataset"></a>
</h2>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ul>
<li>Dilba, G., Bretz, F., Guiard, V., and Hothorn, L. A. (2004).
Simultaneous confidence intervals for ratios with applications to the
comparison of several treatments with a control. Methods of Information
in Medicine 43, 465–469.</li>
<li>Djira G, Hasler M, Gerhard D, Segbehoe L, Schaarschmidt F (2025).
<em>mratios: Ratios of Coefficients in the General Linear Model</em>. R
package version 1.4.4, <a href="https://CRAN.R-project.org/package=mratios" class="external-link uri">https://CRAN.R-project.org/package=mratios</a>.</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Zhenglei Gao, Sean Ryan.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
