<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>MDD in Regulatory Context • drcHelper</title>
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="MDD in Regulatory Context">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">drcHelper</a>

    <small class="nav-text text-default me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.0.4.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-get-started" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Get Started</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-get-started">
<li><a class="dropdown-item" href="../articles/Introduction.html">Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/drcHelper.html">Example ECx Helper Functions Usage</a></li>
    <li><a class="dropdown-item" href="../articles/Dunnetts_Test_for_Data_with_Hierarchical_Structure.html">Example NOEC Helper Functions Usage</a></li>
    <li><a class="dropdown-item" href="../articles/Examples_drc.html">Using DRC and BMD</a></li>
    <li><a class="dropdown-item" href="../articles/Examples_oecd201.html">Example DRC - OECD 201</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-regulatory-stats" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Regulatory Stats</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-regulatory-stats">
<li><a class="dropdown-item" href="../articles/NOEC_Methods.html">NOEC Calculations</a></li>
    <li><a class="dropdown-item" href="../articles/Limit-Test.html">Limit Test Calculations</a></li>
    <li><a class="dropdown-item" href="../articles/EFSA-Criteria.html">EFSA Criteria and Other Reliability Criteria</a></li>
    <li><a class="dropdown-item" href="../articles/Example_RSCABS.html">RSCABS</a></li>
    <li><a class="dropdown-item" href="../articles/Trend-Testing.html">Trend Testing</a></li>
    <li><a class="dropdown-item" href="../articles/NOEC_ECx_BMD.html">NOEC ECx and BMD</a></li>
    <li><a class="dropdown-item" href="../articles/MDD-in-Regulatory-Context.html">MDD in Regulatory Context</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/core_statistical_methods.html">Core Statistical Methods Overview</a></li>
    <li><a class="dropdown-item" href="../articles/Quantal-Data.html">Quantal Data Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/Ordinal-Data.html">Ordinal Data Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/Count_Data.html">Count Data Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/LMM-GLMM-and-GAMM.html">LMM, GLMM, and GAMM Models</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/advanced_topics.html">Advanced Topics Overview</a></li>
    <li><a class="dropdown-item" href="../articles/Normality-Check.html">Normality Checks</a></li>
    <li><a class="dropdown-item" href="../articles/Binomial_Extra_Variance.html">Binomial Extra Variance</a></li>
    <li><a class="dropdown-item" href="../articles/Equivalence-Testing.html">Equivalence Testing</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/alternative_methods.html">Alternative Methods Overview</a></li>
    <li><a class="dropdown-item" href="../articles/Examples%20using%20NLS.html">NLS Examples</a></li>
    <li><a class="dropdown-item" href="../articles/Examples_using_drda.html">DRDA Examples</a></li>
    <li><a class="dropdown-item" href="../articles/TSK_method.html">TSK Method</a></li>
    <li><a class="dropdown-item" href="../articles/MQJT.html">MQJT</a></li>
    <li><a class="dropdown-item" href="../articles/Advanced_Fitting-a-biphasic-dose-reponse-model.html">Biphasic Dose Response Models</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-validation" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Validation</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-validation">
<li><a class="dropdown-item" href="../articles/System_Testing.html">System Testing</a></li>
    <li><a class="dropdown-item" href="../articles/val_ED_plus.html">ED Calculation Consistency</a></li>
    <li><a class="dropdown-item" href="../articles/TSK-and-Probit-Models.html">TSK and Probit Model</a></li>
    <li><a class="dropdown-item" href="../articles/Verification_which_JT.html">Which JT test to use</a></li>
    <li><a class="dropdown-item" href="../articles/Verification_CA_test.html">Verification of CA test</a></li>
    <li><a class="dropdown-item" href="../articles/Validation_MCP_tests.html">Validation of MCP tests</a></li>
    <li><a class="dropdown-item" href="../articles/Test-Guidelines.html">Study Types and Templates</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Bayer-Group/drcHelper/issues/new?template=Blank+issue" aria-label="New Issue"><span class="fa fa-bug"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Bayer-Group/drcHelper" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>MDD in Regulatory Context</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Bayer-Group/drcHelper/blob/main/vignettes/articles/MDD-in-Regulatory-Context.Rmd" class="external-link"><code>vignettes/articles/MDD-in-Regulatory-Context.Rmd</code></a></small>
      <div class="d-none name"><code>MDD-in-Regulatory-Context.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bayer-group.github.io/drcHelper/index.html">drcHelper</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: drc</span></span>
<span><span class="co">#&gt; Loading required package: MASS</span></span>
<span><span class="co">#&gt; Loading required package: drcData</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 'drc' has been loaded.</span></span>
<span><span class="co">#&gt; Please cite R and 'drc' if used for a publication,</span></span>
<span><span class="co">#&gt; for references type 'citation()' and 'citation('drc')'.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'drc'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     gaussian, getInitial</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="st">"../knitr-setup.R"</span><span class="op">)</span></span></code></pre></div>
<p>In the regulatory context, MDD% stands for the minimum percent change
(relative to the control mean) that would be deemed statistically
significant given the test’s critical value, the residual variability,
and the replication. There are two common ways to define it; the often
used way in ecotoxicology is ofent the significance-threshold version
(no power term).</p>
<div class="section level3">
<h3 id="key-definitions">Key definitions<a class="anchor" aria-label="anchor" href="#key-definitions"></a>
</h3>
<ul>
<li>Absolute minimum detectable difference (MDD, on the response scale):
<ul>
<li>For a control vs. dose comparison with pooled residual variance MSE
and per-group sample sizes n_c (control) and n_t (treatment), the
standard error of a difference is:
<ul>
<li><span class="math display">\[SE_{diff} = \sqrt{MSE \cdot
\left(\frac{1}{n_c} + \frac{1}{n_t}\right)}\]</span></li>
</ul>
</li>
<li>Given a one-sided critical value (e.g., Williams’ Tcrit), the
absolute MDD is:
<ul>
<li><span class="math display">\[MDD = T_{crit} \cdot
SE_{diff}\]</span></li>
</ul>
</li>
</ul>
</li>
<li>Percent MDD relative to control mean:
<ul>
<li>If the control mean is μ_c, then
<ul>
<li><span class="math display">\[MDD\% = 100 \cdot \frac{MDD}{\mu_c} =
100 \cdot \frac{T_{crit} \cdot SE_{diff}}{\mu_c}\]</span></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Notes</p>
<ul>
<li>Significance-threshold vs. power-based:
<ul>
<li>The above uses only Tcrit (significance threshold at alpha). Some
literature calls this MSD (Minimum Significant Difference).</li>
<li>A power-based MDD (to achieve power 1−β) adds a second quantile:
<ul>
<li><span class="math display">\[MDD_{power} = \left(t_{1-\alpha,\ df} +
t_{1-\beta,\ df}\right) \cdot SE_{diff}\]</span></li>
<li>and <span class="math display">\[MDD\%_{power} = 100 \cdot
\frac{MDD_{power}}{\mu_c}\]</span>
</li>
</ul>
</li>
<li>Your Williams expected includes “Tcrit” per dose; this aligns with
the significance-threshold version (no power term).</li>
</ul>
</li>
<li>Which Tcrit to use:
<ul>
<li>For Williams: use the Tcrit reported per dose/step from
broom_williams(method = “Williams_PMCMRplus”), which you have
available.</li>
<li>For Dunnett: a true Dunnett critical value depends on the number of
groups (multivariate t). If you don’t have a reported Tcrit, computing
an exact Dunnett Tcrit is more involved; for Williams, you already have
it, so we can compute MDD% reliably.</li>
</ul>
</li>
</ul>
<p><strong>What the function does</strong></p>
<ul>
<li>Accepts a formula x of the form Response ~ Dose (Dose can be numeric
or factor).</li>
<li>Ensures the control (reference) group is the first factor level (by
default the lowest dose).</li>
<li>Computes the per-contrast standard error SE_diff using the
appropriate method:
<ul>
<li>Williams/Dunnett: pooled ANOVA MSE (or directly from glht sigma for
Dunnett).</li>
<li>Student’s t: pooled-variance SE.</li>
<li>Welch: group-specific-variance SE and Welch–Satterthwaite df.</li>
</ul>
</li>
<li>Determines the critical value Tcrit:
<ul>
<li>Williams: from broom_williams t’-crit per contrast.</li>
<li>Dunnett: from multcomp summary.glht test$qfunction at your
alpha.</li>
<li>Student’s t/Welch: qt with per-contrast df.</li>
</ul>
</li>
<li>Computes MDD = Tcrit × SE_diff and MDD% = 100 × MDD /
control_mean.</li>
<li>Returns a tidy tibble with dose, n_c, n_t, df (when applicable),
SE_diff, Tcrit, MDD, MDD_pct, method, alpha, alternative, and
control_mean.</li>
</ul>
</div>
<div class="section level3">
<h3 id="code-compute_mdd_generic">Code: compute_mdd_generic<a class="anchor" aria-label="anchor" href="#code-compute_mdd_generic"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">compute_mdd_generic</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">data</span>,</span>
<span>                                <span class="va">test</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Williams_PMCMRplus"</span>, <span class="st">"Williams_JG"</span>, <span class="st">"Dunnett"</span>, <span class="st">"t"</span>, <span class="st">"Welch"</span><span class="op">)</span>,</span>
<span>                                <span class="va">alpha</span> <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>                                <span class="va">alternative</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"smaller"</span>, <span class="st">"greater"</span>, <span class="st">"two-sided"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/match.arg.html" class="external-link">match.arg</a></span><span class="op">(</span><span class="va">test</span><span class="op">)</span></span>
<span>  <span class="va">alternative</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/match.arg.html" class="external-link">match.arg</a></span><span class="op">(</span><span class="va">alternative</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Parse formula</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">inherits</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"formula"</span><span class="op">)</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"x must be a formula, e.g., Response ~ Dose"</span><span class="op">)</span></span>
<span>  <span class="va">terms_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/terms.html" class="external-link">terms</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>  <span class="va">resp_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">terms_obj</span>, <span class="st">"factors"</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="va">factor_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">terms_obj</span>, <span class="st">"term.labels"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span></span>
<span>  <span class="va">df</span> <span class="op">&lt;-</span> <span class="va">data</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">is.data.frame</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"data must be a data.frame"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Prepare dose factor with control first (lowest dose)</span></span>
<span>  <span class="va">dose_raw</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[[</span><span class="va">factor_name</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">dose_num</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">","</span>, <span class="st">"."</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">dose_raw</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="co"># If numeric conversion fails everywhere, treat as factor and try to sort levels by numeric content</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">dose_num</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Attempt to parse numeric part from strings</span></span>
<span>    <span class="va">dose_num</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">","</span>, <span class="st">"."</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"[^0-9.,-]"</span>, <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">dose_raw</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="co"># Build factor levels: sort unique numeric doses; fallback to existing factor levels</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">dose_num</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">levels_sorted</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">dose_num</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">df</span><span class="op">$</span><span class="va">Dose_factor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">dose_num</span>, levels <span class="op">=</span> <span class="va">levels_sorted</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">df</span><span class="op">$</span><span class="va">Dose_factor</span> <span class="op">&lt;-</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">is.factor</a></span><span class="op">(</span><span class="va">dose_raw</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">dose_raw</span><span class="op">)</span> <span class="kw">else</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">dose_raw</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/warning.html" class="external-link">warning</a></span><span class="op">(</span><span class="st">"Dose values not numeric; using existing factor levels. Ensure control is the first level."</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co"># Basic stats per group</span></span>
<span>  <span class="va">resp</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[[</span><span class="va">resp_name</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">ctrl_level</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">Dose_factor</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="va">ctrl_idx</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">$</span><span class="va">Dose_factor</span> <span class="op">==</span> <span class="va">ctrl_level</span></span>
<span>  <span class="va">mu_c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">resp</span><span class="op">[</span><span class="va">ctrl_idx</span><span class="op">]</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="va">n_c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">ctrl_idx</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># One-way ANOVA for pooled MSE (used by Williams/Dunnett/t pooled)</span></span>
<span>  <span class="va">aov_fit</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/aov.html" class="external-link">aov</a></span><span class="op">(</span><span class="va">resp</span> <span class="op">~</span> <span class="va">df</span><span class="op">$</span><span class="va">Dose_factor</span><span class="op">)</span></span>
<span>  <span class="va">mse</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">aov_fit</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="st">"Residuals"</span>, <span class="st">"Mean Sq"</span><span class="op">]</span>, error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="cn">NA_real_</span><span class="op">)</span></span>
<span>  <span class="va">df_resid</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">aov_fit</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="st">"Residuals"</span>, <span class="st">"Df"</span><span class="op">]</span>, error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="cn">NA_real_</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Per-dose counts and SDs</span></span>
<span>  <span class="va">group_n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="va">resp</span> <span class="op">~</span> <span class="va">df</span><span class="op">$</span><span class="va">Dose_factor</span>, FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">group_sd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="va">resp</span> <span class="op">~</span> <span class="va">df</span><span class="op">$</span><span class="va">Dose_factor</span>, FUN <span class="op">=</span> <span class="fu">stats</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">group_n</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Dose_factor"</span>, <span class="st">"n_t"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">group_sd</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Dose_factor"</span>, <span class="st">"sd_t"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Helper to compute one-/two-sided quantile tail</span></span>
<span>  <span class="va">qtail</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">alt</span>, <span class="va">alpha</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">alt</span> <span class="op">==</span> <span class="st">"two-sided"</span><span class="op">)</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">qt</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">alpha</span> <span class="op">/</span> <span class="fl">2</span>, df <span class="op">=</span> <span class="va">df</span><span class="op">)</span> <span class="kw">else</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">qt</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">alpha</span>, df <span class="op">=</span> <span class="va">df</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co"># Initialize result container</span></span>
<span>  <span class="va">res_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">test</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Williams_PMCMRplus"</span>, <span class="st">"Williams_JG"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Direction for Williams</span></span>
<span>    <span class="va">direction</span> <span class="op">&lt;-</span> <span class="kw">if</span> <span class="op">(</span><span class="va">alternative</span> <span class="op">==</span> <span class="st">"smaller"</span><span class="op">)</span> <span class="st">"decreasing"</span> <span class="kw">else</span> <span class="st">"increasing"</span></span>
<span>    <span class="va">bw</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">drcHelper</span><span class="fu">::</span><span class="fu"><a href="../reference/broom_williams.html">broom_williams</a></span><span class="op">(</span><span class="va">x</span>, data <span class="op">=</span> <span class="va">df</span>, method <span class="op">=</span> <span class="kw">if</span> <span class="op">(</span><span class="va">test</span> <span class="op">==</span> <span class="st">"Williams_PMCMRplus"</span><span class="op">)</span> <span class="st">"Williams_PMCMRplus"</span> <span class="kw">else</span> <span class="st">"Williams_JG"</span>, direction <span class="op">=</span> <span class="va">direction</span><span class="op">)</span>, silent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">inherits</a></span><span class="op">(</span><span class="va">bw</span>, <span class="st">"try-error"</span><span class="op">)</span> <span class="op">||</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">bw</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"broom_williams failed to produce results."</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">bw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">bw</span><span class="op">)</span></span>
<span>    <span class="co"># Map Dose from comparison ("a - 0 &lt;= 0" or "a - 0 &gt;= 0")</span></span>
<span>    <span class="va">comp_clean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"\\s*(&lt;=|&gt;=)\\s*0\\s*$"</span>, <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">bw</span><span class="op">$</span><span class="va">comparison</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">dose_contrast</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">","</span>, <span class="st">"."</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">" - 0$"</span>, <span class="st">""</span>, <span class="va">comp_clean</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">dose_contrast</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="va">test</span> <span class="op">==</span> <span class="st">"Williams_JG"</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="co"># Fallback: assign ascending treatment doses excluding control</span></span>
<span>      <span class="va">trt_levels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">Dose_factor</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span>      <span class="va">dose_contrast</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">trt_levels</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="va">dose_contrast</span> <span class="op">&lt;-</span> <span class="va">dose_contrast</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">dose_contrast</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">bw</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span>      <span class="co"># If lengths mismatch, pad with NA</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">dose_contrast</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">bw</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">dose_contrast</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">dose_contrast</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA_real_</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">bw</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">dose_contrast</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">bw</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">bw</span><span class="op">)</span> <span class="op">==</span> <span class="st">"`t'-crit"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Tcrit"</span></span>
<span>    <span class="co"># Merge per-dose counts</span></span>
<span>    <span class="va">trt_n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Dose_factor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">dose_contrast</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">Dose_factor</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                   <span class="va">group_n</span>, by <span class="op">=</span> <span class="st">"Dose_factor"</span>, all.x <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="va">n_t</span> <span class="op">&lt;-</span> <span class="va">trt_n</span><span class="op">$</span><span class="va">n_t</span></span>
<span>    <span class="co"># SE_diff via pooled MSE</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">mse</span><span class="op">)</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Cannot compute pooled MSE from ANOVA; MDD cannot be computed."</span><span class="op">)</span></span>
<span>    <span class="va">SE_diff</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">mse</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="va">n_c</span> <span class="op">+</span> <span class="fl">1</span> <span class="op">/</span> <span class="va">n_t</span><span class="op">)</span><span class="op">)</span>  <span class="co"># $$SE_{diff} = \sqrt{MSE \cdot (1/n_c + 1/n_t)}$$</span></span>
<span>    <span class="va">MDD</span> <span class="op">&lt;-</span> <span class="va">bw</span><span class="op">$</span><span class="va">Tcrit</span> <span class="op">*</span> <span class="va">SE_diff</span>                   <span class="co"># $$MDD = T_{crit} \cdot SE_{diff}$$</span></span>
<span>    <span class="va">MDD_pct</span> <span class="op">&lt;-</span> <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">mu_c</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="va">mu_c</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span> <span class="fl">100</span> <span class="op">*</span> <span class="va">MDD</span> <span class="op">/</span> <span class="va">mu_c</span> <span class="kw">else</span> <span class="cn">NA_real_</span>  <span class="co"># $$MDD\% = 100 \cdot MDD / \mu_c$$</span></span>
<span>    <span class="va">res_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      dose <span class="op">=</span> <span class="va">dose_contrast</span>,</span>
<span>      n_c <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">n_c</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">n_t</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      n_t <span class="op">=</span> <span class="va">n_t</span>,</span>
<span>      df <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">df_resid</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">n_t</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      SE_diff <span class="op">=</span> <span class="va">SE_diff</span>,</span>
<span>      Tcrit <span class="op">=</span> <span class="va">bw</span><span class="op">$</span><span class="va">Tcrit</span>,</span>
<span>      MDD <span class="op">=</span> <span class="va">MDD</span>,</span>
<span>      MDD_pct <span class="op">=</span> <span class="va">MDD_pct</span>,</span>
<span>      method <span class="op">=</span> <span class="va">test</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">test</span> <span class="op">==</span> <span class="st">"Dunnett"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Need multcomp</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"multcomp"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Package 'multcomp' is required for Dunnett MDD."</span><span class="op">)</span></span>
<span>    <span class="co"># Build Dunnett contrasts and glht</span></span>
<span>    <span class="va">contrasts_call</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/call.html" class="external-link">as.call</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/name.html" class="external-link">as.name</a></span><span class="op">(</span><span class="st">"mcp"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">contrasts_call</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Dunnett"</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">contrasts_call</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">factor_name</span></span>
<span>    <span class="va">dunnett_contrasts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval</a></span><span class="op">(</span><span class="va">contrasts_call</span><span class="op">)</span></span>
<span>    <span class="co"># Construct aov from formula x</span></span>
<span>    <span class="va">aov_model</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/aov.html" class="external-link">aov</a></span><span class="op">(</span><span class="va">x</span>, data <span class="op">=</span> <span class="va">df</span><span class="op">)</span></span>
<span>    <span class="va">gl</span> <span class="op">&lt;-</span> <span class="fu">multcomp</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/multcomp/man/glht.html" class="external-link">glht</a></span><span class="op">(</span><span class="va">aov_model</span>, linfct <span class="op">=</span> <span class="va">dunnett_contrasts</span><span class="op">)</span></span>
<span>    <span class="va">sm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">gl</span><span class="op">)</span></span>
<span>    <span class="co"># Dose from rownames of coefficients like "0.0448 - 0"</span></span>
<span>    <span class="va">comp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">sm</span><span class="op">$</span><span class="va">test</span><span class="op">$</span><span class="va">coefficients</span><span class="op">)</span></span>
<span>    <span class="va">dose_contrast</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">","</span>, <span class="st">"."</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">" - 0$"</span>, <span class="st">""</span>, <span class="va">comp</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="co"># Standard errors per contrast come from sigma in summary (vector)</span></span>
<span>    <span class="va">SE_diff</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">sm</span><span class="op">$</span><span class="va">test</span><span class="op">$</span><span class="va">sigma</span><span class="op">)</span></span>
<span>    <span class="co"># Critical value from qfunction</span></span>
<span>    <span class="va">qfun</span> <span class="op">&lt;-</span> <span class="va">sm</span><span class="op">$</span><span class="va">test</span><span class="op">$</span><span class="va">qfunction</span></span>
<span>    <span class="va">Tcrit</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu">qfun</span><span class="op">(</span>conf.level <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">alpha</span>, adjusted <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>, error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="cn">NA_real_</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">Tcrit</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/warning.html" class="external-link">warning</a></span><span class="op">(</span><span class="st">"Could not obtain Dunnett adjusted critical value; using unadjusted qt with residual df."</span><span class="op">)</span></span>
<span>      <span class="va">Tcrit</span> <span class="op">&lt;-</span> <span class="fu">qtail</span><span class="op">(</span><span class="va">df_resid</span>, <span class="va">alternative</span>, <span class="va">alpha</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">MDD</span> <span class="op">&lt;-</span> <span class="va">Tcrit</span> <span class="op">*</span> <span class="va">SE_diff</span></span>
<span>    <span class="va">MDD_pct</span> <span class="op">&lt;-</span> <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">mu_c</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="va">mu_c</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span> <span class="fl">100</span> <span class="op">*</span> <span class="va">MDD</span> <span class="op">/</span> <span class="va">mu_c</span> <span class="kw">else</span> <span class="cn">NA_real_</span></span>
<span>    <span class="co"># n_t per contrast</span></span>
<span>    <span class="va">trt_n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Dose_factor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">dose_contrast</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">Dose_factor</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                   <span class="va">group_n</span>, by <span class="op">=</span> <span class="st">"Dose_factor"</span>, all.x <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="va">n_t</span> <span class="op">&lt;-</span> <span class="va">trt_n</span><span class="op">$</span><span class="va">n_t</span></span>
<span>    <span class="va">res_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      dose <span class="op">=</span> <span class="va">dose_contrast</span>,</span>
<span>      n_c <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">n_c</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">n_t</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      n_t <span class="op">=</span> <span class="va">n_t</span>,</span>
<span>      df <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">df_resid</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">SE_diff</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      SE_diff <span class="op">=</span> <span class="va">SE_diff</span>,</span>
<span>      Tcrit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">Tcrit</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">SE_diff</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      MDD <span class="op">=</span> <span class="va">MDD</span>,</span>
<span>      MDD_pct <span class="op">=</span> <span class="va">MDD_pct</span>,</span>
<span>      method <span class="op">=</span> <span class="st">"Dunnett_multcomp"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">test</span> <span class="op">==</span> <span class="st">"t"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Pooled-variance per contrast (control vs each treatment)</span></span>
<span>    <span class="co"># Compute control SD</span></span>
<span>    <span class="va">sd_c</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">resp</span><span class="op">[</span><span class="va">ctrl_idx</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">trt_levels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">Dose_factor</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">out_rows</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">trt_levels</span>, <span class="kw">function</span><span class="op">(</span><span class="va">lv</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">trt_idx</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">$</span><span class="va">Dose_factor</span> <span class="op">==</span> <span class="va">lv</span></span>
<span>      <span class="va">n_t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">trt_idx</span><span class="op">)</span></span>
<span>      <span class="va">sd_t</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">resp</span><span class="op">[</span><span class="va">trt_idx</span><span class="op">]</span><span class="op">)</span></span>
<span>      <span class="co"># pooled variance</span></span>
<span>      <span class="va">sp2</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="op">(</span><span class="va">n_c</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="va">sd_c</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="op">(</span><span class="va">n_t</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="va">sd_t</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">n_c</span> <span class="op">+</span> <span class="va">n_t</span> <span class="op">-</span> <span class="fl">2</span><span class="op">)</span>  <span class="co"># $$s_p^2 = ((n_c-1)s_c^2 + (n_t-1)s_t^2) / (n_c+n_t-2)$$</span></span>
<span>      <span class="va">SE_diff</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">sp2</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="va">n_c</span> <span class="op">+</span> <span class="fl">1</span> <span class="op">/</span> <span class="va">n_t</span><span class="op">)</span><span class="op">)</span>                           <span class="co"># $$SE_{diff} = \sqrt{s_p^2 (1/n_c + 1/n_t)}$$</span></span>
<span>      <span class="va">df_ct</span> <span class="op">&lt;-</span> <span class="va">n_c</span> <span class="op">+</span> <span class="va">n_t</span> <span class="op">-</span> <span class="fl">2</span></span>
<span>      <span class="va">Tcrit</span> <span class="op">&lt;-</span> <span class="fu">qtail</span><span class="op">(</span><span class="va">df_ct</span>, <span class="va">alternative</span>, <span class="va">alpha</span><span class="op">)</span></span>
<span>      <span class="va">MDD</span> <span class="op">&lt;-</span> <span class="va">Tcrit</span> <span class="op">*</span> <span class="va">SE_diff</span></span>
<span>      <span class="va">MDD_pct</span> <span class="op">&lt;-</span> <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">mu_c</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="va">mu_c</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span> <span class="fl">100</span> <span class="op">*</span> <span class="va">MDD</span> <span class="op">/</span> <span class="va">mu_c</span> <span class="kw">else</span> <span class="cn">NA_real_</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>dose <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">lv</span><span class="op">)</span><span class="op">)</span>, n_c <span class="op">=</span> <span class="va">n_c</span>, n_t <span class="op">=</span> <span class="va">n_t</span>,</span>
<span>                 df <span class="op">=</span> <span class="va">df_ct</span>, SE_diff <span class="op">=</span> <span class="va">SE_diff</span>, Tcrit <span class="op">=</span> <span class="va">Tcrit</span>, MDD <span class="op">=</span> <span class="va">MDD</span>, MDD_pct <span class="op">=</span> <span class="va">MDD_pct</span>,</span>
<span>                 method <span class="op">=</span> <span class="st">"Student_t"</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span>    <span class="va">res_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">out_rows</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">res_df</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">test</span> <span class="op">==</span> <span class="st">"Welch"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Welch SE and df per contrast</span></span>
<span>    <span class="va">sd_c</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">resp</span><span class="op">[</span><span class="va">ctrl_idx</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">trt_levels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">Dose_factor</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">out_rows</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">trt_levels</span>, <span class="kw">function</span><span class="op">(</span><span class="va">lv</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">trt_idx</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">$</span><span class="va">Dose_factor</span> <span class="op">==</span> <span class="va">lv</span></span>
<span>      <span class="va">n_t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">trt_idx</span><span class="op">)</span></span>
<span>      <span class="va">sd_t</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">resp</span><span class="op">[</span><span class="va">trt_idx</span><span class="op">]</span><span class="op">)</span></span>
<span>      <span class="va">SE_diff</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">sd_c</span><span class="op">^</span><span class="fl">2</span> <span class="op">/</span> <span class="va">n_c</span> <span class="op">+</span> <span class="va">sd_t</span><span class="op">^</span><span class="fl">2</span> <span class="op">/</span> <span class="va">n_t</span><span class="op">)</span>                         <span class="co"># $$SE_{diff} = \sqrt{s_c^2/n_c + s_t^2/n_t}$$</span></span>
<span>      <span class="va">df_w</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">sd_c</span><span class="op">^</span><span class="fl">2</span> <span class="op">/</span> <span class="va">n_c</span> <span class="op">+</span> <span class="va">sd_t</span><span class="op">^</span><span class="fl">2</span> <span class="op">/</span> <span class="va">n_t</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">/</span></span>
<span>        <span class="op">(</span><span class="op">(</span><span class="va">sd_c</span><span class="op">^</span><span class="fl">2</span> <span class="op">/</span> <span class="va">n_c</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">/</span> <span class="op">(</span><span class="va">n_c</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="va">sd_t</span><span class="op">^</span><span class="fl">2</span> <span class="op">/</span> <span class="va">n_t</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">/</span> <span class="op">(</span><span class="va">n_t</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>     <span class="co"># $$df_{Welch} = \frac{(s_c^2/n_c + s_t^2/n_t)^2}{(s_c^2/n_c)^2/(n_c-1) + (s_t^2/n_t)^2/(n_t-1)}$$</span></span>
<span>      <span class="va">Tcrit</span> <span class="op">&lt;-</span> <span class="fu">qtail</span><span class="op">(</span><span class="va">df_w</span>, <span class="va">alternative</span>, <span class="va">alpha</span><span class="op">)</span></span>
<span>      <span class="va">MDD</span> <span class="op">&lt;-</span> <span class="va">Tcrit</span> <span class="op">*</span> <span class="va">SE_diff</span></span>
<span>      <span class="va">MDD_pct</span> <span class="op">&lt;-</span> <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">mu_c</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="va">mu_c</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span> <span class="fl">100</span> <span class="op">*</span> <span class="va">MDD</span> <span class="op">/</span> <span class="va">mu_c</span> <span class="kw">else</span> <span class="cn">NA_real_</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>dose <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">lv</span><span class="op">)</span><span class="op">)</span>, n_c <span class="op">=</span> <span class="va">n_c</span>, n_t <span class="op">=</span> <span class="va">n_t</span>,</span>
<span>                 df <span class="op">=</span> <span class="va">df_w</span>, SE_diff <span class="op">=</span> <span class="va">SE_diff</span>, Tcrit <span class="op">=</span> <span class="va">Tcrit</span>, MDD <span class="op">=</span> <span class="va">MDD</span>, MDD_pct <span class="op">=</span> <span class="va">MDD_pct</span>,</span>
<span>                 method <span class="op">=</span> <span class="st">"Welch_t"</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span>    <span class="va">res_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">out_rows</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">res_df</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co"># Assemble and return tibble for Williams/Dunnett branches</span></span>
<span>  <span class="va">res_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    Dose <span class="op">=</span> <span class="va">res_list</span><span class="op">$</span><span class="va">dose</span>,</span>
<span>    n_c <span class="op">=</span> <span class="va">res_list</span><span class="op">$</span><span class="va">n_c</span>,</span>
<span>    n_t <span class="op">=</span> <span class="va">res_list</span><span class="op">$</span><span class="va">n_t</span>,</span>
<span>    df <span class="op">=</span> <span class="va">res_list</span><span class="op">$</span><span class="va">df</span>,</span>
<span>    SE_diff <span class="op">=</span> <span class="va">res_list</span><span class="op">$</span><span class="va">SE_diff</span>,</span>
<span>    Tcrit <span class="op">=</span> <span class="va">res_list</span><span class="op">$</span><span class="va">Tcrit</span>,</span>
<span>    MDD <span class="op">=</span> <span class="va">res_list</span><span class="op">$</span><span class="va">MDD</span>,</span>
<span>    MDD_pct <span class="op">=</span> <span class="va">res_list</span><span class="op">$</span><span class="va">MDD_pct</span>,</span>
<span>    method <span class="op">=</span> <span class="va">res_list</span><span class="op">$</span><span class="va">method</span>,</span>
<span>    alpha <span class="op">=</span> <span class="va">alpha</span>,</span>
<span>    alternative <span class="op">=</span> <span class="va">alternative</span>,</span>
<span>    control_mean <span class="op">=</span> <span class="va">mu_c</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="co"># Order by Dose ascending</span></span>
<span>  <span class="va">res_df</span> <span class="op">&lt;-</span> <span class="va">res_df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">res_df</span><span class="op">$</span><span class="va">Dose</span><span class="op">)</span>, <span class="op">]</span></span>
<span>  <span class="va">res_df</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Usage examples</p>
<ul>
<li>Williams PMCMRplus (your MOCK0065 Growth Rate):</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Helper to convert dose strings to numeric, handling various formats</span></span>
<span><span class="va">convert_dose</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">xc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>  <span class="va">xc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/trimws.html" class="external-link">trimws</a></span><span class="op">(</span><span class="va">xc</span><span class="op">)</span></span>
<span>  <span class="va">xc</span><span class="op">[</span><span class="va">xc</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">"n/a"</span>, <span class="st">"NA"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA_character_</span></span>
<span>  <span class="co"># Normalize decimal commas and keep scientific notation (e.g., "4,48E-2" -&gt; "4.48E-2")</span></span>
<span>  <span class="va">xc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">","</span>, <span class="st">"."</span>, <span class="va">xc</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">xc</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">convert_numeric</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">xc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>  <span class="va">xc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/trimws.html" class="external-link">trimws</a></span><span class="op">(</span><span class="va">xc</span><span class="op">)</span></span>
<span>  <span class="va">xc</span><span class="op">[</span><span class="va">xc</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">"n/a"</span>, <span class="st">"NA"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA_character_</span></span>
<span>  <span class="va">xc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">","</span>, <span class="st">"."</span>, <span class="va">xc</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">xc</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">dose_from_comparison</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">comp_vec</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">comp_vec</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">vapply</a></span><span class="op">(</span><span class="va">comp_vec</span>, <span class="kw">function</span><span class="op">(</span><span class="va">s</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">NA_real_</span><span class="op">)</span></span>
<span>    <span class="va">parts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="va">s</span>, <span class="st">" - "</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>    <span class="fu">convert_dose</span><span class="op">(</span><span class="va">parts</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span>, FUN.VALUE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">w_ep</span> <span class="op">&lt;-</span> <span class="va">test_cases_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">`Study ID`</span> <span class="op">==</span> <span class="st">"MOCK0065"</span>, <span class="va">Endpoint</span> <span class="op">==</span> <span class="st">"Growth Rate"</span><span class="op">)</span></span>
<span><span class="va">w_ep</span><span class="op">$</span><span class="va">Dose_numeric</span> <span class="op">&lt;-</span> <span class="fu">convert_dose</span><span class="op">(</span><span class="va">w_ep</span><span class="op">$</span><span class="va">Dose</span><span class="op">)</span></span>
<span><span class="va">w_ep</span><span class="op">$</span><span class="va">Dose_factor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">w_ep</span><span class="op">$</span><span class="va">Dose_numeric</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">w_ep</span><span class="op">$</span><span class="va">Dose_numeric</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">res_william</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/broom_williams.html">broom_williams</a></span><span class="op">(</span><span class="va">Response</span> <span class="op">~</span> <span class="va">Dose_factor</span>, data <span class="op">=</span> <span class="va">w_ep</span>,</span>
<span>               test <span class="op">=</span> <span class="st">"Williams_PMCMRplus"</span>, alpha <span class="op">=</span> <span class="fl">0.05</span>, alternative <span class="op">=</span> <span class="st">"less"</span><span class="op">)</span></span>
<span><span class="va">mdd_w_pm</span> <span class="op">&lt;-</span> <span class="fu">compute_mdd_generic</span><span class="op">(</span><span class="va">Response</span> <span class="op">~</span> <span class="va">Dose_factor</span>, data <span class="op">=</span> <span class="va">w_ep</span>,</span>
<span>                                test <span class="op">=</span> <span class="st">"Williams_PMCMRplus"</span>, alpha <span class="op">=</span> <span class="fl">0.05</span>, alternative <span class="op">=</span> <span class="st">"smaller"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">mdd_w_pm</span><span class="op">)</span></span></code></pre></div>
<ul>
<li>Dunnett:</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mdd_dunn</span> <span class="op">&lt;-</span> <span class="fu">compute_mdd_generic</span><span class="op">(</span><span class="va">Response</span> <span class="op">~</span> <span class="va">Dose_factor</span>, data <span class="op">=</span> <span class="va">w_ep</span>,</span>
<span>                                test <span class="op">=</span> <span class="st">"Dunnett"</span>, alpha <span class="op">=</span> <span class="fl">0.05</span>, alternative <span class="op">=</span> <span class="st">"smaller"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">mdd_dunn</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="sc">-</span> Student’s <span class="fu">t</span> (pooled, control vs each dose)<span class="sc">:</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>mdd_t <span class="ot">&lt;-</span> <span class="fu">compute_mdd_generic</span>(Response <span class="sc">~</span> Dose_factor, <span class="at">data =</span> w_ep,</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>                             <span class="at">test =</span> <span class="st">"t"</span>, <span class="at">alpha =</span> <span class="fl">0.05</span>, <span class="at">alternative =</span> <span class="st">"smaller"</span>)</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="fu">print</span>(mdd_t)</span></code></pre></div>
<ul>
<li>Welch:</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mdd_welch</span> <span class="op">&lt;-</span> <span class="fu">compute_mdd_generic</span><span class="op">(</span><span class="va">Response</span> <span class="op">~</span> <span class="va">Dose_factor</span>, data <span class="op">=</span> <span class="va">w_ep</span>,</span>
<span>                                 test <span class="op">=</span> <span class="st">"Welch"</span>, alpha <span class="op">=</span> <span class="fl">0.05</span>, alternative <span class="op">=</span> <span class="st">"two-sided"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">mdd_welch</span><span class="op">)</span></span></code></pre></div>
<p>Notes and options - Alternative handling: MDD uses a critical value
magnitude; the choice of one-sided vs two-sided changes the quantile. If
your expected MDD% was computed with two-sided thresholds, set
alternative = “two-sided”. - For Dunnett, the adjusted Tcrit is taken
from <code>summary(glht)$test$qfunction</code>. If unavailable, we
fallback to unadjusted qt with residual df. - For
<code>Williams_JG</code>, comparison strings might not carry doses; we
assign doses in ascending order excluding control. If you need exact
mapping, we can inspect the internal <code>williamsTest_JG</code> output
via drcHelper to align rows to doses. - You can extend the test argument
to include other tests (e.g., “Dunn”) once you define the appropriate
Tcrit. Dunn typically uses z critical values; for MDD you would use
zcrit × SE_diff on a rank-based scale, which is a different construct;
unless your expected MDD% is defined explicitly for Dunn, I recommend
sticking to parametric tests above. - If you’d like me to integrate this
into your validation report, I can add an MDD% metric branch that uses
compute_mdd_generic under the hood and compares to expected “MDD%” rows
for Williams.</p>
</div>
<div class="section level2">
<h2 id="implementation-in-drchelper">Implementation in <code>drcHelper</code><a class="anchor" aria-label="anchor" href="#implementation-in-drchelper"></a>
</h2>
<p>Reusing existing test objects and building a modular system around
them is far more efficient and robust.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bayer-group.github.io/drcHelper/index.html">drcHelper</a></span><span class="op">)</span></span>
<span><span class="va">Results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/broom_williams.html">broom_williams</a></span><span class="op">(</span><span class="va">Response</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">Dose</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">dat_medium</span>,</span>
<span>               test <span class="op">=</span> <span class="st">"Williams_JG"</span>, alpha <span class="op">=</span> <span class="fl">0.05</span>, alternative <span class="op">=</span> <span class="st">"less"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/compute_mdd_williams.html">compute_mdd_williams</a></span><span class="op">(</span><span class="va">Results</span>,data<span class="op">=</span><span class="va">dat_medium</span>,formula <span class="op">=</span> <span class="va">Response</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">Dose</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 2</span></span></span>
<span><span class="co">#&gt;    Dose MDD_pct</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>  0.94    8.24</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>  1.88    8.57</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>  3.75    8.68</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>  7.5     8.72</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 15       8.76</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 30       8.76</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="implementation-in-the-validation-for-williams">Implementation in the Validation for Williams<a class="anchor" aria-label="anchor" href="#implementation-in-the-validation-for-williams"></a>
</h2>
<p>Here’s a self-contained helper to compute per-dose MDD% for Williams
and return a tidy table. It uses your existing helpers and
broom_williams output.</p>
</div>
<div class="section level2">
<h2 id="how-to-integrate-into-the-validation-workflow">How to integrate into the validation workflow<a class="anchor" aria-label="anchor" href="#how-to-integrate-into-the-validation-workflow"></a>
</h2>
<ul>
<li>In the Williams run_actual handler, compute the prelim summary as
before (for Mean, SD, %Inhibition, CV), and also compute MDD%:</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prelim</span> <span class="op">&lt;-</span> <span class="fu">compute_prelim_summary</span><span class="op">(</span><span class="va">endpoint_data</span><span class="op">)</span></span>
<span><span class="va">mdd_tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_mdd_williams.html">compute_mdd_williams</a></span><span class="op">(</span><span class="va">endpoint_data</span>, alternative <span class="op">=</span> <span class="va">alternative</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Return both; the generic runner can join MDD% when expected rows exist</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>actual_df <span class="op">=</span> <span class="va">actual_df</span>, group_means <span class="op">=</span> <span class="va">prelim</span>, mdd <span class="op">=</span> <span class="va">mdd_tbl</span><span class="op">)</span></span></code></pre></div>
<ul>
<li>In your expected parsing (parse_expected_metrics for Williams), you
already capture “MDD%”:</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out</span><span class="op">$</span><span class="va">mdd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pick.html" class="external-link">pick</a></span><span class="op">(</span><span class="st">"\\bMDD%\\b"</span><span class="op">)</span>; </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">out</span><span class="op">$</span><span class="va">mdd</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Expected_MDDpct"</span></span></code></pre></div>
<ul>
<li>In the generic runner’s join stage for Williams, add:</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">exp_splits</span><span class="op">$</span><span class="va">mdd</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">exp_splits</span><span class="op">$</span><span class="va">mdd</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">mdd_join</span> <span class="op">&lt;-</span> <span class="va">exp_splits</span><span class="op">$</span><span class="va">mdd</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">actual</span><span class="op">$</span><span class="va">mdd</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Dose"</span>, <span class="st">"Actual_MDDpct"</span><span class="op">)</span><span class="op">]</span>, by <span class="op">=</span> <span class="st">"Dose"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      Endpoint <span class="op">=</span> <span class="va">endpoint</span>,</span>
<span>      Diff <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">Actual_MDDpct</span> <span class="op">-</span> <span class="va">Expected_MDDpct</span><span class="op">)</span>,</span>
<span>      Status <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">Expected_MDDpct</span><span class="op">)</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">Actual_MDDpct</span><span class="op">)</span> <span class="op">~</span> <span class="st">"MISSING"</span>,</span>
<span>        <span class="va">Diff</span> <span class="op">&lt;=</span> <span class="va">tolerance</span> <span class="op">~</span> <span class="st">"PASS"</span>, <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"FAIL"</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/transmute.html" class="external-link">transmute</a></span><span class="op">(</span><span class="va">Endpoint</span>, <span class="va">Dose</span>, metric <span class="op">=</span> <span class="st">"MDD%"</span>, Actual <span class="op">=</span> <span class="va">Actual_MDDpct</span>, Expected <span class="op">=</span> <span class="va">Expected_MDDpct</span>, <span class="va">Status</span><span class="op">)</span></span>
<span>  <span class="va">pieces</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">pieces</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">mdd_join</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="section level4">
<h4 id="handling-greater-vs-smaller">Handling “greater” vs “smaller”<a class="anchor" aria-label="anchor" href="#handling-greater-vs-smaller"></a>
</h4>
<ul>
<li>The formula for MDD% doesn’t change with direction; it’s the minimum
absolute difference required for significance. You typically compare
magnitudes (positive values). If you want to encode a “directional” MDD%
(signed), you can attach sign = ifelse(alternative==“greater”, +1, -1)
and report MDD%*sign, but most reports use a positive threshold.</li>
</ul>
</div>
<div class="section level4">
<h4 id="unequal-sample-sizes-and-heteroscedasticity">Unequal sample sizes and heteroscedasticity<a class="anchor" aria-label="anchor" href="#unequal-sample-sizes-and-heteroscedasticity"></a>
</h4>
<ul>
<li>The SE_diff above already handles unequal n via 1/n_c + 1/n_t.</li>
<li>If variances are heterogeneous and a Welch-type approach is used,
you would estimate SE_diff via group-specific variances. Williams is
based on a pooled-variance ANOVA, so the pooled MSE is appropriate
here.</li>
</ul>
</div>
<div class="section level3">
<h3 id="optional-power-based-mdd">Optional: power-based MDD%<a class="anchor" aria-label="anchor" href="#optional-power-based-mdd"></a>
</h3>
<ul>
<li>If we later need to compute a power-based MDD% (target power 1−β),
use:
<ul>
<li><span class="math display">\[MDD_{power} = \left(t_{1-\alpha,\ df} +
t_{1-\beta,\ df}\right) \cdot SE_{diff}\]</span></li>
<li>Then <span class="math display">\[MDD\%_{power} = 100 \cdot
MDD_{power} / \mu_c\]</span>
</li>
</ul>
</li>
<li>df can be taken from the residual df of the ANOVA model. You can
parameterize β (e.g., 0.2 for 80% power) and compute the quantiles using
stats::qt.</li>
</ul>
</div>
<div class="section level3">
<h3 id="notes">Notes<a class="anchor" aria-label="anchor" href="#notes"></a>
</h3>
<p>We probably need to adjust if the expected MDD% uses a different SE
(e.g., contrast-specific SE in Williams instead of the simple (1/n_c +
1/n_t) form).</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Zhenglei Gao, Sean Ryan.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
