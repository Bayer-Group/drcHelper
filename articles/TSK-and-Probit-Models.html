<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>TSK and Probit Models • drcHelper</title>
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="TSK and Probit Models">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">drcHelper</a>

    <small class="nav-text text-default me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.0.4.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-get-started" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Get Started</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-get-started">
<li><a class="dropdown-item" href="../articles/Introduction.html">Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/Example_Analysis_Workflow.html">Example Analysis Workflow</a></li>
    <li><a class="dropdown-item" href="../articles/drcHelper.html">Example ECx Helper Functions Usage</a></li>
    <li><a class="dropdown-item" href="../articles/Dunnetts_Test_for_Data_with_Hierarchical_Structure.html">Example NOEC Helper Functions Usage</a></li>
    <li><a class="dropdown-item" href="../articles/Examples_drc.html">Using DRC and BMD</a></li>
    <li><a class="dropdown-item" href="../articles/Examples_oecd201.html">Example DRC - OECD 201</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-regulatory-stats" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Regulatory Stats</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-regulatory-stats">
<li><a class="dropdown-item" href="../articles/NOEC_Methods.html">NOEC Calculations</a></li>
    <li><a class="dropdown-item" href="../articles/Limit-Test.html">Limit Test Calculations</a></li>
    <li><a class="dropdown-item" href="../articles/EFSA-Criteria.html">EFSA Criteria and Other Reliability Criteria</a></li>
    <li><a class="dropdown-item" href="../articles/Example_RSCABS.html">RSCABS</a></li>
    <li><a class="dropdown-item" href="../articles/Trend-Testing.html">Trend Testing</a></li>
    <li><a class="dropdown-item" href="../articles/NOEC_ECx_BMD.html">NOEC ECx and BMD</a></li>
  </ul>
</li>
<li class="nav-item"><h6 class="dropdown-header" data-toc-skip>Articles</h6></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-validation" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Validation</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-validation">
<li><a class="dropdown-item" href="../articles/System_Testing.html">System Testing</a></li>
    <li><a class="dropdown-item" href="../articles/val_ED_plus.html">ED Calculation Consistency</a></li>
    <li><a class="dropdown-item" href="../articles/TSK-and-Probit-Models.html">TSK and Probit Model</a></li>
    <li><a class="dropdown-item" href="../articles/Verification_which_JT.html">Which JT test to use</a></li>
    <li><a class="dropdown-item" href="../articles/Test-Guidelines.html">Study Types and Templates</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Bayer-Group/drcHelper/issues/new?template=Blank+issue" aria-label="New Issue"><span class="fa fa-bug"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Bayer-Group/drcHelper" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<script src="TSK-and-Probit-Models_files/kePrint-0.0.1/kePrint.js"></script><link href="TSK-and-Probit-Models_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>TSK and Probit Models</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Bayer-Group/drcHelper/blob/main/vignettes/articles/TSK-and-Probit-Models.Rmd" class="external-link"><code>vignettes/articles/TSK-and-Probit-Models.Rmd</code></a></small>
      <div class="d-none name"><code>TSK-and-Probit-Models.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bayer-group.github.io/drcHelper/index.html">drcHelper</a></span><span class="op">)</span></span>
<span><span class="co">## Loading required package: drc</span></span>
<span><span class="co">## Loading required package: MASS</span></span>
<span><span class="co">## Loading required package: drcData</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## 'drc' has been loaded.</span></span>
<span><span class="co">## Please cite R and 'drc' if used for a publication,</span></span>
<span><span class="co">## for references type 'citation()' and 'citation('drc')'.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'drc'</span></span>
<span><span class="co">## The following objects are masked from 'package:stats':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     gaussian, getInitial</span></span></code></pre></div>
<div class="section level2">
<h2 id="trimmed-spearman-karber-tsk-method">Trimmed Spearman-Karber (TSK) Method<a class="anchor" aria-label="anchor" href="#trimmed-spearman-karber-tsk-method"></a>
</h2>
<p>The Trimmed Spearman-Karber (TSK) method is a statistical technique
used primarily in toxicology and ecotoxicology to estimate the median
effective dose/concentration/rate (ED50, EC50, ER50) or median lethal
concentration (LC50) from dose-response data. It builds on the original
Spearman-Karber method, which is a non-parametric approach for
calculating the point where 50% of the test subjects respond (e.g., dead
or symptom present). The “trimmed” aspect, introduced by Hamilton et
al. in 1977, enhances robustness by excluding extreme data points where
the response proportions are near 0% or 100%, reducing bias from
incomplete dose ranges.</p>
<div class="section level3">
<h3 id="how-the-tsk-approach-works">How the TSK Approach Works<a class="anchor" aria-label="anchor" href="#how-the-tsk-approach-works"></a>
</h3>
<p>The TSK method approximates the mean of the underlying tolerance
distribution, assuming it is symmetric on a logarithmic scale (common
for concentrations). It processes data through several steps to compute
the ED50 (referred to as <code>mu</code> in the provided code), its
variance, geometric standard deviation (GSD), and confidence intervals.
Here’s a breakdown based on the algorithm in the code and standard
descriptions:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Input Validation and Data Preparation</strong>:
<ul>
<li>Inputs include: <code>x</code> (vector of doses or concentrations,
must be positive and increasing), <code>r</code> (number of responses,
e.g., deaths), <code>n</code> (number of subjects tested per dose),
<code>A</code> (trim level, 0 ≤ A &lt; 0.5, default 0), and
<code>conf</code> (confidence level, 0.5 &lt; conf &lt; 1, default
0.95).</li>
<li>Doses are log-transformed (base 10) for symmetry. If the first dose
is 0 (control), it’s handled by scaling responses or issuing warnings if
non-zero.</li>
<li>Proportions <code>p = r/n</code> are calculated.</li>
</ul>
</li>
</ol>
<p>Below is an example data set from the R package ecotoxicology.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example data</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">15.54</span>, <span class="fl">20.47</span>, <span class="fl">27.92</span>, <span class="fl">35.98</span>, <span class="fl">55.52</span><span class="op">)</span>,</span>
<span>  r <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">20</span><span class="op">)</span>,</span>
<span>  n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">20</span>, <span class="fl">20</span>, <span class="fl">19</span>, <span class="fl">20</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>
<strong>Smoothing</strong>:
<ul>
<li>If proportions are not monotonically increasing (which can happen
due to sampling variability), adjacent non-increasing values are
averaged to enforce monotonicity. This prevents artifacts in
estimation.</li>
</ul>
</li>
<li>
<strong>Scaling and Trimming</strong>:
<ul>
<li>Proportions are scaled: <code>p_scaled = (p - A) / (1 - 2*A)</code>
to focus on the central response range (A to 1-A).</li>
<li>Data points where p ≤ A or p ≥ 1-A are trimmed. Linear interpolation
adds virtual points at exactly 0% and 100% response if needed, ensuring
the trimmed dataset spans from 0 to 1.</li>
<li>This trimming avoids over-reliance on tails where variability is
high or data is sparse.</li>
</ul>
</li>
<li>
<strong>Estimation of the Median (mu)</strong>:
<ul>
<li>The trimmed log-doses and differences in proportions
(<code>delp</code>) are used to compute the midpoint averages.</li>
<li>The log-median is
<code>logmu = sum((x_i + x_{i+1})/2 * delp_i)</code>, a weighted average
approximating the mean of the log-tolerance distribution.</li>
<li>The median dose is <code>mu = 10^logmu</code>.</li>
</ul>
</li>
<li>
<strong>Variance and Confidence Intervals</strong>:
<ul>
<li>Variance is calculated using specialized functions (V1 to V6 in the
code) based on the positions of lower (L) and upper (U) bounds around
the trim.</li>
<li>These account for binomial variability in proportions and dose
spacings, scaled by <code>(2 - 4*A)^2</code>.</li>
<li>GSD = <code>10^sqrt(Var)</code>, representing dispersion.</li>
<li>Confidence limits use the inverse error function: left =
<code>mu * gsd^(-v)</code>, right = <code>mu * gsd^v</code>, where
<code>v = sqrt(2) * erfinv(conf)</code> for approximate normality on log
scale.</li>
</ul>
</li>
<li>
<strong>Output and Visualization</strong>:
<ul>
<li>Returns <code>mu</code>, <code>gsd</code>, <code>left</code>, and
<code>right</code>.</li>
<li>The code includes plotting: response curve, median point, and error
bars for confidence.</li>
</ul>
</li>
</ol>
<p>This method is computationally simple, non-iterative, and excels in
handling datasets where full 0-100% response isn’t achieved.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load libraries for probit analyses</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/" class="external-link">MASS</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.r-project.org" class="external-link">drc</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute TSK</span></span>
<span><span class="va">tsk_result_ecotox</span> <span class="op">&lt;-</span> <span class="fu">ecotoxicology</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ecotoxicology/man/TSK.html" class="external-link">TSK</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">x</span>, <span class="va">data</span><span class="op">$</span><span class="va">r</span>, <span class="va">data</span><span class="op">$</span><span class="va">n</span>, A <span class="op">=</span> <span class="fl">0</span>, conf <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span></span></code></pre></div>
<p><img src="TSK-and-Probit-Models_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"TSK Results:"</span><span class="op">)</span></span>
<span><span class="co">## [1] "TSK Results:"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">tsk_result_ecotox</span><span class="op">)</span></span>
<span><span class="co">## $mu</span></span>
<span><span class="co">## [1] 43.89339</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $gsd</span></span>
<span><span class="co">##        x </span></span>
<span><span class="co">## 1.017763 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $left</span></span>
<span><span class="co">##        x </span></span>
<span><span class="co">## 42.40451 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $right</span></span>
<span><span class="co">##        x </span></span>
<span><span class="co">## 45.43455</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="validation-against-ecotoxicologytsk">Validation against <code>ecotoxicology::TSK</code><a class="anchor" aria-label="anchor" href="#validation-against-ecotoxicologytsk"></a>
</h3>
<p>This part validate that the tsk function included in the drcHelper
function computes TSK estimate and confidence intervals matching
ecotoxicology::TSK.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bayer-group.github.io/drcHelper/index.html">drcHelper</a></span><span class="op">)</span></span>
<span><span class="va">tsk_result_drc</span> <span class="op">&lt;-</span> <span class="fu">drcHelper</span><span class="fu">::</span><span class="fu"><a href="../reference/tsk.html">tsk</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">x</span>,</span>
<span>  r <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">r</span>,</span>
<span>  n <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">n</span>,</span>
<span>  control <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  trim <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  conf.level <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  use.log.doses <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"TSK Results from drcHelper:"</span><span class="op">)</span></span>
<span><span class="co">## [1] "TSK Results from drcHelper:"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">tsk_result_drc</span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Trimmed Spearman-Karber method using 0 percent trim</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Data was not smoothed</span></span>
<span><span class="co">## Calculation done using the logs of the doses</span></span>
<span><span class="co">## Estimated LD50: 43.89339 GSD of estimate: 1.017763</span></span>
<span><span class="co">## 95 percent confidence interval on LD50:</span></span>
<span><span class="co">##  42.40451 45.43455</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">comparison_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Metric <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"LD50/Mu"</span>, <span class="st">"GSD"</span>, <span class="st">"CI Lower"</span>, <span class="st">"CI Upper"</span><span class="op">)</span>,</span>
<span>  ecotoxicology_TSK <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">tsk_result_ecotox</span><span class="op">$</span><span class="va">mu</span>, <span class="va">tsk_result_ecotox</span><span class="op">$</span><span class="va">gsd</span>, <span class="va">tsk_result_ecotox</span><span class="op">$</span><span class="va">left</span>, <span class="va">tsk_result_ecotox</span><span class="op">$</span><span class="va">right</span><span class="op">)</span>,</span>
<span>  drcHelper_tsk <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">tsk_result_drc</span><span class="op">$</span><span class="va">LD50</span>, <span class="va">tsk_result_drc</span><span class="op">$</span><span class="va">gsd</span>, <span class="va">tsk_result_drc</span><span class="op">$</span><span class="va">conf.int</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">tsk_result_drc</span><span class="op">$</span><span class="va">conf.int</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  Difference <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">tsk_result_ecotox</span><span class="op">$</span><span class="va">mu</span> <span class="op">-</span> <span class="va">tsk_result_drc</span><span class="op">$</span><span class="va">LD50</span>,</span>
<span>                     <span class="va">tsk_result_ecotox</span><span class="op">$</span><span class="va">gsd</span> <span class="op">-</span> <span class="va">tsk_result_drc</span><span class="op">$</span><span class="va">gsd</span>,</span>
<span>                     <span class="va">tsk_result_ecotox</span><span class="op">$</span><span class="va">left</span> <span class="op">-</span> <span class="va">tsk_result_drc</span><span class="op">$</span><span class="va">conf.int</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>                     <span class="va">tsk_result_ecotox</span><span class="op">$</span><span class="va">right</span> <span class="op">-</span> <span class="va">tsk_result_drc</span><span class="op">$</span><span class="va">conf.int</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  Validated <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">tsk_result_ecotox</span><span class="op">$</span><span class="va">mu</span> <span class="op">-</span> <span class="va">tsk_result_drc</span><span class="op">$</span><span class="va">LD50</span>,</span>
<span>                    <span class="va">tsk_result_ecotox</span><span class="op">$</span><span class="va">gsd</span> <span class="op">-</span> <span class="va">tsk_result_drc</span><span class="op">$</span><span class="va">gsd</span>,</span>
<span>                    <span class="va">tsk_result_ecotox</span><span class="op">$</span><span class="va">left</span> <span class="op">-</span> <span class="va">tsk_result_drc</span><span class="op">$</span><span class="va">conf.int</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>                    <span class="va">tsk_result_ecotox</span><span class="op">$</span><span class="va">right</span> <span class="op">-</span> <span class="va">tsk_result_drc</span><span class="op">$</span><span class="va">conf.int</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">0.0001</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://haozhu233.github.io/kableExtra/" class="external-link">kableExtra</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">comparison_table</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html" class="external-link">kable_styling</a></span><span class="op">(</span>bootstrap_options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"striped"</span>, <span class="st">"hover"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/row_spec.html" class="external-link">row_spec</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">comparison_table</span><span class="op">$</span><span class="va">Validated</span><span class="op">)</span>, background <span class="op">=</span> <span class="st">"#FFCCCC"</span><span class="op">)</span></span></code></pre></div>
<table class="table table table-striped table-hover" style="margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:left;">
Metric
</th>
<th style="text-align:right;">
ecotoxicology_TSK
</th>
<th style="text-align:right;">
drcHelper_tsk
</th>
<th style="text-align:right;">
Difference
</th>
<th style="text-align:left;">
Validated
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
LD50/Mu
</td>
<td style="text-align:right;">
43.893393
</td>
<td style="text-align:right;">
43.893393
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
GSD
</td>
<td style="text-align:right;">
1.017763
</td>
<td style="text-align:right;">
1.017763
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
CI Lower
</td>
<td style="text-align:right;">
42.404509
</td>
<td style="text-align:right;">
42.404509
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
CI Upper
</td>
<td style="text-align:right;">
45.434553
</td>
<td style="text-align:right;">
45.434553
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="compare-with-probit-glm-and-drc">Compare with Probit GLM and DRC<a class="anchor" aria-label="anchor" href="#compare-with-probit-glm-and-drc"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Probit GLM (binomial family)</span></span>
<span><span class="va">model_glm_log10</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">r</span>, <span class="va">n</span> <span class="op">-</span> <span class="va">r</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"probit"</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span>
<span><span class="co">## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">model_glm_log10</span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## glm(formula = cbind(r, n - r) ~ log10(x), family = binomial(link = "probit"), </span></span>
<span><span class="co">##     data = data)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##             Estimate Std. Error z value Pr(&gt;|z|)</span></span>
<span><span class="co">## (Intercept)   -73.32   76403.95  -0.001    0.999</span></span>
<span><span class="co">## log10(x)       46.08   49100.87   0.001    0.999</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## (Dispersion parameter for binomial family taken to be 1)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     Null deviance: 9.4482e+01  on 4  degrees of freedom</span></span>
<span><span class="co">## Residual deviance: 4.6395e-10  on 3  degrees of freedom</span></span>
<span><span class="co">## AIC: 5.9464</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Number of Fisher Scoring iterations: 25</span></span>
<span><span class="va">lc50_glm_log10</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MASS/man/dose.p.html" class="external-link">dose.p</a></span><span class="op">(</span><span class="va">model_glm_log10</span>, cf <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, p <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"GLM Probit LC50 (with SE):"</span><span class="op">)</span></span>
<span><span class="co">## [1] "GLM Probit LC50 (with SE):"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">lc50_glm_log10</span><span class="op">)</span></span>
<span><span class="co">##              Dose       SE</span></span>
<span><span class="co">## p = 0.5: 1.591216 37.46047</span></span>
<span></span>
<span><span class="va">lc50_glm_log10_val</span> <span class="op">&lt;-</span> <span class="fl">10</span><span class="op">^</span><span class="va">lc50_glm_log10</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">lc50_glm_log10_val</span></span>
<span><span class="co">## p = 0.5: </span></span>
<span><span class="co">## 39.01356</span></span>
<span><span class="va">lc50_glm_log10_se</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">lc50_glm_log10</span>, <span class="st">"SE"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">a_glm_log10</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">model_glm_log10</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">b_glm_log10</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">model_glm_log10</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">lc50_glm_log10</span> <span class="op">==</span> <span class="op">-</span><span class="va">a_glm_log10</span><span class="op">/</span><span class="va">b_glm_log10</span></span>
<span><span class="co">## p = 0.5: </span></span>
<span><span class="co">##     TRUE</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_glm_log</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">r</span>, <span class="va">n</span> <span class="op">-</span> <span class="va">r</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"probit"</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span>
<span><span class="co">## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</span></span>
<span><span class="va">lc50_glm_log</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MASS/man/dose.p.html" class="external-link">dose.p</a></span><span class="op">(</span><span class="va">model_glm_log</span>, cf <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, p <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="va">lc50_glm_log_val</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">lc50_glm_log</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">lc50_glm_log_se</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">lc50_glm_log</span>, <span class="st">"SE"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">a_glm_log</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">model_glm_log</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">b_glm_log</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">model_glm_log</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">a_glm_log</span></span>
<span><span class="co">## (Intercept) </span></span>
<span><span class="co">##   -73.32047</span></span>
<span><span class="va">a_glm_log10</span></span>
<span><span class="co">## (Intercept) </span></span>
<span><span class="co">##   -73.32047</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Probit DRC (LN.2 with binomial)</span></span>
<span><span class="va">model_drc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/drc/man/drm.html" class="external-link">drm</a></span><span class="op">(</span><span class="va">r</span><span class="op">/</span><span class="va">n</span> <span class="op">~</span> <span class="va">x</span>, fct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/drc/man/lnormal.html" class="external-link">LN.2</a></span><span class="op">(</span><span class="op">)</span>, weight <span class="op">=</span> <span class="va">n</span>, type <span class="op">=</span> <span class="st">"binomial"</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">model_drc</span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Model fitted: Log-normal with lower limit at 0 and upper limit at 1 (2 parms)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Parameter estimates:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##               Estimate Std. Error t-value p-value  </span></span>
<span><span class="co">## b:(Intercept)   14.168     63.140  0.2244 0.82245  </span></span>
<span><span class="co">## e:(Intercept)   40.338     20.573  1.9607 0.04991 *</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="va">ed50_drc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/drc/man/ED.drc.html" class="external-link">ED</a></span><span class="op">(</span><span class="va">model_drc</span>, <span class="fl">50</span>, interval <span class="op">=</span> <span class="st">"inv"</span><span class="op">)</span> <span class="co">## note. if here using delta, very wide CI. </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Estimated effective doses</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##        Estimate  Lower  Upper</span></span>
<span><span class="co">## e:1:50   40.338 36.681 48.478</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/drc/man/ED.drc.html" class="external-link">ED</a></span><span class="op">(</span><span class="va">model_drc</span>, <span class="fl">50</span>, interval <span class="op">=</span> <span class="st">"delta"</span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Estimated effective doses</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##         Estimate Std. Error     Lower     Upper</span></span>
<span><span class="co">## e:1:50 40.337797  20.572946  0.015564 80.660031</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"DRC Probit ED50/LC50 (with CI):"</span><span class="op">)</span></span>
<span><span class="co">## [1] "DRC Probit ED50/LC50 (with CI):"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">ed50_drc</span><span class="op">)</span></span>
<span><span class="co">##        Estimate    Lower    Upper</span></span>
<span><span class="co">## e:1:50  40.3378 36.68111 48.47803</span></span>
<span><span class="va">drc_lc50</span> <span class="op">&lt;-</span> <span class="va">ed50_drc</span><span class="op">[</span><span class="fl">1</span>, <span class="st">"Estimate"</span><span class="op">]</span></span>
<span><span class="va">drc_ci</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">ed50_drc</span><span class="op">[</span><span class="fl">1</span>, <span class="st">"Lower"</span><span class="op">]</span>, <span class="va">ed50_drc</span><span class="op">[</span><span class="fl">1</span>, <span class="st">"Upper"</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model_drc_loge</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/drc/man/drm.html" class="external-link">drm</a></span><span class="op">(</span><span class="va">r</span><span class="op">/</span><span class="va">n</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, fct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/drc/man/lnormal.html" class="external-link">LN.2</a></span><span class="op">(</span><span class="op">)</span>, weight <span class="op">=</span> <span class="va">n</span>, type <span class="op">=</span> <span class="st">"binomial"</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/drc/man/ED.drc.html" class="external-link">ED</a></span><span class="op">(</span><span class="va">model_drc_loge</span>, <span class="fl">50</span>, interval <span class="op">=</span> <span class="st">"delta"</span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Estimated effective doses</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##        Estimate Std. Error   Lower   Upper</span></span>
<span><span class="co">## e:1:50  3.69711    0.32517 3.05979 4.33442</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/drc/man/ED.drc.html" class="external-link">ED</a></span><span class="op">(</span><span class="va">model_drc_loge</span>, <span class="fl">50</span>, interval <span class="op">=</span> <span class="st">"fls"</span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Estimated effective doses</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##        Estimate  Lower  Upper</span></span>
<span><span class="co">## e:1:50   40.330 21.323 76.281</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://haozhu233.github.io/kableExtra/" class="external-link">kableExtra</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">comparison_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Trimmed Spearman-Karber (TSK)"</span>, <span class="st">"Probit GLM (log10)"</span>, <span class="st">"Probit GLM (log)"</span>, <span class="st">"Probit DRC (LN.2, delta)"</span>, <span class="st">"Probit DRC (LN.2, inv)"</span><span class="op">)</span>,</span>
<span>  LC50 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">43.89339</span>, <span class="fl">39.01356</span>, <span class="fl">39.01356</span>, <span class="fl">40.3378</span>,<span class="fl">40.3378</span><span class="op">)</span>,</span>
<span>  Lower_95_CI <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">42.40451</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="fl">0.015564</span>,<span class="fl">36.681</span><span class="op">)</span>,</span>
<span>  Upper_95_CI <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">45.43455</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="fl">80.66003</span>,<span class="fl">48.478</span><span class="op">)</span>,</span>
<span>  <span class="co">#SE = c(NA, 37.46047, lc50_glm_log_se, NA),</span></span>
<span>  Notes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Non-parametric, robust to model fit issues"</span>,</span>
<span>            <span class="st">"Fitting issues (probabilities 0 or 1 warning)"</span>,</span>
<span>            <span class="st">"Fitting issues (probabilities 0 or 1 warning)"</span>,</span>
<span>            <span class="st">"If using delta method, wide CI due to sparse data at high doses"</span>,</span>
<span>            <span class="st">"robust to sparse data with inverse regression CI"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">comparison_table</span>, format <span class="op">=</span> <span class="st">"markdown"</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html" class="external-link">kable_styling</a></span><span class="op">(</span>bootstrap_options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"striped"</span>, <span class="st">"hover"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/column_spec.html" class="external-link">column_spec</a></span><span class="op">(</span><span class="fl">5</span>, width <span class="op">=</span> <span class="st">"4.5in"</span><span class="op">)</span></span></code></pre></div>
<table class="table table table-striped table-hover" style="margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:left;">
Method
</th>
<th style="text-align:right;">
LC50
</th>
<th style="text-align:right;">
Lower_95_CI
</th>
<th style="text-align:right;">
Upper_95_CI
</th>
<th style="text-align:left;">
Notes
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
Trimmed Spearman-Karber (TSK)
</td>
<td style="text-align:right;">
43.893
</td>
<td style="text-align:right;">
42.405
</td>
<td style="text-align:right;">
45.435
</td>
<td style="text-align:left;width: 4.5in; ">
Non-parametric, robust to model fit issues
</td>
</tr>
<tr>
<td style="text-align:left;">
Probit GLM (log10)
</td>
<td style="text-align:right;">
39.014
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;width: 4.5in; ">
Fitting issues (probabilities 0 or 1 warning)
</td>
</tr>
<tr>
<td style="text-align:left;">
Probit GLM (log)
</td>
<td style="text-align:right;">
39.014
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;width: 4.5in; ">
Fitting issues (probabilities 0 or 1 warning)
</td>
</tr>
<tr>
<td style="text-align:left;">
Probit DRC (LN.2, delta)
</td>
<td style="text-align:right;">
40.338
</td>
<td style="text-align:right;">
0.016
</td>
<td style="text-align:right;">
80.660
</td>
<td style="text-align:left;width: 4.5in; ">
If using delta method, wide CI due to sparse data at high doses
</td>
</tr>
<tr>
<td style="text-align:left;">
Probit DRC (LN.2, inv)
</td>
<td style="text-align:right;">
40.338
</td>
<td style="text-align:right;">
36.681
</td>
<td style="text-align:right;">
48.478
</td>
<td style="text-align:left;width: 4.5in; ">
robust to sparse data with inverse regression CI
</td>
</tr>
</tbody>
</table>
<p>The TSK and DRC estimates are close (43.89 vs. 40.34), suggesting
robustness, while GLM’s estimate (39.01) with a large SE (SE = 37.46047)
indicates fitting issues (caused by fitted probabilities numerically 0
or 1 occurred ). Given the warning in GLM, I’d trust TSK or DRC more for
this dataset.</p>
<div class="section level4">
<h4 id="what-kind-of-data-should-be-used">What Kind of Data Should Be Used<a class="anchor" aria-label="anchor" href="#what-kind-of-data-should-be-used"></a>
</h4>
<p>TSK is designed for quantal (binary) bioassay data from toxicity
tests, such as acute lethality studies in aquatic organisms (e.g., fish,
Daphnia) or other dose-response experiments. Key characteristics:</p>
<ul>
<li>
<strong>Data Structure</strong>:
<ul>
<li>Doses (<code>x</code>): A vector of increasing positive
concentrations (e.g., chemical levels in mg/L). Zero-dose controls are
allowed but handled specially.</li>
<li>Responses (<code>r</code>): Counts of affected subjects (e.g., dead
organisms) at each dose.</li>
<li>Sample sizes (<code>n</code>): Number of subjects tested per dose
(can be constant or vary).</li>
<li>Proportions (<code>p = r/n</code>): Should ideally span near 0 to
near 1 across doses, but trimming allows for incomplete coverage if A is
adjusted.</li>
</ul>
</li>
<li>
<strong>Requirements</strong>:
<ul>
<li>At least one dose with partial response (0 &lt; p &lt; 1) for
meaningful estimation.</li>
<li>Doses in strictly increasing order; responses non-negative and ≤
n.</li>
<li>Suitable for small to moderate sample sizes (e.g., n=10-20 per dose,
4-6 doses).</li>
<li>Assumes logarithmic spacing for symmetry, so concentrations (not
logs) are input.</li>
</ul>
</li>
<li>
<strong>Typical Applications</strong>: Data from experiments where
responses are binomial (e.g., dead/alive) and doses are discrete. It’s
robust to irregular dose spacing and doesn’t require normality
assumptions.</li>
</ul>
<p>If responses don’t cover A to 1-A, the code suggests increasing A or
warns of invalid trims.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="comparison-to-standard-probit-analysis">Comparison to Standard Probit Analysis<a class="anchor" aria-label="anchor" href="#comparison-to-standard-probit-analysis"></a>
</h2>
<p>Here I wil compare the <code>tsk</code> function from
<code>drcHelper</code> with the Probit GLM and Probit DRC approaches for
estimating LC50 (or ED50) values. I’ll also explain the differences and
similarities among these three methods and provide details on
transforming results between Probit GLM and Probit DRC.</p>
<div class="section level3">
<h3 id="overview-of-the-three-methods">Overview of the Three Methods<a class="anchor" aria-label="anchor" href="#overview-of-the-three-methods"></a>
</h3>
<ol style="list-style-type: decimal">
<li>
<p><strong>Trimmed Spearman-Karber (TSK) -
<code><a href="../reference/tsk.html">drcHelper::tsk</a></code></strong>:</p>
<ul>
<li>
<strong>Method</strong>: The Trimmed Spearman-Karber method is a
non-parametric approach for estimating the median lethal concentration
(LC50) or effective dose (ED50) from dose-response data. It calculates
the LC50 as a weighted average of dose levels where the response
transitions from below to above 50%, with optional trimming of extreme
data points to reduce the influence of outliers.</li>
<li>
<strong>Implementation</strong>: In <code><a href="../reference/tsk.html">drcHelper::tsk</a></code>, the
method uses logarithmic doses by default
(<code>use.log.doses = TRUE</code>) and implements the
pool-adjacent-violators algorithm (PAVA) via <code><a href="https://rdrr.io/pkg/isotone/man/gpava.html" class="external-link">isotone::gpava</a></code>
to smooth non-monotonic responses. It also calculates confidence
intervals based on the variance of the lognormal distribution.</li>
<li>
<strong>Key Features</strong>: No assumption of a specific
dose-response model; robust to model misspecification; handles
non-monotonic data through smoothing.</li>
</ul>
</li>
<li>
<p><strong>Probit GLM (Generalized Linear Model with Binomial
Family)</strong>:</p>
<ul>
<li>
<strong>Method</strong>: This is a parametric approach using a
generalized linear model with a binomial family and probit link
function. It models the probability of response (e.g., mortality) as a
function of the log-dose, assuming the response follows a normal
distribution on the probit scale.</li>
<li>
<strong>Implementation</strong>:
<code>glm(cbind(r, n - r) ~ log10(x), family = binomial(link = "probit"))</code>
fits the model, and <code><a href="https://rdrr.io/pkg/MASS/man/dose.p.html" class="external-link">MASS::dose.p</a></code> estimates the LC50. The
model assumes a linear relationship between the log-dose and the
probit-transformed response probability.</li>
<li>
<strong>Key Features</strong>: Assumes a specific (normal)
distribution for the response; provides standard errors and confidence
intervals based on asymptotic theory; sensitive to model fit and data
distribution.</li>
</ul>
</li>
<li>
<p><strong>Probit DRC (Dose-Response Curve with <code>drc</code>
Package, LN.2 Model)</strong>:</p>
<ul>
<li>
<strong>Method</strong>: This is also a parametric approach but uses
the <code>drc</code> package to fit a log-normal dose-response curve
(LN.2 model) with a binomial response type. It models the dose-response
relationship using a two-parameter log-normal function, where the
response is bounded between 0 and 1.</li>
<li>
<strong>Implementation</strong>:
<code>drm(r/n ~ x, fct = LN.2(), weight = n, type = "binomial")</code>
fits the model, and <code><a href="https://rdrr.io/pkg/drc/man/ED.drc.html" class="external-link">ED()</a></code> estimates the ED50 (LC50). It uses
a log-dose internally for fitting.</li>
<li>
<strong>Key Features</strong>: Similar to Probit GLM but
specifically tailored for dose-response analysis; assumes a log-normal
distribution; provides confidence intervals via the delta method.</li>
</ul>
</li>
</ol>
</div>
<div class="section level3">
<h3 id="similarities-among-the-three-methods">Similarities Among the Three Methods<a class="anchor" aria-label="anchor" href="#similarities-among-the-three-methods"></a>
</h3>
<ul>
<li>
<strong>Objective</strong>: All three methods aim to estimate the
LC50 (or ED50), the dose at which 50% of the population responds (e.g.,
mortality or effect).</li>
<li>
<strong>Data Input</strong>: They all work with binomial data
(successes and totals, e.g., number of deaths out of total organisms)
and dose levels.</li>
<li>
<strong>Dose Transformation</strong>: Both Probit GLM and TSK (by
default) use logarithmic transformations of doses (<code>log10(x)</code>
in GLM, <code>log10</code> internally in <code>tsk</code>), and DRC uses
log-doses internally for fitting.</li>
<li>
<strong>Confidence Intervals</strong>: All methods provide some form
of uncertainty estimate (confidence intervals or standard errors) around
the LC50 estimate, though the calculation methods differ.</li>
</ul>
</div>
<div class="section level3">
<h3 id="differences-among-the-three-methods">Differences Among the Three Methods<a class="anchor" aria-label="anchor" href="#differences-among-the-three-methods"></a>
</h3>
<ul>
<li>
<strong>Model Assumption</strong>:
<ul>
<li>
<strong>TSK</strong>: Non-parametric; no assumption about the
underlying dose-response curve shape beyond a general monotonic trend
(smoothed if necessary).</li>
<li>
<strong>Probit GLM</strong>: Parametric; assumes a linear
relationship on the probit scale, implying a normal distribution of
tolerance thresholds.</li>
<li>
<strong>Probit DRC (LN.2)</strong>: Parametric; assumes a log-normal
dose-response curve, which may better fit certain biological responses
but still imposes a specific functional form.</li>
</ul>
</li>
<li>
<strong>Handling of Data</strong>:
<ul>
<li>
<strong>TSK</strong>: Uses trimming to reduce the impact of extreme
data points and smoothing (PAVA) to handle non-monotonic responses,
making it more robust to data irregularities.</li>
<li>
<strong>Probit GLM</strong>: Sensitive to deviations from normality
on the probit scale; can fail to converge or give unreliable estimates
if the data doesn’t fit the model (as seen in your warning about fitted
probabilities being 0 or 1).</li>
<li>
<strong>Probit DRC</strong>: More flexible than GLM for
dose-response data due to its specific curve-fitting approach but still
assumes a log-normal relationship.</li>
</ul>
</li>
<li>
<strong>Estimation and Output</strong>:
<ul>
<li>
<strong>TSK</strong>: Directly estimates LC50 as a weighted midpoint
between doses, with variance-based confidence intervals.</li>
<li>
<strong>Probit GLM</strong>: Estimates LC50 via inverse prediction
from the fitted linear model on the probit scale; standard errors are
based on the model’s covariance matrix.</li>
<li>
<strong>Probit DRC</strong>: Estimates ED50 via the fitted
log-normal curve parameters, with confidence intervals using the delta
method.</li>
</ul>
</li>
<li>
<strong>Robustness and Applicability</strong>:
<ul>
<li>
<strong>TSK</strong>: More robust to model misspecification since it
doesn’t assume a specific curve; suitable for small datasets or when
parametric assumptions are questionable.</li>
<li>
<strong>Probit GLM</strong>: Less robust; can fail with extreme data
(e.g., complete separation as in your warning) and requires larger
sample sizes for reliable estimates.</li>
<li>
<strong>Probit DRC</strong>: Tailored for dose-response, often more
robust than GLM for toxicological data but still requires reasonable fit
to the log-normal model.</li>
</ul>
</li>
<li>
<strong>Results from Your Data</strong>:
<ul>
<li>
<strong>TSK (<code><a href="../reference/tsk.html">drcHelper::tsk</a></code>)</strong>: LC50 = 43.89339,
CI = (42.40451, 45.43455)</li>
<li>
<strong>Probit GLM</strong>: LC50 = 39.01356, SE = 37.46047 (very
wide due to fitting issues)</li>
<li>
<strong>Probit DRC (<code><a href="https://rdrr.io/pkg/drc/man/lnormal.html" class="external-link">drc::LN.2</a></code>)</strong>: LC50 =
40.3378, CI = (0.015564, 80.66003)</li>
<li>
<strong>Observation</strong>: TSK and DRC provide similar LC50
estimates (~40-43), while GLM is slightly lower (~39) with a huge SE,
indicating fitting problems (likely due to the warning about numerical
probabilities of 0 or 1). DRC’s wide CI suggests uncertainty in the
upper bound, possibly due to sparse data at higher doses.</li>
</ul>
</li>
</ul>
</div>
<div class="section level3">
<h3 id="transformation-between-probit-glm-and-probit-drc">Transformation Between Probit GLM and Probit DRC<a class="anchor" aria-label="anchor" href="#transformation-between-probit-glm-and-probit-drc"></a>
</h3>
<p>Both Probit GLM and Probit DRC model the dose-response relationship
on a transformed scale, but they differ in their functional forms and
parameterizations. Here’s how to transform or relate results between
them:</p>
<div class="section level4">
<h4 id="probit-glm-to-probit-drc">1. <strong>Probit GLM to Probit DRC</strong><a class="anchor" aria-label="anchor" href="#probit-glm-to-probit-drc"></a>
</h4>
<ul>
<li>
<p><strong>Probit GLM Model</strong>:<br>
The GLM with a probit link models the probability of response as: <span class="math display">\[
\mathrm{probit}(p) = a + b \cdot \log_{10}(\mathrm{dose})
\]</span> where <span class="math inline">\(p\)</span> is the proportion
affected, <span class="math inline">\(a\)</span> is the intercept, and
<span class="math inline">\(b\)</span> is the slope.</p>
<p>The LC50 (dose at which 50% are affected) is found by solving for
dose when <span class="math inline">\(p = 0.5\)</span>: <span class="math display">\[
\mathrm{probit}(0.5) = 0 = a + b \cdot \log_{10}(\mathrm{LC}_{50})
\]</span> which gives: <span class="math display">\[
\log_{10}(\mathrm{LC}_{50}) = -\frac{a}{b}
\]</span></p>
</li>
<li><p><strong>Probit DRC (LN.2)</strong>:<br>
The DRC model <code><a href="https://rdrr.io/pkg/drc/man/lnormal.html" class="external-link">LN.2()</a></code> fits a log-normal curve, parameterized
as: <span class="math display">\[
p = \Phi\left( \frac{\log(\mathrm{dose}) - \log(e)}{1/b} \right)
\]</span> where <span class="math inline">\(e\)</span> is the ED50
(LC50) parameter, <span class="math inline">\(b\)</span> is the slope,
and <span class="math inline">\(\Phi\)</span> is the standard normal
CDF. Here, <span class="math inline">\(\log\)</span> denotes the natural
logarithm (<span class="math inline">\(\ln\)</span>), not <span class="math inline">\(\log_{10}\)</span>.</p></li>
<li>
<p><strong>Transformation</strong>:<br>
To relate the GLM and DRC parameterizations, convert from base-10 to
natural logarithm using <span class="math inline">\(\log(10) \approx
2.302585\)</span>:</p>
<p>If GLM gives: <span class="math display">\[
\log_{10}(\mathrm{LC}_{50}) = -\frac{a}{b}
\]</span> then: <span class="math display">\[
\ln(\mathrm{LC}_{50}) = \log_{10}(\mathrm{LC}_{50}) \cdot \log(10) =
\left(-\frac{a}{b}\right) \cdot 2.302585
\]</span> which approximates the DRC’s <span class="math inline">\(\log(e)\)</span> parameter.</p>
<p>The slope parameter transforms as: <span class="math display">\[
b_{\mathrm{DRC}} \approx \frac{1}{b_{\mathrm{GLM}} \cdot \log(10)}
\]</span> since the DRC slope is inversely related to the spread on the
log scale.</p>
</li>
</ul>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">b_drc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">model_drc</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">model_drc</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">*</span><span class="va">b_drc</span> <span class="op">-</span> <span class="va">a_glm_log</span></span>
<span><span class="co">## e:(Intercept) </span></span>
<span><span class="co">##      20.93709</span></span>
<span><span class="va">b_glm_log</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span> <span class="op">-</span> <span class="va">b_glm_log10</span></span>
<span><span class="co">##       log(x) </span></span>
<span><span class="co">## -8.05251e-10</span></span>
<span><span class="va">b_drc</span></span>
<span><span class="co">## b:(Intercept) </span></span>
<span><span class="co">##      14.16805</span></span>
<span><span class="va">b_glm_log</span></span>
<span><span class="co">##   log(x) </span></span>
<span><span class="co">## 20.01154</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">model_drc_loge</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="co">## b:(Intercept) </span></span>
<span><span class="co">##      51.66112</span></span></code></pre></div>
<p>The DRC LN.2 slope parameter is on the natural log scale and should
equal to the GLM (log) slope.</p>
<ul>
<li>
<strong>Practical Note</strong>:<br>
Due to different fitting algorithms and assumptions, exact equivalence
is not guaranteed. In your data, GLM’s LC50 (39.01356) and DRC’s LC50
(40.3378) are close but not identical, reflecting slight differences in
model fit.</li>
</ul>
</div>
<div class="section level4">
<h4 id="probit-drc-to-probit-glm">2. <strong>Probit DRC to Probit GLM</strong><a class="anchor" aria-label="anchor" href="#probit-drc-to-probit-glm"></a>
</h4>
<ul>
<li>
<strong>Reverse Transformation</strong>:<br>
If DRC gives <span class="math inline">\(e\)</span> (LC50) on the
original scale, compute: <span class="math display">\[
\ln(e)
\]</span> and convert to base-10 log as: <span class="math display">\[
\log_{10}(e) = \frac{\ln(e)}{\log(10)}
\]</span>
</li>
</ul>
<p>In the example dataset:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">-</span><span class="va">a_glm_log10</span><span class="op">/</span><span class="va">b_glm_log10</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span> </span>
<span><span class="co">## (Intercept) </span></span>
<span><span class="co">##    3.663909</span></span>
<span><span class="op">-</span><span class="va">a_glm_log</span><span class="op">/</span><span class="va">b_glm_log</span></span>
<span><span class="co">## (Intercept) </span></span>
<span><span class="co">##    3.663909</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">model_drc</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">## e:(Intercept) </span></span>
<span><span class="co">##      3.697289</span></span></code></pre></div>
<p>Then, approximate GLM parameters as: <span class="math display">\[
  b_{\mathrm{GLM}} \approx \frac{1}{b_{\mathrm{DRC}} \cdot \log(10)}
  \]</span> <span class="math display">\[
  a_{\mathrm{GLM}} \approx -b_{\mathrm{GLM}} \cdot \log_{10}(e)
  \]</span></p>
<p>Again, exact matches are unlikely due to fitting differences.</p>
<ul>
<li>
<strong>Practical Note</strong>:<br>
Use <span class="math inline">\(\log_{10}(x)\)</span> in GLM to align
with DRC’s internal log-scale fitting, though DRC uses <span class="math inline">\(\ln\)</span> internally.</li>
</ul>
</div>
</div>
<div class="section level3">
<h3 id="recommendations-and-conclusion">Recommendations and Conclusion<a class="anchor" aria-label="anchor" href="#recommendations-and-conclusion"></a>
</h3>
<ul>
<li>
<strong>Choosing a Method</strong>:
<ul>
<li>Use <strong>TSK (<code><a href="../reference/tsk.html">drcHelper::tsk</a></code>)</strong> when data is
sparse, non-monotonic, or when you want a non-parametric approach robust
to model misspecification. It’s ideal for quick, reliable LC50 estimates
without strong distributional assumptions.</li>
<li>Use <strong>Probit GLM</strong> for larger datasets where a normal
tolerance distribution is plausible and you need standard statistical
inference (e.g., hypothesis testing on coefficients). Be cautious of
convergence issues (as in your warning).</li>
<li>Use <strong>Probit DRC (LN.2)</strong> for dose-response-specific
analysis, especially when a log-normal model fits the biological
response better. It’s more tailored to toxicology than GLM but still
assumes a specific curve.</li>
</ul>
</li>
<li>
<strong>Transformation Caveat</strong>: While theoretical
transformations between GLM and DRC are possible, practical differences
in optimization and model assumptions mean direct conversion isn’t
exact. Use the respective package functions (<code>dose.p</code> for
GLM, <code>ED</code> for DRC) for accurate estimates.</li>
</ul>
</div>
<div class="section level3">
<h3 id="example-where-results-agree">Example where results agree<a class="anchor" aria-label="anchor" href="#example-where-results-agree"></a>
</h3>
<p>The differences in parameter estimates between <strong>probit
GLM</strong> and <strong>drc::LN.2</strong> (and even TSK) for the
previous example dataset are due to the <strong>extreme
separation</strong> and <strong>lack of intermediate
responses</strong>—most doses have either 0 or 100% response, with only
one intermediate point. This leads to instability and poor
identifiability in parametric models, which is why we saw huge standard
errors and odd parameter values.</p>
<p>Let’s see what happens with a more “ideal” dataset, such as your
<code>finney71</code> example, which has a <strong>smooth, monotonic
increase in response</strong> and a good spread of intermediate response
rates:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">finney71</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  dose <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10.2</span>, <span class="fl">7.7</span>, <span class="fl">5.1</span>, <span class="fl">3.8</span>, <span class="fl">2.6</span>, <span class="fl">0.0</span><span class="op">)</span>,</span>
<span>  total <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">49</span>, <span class="fl">46</span>, <span class="fl">48</span>, <span class="fl">50</span>, <span class="fl">49</span><span class="op">)</span>,</span>
<span>  affected <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">44</span>, <span class="fl">42</span>, <span class="fl">24</span>, <span class="fl">16</span>, <span class="fl">6</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">finney71</span><span class="op">$</span><span class="va">prop</span> <span class="op">&lt;-</span> <span class="va">finney71</span><span class="op">$</span><span class="va">affected</span> <span class="op">/</span> <span class="va">finney71</span><span class="op">$</span><span class="va">total</span></span>
<span></span>
<span><span class="co"># Probit GLM (log10)</span></span>
<span><span class="va">glm_log10</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">affected</span>, <span class="va">total</span> <span class="op">-</span> <span class="va">affected</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">dose</span><span class="op">)</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"probit"</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">finney71</span><span class="op">[</span><span class="va">finney71</span><span class="op">$</span><span class="va">dose</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="op">]</span><span class="op">)</span></span>
<span><span class="va">lc50_log10</span> <span class="op">&lt;-</span> <span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/dose.p.html" class="external-link">dose.p</a></span><span class="op">(</span><span class="va">glm_log10</span>, cf <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, p <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"GLM log10 LC50:"</span>, <span class="fl">10</span><span class="op">^</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">lc50_log10</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">## GLM log10 LC50: 4.845492</span></span>
<span></span>
<span><span class="co"># Probit GLM (log)</span></span>
<span><span class="va">glm_log</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">affected</span>, <span class="va">total</span> <span class="op">-</span> <span class="va">affected</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">dose</span><span class="op">)</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"probit"</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">finney71</span><span class="op">[</span><span class="va">finney71</span><span class="op">$</span><span class="va">dose</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="op">]</span><span class="op">)</span></span>
<span><span class="va">lc50_log</span> <span class="op">&lt;-</span> <span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/dose.p.html" class="external-link">dose.p</a></span><span class="op">(</span><span class="va">glm_log</span>, cf <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, p <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"GLM log LC50:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">lc50_log</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">## GLM log LC50: 4.845492</span></span>
<span></span>
<span><span class="co"># Probit DRC (LN.2)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.r-project.org" class="external-link">drc</a></span><span class="op">)</span></span>
<span><span class="va">drc_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/drc/man/drm.html" class="external-link">drm</a></span><span class="op">(</span><span class="va">affected</span><span class="op">/</span><span class="va">total</span> <span class="op">~</span> <span class="va">dose</span>, weights <span class="op">=</span> <span class="va">total</span>, fct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/drc/man/lnormal.html" class="external-link">LN.2</a></span><span class="op">(</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"binomial"</span>, data <span class="op">=</span> <span class="va">finney71</span><span class="op">)</span></span>
<span><span class="va">ed50_drc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/drc/man/ED.drc.html" class="external-link">ED</a></span><span class="op">(</span><span class="va">drc_mod</span>, <span class="fl">50</span>, interval <span class="op">=</span> <span class="st">"delta"</span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Estimated effective doses</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##        Estimate Std. Error   Lower   Upper</span></span>
<span><span class="co">## e:1:50  4.84550    0.24654 4.36229 5.32871</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"DRC LN.2 LC50:"</span>, <span class="va">ed50_drc</span><span class="op">[</span><span class="fl">1</span>, <span class="st">"Estimate"</span><span class="op">]</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">## DRC LN.2 LC50: 4.845502</span></span>
<span></span>
<span><span class="co"># TSK</span></span>
<span><span class="va">finney71</span> <span class="op">&lt;-</span> <span class="va">finney71</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">finney71</span><span class="op">$</span><span class="va">dose</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="va">tsk_res</span> <span class="op">&lt;-</span> <span class="fu">drcHelper</span><span class="fu">::</span><span class="fu"><a href="../reference/tsk.html">tsk</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">finney71</span><span class="op">$</span><span class="va">dose</span>,</span>
<span>  r <span class="op">=</span> <span class="va">finney71</span><span class="op">$</span><span class="va">affected</span>,</span>
<span>  n <span class="op">=</span> <span class="va">finney71</span><span class="op">$</span><span class="va">total</span>,</span>
<span>  control <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  trim <span class="op">=</span> <span class="fl">0.12</span>,  <span class="co"># as suggested by the error</span></span>
<span>  conf.level <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  use.log.doses <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"TSK LC50:"</span>, <span class="va">tsk_res</span><span class="op">$</span><span class="va">LD50</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">## TSK LC50: 4.779998</span></span>
<span><span class="co">#ecotoxicology::TSK(finney71$dose, finney71$affected, finney71$total, A = 0.12, conf = 0.95)</span></span></code></pre></div>
<p>Note that we have to trim here. This is because the TSK method
assumes that the response curve is monotonic and that the intermediate
responses (not exactly 0 or 1) are most informative for estimating the
median effective dose (LC50/EC50).</p>
</div>
<div class="section level3">
<h3 id="results-table">Results Table<a class="anchor" aria-label="anchor" href="#results-table"></a>
</h3>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">comparison</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Probit GLM (log10)"</span>, <span class="st">"Probit GLM (log)"</span>, <span class="st">"Probit DRC (LN.2)"</span>, <span class="st">"TSK (trim = 0.12)"</span><span class="op">)</span>,</span>
<span>  LC50 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4.845492</span>, <span class="fl">4.845492</span>, <span class="fl">4.845502</span>, <span class="fl">4.779998</span><span class="op">)</span>,</span>
<span>  CI_Lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="cn">NA</span>, <span class="fl">4.36229</span>, <span class="cn">NA</span><span class="op">)</span>,</span>
<span>  CI_Upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="cn">NA</span>, <span class="fl">5.32871</span>, <span class="cn">NA</span><span class="op">)</span>,</span>
<span>  Std_Error <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="cn">NA</span>, <span class="fl">0.24654</span>, <span class="cn">NA</span><span class="op">)</span>,</span>
<span>  Notes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"Identical to log, see below"</span>,</span>
<span>    <span class="st">"Identical to log10"</span>,</span>
<span>    <span class="st">"Nearly identical to GLM"</span>,</span>
<span>    <span class="st">"Robust nonparametric method"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">comparison</span>, digits <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="22%">
<col width="9%">
<col width="10%">
<col width="10%">
<col width="12%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="left">Method</th>
<th align="right">LC50</th>
<th align="right">CI_Lower</th>
<th align="right">CI_Upper</th>
<th align="right">Std_Error</th>
<th align="left">Notes</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Probit GLM (log10)</td>
<td align="right">4.84549</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">Identical to log, see below</td>
</tr>
<tr class="even">
<td align="left">Probit GLM (log)</td>
<td align="right">4.84549</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">Identical to log10</td>
</tr>
<tr class="odd">
<td align="left">Probit DRC (LN.2)</td>
<td align="right">4.84550</td>
<td align="right">4.36229</td>
<td align="right">5.32871</td>
<td align="right">0.24654</td>
<td align="left">Nearly identical to GLM</td>
</tr>
<tr class="even">
<td align="left">TSK (trim = 0.12)</td>
<td align="right">4.78000</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">Robust nonparametric method</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">drc_mod</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> </span>
<span><span class="co">## b:(Intercept) </span></span>
<span><span class="co">##      1.829697</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">glm_log</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="co">## log(dose) </span></span>
<span><span class="co">##  1.829768</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">glm_log10</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">## log10(dose) </span></span>
<span><span class="co">##    1.829768</span></span></code></pre></div>
<div class="section level4">
<h4 id="why-do-they-agree-here">
<strong>Why do they agree here?</strong><a class="anchor" aria-label="anchor" href="#why-do-they-agree-here"></a>
</h4>
<ul>
<li>The data has a <strong>smooth, monotonic, sigmoidal
dose-response</strong> with several intermediate response rates (not
just 0% or 100%).</li>
<li>There is no “complete separation” (i.e., not all 0s then all 1s), so
the GLM and DRC models can estimate both the slope and intercept
reliably.</li>
<li>The TSK method, being nonparametric, will also yield a similar LC50
because the empirical response curve is monotonic and well-behaved.</li>
</ul>
<p><strong>Summary:</strong></p>
<p>For well-behaved, monotonic dose-response data with intermediate
responses, all methods (parametric and nonparametric) yield nearly
identical LC50 estimates. This demonstrates the reliability of these
methods when the data meet their assumptions. Differences become
pronounced only with sparse, non-monotonic, or extreme datasets.</p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Zhenglei Gao, Sean Ryan.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
