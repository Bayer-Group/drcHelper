<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Example Ordinal Data Analysis • drcHelper</title>
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Example Ordinal Data Analysis">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">drcHelper</a>

    <small class="nav-text text-default me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.0.4.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-get-started" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Get Started</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-get-started">
<li><a class="dropdown-item" href="../articles/Introduction.html">Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/Example_Analysis_Workflow.html">Example Analysis Workflow</a></li>
    <li><a class="dropdown-item" href="../articles/drcHelper.html">Example ECx Helper Functions Usage</a></li>
    <li><a class="dropdown-item" href="../articles/Dunnetts_Test_for_Data_with_Hierarchical_Structure.html">Example NOEC Helper Functions Usage</a></li>
    <li><a class="dropdown-item" href="../articles/Examples_drc.html">Using DRC and BMD</a></li>
    <li><a class="dropdown-item" href="../articles/Examples_oecd201.html">Example DRC - OECD 201</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-regulatory-stats" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Regulatory Stats</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-regulatory-stats">
<li><a class="dropdown-item" href="../articles/NOEC_Methods.html">NOEC Calculations</a></li>
    <li><a class="dropdown-item" href="../articles/Limit-Test.html">Limit Test Calculations</a></li>
    <li><a class="dropdown-item" href="../articles/EFSA-Criteria.html">EFSA Criteria and Other Reliability Criteria</a></li>
    <li><a class="dropdown-item" href="../articles/Example_RSCABS.html">RSCABS</a></li>
    <li><a class="dropdown-item" href="../articles/Trend-Testing.html">Trend Testing</a></li>
    <li><a class="dropdown-item" href="../articles/NOEC_ECx_BMD.html">NOEC ECx and BMD</a></li>
  </ul>
</li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Quantal-Data.html">Quantal Data</a></li>
    <li><a class="dropdown-item" href="../articles/Ordinal-Data.html">Ordinal Data</a></li>
    <li><a class="dropdown-item" href="../articles/Count_Data.html">Count Data</a></li>
    <li><a class="dropdown-item" href="../articles/LMM-GLMM-and-GAMM.html">Understanding Mixed Models</a></li>
    <li><a class="dropdown-item" href="../articles/Normality-Check.html">Normality Check</a></li>
    <li><a class="dropdown-item" href="../articles/Binomial_Extra_Variance.html">Extra Binomial Variance and Trend Test</a></li>
    <li><a class="dropdown-item" href="../articles/Equivalence-Testing.html">Equivalence Testing</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>More Topics</h6></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/Examples%20using%20NLS.html">NLS</a></li>
    <li><a class="dropdown-item" href="../articles/Examples_using_drda.html">drda</a></li>
    <li><a class="dropdown-item" href="../articles/TSK_method.html">TSK method</a></li>
    <li><a class="dropdown-item" href="../articles/MQJT.html">MQJT</a></li>
    <li><a class="dropdown-item" href="../articles/Advanced_Fitting-a-biphasic-dose-reponse-model.html">Fitting A biphasic dose response model</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-validation" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Validation</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-validation">
<li><a class="dropdown-item" href="../articles/System_Testing.html">System Testing</a></li>
    <li><a class="dropdown-item" href="../articles/val_ED_plus.html">ED Calculation Consistency</a></li>
    <li><a class="dropdown-item" href="../articles/TSK-and-Probit-Models.html">TSK and Probit Model</a></li>
    <li><a class="dropdown-item" href="../articles/Verification_which_JT.html">Which JT test to use</a></li>
    <li><a class="dropdown-item" href="../articles/Test-Guidelines.html">Study Types and Templates</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Bayer-Group/drcHelper/issues/new?template=Blank+issue" aria-label="New Issue"><span class="fa fa-bug"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Bayer-Group/drcHelper" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">


<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Example Ordinal Data Analysis</h1>
                        <h4 data-toc-skip class="author">Zhenglei
Gao</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Bayer-Group/drcHelper/blob/main/vignettes/articles/Ordinal-Data.Rmd" class="external-link"><code>vignettes/articles/Ordinal-Data.Rmd</code></a></small>
      <div class="d-none name"><code>Ordinal-Data.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bayer-group.github.io/drcHelper/index.html">drcHelper</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<p>There is no routine procedures in regulatory frameworks for ordinal
data analysis yet. For histopathological data, it is recommended to use
RSCABS (Rao-Scott Adjusted Cochran-Armitage Trend Test by Slices) to
derive NOEALs. An alternative is MQJT(Multiquantal Jonckheere–Terpstra),
which is mentioned in OECD TG 231 for AMA life stage analysis.</p>
<p>Plant visual injury data has been evaluated qualitatively and it is
possible to analyze them quantitatively.</p>
<p>For well-behaving data (full clear dose-response), most approaches
will produce very similar results as long as the target endpoint (the
test rate or concentration where the average injury is reaching 50% or
is medium injury category) is the same. In this article, we will explain
how several regression modelling can be applied, focusing on nonlinear
regression with sigmoid shaped curve, logistic regression with
quasibinomial likelihood, and the conventional proportional odds
logistic regression. Other approaches with a different endpoint type are
demonstrated as well, including BMD for ordinal data using
<code>bmdordinal</code>, RSCABS, etc.</p>
<p>All approaches have its own limitations and need to be treated with
caution. For example, for nonlinear model with a normal error assumption
behind, issues could occur with inhomogeneous variance, uncertain
considerations is critical when the data is over-spread across many
categories close to the estimated ER50. I think whichever method to
choose, careful evaluation the assumptions of the model and check the
model data agreement are always necessary.</p>
</div>
<div class="section level2">
<h2 id="ordinal-data-in-general">Ordinal Data in General<a class="anchor" aria-label="anchor" href="#ordinal-data-in-general"></a>
</h2>
<p>From a statistical point view, ordinal data is a type of categorical
data where the order matters, but the exact differences or distances
between the categories are not defined. For example, survey responses
like “satisfied,” “neutral,” and “dissatisfied”, ranking like 1st, 2nd,
3rd, levels of education like high school, bachelor, master. Market
research, psychology, health studies, and social sciences often use
ordinal data.</p>
<p>Since ordinal data doesn’t assume equal intervals, non-parametric
methods are often used. Medians rather than means are often the basis of
comparisons. Chi-Square test can be used to determine if there is a
significant association between two categorical variables. Spearman’s
Rank Correlation and Kendall’s tau are correlation measures that can
assess the strength and direction of association between two ranked
variables.</p>
<p>Ordinal Regression is a somewhat complex method that can predict
outcomes based on ordinal data. It helps understand how different
factors influence rankings and the transition between the ordered
categories.</p>
<ul>
<li>Proportional Odds Model: Coefficient (slopes) remains constant
across all categories.</li>
<li>Continuation Ratio Model: Model cumulative odds ratios.</li>
<li>Adjacent Categories Model: useful when neighboring categories
influence each other.</li>
</ul>
<p>Due to the limited information and potentially unequal intervals, it
requires a clear understanding of its subtleties and complexities, and
careful attentions when implementing regression modelling.</p>
<p>In the ecotoxicology area, histopathology assessment and visual
injury data are ranked categorical data. We focus on the plant visual
injury data (PVI).</p>
</div>
<div class="section level2">
<h2 id="type-of-endpoints">Type of Endpoints<a class="anchor" aria-label="anchor" href="#type-of-endpoints"></a>
</h2>
<p>Depending on how the response variables and the independent variables
are treated, different types of endpoints can be derived.</p>
<p>If the independent variable is treated as a factor or categorical,
then the No Observed Effect Concentration (NOEC) regarding a specific
injury level can be derived by treating the response as ordinal.
Alternatively, a NOEC can be calculated by treating the response as
continuous, using either direct hypothesis testing or post hoc testing
after regression modeling. Conversely, if the independent variable is
treated as continuous, endpoints such as ECx or Benchmark Dose (BMDx)
regarding a specific injury level (with the response treated as ordinal)
or regarding the average injury level (with the response treated as
continuous) can be calculated.</p>
</div>
<div class="section level2">
<h2 id="data-characteristics">Data Characteristics<a class="anchor" aria-label="anchor" href="#data-characteristics"></a>
</h2>
<p>The systematic error or bias that can occur during the assessment of
Plant Visual Injury (PVI) data is beyond the scope of this discussion.
Here, we focus solely on the analysis approaches.</p>
</div>
<div class="section level2">
<h2 id="limitations">Limitations<a class="anchor" aria-label="anchor" href="#limitations"></a>
</h2>
<p>Each method makes its own assumptions and has inherent limitations.
For example, the Rao-Scott Cochran-Armitage by slice (RSCABS) method
cannot handle too many categories effectively. Ordinal regression can be
complex when determining an Effective Rate (ER50) or Effective
Concentration (EC50). Additionally, treating the response as continuous
(from 0 to 1 or from 0 to 100%) may lead to issues with heterogeneous
variance.</p>
</div>
<div class="section level2">
<h2 id="regression-approaches-with-continuous-x">Regression Approaches with Continuous x<a class="anchor" aria-label="anchor" href="#regression-approaches-with-continuous-x"></a>
</h2>
<p>The most natural approach would be using conventional ordinal
regression modelling to derive an ER50. However, this approach is not
routinely applied in regulatory ecotoxicology, the interpretation
including the assumption behind is a bit more complex. To derive an
ER50, specific function and optimization need to be defined for this
purpose. Confidence intervals need to be derived from bootstrap method
and take longer time in calculation. We only use this approach in
comparison with the more commonly or easily applied modelling
approaches.</p>
<p>When transforming the ordinal variable into percentages or
proportions, it is also possible to model them as continuous data or
using logitic regression with quasibinomial assumptions. The two
approaches produce similar results when the data is behaving truly like
a dose-response with over-dispersed binomial distributions.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bayer-group.github.io/drcHelper/index.html">drcHelper</a></span><span class="op">)</span></span></code></pre></div>
<p>The data is artificial and with full dose-response relationship
observed with true ER50=12.18.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dattab_new</span> <span class="op">&lt;-</span> <span class="va">pvi_example</span> <span class="co">## use the example PVI data in the drcHelper package</span></span>
<span><span class="co">## Note that yy2 is transformed by increment of 90/5 = 16. </span></span>
<span><span class="va">dattab_new</span><span class="op">$</span><span class="va">y0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">dattab_new</span><span class="op">$</span><span class="va">y0</span>,ordered <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/ftable.html" class="external-link">ftable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html" class="external-link">xtabs</a></span><span class="op">(</span><span class="op">~</span> <span class="va">y0</span> <span class="op">+</span> <span class="va">dose</span>, data <span class="op">=</span> <span class="va">dattab_new</span><span class="op">)</span><span class="op">)</span> <span class="co">##%&gt;% gt::gt() ## as.data.frame(.) %&gt;% knitr::kable(.,digits = 3)</span></span>
<span><span class="co">#&gt;    dose  2  4  8 16 32 64</span></span>
<span><span class="co">#&gt; y0                       </span></span>
<span><span class="co">#&gt; 0        8  3  1  0  0  0</span></span>
<span><span class="co">#&gt; A        2  5  2  0  1  0</span></span>
<span><span class="co">#&gt; B        0  2  4  2  0  0</span></span>
<span><span class="co">#&gt; C        0  0  2  1  1  0</span></span>
<span><span class="co">#&gt; D        0  0  1  5  2  0</span></span>
<span><span class="co">#&gt; E        0  0  0  2  5  0</span></span>
<span><span class="co">#&gt; F        0  0  0  0  1 10</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span></span>
<span><span class="va">dattab_new</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">y0</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>n<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>,meany<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">yt</span><span class="op">)</span>,meanyy2<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">yy2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">.</span>,digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">y0</th>
<th align="right">n</th>
<th align="right">meany</th>
<th align="right">meanyy2</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">0</td>
<td align="right">12</td>
<td align="right">0.042</td>
<td align="right">0.05</td>
</tr>
<tr class="even">
<td align="left">A</td>
<td align="right">10</td>
<td align="right">0.169</td>
<td align="right">0.18</td>
</tr>
<tr class="odd">
<td align="left">B</td>
<td align="right">8</td>
<td align="right">0.307</td>
<td align="right">0.34</td>
</tr>
<tr class="even">
<td align="left">C</td>
<td align="right">4</td>
<td align="right">0.489</td>
<td align="right">0.50</td>
</tr>
<tr class="odd">
<td align="left">D</td>
<td align="right">8</td>
<td align="right">0.677</td>
<td align="right">0.66</td>
</tr>
<tr class="even">
<td align="left">E</td>
<td align="right">7</td>
<td align="right">0.812</td>
<td align="right">0.82</td>
</tr>
<tr class="odd">
<td align="left">F</td>
<td align="right">11</td>
<td align="right">0.958</td>
<td align="right">0.95</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">dattab_new</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">dose</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>n<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>,meany<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">yt</span><span class="op">)</span>,meanyy<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">yy</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">.</span>,digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">dose</th>
<th align="right">n</th>
<th align="right">meany</th>
<th align="right">meanyy</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">2</td>
<td align="right">10</td>
<td align="right">0.060</td>
<td align="right">0.02</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">10</td>
<td align="right">0.160</td>
<td align="right">0.11</td>
</tr>
<tr class="odd">
<td align="right">8</td>
<td align="right">10</td>
<td align="right">0.326</td>
<td align="right">0.31</td>
</tr>
<tr class="even">
<td align="right">16</td>
<td align="right">10</td>
<td align="right">0.600</td>
<td align="right">0.64</td>
</tr>
<tr class="odd">
<td align="right">32</td>
<td align="right">10</td>
<td align="right">0.722</td>
<td align="right">0.75</td>
</tr>
<tr class="even">
<td align="right">64</td>
<td align="right">10</td>
<td align="right">0.958</td>
<td align="right">1.00</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">dattab_new</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">dose</span>, y<span class="op">=</span><span class="va">yt</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>method<span class="op">=</span><span class="st">"glm"</span>, method.args<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>family<span class="op">=</span><span class="st">"quasibinomial"</span><span class="op">)</span>, formula<span class="op">=</span><span class="st">"y ~ log(x)"</span>,</span>
<span>                       se <span class="op">=</span><span class="cn">TRUE</span>, linewidth<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span></span></code></pre></div>
<p><img src="Ordinal-Data_files/figure-html/unnamed-chunk-6-1.png" width="672"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.r-project.org" class="external-link">drc</a></span><span class="op">)</span></span>
<span><span class="va">mod_drc</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/drc/man/drm.html" class="external-link">drm</a></span><span class="op">(</span><span class="va">yy2</span> <span class="op">~</span> <span class="va">dose</span>, data <span class="op">=</span> <span class="va">dattab_new</span>, fct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/drc/man/LL.2.html" class="external-link">LL.2</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod_drc</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model fitted: Log-logistic (ED50 as parameter) with lower limit at 0 and upper limit at 1 (2 parms)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Parameter estimates:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;               Estimate Std. Error t-value   p-value    </span></span>
<span><span class="co">#&gt; b:(Intercept) -1.33865    0.13595 -9.8465 5.487e-14 ***</span></span>
<span><span class="co">#&gt; e:(Intercept) 12.74391    1.03919 12.2633 &lt; 2.2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual standard error:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  0.1446638 (58 degrees of freedom)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/drc/man/ED.drc.html" class="external-link">ED</a></span><span class="op">(</span><span class="va">mod_drc</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span><span class="op">)</span>, interval <span class="op">=</span> <span class="st">"delta"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Estimated effective doses</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;        Estimate Std. Error   Lower   Upper</span></span>
<span><span class="co">#&gt; e:1:50  12.7439     1.0392 10.6637 14.8241</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="op">{</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mod_drc</span>, type <span class="op">=</span> <span class="st">"all"</span>,main<span class="op">=</span><span class="st">"log-logistic + normal, ER50= 12.74"</span>, broken <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mod_drc</span>, broken <span class="op">=</span> <span class="cn">TRUE</span>, type<span class="op">=</span><span class="st">"confidence"</span>, add<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p><img src="Ordinal-Data_files/figure-html/unnamed-chunk-7-1.png" width="672"></p>
<div class="section level3">
<h3 id="putting-quasi-binomial-and-normal-fit-together">Putting quasi-binomial and normal fit together<a class="anchor" aria-label="anchor" href="#putting-quasi-binomial-and-normal-fit-together"></a>
</h3>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.r-project.org" class="external-link">drc</a></span><span class="op">)</span></span>
<span><span class="va">predictCIglm</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">mod</span>,<span class="va">dat</span>,<span class="va">newdata</span><span class="op">=</span><span class="cn">NULL</span><span class="op">)</span><span class="op">{</span></span>
<span> <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">newdata</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">preddata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">dat</span>, <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, length <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span> <span class="op">}</span><span class="kw">else</span> <span class="va">predata</span> <span class="op">&lt;-</span> <span class="va">newdata</span></span>
<span>  <span class="va">preds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">mod</span>, newdata <span class="op">=</span> <span class="va">preddata</span>, type <span class="op">=</span> <span class="st">"link"</span>, se.fit <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="va">critval</span> <span class="op">&lt;-</span> <span class="fl">1.96</span> <span class="co">## approx 95% CI qnorm(0.975)</span></span>
<span>  <span class="va">upr</span> <span class="op">&lt;-</span> <span class="va">preds</span><span class="op">$</span><span class="va">fit</span> <span class="op">+</span> <span class="op">(</span><span class="va">critval</span> <span class="op">*</span> <span class="va">preds</span><span class="op">$</span><span class="va">se.fit</span><span class="op">)</span></span>
<span>  <span class="va">lwr</span> <span class="op">&lt;-</span> <span class="va">preds</span><span class="op">$</span><span class="va">fit</span> <span class="op">-</span> <span class="op">(</span><span class="va">critval</span> <span class="op">*</span> <span class="va">preds</span><span class="op">$</span><span class="va">se.fit</span><span class="op">)</span></span>
<span>  <span class="va">fit</span> <span class="op">&lt;-</span> <span class="va">preds</span><span class="op">$</span><span class="va">fit</span></span>
<span>  <span class="va">fit2</span> <span class="op">&lt;-</span> <span class="va">mod</span><span class="op">$</span><span class="va">family</span><span class="op">$</span><span class="fu">linkinv</span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span>  <span class="va">upr2</span> <span class="op">&lt;-</span> <span class="va">mod</span><span class="op">$</span><span class="va">family</span><span class="op">$</span><span class="fu">linkinv</span><span class="op">(</span><span class="va">upr</span><span class="op">)</span></span>
<span>  <span class="va">lwr2</span> <span class="op">&lt;-</span> <span class="va">mod</span><span class="op">$</span><span class="va">family</span><span class="op">$</span><span class="fu">linkinv</span><span class="op">(</span><span class="va">lwr</span><span class="op">)</span></span>
<span>  <span class="va">preddata</span><span class="op">$</span><span class="va">Prediction</span> <span class="op">&lt;-</span> <span class="va">fit2</span> </span>
<span>  <span class="va">preddata</span><span class="op">$</span><span class="va">Lower</span> <span class="op">&lt;-</span> <span class="va">lwr2</span> </span>
<span>  <span class="va">preddata</span><span class="op">$</span><span class="va">Upper</span> <span class="op">&lt;-</span> <span class="va">upr2</span> </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">preddata</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="va">preddrc</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">mod</span>,<span class="va">dat</span>,<span class="va">newdata</span><span class="op">=</span><span class="cn">NULL</span><span class="op">)</span><span class="op">{</span></span>
<span> <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">newdata</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">preddata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">dat</span>, <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, length <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span> <span class="op">}</span><span class="kw">else</span> <span class="va">predata</span> <span class="op">&lt;-</span> <span class="va">newdata</span></span>
<span> <span class="va">preds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">mod</span>,newdata<span class="op">=</span><span class="va">preddata</span>,interval<span class="op">=</span><span class="st">"confidence"</span><span class="op">)</span></span>
<span> <span class="va">preddata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">preddata</span>,<span class="va">preds</span><span class="op">)</span></span>
<span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">preddata</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">modelall</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dat</span>,<span class="va">addbeta</span> <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">mod1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">y</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,data<span class="op">=</span><span class="va">dat</span>,family <span class="op">=</span> <span class="st">"quasibinomial"</span><span class="op">)</span></span>
<span>  <span class="va">mod2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/drc/man/drm.html" class="external-link">drm</a></span><span class="op">(</span><span class="va">y</span><span class="op">~</span><span class="va">x</span>,fct<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/drc/man/LL.2.html" class="external-link">LL.2</a></span><span class="op">(</span><span class="op">)</span>,data<span class="op">=</span><span class="va">dat</span><span class="op">)</span></span>
<span> </span>
<span>  <span class="co">## mod3 &lt;- MASS::glmmPQL(y ~ log(x),random=~1|x,family="quasibinomial",data=dat) </span></span>
<span>  <span class="co">## Estimation the same as quasibinomial without random effects, uncertainty estimation wider. </span></span>
<span>  <span class="co">## mod3 &lt;- lme4::glmer(y ~ log(x)+ (1|x),family="binomial",data=dat) ## dose not work without sample size.</span></span>
<span>  <span class="co"># mod4 &lt;- betareg::betareg(y ~ log(x),link="logit",data=dat)</span></span>
<span>  <span class="co"># y3&lt;- predict(mod3,newdata=data.frame(x=dat$x),type="response")</span></span>
<span>  <span class="va">y1</span> <span class="op">&lt;-</span> <span class="fu">predictCIglm</span><span class="op">(</span><span class="va">mod1</span>,dat<span class="op">=</span><span class="va">dat</span><span class="op">)</span></span>
<span>  <span class="va">y1</span><span class="op">$</span><span class="va">model</span> <span class="op">&lt;-</span> <span class="st">"quasibinomial"</span></span>
<span></span>
<span>  <span class="va">y2</span> <span class="op">&lt;-</span> <span class="fu">preddrc</span><span class="op">(</span><span class="va">mod2</span>,dat <span class="op">=</span> <span class="va">dat</span><span class="op">)</span></span>
<span>  <span class="va">y2</span><span class="op">$</span><span class="va">model</span> <span class="op">&lt;-</span> <span class="st">"drc LL.2"</span></span>
<span>  <span class="va">preddata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">y1</span>,<span class="va">y2</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">ec1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getEC50.html">getEC50</a></span><span class="op">(</span><span class="va">mod1</span><span class="op">)</span></span>
<span>  <span class="va">ec2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getEC50.html">getEC50</a></span><span class="op">(</span><span class="va">mod2</span><span class="op">)</span></span>
<span>  <span class="va">ec50</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">ec1</span>,<span class="va">ec2</span><span class="op">)</span>,model<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"quasibinomial"</span>,<span class="st">"drc LL.2"</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">addbeta</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">mod3</span> <span class="op">&lt;-</span> <span class="fu">gam</span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, family<span class="op">=</span><span class="fu">betar</span><span class="op">(</span>link<span class="op">=</span><span class="st">"logit"</span><span class="op">)</span>, data<span class="op">=</span><span class="va">dat</span><span class="op">)</span></span>
<span>    <span class="va">y3</span> <span class="op">&lt;-</span> <span class="fu">predictCIglm</span><span class="op">(</span><span class="va">mod3</span>,dat<span class="op">=</span><span class="va">dat</span><span class="op">)</span></span>
<span>    <span class="va">y3</span><span class="op">$</span><span class="va">model</span> <span class="op">&lt;-</span> <span class="st">"beta"</span></span>
<span>    <span class="va">preddata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">preddata</span>,<span class="va">y3</span><span class="op">)</span></span>
<span>    <span class="va">ec3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getEC50.html">getEC50</a></span><span class="op">(</span><span class="va">mod3</span><span class="op">)</span></span>
<span>    <span class="va">ec50</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">ec50</span>,<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">ec3</span>,model<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"beta"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="co">#ec4 &lt;- uniroot(function(x) predict(mod4, newdata = data.frame(x=x)) - 0.5,lower = 1, upper = 80)$root</span></span>
<span>  <span class="co">## 19.55968 beta regression does not perform better than binomial or quasi-binomial regression!</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ec50<span class="op">=</span><span class="va">ec50</span>,predata<span class="op">=</span><span class="va">preddata</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">modelallbeta</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dat</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu">modelall</span><span class="op">(</span><span class="va">dat</span>,addbeta<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dattab_new</span> <span class="op">&lt;-</span> <span class="va">dattab_new</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">yy</span>,x<span class="op">=</span><span class="va">dose</span><span class="op">)</span><span class="op"><a href="../reference/pipe.html">%&gt;%</a></span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="op">{</span><span class="va">modres</span> <span class="op">&lt;-</span> <span class="fu">modelall</span><span class="op">(</span><span class="va">dattab_new</span><span class="op">)</span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Estimated effective doses</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;        Estimate Std. Error   Lower   Upper</span></span>
<span><span class="co">#&gt; e:1:50  12.7097     1.0856 10.5367 14.8826</span></span>
<span><span class="va">predres</span> <span class="op">&lt;-</span> <span class="va">modres</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">modres</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op"><a href="../reference/pipe.html">%&gt;%</a></span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>TrueEC50 <span class="op">=</span> <span class="fl">12.18</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>EC50<span class="op">=</span><span class="fl">12.15856</span>,lower<span class="op">=</span><span class="fl">10.16505</span>,upper<span class="op">=</span><span class="fl">15.09790</span>,se<span class="op">=</span><span class="cn">NA</span>,model<span class="op">=</span><span class="st">"ordinal regression"</span>, TrueEC50 <span class="op">=</span><span class="fl">12.18</span><span class="op">)</span><span class="op">)</span>,digits<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">EC50</th>
<th align="right">lower</th>
<th align="right">upper</th>
<th align="right">se</th>
<th align="left">model</th>
<th align="right">TrueEC50</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">12.789</td>
<td align="right">10.744</td>
<td align="right">15.223</td>
<td align="right">1.144</td>
<td align="left">quasibinomial</td>
<td align="right">12.18</td>
</tr>
<tr class="even">
<td align="right">12.710</td>
<td align="right">10.537</td>
<td align="right">14.883</td>
<td align="right">1.086</td>
<td align="left">drc LL.2</td>
<td align="right">12.18</td>
</tr>
<tr class="odd">
<td align="right">12.159</td>
<td align="right">10.165</td>
<td align="right">15.098</td>
<td align="right">NA</td>
<td align="left">ordinal regression</td>
<td align="right">12.18</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p_drc_qb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">dattab_new</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">dose</span>, y<span class="op">=</span><span class="va">yt</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>alpha<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">dose</span>, y<span class="op">=</span><span class="va">yy</span><span class="op">)</span>,col<span class="op">=</span><span class="st">"green"</span><span class="op">)</span><span class="op">+</span></span>
<span>                <span class="co">#scale_color_viridis_d()+scale_fill_viridis_d()+</span></span>
<span>        <span class="co"># scale_color_brewer(palette = "Reds") + </span></span>
<span>        <span class="co"># #geom_smooth(method="loess", se = FALSE, size=1.5) +</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">predres</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>,y<span class="op">=</span><span class="va">Prediction</span>,ymin<span class="op">=</span><span class="va">Lower</span>,ymax<span class="op">=</span><span class="va">Upper</span>,col<span class="op">=</span><span class="va">model</span>,fill<span class="op">=</span><span class="va">model</span><span class="op">)</span>,alpha<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">predres</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>,y<span class="op">=</span><span class="va">Prediction</span>,col<span class="op">=</span><span class="va">model</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Concentration"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"% Injury / 100"</span><span class="op">)</span></span>
<span><span class="va">p_drc_qb</span></span></code></pre></div>
<p><img src="Ordinal-Data_files/figure-html/unnamed-chunk-9-1.png" width="672"></p>
<div class="section level4">
<h4 id="on-the-gof">On the GoF<a class="anchor" aria-label="anchor" href="#on-the-gof"></a>
</h4>
<p>Normally we could test lack of fit for continuous data by comparing
the model fit with ANOVA model, which should achieve the least square
estimation. Changjian proposed to use the prediction intervals from the
models to estimate the frequency table that would usually be a product
of conventional ordinal regression, followed by a chi-square test.</p>
<p>The common goodness of fit tests and measures for logistic regression
include deviance or likelihood ratio test, the Hosmer-Lemeshow Test, the
pseudo R-squared measures, residual analysis, and
classification/frequency tables.</p>
</div>
<div class="section level4">
<h4 id="additional-thoughts">Additional Thoughts<a class="anchor" aria-label="anchor" href="#additional-thoughts"></a>
</h4>
<p>Thinking about (quasi)-binomial type modelling and data-generation
process, it is possible to assume when you see level B injury, you had
many independent binary yes/no outcomes (conditional on the observed
covariate values for each replicate or experiment unit) for each injury
level or for an arbitrary number of categories, the proportion of yes
answer is then the average injury. The probabilities of each binary
outcome are the same, which may mismatch the observed data rather
badly.</p>
<p>Beta regression can be used to model proportions too, however, 0 and
1’s need to be specifically handled.</p>
</div>
</div>
<div class="section level3">
<h3 id="using-conventional-ordinal-regression-approaches">Using Conventional Ordinal Regression Approaches<a class="anchor" aria-label="anchor" href="#using-conventional-ordinal-regression-approaches"></a>
</h3>
<p>Ordinal regression approaches works well in terms of prediction but
would need a specific function to calculate ER50. <span class="math inline">\(\sum p_i Y_{ij}\)</span> would be the average
injury level. Here we achieved by the steps below:</p>
<ol style="list-style-type: decimal">
<li>We fit an ordinal regression model using polr with your ordinal
response data.</li>
<li>Define the expected Response Function: The key to solving this
problem is calculating the expected response at any dose:</li>
</ol>
<ul>
<li>We calculate the probability of being in each category at a given
dose</li>
<li>We multiply these probabilities by the corresponding injury
percentages (0%, 10%, 30%, 50%, 70%, 90%, 100%)</li>
<li>The sum gives us the expected injury percentage at that dose</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li>Finding EC50: We search through a range of doses to find where the
expected injury percentage is closest to 50%. Alternatively, we could
define an objective function and use optimization to find the dose,
which could be more precise than the grid search approach.</li>
<li>Bootstrap Confidence Intervals:
<ul>
<li>We resample the data with replacement 1000 times</li>
<li>For each bootstrap sample, we calculate the EC50</li>
<li>The 2.5th and 97.5th percentiles of these bootstrap EC50 values form
our 95% confidence interval</li>
</ul>
</li>
</ol>
<p>This approach provides a robust estimate of the EC50 with confidence
intervals that account for the uncertainty in your data and model. The
bootstrap method is particularly valuable here because it doesn’t
require assumptions about the distribution of the EC50 estimator.</p>
<p>The proportional odds model can be interpreted in terms of
probabilities of transitions and also in terms of covariate-specific
cumulative probabilities. The latter is a bit easier to understand.
Ordinal regression can be conducted using MASS::polr function or the
function provided in GLMcat, which is an R package that encompasses lots
of models specified in a similar way: (ratio, cdf, design: parallel or
complete).</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## fit ordered logit model and store results 'm'</span></span>
<span><span class="va">dattab_new</span> <span class="op">$</span><span class="va">y0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">dattab_new</span><span class="op">$</span><span class="va">y0</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"0"</span>,<span class="st">"A"</span>,<span class="st">"B"</span>,<span class="st">"C"</span>,<span class="st">"D"</span>,<span class="st">"E"</span>,<span class="st">"F"</span><span class="op">)</span>,ordered <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/polr.html" class="external-link">polr</a></span><span class="op">(</span><span class="va">y0</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">dose</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">dattab_new</span>, Hess<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; MASS::polr(formula = y0 ~ log(dose), data = dattab_new, Hess = TRUE)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;           Value Std. Error t value</span></span>
<span><span class="co">#&gt; log(dose) 3.465     0.4876   7.106</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Intercepts:</span></span>
<span><span class="co">#&gt;     Value   Std. Error t value</span></span>
<span><span class="co">#&gt; 0|A  4.0061  0.8091     4.9513</span></span>
<span><span class="co">#&gt; A|B  6.3415  1.0283     6.1669</span></span>
<span><span class="co">#&gt; B|C  8.1921  1.2395     6.6092</span></span>
<span><span class="co">#&gt; C|D  9.1287  1.3489     6.7677</span></span>
<span><span class="co">#&gt; D|E 10.9709  1.5691     6.9917</span></span>
<span><span class="co">#&gt; E|F 12.9482  1.8234     7.1011</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual Deviance: 128.7906 </span></span>
<span><span class="co">#&gt; AIC: 142.7906</span></span>
<span><span class="co"># Extract the coefficients and thresholds</span></span>
<span><span class="va">coefficients</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span>
<span><span class="va">thresholds</span> <span class="op">&lt;-</span> <span class="va">m</span><span class="op">$</span><span class="va">zeta</span></span>
<span></span>
<span><span class="co"># Define a function to calculate the expected response category at any given dose</span></span>
<span><span class="va">expected_response</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">log_dose</span>, <span class="va">coefficients</span>, <span class="va">thresholds</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Calculate probabilities for each category</span></span>
<span>  <span class="va">probabilities</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">thresholds</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">thresholds</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">-</span> <span class="va">coefficients</span> <span class="op">*</span> <span class="va">log_dose</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Convert to category probabilities</span></span>
<span>  <span class="va">probabilities</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">probabilities</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">probabilities</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Define the injury percentage for each category</span></span>
<span>  <span class="va">categories</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span>, <span class="fl">30</span>, <span class="fl">50</span>, <span class="fl">70</span>, <span class="fl">90</span>, <span class="fl">100</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Calculate expected value (weighted average)</span></span>
<span>  <span class="va">expected_value</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">probabilities</span> <span class="op">*</span> <span class="va">categories</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">expected_value</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Find the dose where the expected response is closest to 50%</span></span>
<span><span class="va">log_doses</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>, length.out <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="va">responses</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">log_doses</span>, <span class="va">expected_response</span>, </span>
<span>                   coefficients <span class="op">=</span> <span class="va">coefficients</span><span class="op">[</span><span class="st">"log(dose)"</span><span class="op">]</span>, </span>
<span>                   thresholds <span class="op">=</span> <span class="va">thresholds</span><span class="op">)</span></span>
<span><span class="va">closest_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">responses</span> <span class="op">-</span> <span class="fl">50</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">dose_ec50</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">log_doses</span><span class="op">[</span><span class="va">closest_index</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print the EC50 value</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">dose_ec50</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 12.13624</span></span></code></pre></div>
<p>or we could find the EC50 by an optimization</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define the objective function to minimize (distance from 50%)</span></span>
<span><span class="va">objective_function</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">log_dose</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu">expected_response</span><span class="op">(</span><span class="va">log_dose</span>, <span class="va">coefficients</span><span class="op">[</span><span class="st">"log(dose)"</span><span class="op">]</span>, <span class="va">thresholds</span><span class="op">)</span> <span class="op">-</span> <span class="fl">50</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Use optimization to find the EC50</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/optimize.html" class="external-link">optimize</a></span><span class="op">(</span><span class="va">objective_function</span>, interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">dose_ec50</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">minimum</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print the EC50 value and the corresponding expected response</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"EC50:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">dose_ec50</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "EC50: 12.1586"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Expected response at EC50:"</span>, </span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu">expected_response</span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">minimum</span>, <span class="va">coefficients</span><span class="op">[</span><span class="st">"log(dose)"</span><span class="op">]</span>, <span class="va">thresholds</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Expected response at EC50: 49.9986"</span></span></code></pre></div>
<p>Note that when implementing the bootstrap approach, some bootstrap
samples are causing separation problems in the ordinal regression model,
which is common when resampling from smaller datasets. Therefore, a
robust solution here is given to gracefully handle this issue.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define the function to calculate EC50 for a bootstrap sample with error handling</span></span>
<span><span class="va">calculate_ec50</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Try to fit the model, return NA if it fails</span></span>
<span>  <span class="va">m_boot</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/polr.html" class="external-link">polr</a></span><span class="op">(</span><span class="va">y0</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">dose</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">data</span>, Hess <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, silent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">inherits</a></span><span class="op">(</span><span class="va">m_boot</span>, <span class="st">"try-error"</span><span class="op">)</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">coefficients</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">m_boot</span><span class="op">)</span></span>
<span>  <span class="va">thresholds</span> <span class="op">&lt;-</span> <span class="va">m_boot</span><span class="op">$</span><span class="va">zeta</span></span>
<span>  </span>
<span>  <span class="co"># Define objective function to minimize</span></span>
<span>  <span class="va">objective_function</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">log_dose</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu">expected_response</span><span class="op">(</span><span class="va">log_dose</span>, <span class="va">coefficients</span><span class="op">[</span><span class="st">"log(dose)"</span><span class="op">]</span>, <span class="va">thresholds</span><span class="op">)</span> <span class="op">-</span> <span class="fl">50</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># Try to optimize, return NA if it fails</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/optimize.html" class="external-link">optimize</a></span><span class="op">(</span><span class="va">objective_function</span>, interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, silent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">inherits</a></span><span class="op">(</span><span class="va">result</span>, <span class="st">"try-error"</span><span class="op">)</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">dose_ec50</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">minimum</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">dose_ec50</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Bootstrap resampling with error handling</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">n_bootstrap</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">bootstrap_ec50</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span><span class="va">n_bootstrap</span>, <span class="op">{</span></span>
<span>  <span class="co"># Sample with replacement</span></span>
<span>  <span class="va">sample_indices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">dattab_new</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="va">bootstrap_sample</span> <span class="op">&lt;-</span> <span class="va">dattab_new</span><span class="op">[</span><span class="va">sample_indices</span>, <span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># Calculate EC50 for this sample</span></span>
<span>  <span class="fu">calculate_ec50</span><span class="op">(</span><span class="va">bootstrap_sample</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Remove NA values from bootstrap results</span></span>
<span><span class="va">bootstrap_ec50</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="va">bootstrap_ec50</span><span class="op">)</span></span>
<span><span class="va">valid_samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">bootstrap_ec50</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate point estimate using original data rather than as the mean of bootstrap estimates, which is more statistically sound.</span></span>
<span><span class="va">ec50_point</span> <span class="op">&lt;-</span> <span class="fu">calculate_ec50</span><span class="op">(</span><span class="va">dattab_new</span><span class="op">)</span></span>
<span><span class="co"># Calculate confidence intervals</span></span>
<span><span class="va">ec50_ci</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">bootstrap_ec50</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print the results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"EC50:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">ec50_point</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "EC50: 12.1586"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"95% Confidence Interval:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">ec50_ci</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fl">4</span><span class="op">)</span>, <span class="st">"-"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">ec50_ci</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "95% Confidence Interval: 10.1651 - 15.0979"</span></span>
<span><span class="co">## Reporting Valid Samples: how many bootstrap samples were valid, which helps assess the reliability of the confidence interval.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Based on"</span>, <span class="va">valid_samples</span>, <span class="st">"valid bootstrap samples out of"</span>, <span class="va">n_bootstrap</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Based on 957 valid bootstrap samples out of 1000"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="additional-understanding-of-the-ordinal-regression-model">Additional understanding of the ordinal regression model<a class="anchor" aria-label="anchor" href="#additional-understanding-of-the-ordinal-regression-model"></a>
</h3>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ctable</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## At ER50, the cumulative probability probability of the response being in a higher category is close to 1.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">ctable</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">ctable</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">12.18</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; log(dose)       0|A       A|B       B|C       C|D       D|E       E|F </span></span>
<span><span class="co">#&gt; 0.9908438 0.9975973 0.9998653 0.9999875 0.9999963 0.9999997 1.0000000</span></span>
<span><span class="co">## calculate and store p values</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">pnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">ctable</span><span class="op">[</span>, <span class="st">"t value"</span><span class="op">]</span><span class="op">)</span>, lower.tail <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">*</span> <span class="fl">2</span></span>
<span></span>
<span><span class="co">## combined table</span></span>
<span><span class="op">(</span><span class="va">ctable</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">ctable</span>, <span class="st">"p value"</span> <span class="op">=</span> <span class="va">p</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;               Value Std. Error  t value      p value</span></span>
<span><span class="co">#&gt; log(dose)  3.465155  0.4876298 7.106117 1.193530e-12</span></span>
<span><span class="co">#&gt; 0|A        4.006148  0.8091031 4.951344 7.370254e-07</span></span>
<span><span class="co">#&gt; A|B        6.341529  1.0283150 6.166913 6.963590e-10</span></span>
<span><span class="co">#&gt; B|C        8.192141  1.2395138 6.609156 3.865169e-11</span></span>
<span><span class="co">#&gt; C|D        9.128696  1.3488680 6.767672 1.308710e-11</span></span>
<span><span class="co">#&gt; D|E       10.970866  1.5691374 6.991654 2.716642e-12</span></span>
<span><span class="co">#&gt; E|F       12.948174  1.8234117 7.101070 1.237950e-12</span></span>
<span></span>
<span><span class="op">(</span><span class="va">ci</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span><span class="op">)</span> <span class="co">## profiled CI</span></span>
<span><span class="co">#&gt;    2.5 %   97.5 % </span></span>
<span><span class="co">#&gt; 2.582836 4.504378</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">ci</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;                       2.5 %   97.5 %</span></span>
<span><span class="co">#&gt; log(dose) 31.98141 13.23462 90.41212</span></span>
<span><span class="co">## OR and CI</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>OR <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span>, <span class="va">ci</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;              OR       ci</span></span>
<span><span class="co">#&gt; 2.5 %  31.98141 13.23462</span></span>
<span><span class="co">#&gt; 97.5 % 31.98141 90.41212</span></span>
<span></span>
<span><span class="va">newdat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>dose <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">dattab_new</span><span class="op">$</span><span class="va">dose</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>logdose <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">dose</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">(</span><span class="va">phat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">m</span>, <span class="va">newdat</span>, type<span class="op">=</span><span class="st">"p"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;              0            A           B           C          D            E</span></span>
<span><span class="co">#&gt; 1 8.326166e-01 0.1483000019 0.016035611 0.001850927 0.00100702 0.0001635762</span></span>
<span><span class="co">#&gt; 2 3.105443e-01 0.5126011687 0.144195119 0.019598385 0.01096824 0.0018025754</span></span>
<span><span class="co">#&gt; 3 3.918687e-02 0.2573055374 0.431914336 0.144078094 0.10487831 0.0194406374</span></span>
<span><span class="co">#&gt; 4 3.342916e-04 0.0031093320 0.018073161 0.031603441 0.20832988 0.4574198047</span></span>
<span><span class="co">#&gt; 5 3.679470e-03 0.0330795765 0.158639125 0.187148646 0.41376767 0.1694853156</span></span>
<span><span class="co">#&gt; 6 3.027903e-05 0.0002825179 0.001674417 0.003066947 0.02600507 0.1569497884</span></span>
<span><span class="co">#&gt;              F</span></span>
<span><span class="co">#&gt; 1 2.628958e-05</span></span>
<span><span class="co">#&gt; 2 2.902582e-04</span></span>
<span><span class="co">#&gt; 3 3.196213e-03</span></span>
<span><span class="co">#&gt; 4 2.811301e-01</span></span>
<span><span class="co">#&gt; 5 3.420020e-02</span></span>
<span><span class="co">#&gt; 6 8.119910e-01</span></span>
<span></span>
<span><span class="va">phat</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">.</span>,digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">0</th>
<th align="right">A</th>
<th align="right">B</th>
<th align="right">C</th>
<th align="right">D</th>
<th align="right">E</th>
<th align="right">F</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">0.833</td>
<td align="right">0.148</td>
<td align="right">0.016</td>
<td align="right">0.002</td>
<td align="right">0.001</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="right">0.311</td>
<td align="right">0.513</td>
<td align="right">0.144</td>
<td align="right">0.020</td>
<td align="right">0.011</td>
<td align="right">0.002</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="right">0.039</td>
<td align="right">0.257</td>
<td align="right">0.432</td>
<td align="right">0.144</td>
<td align="right">0.105</td>
<td align="right">0.019</td>
<td align="right">0.003</td>
</tr>
<tr class="even">
<td align="right">0.000</td>
<td align="right">0.003</td>
<td align="right">0.018</td>
<td align="right">0.032</td>
<td align="right">0.208</td>
<td align="right">0.457</td>
<td align="right">0.281</td>
</tr>
<tr class="odd">
<td align="right">0.004</td>
<td align="right">0.033</td>
<td align="right">0.159</td>
<td align="right">0.187</td>
<td align="right">0.414</td>
<td align="right">0.169</td>
<td align="right">0.034</td>
</tr>
<tr class="even">
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.002</td>
<td align="right">0.003</td>
<td align="right">0.026</td>
<td align="right">0.157</td>
<td align="right">0.812</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ylleonv/GLMcat" class="external-link">GLMcat</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">dattab_new</span> <span class="op">&lt;-</span> <span class="va">dattab_new</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>logdose <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">dose</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mod_ref_log_c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/GLMcat/man/glmcat.html" class="external-link">glmcat</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">y0</span> <span class="op">~</span> <span class="va">logdose</span>, ratio <span class="op">=</span> <span class="st">"reference"</span>, cdf <span class="op">=</span> <span class="st">"logistic"</span>, data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">dattab_new</span><span class="op">)</span>,ref<span class="op">=</span><span class="st">"0"</span>,parallel <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod_ref_log_c</span><span class="op">)</span></span>
<span><span class="co">#&gt; y0 ~ logdose</span></span>
<span><span class="co">#&gt;                 ratio      cdf nobs niter    logLik</span></span>
<span><span class="co">#&gt; Model info: reference logistic   60    15 -61.33542</span></span>
<span><span class="co">#&gt;                 Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; (Intercept) A     -2.907      1.309  -2.221 0.026323 *  </span></span>
<span><span class="co">#&gt; (Intercept) B     -5.398      1.835  -2.942 0.003260 ** </span></span>
<span><span class="co">#&gt; (Intercept) C     -9.347      3.019  -3.096 0.001958 ** </span></span>
<span><span class="co">#&gt; (Intercept) D    -10.923      3.065  -3.564 0.000366 ***</span></span>
<span><span class="co">#&gt; (Intercept) E    -17.421      4.838  -3.600 0.000318 ***</span></span>
<span><span class="co">#&gt; (Intercept) F   -118.572 109742.356  -0.001 0.999138    </span></span>
<span><span class="co">#&gt; logdose A          2.179      0.993   2.194 0.028225 *  </span></span>
<span><span class="co">#&gt; logdose B          3.415      1.177   2.901 0.003725 ** </span></span>
<span><span class="co">#&gt; logdose C          4.803      1.504   3.194 0.001404 ** </span></span>
<span><span class="co">#&gt; logdose D          5.633      1.499   3.758 0.000172 ***</span></span>
<span><span class="co">#&gt; logdose E          7.692      1.895   4.058 4.94e-05 ***</span></span>
<span><span class="co">#&gt; logdose F         36.404  31664.951   0.001 0.999083    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="op">(</span><span class="va">phat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">mod_ref_log_c</span>, <span class="va">newdat</span>, type<span class="op">=</span><span class="st">"prob"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;                 A            B            C            D            E</span></span>
<span><span class="co">#&gt; [1,] 1.904456e-01 3.716346e-02 1.873707e-03 6.891895e-04 4.324730e-06</span></span>
<span><span class="co">#&gt; [2,] 4.075170e-01 1.873256e-01 2.472185e-02 1.616443e-02 4.225492e-04</span></span>
<span><span class="co">#&gt; [3,] 3.188563e-01 3.452649e-01 1.192710e-01 1.386298e-01 1.509628e-02</span></span>
<span><span class="co">#&gt; [4,] 5.226961e-03 3.140645e-02 7.433584e-02 2.730262e-01 5.159543e-01</span></span>
<span><span class="co">#&gt; [5,] 7.795418e-02 1.988396e-01 1.797976e-01 3.714905e-01 1.685225e-01</span></span>
<span><span class="co">#&gt; [6,] 2.602312e-12 3.683282e-11 2.281986e-10 1.489914e-09 1.172910e-08</span></span>
<span><span class="co">#&gt;                 F            0</span></span>
<span><span class="co">#&gt; [1,] 2.238527e-41 7.698238e-01</span></span>
<span><span class="co">#&gt; [2,] 9.621150e-31 3.638486e-01</span></span>
<span><span class="co">#&gt; [3,] 1.512050e-20 6.288173e-02</span></span>
<span><span class="co">#&gt; [4,] 1.000000e-01 5.029071e-05</span></span>
<span><span class="co">#&gt; [5,] 7.425066e-11 3.395654e-03</span></span>
<span><span class="co">#&gt; [6,] 1.000000e+00 5.662137e-15</span></span>
<span><span class="va">phat</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">.</span>,digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">A</th>
<th align="right">B</th>
<th align="right">C</th>
<th align="right">D</th>
<th align="right">E</th>
<th align="right">F</th>
<th align="right">0</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">0.190</td>
<td align="right">0.037</td>
<td align="right">0.002</td>
<td align="right">0.001</td>
<td align="right">0.000</td>
<td align="right">0.0</td>
<td align="right">0.770</td>
</tr>
<tr class="even">
<td align="right">0.408</td>
<td align="right">0.187</td>
<td align="right">0.025</td>
<td align="right">0.016</td>
<td align="right">0.000</td>
<td align="right">0.0</td>
<td align="right">0.364</td>
</tr>
<tr class="odd">
<td align="right">0.319</td>
<td align="right">0.345</td>
<td align="right">0.119</td>
<td align="right">0.139</td>
<td align="right">0.015</td>
<td align="right">0.0</td>
<td align="right">0.063</td>
</tr>
<tr class="even">
<td align="right">0.005</td>
<td align="right">0.031</td>
<td align="right">0.074</td>
<td align="right">0.273</td>
<td align="right">0.516</td>
<td align="right">0.1</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="right">0.078</td>
<td align="right">0.199</td>
<td align="right">0.180</td>
<td align="right">0.371</td>
<td align="right">0.169</td>
<td align="right">0.0</td>
<td align="right">0.003</td>
</tr>
<tr class="even">
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">1.0</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">## (phat &lt;- predict(object = mod_ref_log_c, newdat, type="linear.predictor"))</span></span>
<span></span>
<span><span class="va">mod_cum_logis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/GLMcat/man/glmcat.html" class="external-link">glmcat</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">y0</span> <span class="op">~</span> <span class="va">logdose</span>, ratio <span class="op">=</span> <span class="st">"cumulative"</span>, cdf <span class="op">=</span> <span class="st">"logistic"</span>, data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">dattab_new</span><span class="op">)</span>,parallel <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod_cum_logis</span><span class="op">)</span></span>
<span><span class="co">#&gt; y0 ~ logdose</span></span>
<span><span class="co">#&gt;                  ratio      cdf nobs niter   logLik</span></span>
<span><span class="co">#&gt; Model info: cumulative logistic   60     9 -64.3953</span></span>
<span><span class="co">#&gt;               Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; (Intercept) 0   4.0061     0.8142   4.920 8.64e-07 ***</span></span>
<span><span class="co">#&gt; (Intercept) A   6.3415     1.0419   6.086 1.16e-09 ***</span></span>
<span><span class="co">#&gt; (Intercept) B   8.1920     1.2583   6.510 7.50e-11 ***</span></span>
<span><span class="co">#&gt; (Intercept) C   9.1286     1.3693   6.666 2.62e-11 ***</span></span>
<span><span class="co">#&gt; (Intercept) D  10.9707     1.6005   6.854 7.16e-12 ***</span></span>
<span><span class="co">#&gt; (Intercept) E  12.9479     1.8194   7.117 1.11e-12 ***</span></span>
<span><span class="co">#&gt; logdose        -3.4651     0.4912  -7.054 1.74e-12 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span></span>
<span><span class="op">(</span><span class="va">phat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">mod_cum_logis</span>, <span class="va">newdat</span>, type<span class="op">=</span><span class="st">"prob"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;                 0            A           B           C           D           E</span></span>
<span><span class="co">#&gt; [1,] 8.326186e-01 0.1482975531 0.016035767 0.001851046 0.001007102 0.000163596</span></span>
<span><span class="co">#&gt; [2,] 3.105557e-01 0.5125923926 0.144191357 0.019598856 0.010968693 0.001802725</span></span>
<span><span class="co">#&gt; [3,] 3.919032e-02 0.2573138937 0.431903119 0.144076171 0.104878455 0.019441472</span></span>
<span><span class="co">#&gt; [4,] 3.343480e-04 0.0031097342 0.018074387 0.031605029 0.208331116 0.457408504</span></span>
<span><span class="co">#&gt; [5,] 3.679947e-03 0.0330824671 0.158642283 0.187148395 0.413758936 0.169485389</span></span>
<span><span class="co">#&gt; [6,] 3.028531e-05 0.0002825654 0.001674598 0.003067232 0.026006412 0.156948672</span></span>
<span><span class="co">#&gt;                 F</span></span>
<span><span class="co">#&gt; [1,] 2.629451e-05</span></span>
<span><span class="co">#&gt; [2,] 2.903015e-04</span></span>
<span><span class="co">#&gt; [3,] 3.196565e-03</span></span>
<span><span class="co">#&gt; [4,] 2.811369e-01</span></span>
<span><span class="co">#&gt; [5,] 3.420258e-02</span></span>
<span><span class="co">#&gt; [6,] 8.119902e-01</span></span>
<span><span class="va">phat</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">.</span>,digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">0</th>
<th align="right">A</th>
<th align="right">B</th>
<th align="right">C</th>
<th align="right">D</th>
<th align="right">E</th>
<th align="right">F</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">0.833</td>
<td align="right">0.148</td>
<td align="right">0.016</td>
<td align="right">0.002</td>
<td align="right">0.001</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="right">0.311</td>
<td align="right">0.513</td>
<td align="right">0.144</td>
<td align="right">0.020</td>
<td align="right">0.011</td>
<td align="right">0.002</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="right">0.039</td>
<td align="right">0.257</td>
<td align="right">0.432</td>
<td align="right">0.144</td>
<td align="right">0.105</td>
<td align="right">0.019</td>
<td align="right">0.003</td>
</tr>
<tr class="even">
<td align="right">0.000</td>
<td align="right">0.003</td>
<td align="right">0.018</td>
<td align="right">0.032</td>
<td align="right">0.208</td>
<td align="right">0.457</td>
<td align="right">0.281</td>
</tr>
<tr class="odd">
<td align="right">0.004</td>
<td align="right">0.033</td>
<td align="right">0.159</td>
<td align="right">0.187</td>
<td align="right">0.414</td>
<td align="right">0.169</td>
<td align="right">0.034</td>
</tr>
<tr class="even">
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.002</td>
<td align="right">0.003</td>
<td align="right">0.026</td>
<td align="right">0.157</td>
<td align="right">0.812</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="other-understanding-of-the-dataset">Other understanding of the dataset<a class="anchor" aria-label="anchor" href="#other-understanding-of-the-dataset"></a>
</h3>
<p>In principle, ordinal regression is treating the ranked categorical
as several binomial for each category. Note that how the intercept of
<code>0|A</code> is -1.386294e+00.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit0</span> <span class="op">&lt;-</span> <span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/polr.html" class="external-link">polr</a></span><span class="op">(</span><span class="va">y0</span> <span class="op">~</span>  <span class="fl">1</span>,</span>
<span>                      data <span class="op">=</span> <span class="va">dattab_new</span>,</span>
<span>                      Hess<span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="va">fit0</span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; MASS::polr(formula = y0 ~ 1, data = dattab_new, Hess = T)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; No coefficients</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Intercepts:</span></span>
<span><span class="co">#&gt;           0|A           A|B           B|C           C|D           D|E </span></span>
<span><span class="co">#&gt; -1.386294e+00 -5.465462e-01 -1.793225e-06  2.682586e-01  8.472940e-01 </span></span>
<span><span class="co">#&gt;           E|F </span></span>
<span><span class="co">#&gt;  1.493920e+00 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual Deviance: 228.003 </span></span>
<span><span class="co">#&gt; AIC: 240.003</span></span>
<span><span class="co">## Note that </span></span>
<span></span>
<span><span class="co">#source("https://github.com/rwnahhas/RMPH_Resources/raw/main/Functions_rmph.R")</span></span>
<span><span class="va">ilogit</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">ilogit</span><span class="op">(</span><span class="va">fit0</span><span class="op">$</span><span class="va">zeta</span><span class="op">)</span></span>
<span><span class="co">#&gt;       0|A       A|B       B|C       C|D       D|E       E|F </span></span>
<span><span class="co">#&gt; 0.2000001 0.3666661 0.4999996 0.5666653 0.6999992 0.8166659</span></span>
<span></span>
<span></span>
<span><span class="va">sf</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Y&gt;=1'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">qlogis</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">y</span> <span class="op">&gt;=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="st">'Y&gt;=2'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">qlogis</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">y</span> <span class="op">&gt;=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="st">'Y&gt;=3'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">qlogis</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">y</span> <span class="op">&gt;=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="st">'Y&gt;=4'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">qlogis</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">y</span> <span class="op">&gt;=</span> <span class="fl">4</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="st">'Y&gt;=5'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">qlogis</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">y</span> <span class="op">&gt;=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="st">'Y&gt;=6'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">qlogis</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">y</span> <span class="op">&gt;=</span> <span class="fl">6</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://hbiostat.org/R/Hmisc/" class="external-link">Hmisc</a></span><span class="op">)</span></span>
<span><span class="op">(</span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">dattab_new</span>,<span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">y0</span><span class="op">)</span> <span class="op">~</span> <span class="op">(</span><span class="va">dose</span><span class="op">)</span>, fun<span class="op">=</span><span class="va">sf</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; as.numeric(y0)      N= 60  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; +-------+--+--+----+----------+----------+----------+----------+----------+</span></span>
<span><span class="co">#&gt; |       |  | N|Y&gt;=1|      Y&gt;=2|      Y&gt;=3|      Y&gt;=4|      Y&gt;=5|      Y&gt;=6|</span></span>
<span><span class="co">#&gt; +-------+--+--+----+----------+----------+----------+----------+----------+</span></span>
<span><span class="co">#&gt; |   dose| 2|10| Inf|-1.3862944|      -Inf|      -Inf|      -Inf|      -Inf|</span></span>
<span><span class="co">#&gt; |       | 4|10| Inf| 0.8472979|-1.3862944|      -Inf|      -Inf|      -Inf|</span></span>
<span><span class="co">#&gt; |       | 8|10| Inf| 2.1972246| 0.8472979|-0.8472979|-2.1972246|      -Inf|</span></span>
<span><span class="co">#&gt; |       |16|10| Inf|       Inf|       Inf| 1.3862944| 0.8472979|-1.3862944|</span></span>
<span><span class="co">#&gt; |       |32|10| Inf|       Inf| 2.1972246| 2.1972246| 1.3862944| 0.4054651|</span></span>
<span><span class="co">#&gt; |       |64|10| Inf|       Inf|       Inf|       Inf|       Inf|       Inf|</span></span>
<span><span class="co">#&gt; +-------+--+--+----+----------+----------+----------+----------+----------+</span></span>
<span><span class="co">#&gt; |Overall|  |60| Inf| 1.3862944| 0.5465437| 0.0000000|-0.2682640|-0.8472979|</span></span>
<span><span class="co">#&gt; +-------+--+--+----+----------+----------+----------+----------+----------+</span></span>
<span></span>
<span></span>
<span><span class="va">mod2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">y0</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">dose</span><span class="op">)</span>, family<span class="op">=</span><span class="st">"binomial"</span>, data <span class="op">=</span> <span class="va">dattab_new</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/predict.glm.html" class="external-link">predict.glm</a></span><span class="op">(</span><span class="va">mod2</span>,<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>dose<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;         1 </span></span>
<span><span class="co">#&gt; -1.386294</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/predict.glm.html" class="external-link">predict.glm</a></span><span class="op">(</span><span class="va">mod2</span>,<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>dose<span class="op">=</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;         1 </span></span>
<span><span class="co">#&gt; 0.8472979</span></span>
<span><span class="va">mod3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">y0</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">dose</span><span class="op">)</span>, family<span class="op">=</span><span class="st">"binomial"</span>, data <span class="op">=</span> <span class="va">dattab_new</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/predict.glm.html" class="external-link">predict.glm</a></span><span class="op">(</span><span class="va">mod3</span>,<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>dose<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;         1 </span></span>
<span><span class="co">#&gt; -20.56607</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">y0</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">dose</span><span class="op">)</span>, family<span class="op">=</span><span class="st">"binomial"</span>, data <span class="op">=</span> <span class="va">dattab_new</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:  glm(formula = I(as.numeric(y0) &gt;= 4) ~ factor(dose), family = "binomial", </span></span>
<span><span class="co">#&gt;     data = dattab_new)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;    (Intercept)   factor(dose)4   factor(dose)8  factor(dose)16  factor(dose)32  </span></span>
<span><span class="co">#&gt;     -2.057e+01       9.728e-12       1.972e+01       2.195e+01       2.276e+01  </span></span>
<span><span class="co">#&gt; factor(dose)64  </span></span>
<span><span class="co">#&gt;      4.113e+01  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Degrees of Freedom: 59 Total (i.e. Null);  54 Residual</span></span>
<span><span class="co">#&gt; Null Deviance:       83.18 </span></span>
<span><span class="co">#&gt; Residual Deviance: 28.73     AIC: 40.73</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="log-logistic-with-quasi-binomial-replicate-effects">log-logistic with quasi-binomial: replicate effects<a class="anchor" aria-label="anchor" href="#log-logistic-with-quasi-binomial-replicate-effects"></a>
</h3>
<p>Original study design is CRD. However, it was argued to treat it as
RCBD with blocking effect coming from the replicate numbering. We can
compare the result differences.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">yy2</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">dose</span><span class="op">)</span>,data <span class="op">=</span> <span class="va">dattab_new</span>,family <span class="op">=</span> <span class="va">quasibinomial</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; glm(formula = yy2 ~ log(dose), family = quasibinomial, data = dattab_new)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept)  -3.5064     0.3132  -11.19 4.02e-16 ***</span></span>
<span><span class="co">#&gt; log(dose)     1.3832     0.1171   11.81  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; (Dispersion parameter for quasibinomial family taken to be 0.1163524)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Null deviance: 31.8277  on 59  degrees of freedom</span></span>
<span><span class="co">#&gt; Residual deviance:  6.3595  on 58  degrees of freedom</span></span>
<span><span class="co">#&gt; AIC: NA</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of Fisher Scoring iterations: 5</span></span>
<span><span class="va">ER50</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">ER50</span></span>
<span><span class="co">#&gt; (Intercept) </span></span>
<span><span class="co">#&gt;      12.617</span></span>
<span><span class="fu"><a href="../reference/getEC50.html">getEC50</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span><span class="co">#&gt;     EC50    lower    upper       se</span></span>
<span><span class="co">#&gt; 1 12.617 10.77038 14.78023 1.023657</span></span>
<span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">mod</span>,newdata <span class="op">=</span> <span class="va">dattab_new</span>,type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span><span class="va">dattab_new</span><span class="op">$</span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="va">pred</span></span>
<span><span class="va">dattab_new</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">y0</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>n<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>,meany<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">yt</span><span class="op">)</span>,meanyy2<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">yy2</span><span class="op">)</span>,meanEst<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">pred</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">.</span>,digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">y0</th>
<th align="right">n</th>
<th align="right">meany</th>
<th align="right">meanyy2</th>
<th align="right">meanEst</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">0</td>
<td align="right">12</td>
<td align="right">0.042</td>
<td align="right">0.05</td>
<td align="right">0.120</td>
</tr>
<tr class="even">
<td align="left">A</td>
<td align="right">10</td>
<td align="right">0.169</td>
<td align="right">0.18</td>
<td align="right">0.247</td>
</tr>
<tr class="odd">
<td align="left">B</td>
<td align="right">8</td>
<td align="right">0.307</td>
<td align="right">0.34</td>
<td align="right">0.361</td>
</tr>
<tr class="even">
<td align="left">C</td>
<td align="right">4</td>
<td align="right">0.489</td>
<td align="right">0.50</td>
<td align="right">0.515</td>
</tr>
<tr class="odd">
<td align="left">D</td>
<td align="right">8</td>
<td align="right">0.677</td>
<td align="right">0.66</td>
<td align="right">0.603</td>
</tr>
<tr class="even">
<td align="left">E</td>
<td align="right">7</td>
<td align="right">0.812</td>
<td align="right">0.82</td>
<td align="right">0.726</td>
</tr>
<tr class="odd">
<td align="left">F</td>
<td align="right">11</td>
<td align="right">0.958</td>
<td align="right">0.95</td>
<td align="right">0.893</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">## Consider Replicate effect</span></span>
<span><span class="va">modr</span> <span class="op">&lt;-</span> <span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/glmmPQL.html" class="external-link">glmmPQL</a></span><span class="op">(</span><span class="va">yy2</span><span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">dose</span><span class="op">)</span>,random<span class="op">=</span><span class="op">~</span><span class="fl">1</span><span class="op">|</span><span class="va">rep</span>,family<span class="op">=</span><span class="st">"quasibinomial"</span>,data<span class="op">=</span><span class="va">dattab_new</span><span class="op">)</span></span>
<span><span class="va">ER50</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">modr</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">modr</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">modr</span><span class="op">$</span><span class="va">coefficients</span><span class="op">$</span><span class="va">fixed</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">/</span> <span class="va">modr</span><span class="op">$</span><span class="va">coefficients</span><span class="op">$</span><span class="va">fixed</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; (Intercept) </span></span>
<span><span class="co">#&gt;    12.61695</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">modr</span><span class="op">)</span></span>
<span><span class="co">#&gt; Linear mixed-effects model fit by maximum likelihood</span></span>
<span><span class="co">#&gt;   Data: dattab_new </span></span>
<span><span class="co">#&gt;   AIC BIC logLik</span></span>
<span><span class="co">#&gt;    NA  NA     NA</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Random effects:</span></span>
<span><span class="co">#&gt;  Formula: ~1 | rep</span></span>
<span><span class="co">#&gt;         (Intercept)  Residual</span></span>
<span><span class="co">#&gt; StdDev:   0.2256918 0.3155037</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Variance function:</span></span>
<span><span class="co">#&gt;  Structure: fixed weights</span></span>
<span><span class="co">#&gt;  Formula: ~invwt </span></span>
<span><span class="co">#&gt; Fixed effects:  yy2 ~ log(dose) </span></span>
<span><span class="co">#&gt;                 Value Std.Error DF   t-value p-value</span></span>
<span><span class="co">#&gt; (Intercept) -3.517527 0.3039553 49 -11.57251       0</span></span>
<span><span class="co">#&gt; log(dose)    1.387562 0.1103306 49  12.57640       0</span></span>
<span><span class="co">#&gt;  Correlation: </span></span>
<span><span class="co">#&gt;           (Intr)</span></span>
<span><span class="co">#&gt; log(dose) -0.907</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Standardized Within-Group Residuals:</span></span>
<span><span class="co">#&gt;        Min         Q1        Med         Q3        Max </span></span>
<span><span class="co">#&gt; -3.9592347 -0.3047297  0.1382668  0.4944066  1.9353183 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of Observations: 60</span></span>
<span><span class="co">#&gt; Number of Groups: 10</span></span>
<span><span class="fu"><a href="../reference/getEC50.html">getEC50</a></span><span class="op">(</span><span class="va">modr</span><span class="op">)</span></span>
<span><span class="co">#&gt;              EC50    lower    upper       se</span></span>
<span><span class="co">#&gt; p = 0.5: 12.61695 10.56476 15.06777 1.149772</span></span>
<span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">modr</span>,newdata <span class="op">=</span> <span class="va">dattab_new</span>,type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span><span class="va">dattab_new</span><span class="op">$</span><span class="va">predr</span> <span class="op">&lt;-</span> <span class="va">pred</span></span>
<span><span class="va">dattab_new</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">y0</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>n<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>,meany<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">yt</span><span class="op">)</span>,meanyy2<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">yy2</span><span class="op">)</span>,meanEst<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">pred</span><span class="op">)</span>,meanEstR<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">predr</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">.</span>,digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">y0</th>
<th align="right">n</th>
<th align="right">meany</th>
<th align="right">meanyy2</th>
<th align="right">meanEst</th>
<th align="right">meanEstR</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">0</td>
<td align="right">12</td>
<td align="right">0.042</td>
<td align="right">0.05</td>
<td align="right">0.120</td>
<td align="right">0.120</td>
</tr>
<tr class="even">
<td align="left">A</td>
<td align="right">10</td>
<td align="right">0.169</td>
<td align="right">0.18</td>
<td align="right">0.247</td>
<td align="right">0.240</td>
</tr>
<tr class="odd">
<td align="left">B</td>
<td align="right">8</td>
<td align="right">0.307</td>
<td align="right">0.34</td>
<td align="right">0.361</td>
<td align="right">0.342</td>
</tr>
<tr class="even">
<td align="left">C</td>
<td align="right">4</td>
<td align="right">0.489</td>
<td align="right">0.50</td>
<td align="right">0.515</td>
<td align="right">0.517</td>
</tr>
<tr class="odd">
<td align="left">D</td>
<td align="right">8</td>
<td align="right">0.677</td>
<td align="right">0.66</td>
<td align="right">0.603</td>
<td align="right">0.620</td>
</tr>
<tr class="even">
<td align="left">E</td>
<td align="right">7</td>
<td align="right">0.812</td>
<td align="right">0.82</td>
<td align="right">0.726</td>
<td align="right">0.736</td>
</tr>
<tr class="odd">
<td align="left">F</td>
<td align="right">11</td>
<td align="right">0.958</td>
<td align="right">0.95</td>
<td align="right">0.893</td>
<td align="right">0.894</td>
</tr>
</tbody>
</table>
<p>Note that glmer and glmmPQL (based on lme from the nlme pacakge)
differs in terms of parameter estimation algorithm and nlme is not
optimized for dealing with crossed random effects, which are associated
with a sparse design matrix. See more in the book from Pinheiro &amp;
Bates.[^1]</p>
</div>
<div class="section level3">
<h3 id="drm-ordinal">DRM Ordinal<a class="anchor" aria-label="anchor" href="#drm-ordinal"></a>
</h3>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.r-project.org" class="external-link">drc</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">bmd</span><span class="op">)</span></span>
<span><span class="va">dat_ord</span> <span class="op">&lt;-</span> <span class="va">dattab_new</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">y0</span>,<span class="va">dose</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>n<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">y0</span>,values_from <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span>
<span><span class="va">dat_ord</span> <span class="op">&lt;-</span> <span class="va">dat_ord</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">`0`</span>,<span class="va">`A`</span>,<span class="va">`B`</span>,<span class="va">`C`</span>,<span class="va">`D`</span>,<span class="va">`E`</span>,<span class="va">`F`</span><span class="op">)</span>,<span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>,<span class="fl">0</span>,<span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>total<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums-methods.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">`0`</span>,<span class="va">`A`</span>,<span class="va">`B`</span>,<span class="va">`C`</span>,<span class="va">`D`</span>,<span class="va">`E`</span>,<span class="va">`F`</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mod_ord</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/bmd/man/drmOrdinal.html" class="external-link">drmOrdinal</a></span><span class="op">(</span>levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">dattab_new</span><span class="op">$</span><span class="va">y0</span><span class="op">)</span>,  weights<span class="op">=</span><span class="st">"total"</span>,dose <span class="op">=</span> <span class="st">"dose"</span>, data <span class="op">=</span> <span class="va">dat_ord</span>, fct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/drc/man/LL.2.html" class="external-link">LL.2</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mod_ord</span><span class="op">)</span> <span class="co"># uses ggplot</span></span></code></pre></div>
<p><img src="Ordinal-Data_files/figure-html/unnamed-chunk-16-1.png" width="672"></p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/bmd/man/bmdOrdinal.html" class="external-link">bmdOrdinal</a></span><span class="op">(</span><span class="va">mod_ord</span>, bmr <span class="op">=</span> <span class="fl">0.5</span>, backgType <span class="op">=</span> <span class="st">"modelBased"</span>, def <span class="op">=</span> <span class="st">"excess"</span><span class="op">)</span></span>
<span><span class="co">#&gt;           BMD     BMDL</span></span>
<span><span class="co">#&gt; [1,] 16.32314 14.93955</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="rscabs-mqjt-and-other-testing-approaches">RSCABS, MQJT and other testing approaches<a class="anchor" aria-label="anchor" href="#rscabs-mqjt-and-other-testing-approaches"></a>
</h2>
<p>Details about RSCABS approach you can find <a href="https://bayer-group.github.io/drcHelper/articles/Example_RSCABS.html" class="external-link">here</a>.</p>
<p>Current implementation used Rao-Scott correction always, exact CA
test is not possible, potential inflated type-I error in slices with
very low occurences. High resolution of scoring system (many categories)
could be less powerful due to the violation of monotonicity.</p>
<p>MQJT is another alternative procedure and the simplest solution would
be using the standard JT test on Q50 alone. Jonckheere-test by slices on
the proportions (JTBS) can also be applied similarly as RSCABS.</p>
<p>Non-parametric Dunnett or Williams type procedure (F. Konietschke and
L. A. Hothorn Stat. Biopharm. Res., 2012, 4, 14–27) could be used
follwed by regression modelling with independent variable treated as
factors.</p>
<p>All these testing approaches are targeting at a NOEC at a certain
injury level. By default, these testing approaches actually treat the
test rates or concentrations in the study as categorical variable,
losing the continuous property and therefore an ER50 cannot be directly
calculated. However, the NOEC at the medium injury level is comparable
to ER50, which will always be smaller than ER50.</p>
</div>
<div class="section level2">
<h2 id="simulation-study">Simulation Study<a class="anchor" aria-label="anchor" href="#simulation-study"></a>
</h2>
<p>Simulation studies show that glm with quasibinomial and nonlinear
log-logistic with normal perfom similarly when there are limited dose
groups. When we observe the full dose-response curve, quasibinomial is
less flexible in adapting to the data.</p>
<div class="section level3">
<h3 id="data-generated-using-the-logistic-cdf-">Data generated using the logistic CDF.<a class="anchor" aria-label="anchor" href="#data-generated-using-the-logistic-cdf-"></a>
</h3>
<p>The data is generated using the cumulative function for logistic
distribution. Note that the logistic function is just an inverse logit
(<span class="math inline">\(\log(p/(1-p))\)</span>) function in R. The
code is modified based on <a href="https://www.r-bloggers.com/2016/01/s-shaped-data-smoothing-with-quasibinomial-distribution-2/" class="external-link">this
blog post</a>. <span class="math display">\[F(x;\mu,s) = \frac{1}{2} +
\frac{1}{2} \tanh((x-\mu)/2s) = \frac{1}{1+e^{-(x-\mu)/s}}\]</span></p>
<p>where, <span class="math inline">\(\tanh(x) =
\frac{\sinh(x)}{\cosh(x)} = \frac{e^x - e^{-x}}{e^x + e^{-x}}\)</span>,
is the <a href="https://en.wikipedia.org/wiki/Hyperbolic_functions" class="external-link">hyperbolic
tangent function</a> that maps real numbers to the range between -1 and
1.</p>
<p>Quantile of the CDF is then <span class="math inline">\(\mu+s\log(\frac{p}{1-p})\)</span>, therefore, the
EC50 should be <span class="math inline">\(\mu\)</span> or <span class="math inline">\(\exp(\mu)\)</span>.</p>
<p>Random noises are added afterwards to the logistic distribution
CDF.</p>
<p>We simulate <span class="math inline">\(n\)</span> studies over
concentration <span class="math inline">\(x\)</span>, denoted, <span class="math inline">\(X_{1}, X_{2}, …, X_{n}\)</span> for <span class="math inline">\(k\)</span> study <span class="math inline">\(X=(x_{1}, x_{2}, …, x_{k})\)</span>, where <span class="math inline">\(k\)</span> is the number of different studies with
different <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\sigma\)</span>.</p>
<p>Let’s say there are <span class="math inline">\(k=6\)</span> study
groups with the following parameter sets, <span class="math inline">\(\mu = \{9,2,3,5,7,5\}\)</span> and <span class="math inline">\(s=\{2,2,4,3,4,2\}\)</span></p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">generate_logit_cdf</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">mu</span>, <span class="va">s</span>, </span>
<span>                               <span class="va">sigma_y</span><span class="op">=</span><span class="fl">0.1</span>, </span>
<span>                               <span class="va">x</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>,<span class="fl">20</span>,<span class="fl">0.1</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">x_ms</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">x</span><span class="op">-</span><span class="va">mu</span><span class="op">)</span><span class="op">/</span><span class="va">s</span></span>
<span>  <span class="va">y</span>    <span class="op">&lt;-</span> <span class="fl">0.5</span> <span class="op">+</span> <span class="fl">0.5</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Hyperbolic.html" class="external-link">tanh</a></span><span class="op">(</span><span class="va">x_ms</span><span class="op">)</span>  </span>
<span>  <span class="va">y</span>    <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">y</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="fl">0</span>, <span class="va">sigma_y</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">ix</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">y</span><span class="op">&gt;=</span><span class="fl">1.0</span><span class="op">)</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ix</span><span class="op">)</span><span class="op">&gt;=</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span> </span>
<span>    <span class="va">y</span><span class="op">[</span><span class="va">ix</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1.0</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Hyperbolic.html" class="external-link">tanh</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">424242</span><span class="op">)</span></span>
<span><span class="va">x</span>      <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>,<span class="fl">15</span>,<span class="fl">0.025</span><span class="op">)</span> </span>
<span><span class="va">mu_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">5</span>,<span class="fl">7</span>,<span class="fl">8</span><span class="op">)</span>   <span class="co"># 6 Studies</span></span>
<span><span class="va">idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">mu_vec</span>,<span class="kw">function</span><span class="op">(</span><span class="va">mu</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">x</span><span class="op">==</span><span class="va">mu</span><span class="op">)</span><span class="op">)</span>  <span class="co">## we just need to know which index to find the ER50</span></span>
<span><span class="va">s_vec</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">4</span>,<span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">2</span><span class="op">)</span></span>
<span><span class="co"># Synthetic Study ID</span></span>
<span><span class="va">studies_df</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mapply.html" class="external-link">mapply</a></span><span class="op">(</span><span class="va">generate_logit_cdf</span>, </span>
<span>                              <span class="va">mu_vec</span>, </span>
<span>                              <span class="va">s_vec</span>, </span>
<span>                              MoreArgs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Give them names</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">studies_df</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Study1"</span>, <span class="st">"Study2"</span>, <span class="st">"Study3"</span>, <span class="st">"Study4"</span>, <span class="st">"Study5"</span>, <span class="st">"Study6"</span><span class="op">)</span></span>
<span>  </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">studies_df</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 801   6</span></span></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/get_theme.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="va">df_all</span> <span class="op">&lt;-</span> <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x<span class="op">=</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fl">10</span>,<span class="va">studies_df</span><span class="op">)</span>,cols<span class="op">=</span><span class="fl">2</span><span class="op">:</span><span class="fl">7</span><span class="op">)</span></span>
<span><span class="va">true_ec50</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fl">10</span><span class="op">)</span><span class="op">[</span><span class="va">idx</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">df_all</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"study"</span>, <span class="st">"y"</span><span class="op">)</span></span>
<span><span class="va">df_all</span><span class="op">$</span><span class="va">study</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">df_all</span><span class="op">$</span><span class="va">study</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p_quasibinomial</span><span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df_all</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span>, color<span class="op">=</span><span class="va">study</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>alpha<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span>  <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_d</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>        <span class="co"># scale_color_brewer(palette = "Reds") + </span></span>
<span>        <span class="co"># #geom_smooth(method="loess", se = FALSE, size=1.5) +</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>group<span class="op">=</span><span class="va">study</span><span class="op">)</span>,method<span class="op">=</span><span class="st">"glm"</span>, method.args<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>family<span class="op">=</span><span class="st">"quasibinomial"</span><span class="op">)</span>, formula<span class="op">=</span><span class="st">"y ~ log(x)"</span>,</span>
<span>                       se <span class="op">=</span><span class="cn">TRUE</span>, size<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Concentration"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"% Injury / 100"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Quasibinomial Fit"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p_quasibinomial</span><span class="co">#+scale_x_log10()</span></span></code></pre></div>
<p><img src="Ordinal-Data_files/figure-html/unnamed-chunk-18-1.png" width="768"></p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">p_quasibinomial</span> <span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">study</span><span class="op">)</span></span></code></pre></div>
<p><img src="Ordinal-Data_files/figure-html/unnamed-chunk-18-2.png" width="768"></p>
<p>Nonlinear log-logistic modelling with normal errors seem to be more
flexible in dealing with very different curve shapes. It also fits the
data generation process in this case.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.r-project.org" class="external-link">drc</a></span><span class="op">)</span></span>
<span><span class="va">p_drc</span><span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df_all</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span>, color<span class="op">=</span><span class="va">study</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>alpha<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span>  <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_d</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>        <span class="co"># scale_color_brewer(palette = "Reds") + </span></span>
<span>        <span class="co"># #geom_smooth(method="loess", se = FALSE, size=1.5) +</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>group<span class="op">=</span><span class="va">study</span><span class="op">)</span>,method<span class="op">=</span><span class="st">"drm"</span>, method.args<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fct<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/drc/man/LL.2.html" class="external-link">LL.2</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>, formula<span class="op">=</span><span class="st">"y ~ x"</span>,</span>
<span>                       se <span class="op">=</span> <span class="cn">FALSE</span>, size<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Concentration"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"% Injury / 100"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"DRC nonlinear normal fit"</span><span class="op">)</span></span>
<span><span class="va">p_drc</span><span class="co">#+scale_x_log10()</span></span></code></pre></div>
<p><img src="Ordinal-Data_files/figure-html/unnamed-chunk-19-1.png" width="672"></p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">p_drc</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">study</span><span class="op">)</span></span></code></pre></div>
<p><img src="Ordinal-Data_files/figure-html/unnamed-chunk-19-2.png" width="672"></p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_nested</span> <span class="op">&lt;-</span> <span class="va">df_all</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">study</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">nest</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">dfres</span> <span class="op">&lt;-</span> <span class="va">df_nested</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>modres<span class="op">=</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">data</span>,<span class="va">modelall</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Estimated effective doses</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;        Estimate Std. Error    Lower    Upper</span></span>
<span><span class="co">#&gt; e:1:50 23.72221    0.13908 23.44921 23.99521</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Estimated effective doses</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;        Estimate Std. Error    Lower    Upper</span></span>
<span><span class="co">#&gt; e:1:50 27.53930    0.14351 27.25759 27.82100</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Estimated effective doses</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;        Estimate Std. Error    Lower    Upper</span></span>
<span><span class="co">#&gt; e:1:50 30.85168    0.20483 30.44961 31.25375</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Estimated effective doses</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;        Estimate Std. Error    Lower    Upper</span></span>
<span><span class="co">#&gt; e:1:50 39.35892    0.18648 38.99287 39.72498</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Estimated effective doses</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;        Estimate Std. Error    Lower    Upper</span></span>
<span><span class="co">#&gt; e:1:50 47.09152    0.20831 46.68262 47.50042</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Estimated effective doses</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;        Estimate Std. Error    Lower    Upper</span></span>
<span><span class="co">#&gt; e:1:50 51.84412    0.14198 51.56541 52.12283</span></span>
<span><span class="va">ec50</span> <span class="op">&lt;-</span> <span class="va">dfres</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ec50<span class="op">=</span><span class="va">modres</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">data</span>,<span class="va">modres</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span>cols<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">ec50</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>TrueEC50 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">true_ec50</span>,each<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">ec50</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="9%">
<col width="12%">
<col width="13%">
<col width="15%">
<col width="16%">
<col width="19%">
<col width="12%">
</colgroup>
<thead><tr class="header">
<th align="left">study</th>
<th align="right">EC50</th>
<th align="right">lower</th>
<th align="right">upper</th>
<th align="right">se</th>
<th align="left">model</th>
<th align="right">TrueEC50</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Study1</td>
<td align="right">20.93803</td>
<td align="right">12.727863</td>
<td align="right">34.44419</td>
<td align="right">5.5815848</td>
<td align="left">quasibinomial</td>
<td align="right">24.1</td>
</tr>
<tr class="even">
<td align="left">Study1</td>
<td align="right">23.72221</td>
<td align="right">23.449208</td>
<td align="right">23.99521</td>
<td align="right">0.1390778</td>
<td align="left">drc LL.2</td>
<td align="right">24.1</td>
</tr>
<tr class="odd">
<td align="left">Study2</td>
<td align="right">24.47938</td>
<td align="right">4.590626</td>
<td align="right">130.53558</td>
<td align="right">36.5249031</td>
<td align="left">quasibinomial</td>
<td align="right">28.1</td>
</tr>
<tr class="even">
<td align="left">Study2</td>
<td align="right">27.53930</td>
<td align="right">27.257594</td>
<td align="right">27.82100</td>
<td align="right">0.1435116</td>
<td align="left">drc LL.2</td>
<td align="right">28.1</td>
</tr>
<tr class="odd">
<td align="left">Study3</td>
<td align="right">27.64177</td>
<td align="right">20.206538</td>
<td align="right">37.81290</td>
<td align="right">4.5043310</td>
<td align="left">quasibinomial</td>
<td align="right">32.1</td>
</tr>
<tr class="even">
<td align="left">Study3</td>
<td align="right">30.85168</td>
<td align="right">30.449615</td>
<td align="right">31.25375</td>
<td align="right">0.2048285</td>
<td align="left">drc LL.2</td>
<td align="right">32.1</td>
</tr>
<tr class="odd">
<td align="left">Study4</td>
<td align="right">35.49035</td>
<td align="right">16.028210</td>
<td align="right">78.58425</td>
<td align="right">16.2927035</td>
<td align="left">quasibinomial</td>
<td align="right">40.1</td>
</tr>
<tr class="even">
<td align="left">Study4</td>
<td align="right">39.35892</td>
<td align="right">38.992866</td>
<td align="right">39.72498</td>
<td align="right">0.1864849</td>
<td align="left">drc LL.2</td>
<td align="right">40.1</td>
</tr>
<tr class="odd">
<td align="left">Study5</td>
<td align="right">43.08117</td>
<td align="right">4.914720</td>
<td align="right">377.63846</td>
<td align="right">123.5039983</td>
<td align="left">quasibinomial</td>
<td align="right">48.1</td>
</tr>
<tr class="even">
<td align="left">Study5</td>
<td align="right">47.09152</td>
<td align="right">46.682623</td>
<td align="right">47.50042</td>
<td align="right">0.2083091</td>
<td align="left">drc LL.2</td>
<td align="right">48.1</td>
</tr>
<tr class="odd">
<td align="left">Study6</td>
<td align="right">47.45811</td>
<td align="right">1.938822</td>
<td align="right">1161.67056</td>
<td align="right">655.5640528</td>
<td align="left">quasibinomial</td>
<td align="right">52.1</td>
</tr>
<tr class="even">
<td align="left">Study6</td>
<td align="right">51.84412</td>
<td align="right">51.565412</td>
<td align="right">52.12283</td>
<td align="right">0.1419849</td>
<td align="left">drc LL.2</td>
<td align="right">52.1</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">predres</span> <span class="op">&lt;-</span> <span class="va">dfres</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>preds<span class="op">=</span><span class="va">modres</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">data</span>,<span class="va">modres</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span>cols<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">preds</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">p_drc_qb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df_all</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>alpha<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span>  <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_d</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>        <span class="co"># scale_color_brewer(palette = "Reds") + </span></span>
<span>        <span class="co"># #geom_smooth(method="loess", se = FALSE, size=1.5) +</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>group<span class="op">=</span><span class="va">study</span><span class="op">)</span>,method<span class="op">=</span><span class="st">"drm"</span>, method.args<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fct<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/drc/man/LL.2.html" class="external-link">LL.2</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>, formula<span class="op">=</span><span class="st">"y~x"</span>,</span>
<span>                       se <span class="op">=</span> <span class="cn">FALSE</span>, size<span class="op">=</span><span class="fl">1.5</span>,col<span class="op">=</span><span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/pal_hue.html" class="external-link">hue_pal</a></span><span class="op">(</span><span class="op">)</span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>                       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>group<span class="op">=</span><span class="va">study</span><span class="op">)</span>,method<span class="op">=</span><span class="st">"glm"</span>, method.args<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>family<span class="op">=</span><span class="st">"quasibinomial"</span><span class="op">)</span>, formula<span class="op">=</span><span class="st">"y~log(x)"</span>,</span>
<span>                       se <span class="op">=</span> <span class="cn">FALSE</span>, size<span class="op">=</span><span class="fl">1.5</span>,lty<span class="op">=</span><span class="fl">3</span>,col<span class="op">=</span><span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/pal_hue.html" class="external-link">hue_pal</a></span><span class="op">(</span><span class="op">)</span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Concentration"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"% Injury / 100"</span><span class="op">)</span>  <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">study</span><span class="op">)</span></span>
<span> <span class="va">p_drc_qb</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept<span class="op">=</span><span class="fl">0.5</span>,col<span class="op">=</span><span class="st">"purple"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">ec50</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xintercept<span class="op">=</span><span class="va">TrueEC50</span><span class="op">)</span>,col<span class="op">=</span><span class="st">"purple"</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">predres</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>,ymin<span class="op">=</span><span class="va">Lower</span>,ymax<span class="op">=</span><span class="va">Upper</span>,y<span class="op">=</span><span class="va">Prediction</span>,fill<span class="op">=</span><span class="va">model</span><span class="op">)</span>,alpha<span class="op">=</span><span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"drc and quasibinomial fit with CI"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">ec50</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xintercept<span class="op">=</span><span class="va">EC50</span>,col<span class="op">=</span><span class="va">model</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Ordinal-Data_files/figure-html/unnamed-chunk-21-1.png" width="672"></p>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ul>
<li>Agresti, A. (2002) Categorical Data Analysis, Second Edition.
Hoboken, New Jersey: John Wiley &amp; Sons, Inc.</li>
<li>Harrell, F. E, (2001) Regression Modeling Strategies. New York:
Springer-Verlag.</li>
<li><a href="http://www.sthda.com/english/articles/32-r-graphics-essentials/132-plot-grouped-data-box-plot-bar-plot-and-more/" class="external-link uri">http://www.sthda.com/english/articles/32-r-graphics-essentials/132-plot-grouped-data-box-plot-bar-plot-and-more/</a></li>
<li>Chuang-Stein G, Agresti A. A review of tests for detecting a
monotone dose-response relationship with ordinal response data. Stat
Med. 1997 Nov 30;16(22):2599-618. doi:
10.1002/(sici)1097-0258(19971130)16:22&lt;2599::aid-sim734&gt;3.0.co;2-9.
PMID: 9403959.</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Zhenglei Gao, Sean Ryan.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
