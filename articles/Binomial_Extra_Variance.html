<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Binomial Extra Variance and Trend Test • drcHelper</title>
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Binomial Extra Variance and Trend Test">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">drcHelper</a>

    <small class="nav-text text-default me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.0.4</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-get-started" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Get Started</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-get-started">
<li><a class="dropdown-item" href="../articles/Introduction.html">Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/Example_Analysis_Workflow.html">Example Analysis Workflow</a></li>
    <li><a class="dropdown-item" href="../articles/drcHelper.html">Example ECx Helper Functions Usage</a></li>
    <li><a class="dropdown-item" href="../articles/Dunnetts_Test_for_Data_with_Hierarchical_Structure.html">Example NOEC Helper Functions Usage</a></li>
    <li><a class="dropdown-item" href="../articles/Examples_drc.html">Using DRC and BMD</a></li>
    <li><a class="dropdown-item" href="../articles/Examples_oecd201.html">Example DRC - OECD 201</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-regulatory-stats" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Regulatory Stats</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-regulatory-stats">
<li><a class="dropdown-item" href="../articles/NOEC_Methods.html">NOEC Calculations</a></li>
    <li><a class="dropdown-item" href="../articles/Limit-Test.html">Limit Test Calculations</a></li>
    <li><a class="dropdown-item" href="../articles/EFSA-Criteria.html">EFSA Criteria and Other Reliability Criteria</a></li>
    <li><a class="dropdown-item" href="../articles/Example_RSCABS.html">RSCABS</a></li>
    <li><a class="dropdown-item" href="../articles/Trend-Testing.html">Trend Testing</a></li>
    <li><a class="dropdown-item" href="../articles/NOEC_ECx_BMD.html">NOEC ECx and BMD</a></li>
  </ul>
</li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Quantal-Data.html">Quantal Data</a></li>
    <li><a class="dropdown-item" href="../articles/Ordinal-Data.html">Ordinal Data</a></li>
    <li><a class="dropdown-item" href="../articles/Count_Data.html">Count Data</a></li>
    <li><a class="dropdown-item" href="../articles/LMM-GLMM-and-GAMM.html">Understanding Mixed Models</a></li>
    <li><a class="dropdown-item" href="../articles/Normality-Check.html">Normality Check</a></li>
    <li><a class="dropdown-item" href="../articles/Binomial_Extra_Variance.html">Extra Binomial Variance and Trend Test</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>More Topics</h6></li>
    <li><a class="dropdown-item" href="../articles/Examples%20using%20NLS.html">NLS</a></li>
    <li><a class="dropdown-item" href="../articles/Examples_using_drda.html">drda</a></li>
    <li><a class="dropdown-item" href="../articles/TSK_method.html">TSK method</a></li>
    <li><a class="dropdown-item" href="../articles/MQJT.html">MQJT</a></li>
    <li><a class="dropdown-item" href="../articles/Advanced_Fitting-a-biphasic-dose-reponse-model.html">Fitting A biphasic dose response model</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-validation" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Validation</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-validation">
<li><a class="dropdown-item" href="../articles/System_Testing.html">System Testing</a></li>
    <li><a class="dropdown-item" href="../articles/Verification_which_JT.html">Which JT test to use</a></li>
    <li><a class="dropdown-item" href="../articles/Test-Guidelines.html">Study Types and Templates</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Bayer-Group/drcHelper/issues/new?template=Blank+issue" aria-label="New Issue"><span class="fa fa-bug"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Bayer-Group/drcHelper" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Binomial Extra Variance and Trend Test</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Bayer-Group/drcHelper/blob/main/vignettes/articles/Binomial_Extra_Variance.Rmd" class="external-link"><code>vignettes/articles/Binomial_Extra_Variance.Rmd</code></a></small>
      <div class="d-none name"><code>Binomial_Extra_Variance.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bayer-group.github.io/drcHelper/index.html">drcHelper</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://conflicted.r-lib.org/" class="external-link">conflicted</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://conflicted.r-lib.org/reference/conflict_prefer.html" class="external-link">conflict_prefer</a></span><span class="op">(</span><span class="st">"filter"</span>,<span class="st">"dplyr"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://conflicted.r-lib.org/reference/conflict_prefer.html" class="external-link">conflict_prefer</a></span><span class="op">(</span><span class="st">"group_by"</span>,<span class="st">"dplyr"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://conflicted.r-lib.org/reference/conflict_prefer.html" class="external-link">conflict_prefer</a></span><span class="op">(</span><span class="st">"select"</span>,<span class="st">"dplyr"</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<p>One very standard procedure for dealing with binomial or quantal data
in Ecotox area is to test first if extra-binomial variation exists when
there are replications, if no, continue with Cochran-Armitage trend test
to derive NOEC; if yes, then use the Cochran-Armitage test with
Rao-Scott correction. The question is, are we going to use replicate
data or are we going to use pooled data in the following
Cochran-Armitage test. If the latter, testing within-group
overdispersion is necessary for pooling the data together; if the
former, the overdispersion should be designed to test for extra-binomial
variation (overdispersion) in the context of dose-response data,
specifically:</p>
<ul>
<li>Assumes a trend exists (linear dose-response relationship)</li>
<li>Tests if the observed variation around this expected trend is
greater than what binomial distribution would predict.</li>
</ul>
<p>It is used to validate the Cochran-Armitage trend test assumptions.
This actually comes together with the issue of scoring in the
Cochran-Armitage test.</p>
<table class="table">
<colgroup>
<col width="28%">
<col width="23%">
<col width="21%">
<col width="26%">
</colgroup>
<thead><tr class="header">
<th>Scoring Method</th>
<th>When to Use</th>
<th>Advantages</th>
<th>Disadvantages</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>Actual doses</strong></td>
<td>Known dose-response relationship</td>
<td>Biologically meaningful</td>
<td>Sensitive to dose spacing</td>
</tr>
<tr class="even">
<td>
<strong>Ranks</strong> (<code>seq_along</code>)</td>
<td>Unknown relationship</td>
<td>Robust to outlying doses</td>
<td>May miss non-linear patterns</td>
</tr>
<tr class="odd">
<td><strong>Log-transformed doses</strong></td>
<td>Exponential relationships</td>
<td>Handles wide dose ranges</td>
<td>Requires exponential relationships</td>
</tr>
<tr class="even">
<td><strong>Equally spaced</strong></td>
<td>Exploratory analysis</td>
<td>Simple interpretation</td>
<td>May not reflect true spacing</td>
</tr>
</tbody>
</table>
<div class="section level3">
<h3 id="test-statistic-calculation">Test Statistic Calculation<a class="anchor" aria-label="anchor" href="#test-statistic-calculation"></a>
</h3>
<p>Going back to standard Cochran-Armitage test. The core calculation
follows the standard Cochran-Armitage formula:</p>
<p><span class="math display">\[ Z = -\sqrt{\frac{N}{R(N-R)}} \cdot
\frac{\sum_{i=1}^k (r_i - \frac{n_i R}{N}) d_i}{\sqrt{\sum_{i=1}^k
\frac{n_i d_i^2}{N} - \left(\sum_{i=1}^k \frac{n_i d_i}{N}\right)^2}}
\]</span></p>
<p>Where: - $ N = n_i $ (total sample size) - $ R = r_i $ (total cases)
- $ n_i $ = totals in group i - $ r_i $ = cases in group i<br>
- $ d_i $ = dose rating for group i</p>
<p>or considering a two-way contingency table with R rows and C columns,
we can write the test statistics in a different way.</p>
<p>The null hypothesis is the binomial proportion in each group (<span class="math inline">\(p_i=n_i/n_{total}\)</span>) is the same across all
dose levels.</p>
<p>On a separate note, the default implementation of Cochran-Armitage
test usually uses the normal distribution as the test statistic
distribution. It is possible to calculate exact p-values by specifying
“exact” options. However, it requires enumerating all possible
configurations of cases across groups while maintaining the marginal
totals, which becomes computationally prohibitive for large samples.
Most practical implementations use the asymptotic approximation or Monte
Carlo methods for the exact test.</p>
</div>
</div>
<div class="section level2">
<h2 id="the-ben-oneills-version-of-tarones-test">The Ben O’Neill’s version of Tarone’s Test<a class="anchor" aria-label="anchor" href="#the-ben-oneills-version-of-tarones-test"></a>
</h2>
<p>The implementation of Ben O’Neill’s Tarone’s test takes .. 1. It
pools all the data and calculates an <strong>overall
proportion</strong>: <code>estimate &lt;- sum(M)/sum(N)</code> 2. It
calculates a Pearson chi-square-like statistic S based on deviations
from the overall proportion:
<code>S &lt;- ifelse(estimate == 1, sum(N), sum((M - N * estimate)^2/(estimate * (1 - estimate))))</code>.
Note that the denominator is the variance under binomial assumption 3.
Then it calculates the statistic by standardization, converting it to a
z-statistic :
<code>statistic &lt;- (S - sum(N))/sqrt(2 * sum(N * (N - 1)))</code> 4.
Uses a normal approximation for p-value:
<code>p.value &lt;- 2 * pnorm(-abs(statistic), 0, 1)</code></p>
<p>This tests: <span class="math inline">\(H_0\)</span>: All groups have
the same underlying proportion (pooled estimate) <span class="math inline">\(H_a\)</span>: Extra-binomial variation exists
(overdispersion relative to pooled proportion)</p>
<p>It doesn’t assume any particular dose-response relationship. It’s
more like testing for heterogeneity between groups.</p>
<p>An example is given below:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="co">#Generate example data</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">32</span>, <span class="fl">40</span>, <span class="fl">28</span>, <span class="fl">29</span>, <span class="fl">35</span>, <span class="fl">30</span>, <span class="fl">34</span>, <span class="fl">31</span>, <span class="fl">39</span><span class="op">)</span></span>
<span><span class="va">M</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="fl">9</span>, <span class="fl">10</span>, <span class="fl">22</span>, <span class="fl">15</span>,  <span class="fl">8</span>, <span class="fl">19</span>, <span class="fl">16</span>, <span class="fl">19</span>, <span class="fl">15</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/Tarone.test.html">Tarone.test</a></span><span class="op">(</span><span class="va">N</span>, <span class="va">M</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Tarone's Z test</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data:  M successes from N trials</span></span>
<span><span class="co">#&gt; z = 2.5988, p-value = 0.009355</span></span>
<span><span class="co">#&gt; alternative hypothesis: true dispersion parameter is greater than 0</span></span>
<span><span class="co">#&gt; sample estimates:</span></span>
<span><span class="co">#&gt; proportion parameter </span></span>
<span><span class="co">#&gt;            0.4359756</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="comparison-with-trend-based-tarones-test">Comparison with Trend-Based Tarone’s Test:<a class="anchor" aria-label="anchor" href="#comparison-with-trend-based-tarones-test"></a>
</h2>
<p>Trend-based Tarone’s test can be implemented by excluding a trend
first followed by the z-test or chi-square test. Details please see the
example below.</p>
</div>
<div class="section level2">
<h2 id="which-should-you-use">Which Should You Use?<a class="anchor" aria-label="anchor" href="#which-should-you-use"></a>
</h2>
<p>The O’Neill’s version is simpler and tests for basic
<strong>heterogeneity between groups</strong>. However, things become
more complicated when there are replicates, how do we derive a <span class="math inline">\(p_i\)</span> for <span class="math inline">\(i_{th}\)</span> dose level? Are there within group
overdispersion already? Do we use incidence occurred for each replicate,
or use an average of incidence rates from each replicate, or do we pool
all incidences from all replicates to calculate a pooled average?</p>
<p>If we have one “average” proportion for each dose group, then what is
the total should be used? Because in analogous to ANOVA, in the case we
used average of a replicate, then the sample size from that dose group
is becoming the number of replicates instead of number of all
individuals. When each replicate have the same amount of individuals,
then there is no difference between using average of average or pooled
incidence rates. but the sample size in each dose group is still a
concern.</p>
<p><strong>Trend-based version</strong> is more appropriate when you
expect a <strong>dose-response relationship</strong> and want to test if
there’s <strong>extra variation beyond the trend</strong> using the
replicate data.</p>
<p>For <strong>NOEC determination with Cochran-Armitage</strong>, the
<strong>trend-based version</strong> is more theoretically appropriate
since CA test assumes a dose-response trend.</p>
</div>
<div class="section level2">
<h2 id="example-data">Example Data<a class="anchor" aria-label="anchor" href="#example-data"></a>
</h2>
<p>We do a comparison of various approaches using an example
dataset.</p>
<p>Note that the arcsine transformation is used to “stretch out” data
points that range between 0 and 1. This transformation is typically used
when dealing with proportions and percentages. This has been the lab
routine procedure for analyzing Daphnia acute studies. However, in
generic OECD statistical guidances, the recommended approach is the step
down Cochran-Armitage test, in combine nation with Tarone test as a
pre-test for overdispersion.</p>
<p>Ideally, inn the normal statistical procedure outside the regulatory
statistics, we would conduct GLM binomial regression first to see if
there is a trend by treating concentration levels as continuous
predictor or to calculate an NOEC by treating concentration levels as
categorical predictor. However, often in this type of study data, we
have the quasi-complete separation where there are perfect zeros in the
lower doses and some responses the few high dose levels, creating a
“cliff” in the data. The GLM algorithm will struggle to estimate
parameters and produce very large standard error estimations which will
result insignificance even if there are high mortality or incidence rate
in high dose groups. There are several approaches to deal with this
separation issue. For example, Firth’s method adds a penalty term that
stabilizes estimation, giving much more reasonable standard errors and
interpretable results. We can also pool low-dose levels to do the
regression. For small samples with separation, exact logistic regression
(elrm) can be conducted but it is computationally intensive.</p>
<p>In this example data, we encounter this separation issue, which
prevents us from using the GLM approach as a reliable anchor point for
meaningful NOEC comparisons without conducting a more robust analysis.
Instead, we directly compare NOEC calculation with the two
approaches:</p>
<ol style="list-style-type: decimal">
<li>arcsine sqrt transformation and then test normality and variance
homogeneity, monotonicity test, followed by either Williams’ or
Dunnett’s or non-parametric alternatives.</li>
<li>Tarone’s test for overdispersion in binomial data, followed by
step-down Cochran-Armitage test.</li>
</ol>
<p>However, in option 2, in terms testing overdispersion, just as in
ANOVA, normality should be tested on residuals, overdispersion should be
tested on residuals removing the trend. In terms of the Cochran-Armitage
test, the scores can be directly the dose, or using the rank, for
example, default coding would be just
<code>seq_along(c(0.10,30,50,80))</code>. This creates the question how
to define the trend and how to remove the trend. To make it consistent,
we make sure that</p>
<ol style="list-style-type: decimal">
<li>The overdispersion phi parameter should be calculated from the
trend-adjusted residuals, not the raw residuals. <span class="math inline">\(\phi = \frac{S_{adj}}{df_{adj}}\)</span> where
<span class="math inline">\(S_{adj}\)</span> is the sum of squared
standardized residuals after trend removal.</li>
<li>The linear trend is properly estimated and removed before
calculating overdispersion.</li>
<li>The linear trend is calculated using the same scoring as that will
be used in the Cochran-Armitage test.</li>
</ol>
<p>With different scoring approaches, we can obtain very different
results. In this example data, the dramatic difference (<span class="math inline">\(\phi\)</span> = 1.97 for doses vs <span class="math inline">\(\phi\)</span> = 6.01 for ranks) suggests that the
choice of scoring method is crucial, and the rank-based scoring is
detecting much stronger overdispersion after trend removal.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##proj_dir &lt;- here::here()</span></span>
<span><span class="co">##quantal_dat_nested &lt;- readRDS(paste0(proj_dir,"/data-raw/quantal_dat_nested.rds"))</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"quantal_dat_nested"</span><span class="op">)</span></span>
<span><span class="va">second_arcsin_data</span> <span class="op">&lt;-</span> <span class="va">quantal_dat_nested</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>arcsin_prop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">asin</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">immob</span><span class="op">)</span><span class="op">)</span>,Treatment <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">Treatment</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Control"</span>, <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">Treatment</span><span class="op">[</span><span class="va">Treatment</span> <span class="op">!=</span> <span class="st">"Control"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Full comparison</span></span>
<span><span class="va">comparison_results</span> <span class="op">&lt;-</span> <span class="fu">drcHelper</span><span class="fu">:::</span><span class="fu"><a href="../reference/compare_tarone_scoring.html">compare_tarone_scoring</a></span><span class="op">(</span></span>
<span>    successes <span class="op">=</span> <span class="va">second_arcsin_data</span><span class="op">$</span><span class="va">Immobile</span>,</span>
<span>    totals <span class="op">=</span> <span class="va">second_arcsin_data</span><span class="op">$</span><span class="va">Total</span>,</span>
<span>    doses <span class="op">=</span> <span class="va">second_arcsin_data</span><span class="op">$</span><span class="va">Dose</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; === Running analysis with doses scoring ===</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; === Running analysis with ranks scoring ===</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; === Running analysis with log_doses scoring ===</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; === Running analysis with equal_spaced scoring ===</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ================================================================================</span></span>
<span><span class="co">#&gt; COMPARISON ACROSS SCORING METHODS</span></span>
<span><span class="co">#&gt; ================================================================================</span></span>
<span><span class="co">#&gt;  Scoring_Method Phi_Estimate Trend_Z_Stat Trend_P_Value Overdispersion</span></span>
<span><span class="co">#&gt;           doses        1.966        1.366        0.1719             No</span></span>
<span><span class="co">#&gt;           ranks        6.006        7.080        0.0000          Yes *</span></span>
<span><span class="co">#&gt;       log_doses        7.639        9.388        0.0000          Yes *</span></span>
<span><span class="co">#&gt;    equal_spaced        6.006        7.080        0.0000          Yes *</span></span>
<span><span class="co">#&gt;                      Recommendation</span></span>
<span><span class="co">#&gt;  Strong Rao-Scott correction needed</span></span>
<span><span class="co">#&gt;  Strong Rao-Scott correction needed</span></span>
<span><span class="co">#&gt;  Strong Rao-Scott correction needed</span></span>
<span><span class="co">#&gt;  Strong Rao-Scott correction needed</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Groupwise Overdispersion Summary:</span></span>
<span><span class="co">#&gt;  Dose N_Replicates Proportion Tarone_P_Value Overdispersed</span></span>
<span><span class="co">#&gt;     0            6      0.000             NA   Cannot test</span></span>
<span><span class="co">#&gt;     5            6      0.000             NA   Cannot test</span></span>
<span><span class="co">#&gt;    10            6      0.000             NA   Cannot test</span></span>
<span><span class="co">#&gt;    20            6      0.000             NA   Cannot test</span></span>
<span><span class="co">#&gt;    40            6      0.067         0.5801            No</span></span>
<span><span class="co">#&gt;    80            6      0.633         0.9704            No</span></span>
<span></span>
<span><span class="co"># Create publication-ready summary</span></span>
<span><span class="va">summary_table</span> <span class="op">&lt;-</span> <span class="fu">drcHelper</span><span class="fu">:::</span><span class="fu"><a href="../reference/create_summary_table.html">create_summary_table</a></span><span class="op">(</span><span class="va">comparison_results</span><span class="op">)</span></span>
<span><span class="co">#&gt; Summary Table for Publication:</span></span>
<span><span class="co">#&gt; ==============================</span></span>
<span><span class="co">#&gt;  Scoring Method Phi (Overdispersion) Trend Test Z P-value Significant?</span></span>
<span><span class="co">#&gt;           doses                1.966        1.366  0.1719           No</span></span>
<span><span class="co">#&gt;           ranks                6.006        7.080  0.0000        Yes *</span></span>
<span><span class="co">#&gt;       log_doses                7.639        9.388  0.0000        Yes *</span></span>
<span><span class="co">#&gt;    equal_spaced                6.006        7.080  0.0000        Yes *</span></span>
<span><span class="co">#&gt;             Analysis Recommendation</span></span>
<span><span class="co">#&gt;  Strong Rao-Scott correction needed</span></span>
<span><span class="co">#&gt;  Strong Rao-Scott correction needed</span></span>
<span><span class="co">#&gt;  Strong Rao-Scott correction needed</span></span>
<span><span class="co">#&gt;  Strong Rao-Scott correction needed</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Interpretation Guide:</span></span>
<span><span class="co">#&gt; - φ &gt; 1.2: Consider overdispersion correction</span></span>
<span><span class="co">#&gt; - φ &gt; 1.5: Strong evidence of overdispersion</span></span>
<span><span class="co">#&gt; - * indicates statistical significance (p &lt; 0.05)</span></span>
<span><span class="co">#&gt; - Groupwise tests examine within-dose variation</span></span>
<span><span class="co">#&gt; - Trend-adjusted tests examine overdispersion after removing dose-response trend</span></span></code></pre></div>
<p>Perform Tarone’s test followed by stepdown CA test and compare the
results</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Test the fixed function</span></span>
<span><span class="va">phi_comparison_ranks</span> <span class="op">&lt;-</span> <span class="fu">drcHelper</span><span class="fu">:::</span><span class="fu"><a href="../reference/compare_phi_methods.html">compare_phi_methods</a></span><span class="op">(</span></span>
<span>  successes <span class="op">=</span> <span class="va">second_arcsin_data</span><span class="op">$</span><span class="va">Immobile</span>,</span>
<span>  totals <span class="op">=</span> <span class="va">second_arcsin_data</span><span class="op">$</span><span class="va">Total</span>,</span>
<span>  doses <span class="op">=</span> <span class="va">second_arcsin_data</span><span class="op">$</span><span class="va">Dose</span>,</span>
<span>  scoring <span class="op">=</span> <span class="st">"ranks"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Calculating phi estimates...</span></span>
<span><span class="co">#&gt; Simple method phi: 18.85714 </span></span>
<span><span class="co">#&gt; Trend-adjusted method phi: 5.992918 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Phi Estimation Method Comparison (ranks scoring):</span></span>
<span><span class="co">#&gt; ============================================================ </span></span>
<span><span class="co">#&gt;                        Method Phi_Estimate</span></span>
<span><span class="co">#&gt;  Simple (no trend adjustment)       18.857</span></span>
<span><span class="co">#&gt;                Trend-adjusted        5.993</span></span>
<span><span class="co">#&gt;                                     Description</span></span>
<span><span class="co">#&gt;            Based on residuals from overall mean</span></span>
<span><span class="co">#&gt;  Based on residuals after removing linear trend</span></span>
<span><span class="co">#&gt;                               Use_When</span></span>
<span><span class="co">#&gt;  No clear dose-response trend expected</span></span>
<span><span class="co">#&gt;      Clear dose-response trend present</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Recommendation:</span></span>
<span><span class="co">#&gt; Simple method shows higher overdispersion.</span></span>
<span><span class="co">#&gt; May indicate overdispersion not related to dose-response trend.</span></span>
<span></span>
<span><span class="co"># Comprehensive comparison</span></span>
<span><span class="va">comprehensive_results</span> <span class="op">&lt;-</span> <span class="fu">drcHelper</span><span class="fu">:::</span><span class="fu"><a href="../reference/comprehensive_phi_comparison.html">comprehensive_phi_comparison</a></span><span class="op">(</span></span>
<span>  successes <span class="op">=</span> <span class="va">second_arcsin_data</span><span class="op">$</span><span class="va">Immobile</span>,</span>
<span>  totals <span class="op">=</span> <span class="va">second_arcsin_data</span><span class="op">$</span><span class="va">Total</span>,</span>
<span>  doses <span class="op">=</span> <span class="va">second_arcsin_data</span><span class="op">$</span><span class="va">Dose</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Comprehensive Phi Comparison Across Methods</span></span>
<span><span class="co">#&gt; ====================================================================== </span></span>
<span><span class="co">#&gt;  Scoring_Method simple trend_adjusted Difference</span></span>
<span><span class="co">#&gt;           doses   18.9           1.95      -16.9</span></span>
<span><span class="co">#&gt;           ranks   18.9           5.99      -12.9</span></span>
<span><span class="co">#&gt;       log_doses   18.9           7.63      -11.2</span></span>
<span><span class="co">#&gt;    equal_spaced   18.9           5.99      -12.9</span></span>
<span><span class="co">#&gt;                     Interpretation</span></span>
<span><span class="co">#&gt;  Strong overdispersion (trend-adj)</span></span>
<span><span class="co">#&gt;  Strong overdispersion (trend-adj)</span></span>
<span><span class="co">#&gt;  Strong overdispersion (trend-adj)</span></span>
<span><span class="co">#&gt;  Strong overdispersion (trend-adj)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Key Findings:</span></span>
<span><span class="co">#&gt; - Simple method assumes no dose-response trend</span></span>
<span><span class="co">#&gt; - Trend-adjusted method removes linear dose-response before testing overdispersion</span></span>
<span><span class="co">#&gt; - Large differences suggest trend-related vs. random overdispersion</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Step-down test with simple phi method</span></span>
<span><span class="va">stepdown_simple</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stepDownTrendTestBinom.html">stepDownTrendTestBinom</a></span><span class="op">(</span></span>
<span>  successes <span class="op">=</span> <span class="va">second_arcsin_data</span><span class="op">$</span><span class="va">Immobile</span>,</span>
<span>  totals <span class="op">=</span> <span class="va">second_arcsin_data</span><span class="op">$</span><span class="va">Total</span>,</span>
<span>  doses <span class="op">=</span> <span class="va">second_arcsin_data</span><span class="op">$</span><span class="va">Dose</span>,</span>
<span>  scoring <span class="op">=</span> <span class="st">"rank"</span>,</span>
<span>  alternative <span class="op">=</span> <span class="st">"greater"</span>,</span>
<span>  rao_scott <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  phi_method <span class="op">=</span> <span class="st">"simple"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Estimated phi = 18.857 using simple method with ranks scoring</span></span>
<span></span>
<span><span class="co"># Step-down test with trend-adjusted phi method</span></span>
<span><span class="va">stepdown_trend</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stepDownTrendTestBinom.html">stepDownTrendTestBinom</a></span><span class="op">(</span></span>
<span>  successes <span class="op">=</span> <span class="va">second_arcsin_data</span><span class="op">$</span><span class="va">Immobile</span>,</span>
<span>  totals <span class="op">=</span> <span class="va">second_arcsin_data</span><span class="op">$</span><span class="va">Total</span>,</span>
<span>  doses <span class="op">=</span> <span class="va">second_arcsin_data</span><span class="op">$</span><span class="va">Dose</span>,</span>
<span>  scoring <span class="op">=</span> <span class="st">"rank"</span>,</span>
<span>  alternative <span class="op">=</span> <span class="st">"greater"</span>,</span>
<span>  rao_scott <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  phi_method <span class="op">=</span> <span class="st">"trend_adjusted"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Estimated phi = 5.993 using trend_adjusted method with ranks scoring</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Test with ranks scoring and trend-adjusted phi</span></span>
<span><span class="va">analysis_ranks_trend</span> <span class="op">&lt;-</span> <span class="fu">drcHelper</span><span class="fu">:::</span><span class="fu"><a href="../reference/complete_trend_analysis.html">complete_trend_analysis</a></span><span class="op">(</span></span>
<span>  successes <span class="op">=</span> <span class="va">second_arcsin_data</span><span class="op">$</span><span class="va">Immobile</span>,</span>
<span>  totals <span class="op">=</span> <span class="va">second_arcsin_data</span><span class="op">$</span><span class="va">Total</span>,</span>
<span>  doses <span class="op">=</span> <span class="va">second_arcsin_data</span><span class="op">$</span><span class="va">Dose</span>,</span>
<span>  scoring <span class="op">=</span> <span class="st">"ranks"</span>,</span>
<span>  alternative <span class="op">=</span> <span class="st">"greater"</span>,</span>
<span>  phi_method <span class="op">=</span> <span class="st">"trend_adjusted"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Performing complete trend analysis</span></span>
<span><span class="co">#&gt; Scoring method: ranks </span></span>
<span><span class="co">#&gt; Phi estimation method: trend_adjusted </span></span>
<span><span class="co">#&gt; ============================================================ </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Step 1: Testing for overdispersion...</span></span>
<span><span class="co">#&gt; Tarone test phi estimate: 6.006 </span></span>
<span><span class="co">#&gt; Simple phi estimate: 18.857 </span></span>
<span><span class="co">#&gt; Trend-adjusted phi estimate: 5.993 </span></span>
<span><span class="co">#&gt; Using phi = 5.993 for Rao-Scott correction</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Step 2: Step-down Cochran-Armitage trend test...</span></span>
<span><span class="co">#&gt; Overdispersion detected (phi = 5.993 ), applying Rao-Scott correction...</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">analysis_ranks_trend</span><span class="op">)</span></span>
<span><span class="co">#&gt; $scoring_method</span></span>
<span><span class="co">#&gt; [1] "ranks"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $phi_method</span></span>
<span><span class="co">#&gt; [1] "trend_adjusted"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $phi_estimates</span></span>
<span><span class="co">#&gt; $phi_estimates$simple</span></span>
<span><span class="co">#&gt; [1] 18.85714</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $phi_estimates$trend_adjusted</span></span>
<span><span class="co">#&gt; [1] 5.992918</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $phi_estimates$tarone</span></span>
<span><span class="co">#&gt; [1] 6.006433</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $phi_estimates$used</span></span>
<span><span class="co">#&gt; [1] 5.992918</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $tarone_analysis</span></span>
<span><span class="co">#&gt; $scoring_method</span></span>
<span><span class="co">#&gt; [1] "ranks"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $doses</span></span>
<span><span class="co">#&gt; [1]  0  5 10 20 40 80</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $scores</span></span>
<span><span class="co">#&gt; [1] 1 2 3 4 5 6</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $dose_summary</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 4</span></span></span>
<span><span class="co">#&gt;   doses successes totals n_replicates</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     0         0     30            6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     5         0     30            6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>    10         0     30            6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>    20         0     30            6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>    40         2     30            6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>    80        19     30            6</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $groupwise_tarone</span></span>
<span><span class="co">#&gt; $groupwise_tarone$summary</span></span>
<span><span class="co">#&gt;   dose n_replicates z_statistic   p_value significant note</span></span>
<span><span class="co">#&gt; 1    0            6         NaN       NaN          NA     </span></span>
<span><span class="co">#&gt; 2    5            6         NaN       NaN          NA     </span></span>
<span><span class="co">#&gt; 3   10            6         NaN       NaN          NA     </span></span>
<span><span class="co">#&gt; 4   20            6         NaN       NaN          NA     </span></span>
<span><span class="co">#&gt; 5   40            6 -0.55328334 0.5800694       FALSE     </span></span>
<span><span class="co">#&gt; 6   80            6 -0.03706204 0.9704355       FALSE     </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $groupwise_tarone$detailed_results</span></span>
<span><span class="co">#&gt; $groupwise_tarone$detailed_results[[1]]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Tarone's Z test</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data:  successes successes from totals trials</span></span>
<span><span class="co">#&gt; z = NaN, p-value = NA</span></span>
<span><span class="co">#&gt; alternative hypothesis: true dispersion parameter is greater than 0</span></span>
<span><span class="co">#&gt; sample estimates:</span></span>
<span><span class="co">#&gt; proportion parameter </span></span>
<span><span class="co">#&gt;                    0 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $groupwise_tarone$detailed_results[[2]]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Tarone's Z test</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data:  successes successes from totals trials</span></span>
<span><span class="co">#&gt; z = NaN, p-value = NA</span></span>
<span><span class="co">#&gt; alternative hypothesis: true dispersion parameter is greater than 0</span></span>
<span><span class="co">#&gt; sample estimates:</span></span>
<span><span class="co">#&gt; proportion parameter </span></span>
<span><span class="co">#&gt;                    0 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $groupwise_tarone$detailed_results[[3]]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Tarone's Z test</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data:  successes successes from totals trials</span></span>
<span><span class="co">#&gt; z = NaN, p-value = NA</span></span>
<span><span class="co">#&gt; alternative hypothesis: true dispersion parameter is greater than 0</span></span>
<span><span class="co">#&gt; sample estimates:</span></span>
<span><span class="co">#&gt; proportion parameter </span></span>
<span><span class="co">#&gt;                    0 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $groupwise_tarone$detailed_results[[4]]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Tarone's Z test</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data:  successes successes from totals trials</span></span>
<span><span class="co">#&gt; z = NaN, p-value = NA</span></span>
<span><span class="co">#&gt; alternative hypothesis: true dispersion parameter is greater than 0</span></span>
<span><span class="co">#&gt; sample estimates:</span></span>
<span><span class="co">#&gt; proportion parameter </span></span>
<span><span class="co">#&gt;                    0 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $groupwise_tarone$detailed_results[[5]]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Tarone's Z test</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data:  successes successes from totals trials</span></span>
<span><span class="co">#&gt; z = -0.55328, p-value = 0.5801</span></span>
<span><span class="co">#&gt; alternative hypothesis: true dispersion parameter is greater than 0</span></span>
<span><span class="co">#&gt; sample estimates:</span></span>
<span><span class="co">#&gt; proportion parameter </span></span>
<span><span class="co">#&gt;           0.06666667 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $groupwise_tarone$detailed_results[[6]]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Tarone's Z test</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data:  successes successes from totals trials</span></span>
<span><span class="co">#&gt; z = -0.037062, p-value = 0.9704</span></span>
<span><span class="co">#&gt; alternative hypothesis: true dispersion parameter is greater than 0</span></span>
<span><span class="co">#&gt; sample estimates:</span></span>
<span><span class="co">#&gt; proportion parameter </span></span>
<span><span class="co">#&gt;            0.6333333 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $trend_adjusted_tarone</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Tarone's test for overdispersion (trend-adjusted)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data:  successes from totals with trend removed</span></span>
<span><span class="co">#&gt; = 7.0802, p-value = 1.44e-12</span></span>
<span><span class="co">#&gt; alternative hypothesis: two.sided</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $phi_estimate</span></span>
<span><span class="co">#&gt; [1] 6.006433</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $trend_fit</span></span>
<span><span class="co">#&gt; $trend_fit$beta</span></span>
<span><span class="co">#&gt; [1] 0.09619048</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $trend_fit$trend_proportions</span></span>
<span><span class="co">#&gt; [1] 0.00100000 0.00100000 0.06857143 0.16476190 0.26095238 0.35714286</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $trend_fit$expected_under_trend</span></span>
<span><span class="co">#&gt; [1]  0.030000  0.030000  2.057143  4.942857  7.828571 10.714286</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $trend_fit$residuals_after_trend</span></span>
<span><span class="co">#&gt; [1] -0.030000 -0.030000 -2.057143 -4.942857 -5.828571  8.285714</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $trend_fit$variance_components</span></span>
<span><span class="co">#&gt; [1] 0.029970 0.029970 1.916082 4.128463 5.785687 6.887755</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attr(,"class")</span></span>
<span><span class="co">#&gt; [1] "TaroneTrendTest"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $stepdown_standard</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Step-down Cochran-Armitage test for trend (ranks scoring) (ranks scoring) </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data: successes out of totals at doses 0, 5, 10, 20, 40, 80 with ranks scoring </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Step-down results:</span></span>
<span><span class="co">#&gt;              Doses_Included Statistic      P_Value</span></span>
<span><span class="co">#&gt; Step 1 0, 5, 10, 20, 40, 80  6.865561 3.311526e-12</span></span>
<span><span class="co">#&gt; Step 2     0, 5, 10, 20, 40  2.013468 2.203270e-02</span></span>
<span><span class="co">#&gt; Step 3         0, 5, 10, 20  0.000000 5.000000e-01</span></span>
<span><span class="co">#&gt; Step 4             0, 5, 10  0.000000 5.000000e-01</span></span>
<span><span class="co">#&gt; Step 5                 0, 5  0.000000 5.000000e-01</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Alternative hypothesis: greater </span></span>
<span><span class="co">#&gt; NOEC: 20 </span></span>
<span><span class="co">#&gt; LOEC: 40 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $stepdown_corrected</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Step-down Rao-Scott corrected Cochran-Armitage test for trend (ranks scoring) (ranks scoring) </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data: successes out of totals at doses 0, 5, 10, 20, 40, 80 with ranks scoring </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Step-down results:</span></span>
<span><span class="co">#&gt;              Doses_Included Statistic     P_Value</span></span>
<span><span class="co">#&gt; Step 1 0, 5, 10, 20, 40, 80 2.8045091 0.002519663</span></span>
<span><span class="co">#&gt; Step 2     0, 5, 10, 20, 40 0.8224805 0.205401748</span></span>
<span><span class="co">#&gt; Step 3         0, 5, 10, 20 0.0000000 0.500000000</span></span>
<span><span class="co">#&gt; Step 4             0, 5, 10 0.0000000 0.500000000</span></span>
<span><span class="co">#&gt; Step 5                 0, 5 0.0000000 0.500000000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Alternative hypothesis: greater </span></span>
<span><span class="co">#&gt; NOEC: 40 </span></span>
<span><span class="co">#&gt; LOEC: 80 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attr(,"class")</span></span>
<span><span class="co">#&gt; [1] "completeTrendAnalysis"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="the-false-significance-problem">The False Significance Problem<a class="anchor" aria-label="anchor" href="#the-false-significance-problem"></a>
</h2>
<p>The traditional CA trend test may not be the best tool for some
dose-response patterns. In particular, CA test ignores within-group
dispersion - it’s purely about group means. Even if over-dispersion is
corrected within each group, it is not adjusted by the corresponding
trend that is assumed in the testing procedure. It could happen that
there is no over-dispersion within each treatment group, but the
residuals after the trend removal are actually overdispersed, which is
exactly what happened in the specific data example. Secondly, Scoring
systems can mask biological reality - equal weight to unequal biological
changes. Thirdly, linear trend assumption fails with cliff data - the 40
mg a.i./L “significance” can be an artifact of the testing assumption
and procedure.</p>
<p>The data pattern: 0%, 0%, 0%, 0%, 6.7%, 63.3%</p>
<p>What happens in step-down testing: Step 1: Test all groups
(0,5,10,20,40,80) - SIGNIFICANT (driven by 80 mg a.i./L) Step 2: Test
(0,5,10,20,40) - May be SIGNIFICANT (driven by 40 mg a.i./L vs others)
Step 3: Test (0,5,10,20) - NOT significant</p>
<p>Result: NOEC = 20mg, LOEC = 40 mg a.i./L But biologically: 40mg shows
minimal effect (6.7%) The real biological effect starts at 80 mg a.i./L
(63.3%)</p>
<p>This happens because: 1. CA test uses LINEAR trend assumption 2. The
huge 80 mg a.i./L effect ‘pulls’ the trend line 3. 40 mg a.i./La ppears
significant relative to this trend 4. Actual biological threshold
(cliff) is ignored</p>
<p>Given these limitations, there could be more suitable approaches.</p>
<ol style="list-style-type: decimal">
<li>Pairwise Comparisons with Control</li>
<li>Change-Point Detection</li>
<li>BMD</li>
<li>Other custom threshold tests</li>
</ol>
<div class="section level3">
<h3 id="pairwise-comparison-with-control">Pairwise Comparison with Control<a class="anchor" aria-label="anchor" href="#pairwise-comparison-with-control"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">second_arcsin_data</span> <span class="op">&lt;-</span> <span class="va">second_arcsin_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Active <span class="op">=</span> <span class="va">Total</span><span class="op">-</span><span class="va">Immobile</span><span class="op">)</span></span>
<span><span class="va">res1</span><span class="op">&lt;-</span> <span class="fu"><a href="../reference/compare_to_control_fisher.html">compare_to_control_fisher</a></span><span class="op">(</span><span class="va">second_arcsin_data</span>,factor_col <span class="op">=</span> <span class="st">"Treatment"</span>,success_col <span class="op">=</span> <span class="st">"Immobile"</span>,failure_col <span class="op">=</span> <span class="st">"Active"</span>,</span>
<span>                          p.adjust.method <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span><span class="va">res1</span></span>
<span><span class="co">#&gt;   Treatment p_value odds_ratio ci_lower ci_upper p_adjusted</span></span>
<span><span class="co">#&gt; 1         5  1.0000          0        0      Inf     1.0000</span></span>
<span><span class="co">#&gt; 2        10  1.0000          0        0      Inf     1.0000</span></span>
<span><span class="co">#&gt; 3        20  1.0000          0        0      Inf     1.0000</span></span>
<span><span class="co">#&gt; 4        40  0.4915          0        0   5.2956     0.4915</span></span>
<span><span class="co">#&gt; 5        80  0.0000          0        0   0.1005     0.0000</span></span>
<span><span class="va">res2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compare_to_control_fisher.html">compare_to_control_fisher</a></span><span class="op">(</span><span class="va">second_arcsin_data</span>,factor_col <span class="op">=</span> <span class="st">"Treatment"</span>,success_col <span class="op">=</span> <span class="st">"Immobile"</span>,failure_col <span class="op">=</span> <span class="st">"Active"</span>, p.adjust.method <span class="op">=</span> <span class="st">"holm"</span><span class="op">)</span></span>
<span><span class="va">res2</span></span>
<span><span class="co">#&gt;   Treatment p_value odds_ratio ci_lower ci_upper p_adjusted</span></span>
<span><span class="co">#&gt; 1         5  1.0000          0        0      Inf          1</span></span>
<span><span class="co">#&gt; 2        10  1.0000          0        0      Inf          1</span></span>
<span><span class="co">#&gt; 3        20  1.0000          0        0      Inf          1</span></span>
<span><span class="co">#&gt; 4        40  0.4915          0        0   5.2956          1</span></span>
<span><span class="co">#&gt; 5        80  0.0000          0        0   0.1005          0</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="exact-cochran-armitage-on-replicate-averages">Exact Cochran-Armitage on replicate averages<a class="anchor" aria-label="anchor" href="#exact-cochran-armitage-on-replicate-averages"></a>
</h3>
<p>Another important aspect is the difference between the exact test
p-value and the asymptotic p-value, apart from the sample size being
used.</p>
<table class="table">
<colgroup>
<col width="9%">
<col width="23%">
<col width="20%">
<col width="27%">
<col width="18%">
</colgroup>
<thead><tr class="header">
<th align="center">Dose</th>
<th align="center">test.statistic</th>
<th align="center">exact.pvalue</th>
<th align="center">asymptotic.pvalue</th>
<th align="center">sampe.size</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">40</td>
<td align="center">-1.798</td>
<td align="center">0.2</td>
<td align="center">0.03609</td>
<td align="center">6</td>
</tr>
<tr class="even">
<td align="center">40</td>
<td align="center">-2.517</td>
<td align="center">0.03893</td>
<td align="center">0.005921</td>
<td align="center">30</td>
</tr>
<tr class="odd">
<td align="center">80</td>
<td align="center">-4.053</td>
<td align="center">0.0002546</td>
<td align="center">2.531e-05</td>
<td align="center">6</td>
</tr>
<tr class="even">
<td align="center">80</td>
<td align="center">-8.945</td>
<td align="center">2.12e-17</td>
<td align="center">1.862e-19</td>
<td align="center">30</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ca_dose_40</span> <span class="op">&lt;-</span> <span class="va">second_arcsin_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Dose</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>nrep<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>,p<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">immob</span><span class="op">)</span>,ntot<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Total</span><span class="op">)</span>,p2<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Immobile</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Total</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Dose</span><span class="op">!=</span> <span class="fl">80</span><span class="op">)</span></span>
<span><span class="va">a1</span> <span class="op">&lt;-</span> <span class="fu">CATTexact</span><span class="fu">::</span><span class="fu">catt_exact</span><span class="op">(</span><span class="va">ca_dose_40</span><span class="op">$</span><span class="va">Dose</span>,<span class="va">ca_dose_40</span><span class="op">$</span><span class="va">nrep</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">ca_dose_40</span><span class="op">$</span><span class="va">p</span><span class="op">*</span><span class="va">ca_dose_40</span><span class="op">$</span><span class="va">nrep</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">a2</span> <span class="op">&lt;-</span> <span class="fu">CATTexact</span><span class="fu">::</span><span class="fu">catt_exact</span><span class="op">(</span><span class="va">ca_dose_40</span><span class="op">$</span><span class="va">Dose</span>,<span class="va">ca_dose_40</span><span class="op">$</span><span class="va">ntot</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">ca_dose_40</span><span class="op">$</span><span class="va">p</span><span class="op">*</span><span class="va">ca_dose_40</span><span class="op">$</span><span class="va">ntot</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">ca_dose_80</span> <span class="op">&lt;-</span> <span class="va">second_arcsin_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Dose</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>nrep<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>,p<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">immob</span><span class="op">)</span>,ntot<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Total</span><span class="op">)</span>,p2<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Immobile</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Total</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="va">b1</span> <span class="op">&lt;-</span> <span class="fu">CATTexact</span><span class="fu">::</span><span class="fu">catt_exact</span><span class="op">(</span><span class="va">ca_dose_80</span><span class="op">$</span><span class="va">Dose</span>,<span class="va">ca_dose_80</span><span class="op">$</span><span class="va">nrep</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">ca_dose_80</span><span class="op">$</span><span class="va">p</span><span class="op">*</span><span class="va">ca_dose_80</span><span class="op">$</span><span class="va">nrep</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">b2</span> <span class="op">&lt;-</span> <span class="fu">CATTexact</span><span class="fu">::</span><span class="fu">catt_exact</span><span class="op">(</span><span class="va">ca_dose_80</span><span class="op">$</span><span class="va">Dose</span>,<span class="va">ca_dose_80</span><span class="op">$</span><span class="va">ntot</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">ca_dose_80</span><span class="op">$</span><span class="va">p</span><span class="op">*</span><span class="va">ca_dose_80</span><span class="op">$</span><span class="va">ntot</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Dose<span class="op">=</span><span class="fl">40</span>,<span class="va">a1</span>,sampe.size<span class="op">=</span><span class="fl">6</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Dose<span class="op">=</span><span class="fl">40</span>,<span class="va">a2</span>,sampe.size<span class="op">=</span><span class="fl">30</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Dose<span class="op">=</span><span class="fl">80</span>,<span class="va">b1</span>,sampe.size<span class="op">=</span><span class="fl">6</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Dose<span class="op">=</span><span class="fl">80</span>,<span class="va">b2</span>,sampe.size<span class="op">=</span><span class="fl">30</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="change-point-analysis">Change Point Analysis<a class="anchor" aria-label="anchor" href="#change-point-analysis"></a>
</h3>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Detect change points in dose-response</span></span>
<span><span class="va">detect_change_point</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">successes</span>, <span class="va">totals</span>, <span class="va">doses</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">group_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">successes</span>, <span class="va">totals</span>, <span class="va">doses</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">doses</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>      successes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">successes</span><span class="op">)</span>,</span>
<span>      totals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">totals</span><span class="op">)</span>,</span>
<span>      proportion <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">successes</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">totals</span><span class="op">)</span>,</span>
<span>      .groups <span class="op">=</span> <span class="st">'drop'</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">doses</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Change Point Analysis:\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"=====================\n"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Look for largest jump in proportions</span></span>
<span>  <span class="va">prop_diffs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">group_data</span><span class="op">$</span><span class="va">proportion</span><span class="op">)</span></span>
<span>  <span class="va">max_jump_idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.max</a></span><span class="op">(</span><span class="va">prop_diffs</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Proportion differences between consecutive doses:\n"</span><span class="op">)</span></span>
<span>  <span class="va">diff_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    From_Dose <span class="op">=</span> <span class="va">group_data</span><span class="op">$</span><span class="va">doses</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">group_data</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    To_Dose <span class="op">=</span> <span class="va">group_data</span><span class="op">$</span><span class="va">doses</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>    Proportion_Jump <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">prop_diffs</span>, <span class="fl">3</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">diff_df</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nLargest jump: from"</span>, <span class="va">group_data</span><span class="op">$</span><span class="va">doses</span><span class="op">[</span><span class="va">max_jump_idx</span><span class="op">]</span>, </span>
<span>      <span class="st">"to"</span>, <span class="va">group_data</span><span class="op">$</span><span class="va">doses</span><span class="op">[</span><span class="va">max_jump_idx</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Jump size:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">prop_diffs</span><span class="op">[</span><span class="va">max_jump_idx</span><span class="op">]</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nSuggested biological threshold:"</span>, <span class="va">group_data</span><span class="op">$</span><span class="va">doses</span><span class="op">[</span><span class="va">max_jump_idx</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    change_point <span class="op">=</span> <span class="va">group_data</span><span class="op">$</span><span class="va">doses</span><span class="op">[</span><span class="va">max_jump_idx</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span>,</span>
<span>    jump_size <span class="op">=</span> <span class="va">prop_diffs</span><span class="op">[</span><span class="va">max_jump_idx</span><span class="op">]</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">change_point</span> <span class="op">&lt;-</span> <span class="fu">detect_change_point</span><span class="op">(</span></span>
<span>  <span class="va">second_arcsin_data</span><span class="op">$</span><span class="va">Immobile</span>,</span>
<span>  <span class="va">second_arcsin_data</span><span class="op">$</span><span class="va">Total</span>,</span>
<span>  <span class="va">second_arcsin_data</span><span class="op">$</span><span class="va">Dose</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Change Point Analysis:</span></span>
<span><span class="co">#&gt; =====================</span></span>
<span><span class="co">#&gt; Proportion differences between consecutive doses:</span></span>
<span><span class="co">#&gt;  From_Dose To_Dose Proportion_Jump</span></span>
<span><span class="co">#&gt;          0       5           0.000</span></span>
<span><span class="co">#&gt;          5      10           0.000</span></span>
<span><span class="co">#&gt;         10      20           0.000</span></span>
<span><span class="co">#&gt;         20      40           0.067</span></span>
<span><span class="co">#&gt;         40      80           0.567</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Largest jump: from 40 to 80 </span></span>
<span><span class="co">#&gt; Jump size: 0.567 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Suggested biological threshold: 80</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Zhenglei Gao, Sean Ryan.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
