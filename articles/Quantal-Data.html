<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Quantal Data • drcHelper</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="../deps/MathJax-3.2.2/tex-chtml.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Quantal Data">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">drcHelper</a>

    <small class="nav-text text-default me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-getting-started" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Getting Started</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-getting-started">
<li><a class="dropdown-item" href="../articles/Introduction.html">Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/Example_Analysis_Workflow.html">Example Analysis Workflow</a></li>
    <li><a class="dropdown-item" href="../articles/drcHelper.html">Example Helper Functions Usage</a></li>
    <li><a class="dropdown-item" href="../articles/Examples_drc.html">Using DRC and BMD</a></li>
    <li><a class="dropdown-item" href="../articles/Examples_oecd201.html">Example DRC - OECD 201</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-regulatory-stats" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Regulatory Stats</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-regulatory-stats">
<li><a class="dropdown-item" href="../articles/NOEC_Methods.html">NOEC Calculations</a></li>
    <li><a class="dropdown-item" href="../articles/Limit-Test.html">Limit Test Calculations</a></li>
    <li><a class="dropdown-item" href="../articles/EFSA-Criteria.html">EFSA Criteria and Other Reliability Criteria</a></li>
    <li><a class="dropdown-item" href="../articles/Example_RSCABS.html">RSCABS</a></li>
  </ul>
</li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Quantal-Data.html">Quantal Data</a></li>
    <li><a class="dropdown-item" href="../articles/Ordinal-Data.html">Ordinal Data</a></li>
    <li><a class="dropdown-item" href="../articles/Examples%20using%20NLS.html">NLS</a></li>
    <li><a class="dropdown-item" href="../articles/Examples_using_drda.html">drda</a></li>
    <li><a class="dropdown-item" href="../articles/TSK_method.html">TSK method</a></li>
    <li><a class="dropdown-item" href="../articles/MQJT.html">MQJT</a></li>
    <li><a class="dropdown-item" href="../articles/Advanced_Fitting-a-biphasic-dose-reponse-model.html">Fitting A biphasic dose response model</a></li>
    <li><a class="dropdown-item" href="../articles/Count_Data.html">Count Data</a></li>
    <li><a class="dropdown-item" href="../articles/Normality-Check.html">Normality Check</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-validation" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Validation</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-validation">
<li><a class="dropdown-item" href="../articles/System_Testing.html">System Testing</a></li>
    <li><a class="dropdown-item" href="../articles/Test-Guidelines.html">Study Types and Templates</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Bayer-Group/drcHelper/issues/new?template=Blank+issue" aria-label="New Issue"><span class="fa fa-bug"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Bayer-Group/drcHelper" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Quantal Data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Bayer-Group/drcHelper/blob/main/vignettes/articles/Quantal-Data.Rmd" class="external-link"><code>vignettes/articles/Quantal-Data.Rmd</code></a></small>
      <div class="d-none name"><code>Quantal-Data.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bayer-group.github.io/drcHelper/index.html">drcHelper</a></span><span class="op">)</span></span></code></pre></div>
<p>Analysis of quantal data typically involves the following steps as
shown in the flowchart below:</p>
<p><img src="..%2Fassets%2Fquantal_NOEC.png" width="90%"></p>
<div class="section level2">
<h2 id="an-example-dataset">An example dataset<a class="anchor" aria-label="anchor" href="#an-example-dataset"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rpkgs.datanovia.com/rstatix/" class="external-link">rstatix</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">test_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  treatment <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"control"</span>, <span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"low"</span>, <span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"high"</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  survived <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">9</span>, <span class="fl">8</span>, <span class="fl">10</span>, <span class="fl">7</span>, <span class="fl">6</span>, <span class="fl">5</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  died <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">0</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">7</span>, <span class="fl">6</span>, <span class="fl">8</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="fishers-exact-test-comparing-each-dose-to-control">Fisher’s Exact Test (comparing each dose to control)<a class="anchor" aria-label="anchor" href="#fishers-exact-test-comparing-each-dose-to-control"></a>
</h2>
<p>Note that just two groups also work.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run the function</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compare_to_control_fisher.html">compare_to_control_fisher</a></span><span class="op">(</span><span class="va">test_data</span>, <span class="st">"treatment"</span>, <span class="st">"survived"</span>, <span class="st">"died"</span>,</span>
<span>                                    control_level <span class="op">=</span> <span class="st">"control"</span>,p.adjust.method<span class="op">=</span><span class="st">"holm"</span><span class="op">)</span></span>
<span><span class="va">result</span></span>
<span><span class="co">#&gt;   treatment p_value odds_ratio ci_lower ci_upper p_adjusted</span></span>
<span><span class="co">#&gt; 1       low  0.0153     5.8215   1.3182  36.6614     0.0153</span></span>
<span><span class="co">#&gt; 2      high  0.0000    19.6536   4.4429 126.9504     0.0000</span></span>
<span><span class="va">ctab</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_contingency_table.html">create_contingency_table</a></span><span class="op">(</span><span class="va">test_data</span>,<span class="st">"treatment"</span>, <span class="st">"survived"</span>, <span class="st">"died"</span><span class="op">)</span></span>
<span><span class="fu">drcHelper</span><span class="fu">::</span><span class="fu"><a href="../reference/many_to_one_fisher_test.html">many_to_one_fisher_test</a></span><span class="op">(</span><span class="va">ctab</span>,ref.group <span class="op">=</span> <span class="st">"treatment_control"</span>,p.adjust.method <span class="op">=</span> <span class="st">"holm"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 6</span></span></span>
<span><span class="co">#&gt;   group1            group2             n          p      p.adj p.adj.signif</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> treatment_control treatment_high    60 0.000<span style="text-decoration: underline;">003</span>37 0.000<span style="text-decoration: underline;">006</span>74 ****        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> treatment_control treatment_low     60 0.015<span style="text-decoration: underline;">3</span>     0.015<span style="text-decoration: underline;">3</span>     *</span></span></code></pre></div>
<p>Note that with two groups, same functions can be used and the
p_adjusted will always be equal to original p-value.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compare_to_control_fisher.html">compare_to_control_fisher</a></span><span class="op">(</span><span class="va">test_data</span><span class="op"><a href="../reference/pipe.html">%&gt;%</a></span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">treatment</span><span class="op">!=</span><span class="st">"high"</span><span class="op">)</span><span class="op"><a href="../reference/pipe.html">%&gt;%</a></span><span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>, <span class="st">"treatment"</span>, <span class="st">"survived"</span>, <span class="st">"died"</span>,control_level <span class="op">=</span> <span class="st">"control"</span><span class="op">)</span></span>
<span><span class="va">result</span></span>
<span><span class="co">#&gt;   treatment p_value odds_ratio ci_lower ci_upper p_adjusted</span></span>
<span><span class="co">#&gt; 1       low  0.0153     5.8215   1.3182  36.6614     0.0153</span></span>
<span><span class="va">ctab</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_contingency_table.html">create_contingency_table</a></span><span class="op">(</span><span class="va">test_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">treatment</span><span class="op">!=</span><span class="st">"high"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>,<span class="st">"treatment"</span>, <span class="st">"survived"</span>, <span class="st">"died"</span><span class="op">)</span></span>
<span><span class="fu">drcHelper</span><span class="fu">::</span><span class="fu"><a href="../reference/many_to_one_fisher_test.html">many_to_one_fisher_test</a></span><span class="op">(</span><span class="va">ctab</span>,ref.group <span class="op">=</span> <span class="st">"treatment_control"</span>,p.adjust.method <span class="op">=</span> <span class="st">"holm"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 6</span></span></span>
<span><span class="co">#&gt;   group1            group2            n      p  p.adj p.adj.signif</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> treatment_control treatment_low    60 0.015<span style="text-decoration: underline;">3</span> 0.015<span style="text-decoration: underline;">3</span> *</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/fisher.test.html" class="external-link">fisher.test</a></span><span class="op">(</span><span class="va">ctab</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Fisher's Exact Test for Count Data</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data:  ctab</span></span>
<span><span class="co">#&gt; p-value = 0.01533</span></span>
<span><span class="co">#&gt; alternative hypothesis: true odds ratio is not equal to 1</span></span>
<span><span class="co">#&gt; 95 percent confidence interval:</span></span>
<span><span class="co">#&gt;   1.318207 36.661382</span></span>
<span><span class="co">#&gt; sample estimates:</span></span>
<span><span class="co">#&gt; odds ratio </span></span>
<span><span class="co">#&gt;    5.82151</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># CMH test</span></span>
<span><span class="va">cmh_result</span> <span class="op">&lt;-</span> <span class="va">data_long</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">dose</span>, <span class="va">condition</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/mantelhaen.test.html" class="external-link">mantelhaen.test</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"Fisher's Exact Test results (comparing each dose to control):"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">fisher_results</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"\nCochran-Mantel-Haenszel Test result:"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">cmh_result</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate NOEC</span></span>
<span><span class="va">noec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">fisher_results</span><span class="op">$</span><span class="va">dose</span><span class="op">[</span><span class="va">fisher_results</span><span class="op">$</span><span class="va">p_value</span> <span class="op">&gt;</span> <span class="fl">0.05</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="cochran-mantel-haenszel-chi-squared-test-for-count-data">Cochran-Mantel-Haenszel Chi-Squared Test for Count Data<a class="anchor" aria-label="anchor" href="#cochran-mantel-haenszel-chi-squared-test-for-count-data"></a>
</h3>
<p>It is an extension of Cochran-Mantel test used for stratified or
matched categorical data.</p>
</div>
<div class="section level3">
<h3 id="mcnemars-chi-squared-test-for-count-data">McNemar’s Chi-squared Test for Count Data<a class="anchor" aria-label="anchor" href="#mcnemars-chi-squared-test-for-count-data"></a>
</h3>
<p>McNemar’s test was not appropriate for NOEC derivation as it’s
designed for paired observations (before/after measurements).</p>
</div>
</div>
<div class="section level2">
<h2 id="tarones-test">Tarone’s Test<a class="anchor" aria-label="anchor" href="#tarones-test"></a>
</h2>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mymatrix1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">5</span>,<span class="fl">5</span>,<span class="fl">103</span><span class="op">)</span>,nrow<span class="op">=</span><span class="fl">2</span>,byrow<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">mymatrix1</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Disease"</span>,<span class="st">"Control"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">mymatrix1</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Exposure"</span>,<span class="st">"Unexposed"</span><span class="op">)</span></span>
<span><span class="va">mymatrix2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">3</span>,<span class="fl">5</span>,<span class="fl">43</span><span class="op">)</span>,nrow<span class="op">=</span><span class="fl">2</span>,byrow<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">mymatrix2</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Disease"</span>,<span class="st">"Control"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">mymatrix2</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Exposure"</span>,<span class="st">"Unexposed"</span><span class="op">)</span></span>
<span><span class="va">mylist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">mymatrix1</span>,<span class="va">mymatrix2</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/calcTaronesTest.html">calcTaronesTest</a></span><span class="op">(</span><span class="va">mylist</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Pvalue for Tarone's test = 0.627420741721689"</span></span>
<span><span class="co">#&gt; $pval</span></span>
<span><span class="co">#&gt; [1] 0.6274207</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $tarone</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Equal-Effects Model (k = 2)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; I^2 (total heterogeneity / total variability):  0.00%</span></span>
<span><span class="co">#&gt; H^2 (total variability / sampling variability): 0.24</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Test for Heterogeneity: </span></span>
<span><span class="co">#&gt; Q(df = 1) = 0.2423, p-val = 0.6225</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model Results (log scale):</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; estimate      se    zval    pval   ci.lb   ci.ub </span></span>
<span><span class="co">#&gt;   3.1355  0.5741  5.4613  &lt;.0001  2.0102  4.2608 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model Results (OR scale):</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; estimate   ci.lb    ci.ub </span></span>
<span><span class="co">#&gt;  23.0006  7.4652  70.8663 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Cochran-Mantel-Haenszel Test:    CMH = 36.6043, df = 1, p-val &lt; 0.0001</span></span>
<span><span class="co">#&gt; Tarone's Test for Heterogeneity: X^2 =  0.2356, df = 1, p-val = 0.6274</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="trend-test">Trend Test<a class="anchor" aria-label="anchor" href="#trend-test"></a>
</h2>
<p>Cochran Armitage test for trend in binomial proportions across the
treament levels can be performed by <code>prop.trend.test</code> or
<code>CochranArmitageTest</code> from <code>DescTools</code> or use the
wrapper function <code>prop_trend_test</code> provided by
<strong>rstatix</strong> package. Step-down procedures can be performed
using the helper function in this package <code>step_down_CA</code> or
<code>step_down_RSCA</code>.</p>
<p>The Rao-Scott correction is needed when your binomial data exhibits
overdispersion, which occurs when the observed variance in the data
exceeds what would be expected under a simple binomial model. This is
common in:</p>
<ul>
<li>Clustered data: When observations within a group (like organisms in
the same tank) are more similar to each other than to organisms in
different groups</li>
<li>Hierarchical experimental designs: When there are multiple levels of
sampling (e.g., tanks within treatments, organisms within tanks)</li>
<li>Longitudinal studies: When the same subjects are measured repeatedly
over time</li>
<li>Ecological studies: Where environmental factors create additional
variability beyond what a simple binomial model predicts</li>
</ul>
<p>Without Rao-Scott correction, it is possible to underestimate
standard errors, and obtain artificially small p-values (Type I
errors).</p>
<p>Dispersion can be tested by many approaches. Some of them are: 1.
Calculate the dispersion parameter (<span class="math inline">\(\phi\)</span>) as the ratio of the Pearson
chi-square statistic to its degrees of freedom. 2. Compare a binomial
model to a quasi-binomial or beta-binomial model. 3. Dean’s test for
overdispersion</p>
<p><strong>DHARMa</strong> package provides a simulation-based
overdispersion test.</p>
<p>Note that the Rao-Scott correction is used to deal with
over-dispersion and clustered data. The <code>prop.trend.test</code>
uses a <span class="math inline">\(\chi^2\)</span> statistic which is
the square of <span class="math inline">\(Z\)</span> statistic used in
<code><a href="../reference/cochranArmitageTrendTest.html">drcHelper::cochranArmitageTrendTest</a></code> or
<code><a href="https://andrisignorell.github.io/DescTools/reference/CochranArmitageTest.html" class="external-link">DescTools::CochranArmitageTest</a></code>. Also
<code>prop.trend.test</code> only gave two sided test p-values, whereas
<code><a href="https://andrisignorell.github.io/DescTools/reference/CochranArmitageTest.html" class="external-link">DescTools::CochranArmitageTest</a></code> only gives one-sided or
two-sided p-values and do not allow the specification of the
direction.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://andrisignorell.github.io/DescTools/" class="external-link">DescTools</a></span><span class="op">)</span></span>
<span><span class="va">test_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">9</span>,<span class="fl">10</span>,<span class="fl">7</span>, <span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">3</span><span class="op">)</span>, byrow<span class="op">=</span><span class="cn">TRUE</span>, nrow<span class="op">=</span><span class="fl">2</span>, dimnames<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>resp<span class="op">=</span><span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, dose<span class="op">=</span><span class="fl">0</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## DescTools::Desc(dose)</span></span>
<span></span>
<span><span class="fu">DescTools</span><span class="fu">::</span><span class="fu"><a href="https://andrisignorell.github.io/DescTools/reference/CochranArmitageTest.html" class="external-link">CochranArmitageTest</a></span><span class="op">(</span><span class="va">test_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Cochran-Armitage test for trend</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data:  test_data</span></span>
<span><span class="co">#&gt; Z = -1.8856, dim = 4, p-value = 0.05935</span></span>
<span><span class="co">#&gt; alternative hypothesis: two.sided</span></span>
<span><span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/prop.trend.test.html" class="external-link">prop.trend.test</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">9</span>,<span class="fl">10</span>,<span class="fl">7</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">4</span><span class="op">)</span>,<span class="fl">0</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Chi-squared Test for Trend in Proportions</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data:  c(10, 9, 10, 7) out of rep(10, 4) ,</span></span>
<span><span class="co">#&gt;  using scores: 0 1 2 3</span></span>
<span><span class="co">#&gt; X-squared = 3.5556, df = 1, p-value = 0.05935</span></span>
<span><span class="fu">drcHelper</span><span class="fu">::</span><span class="fu"><a href="../reference/cochranArmitageTrendTest.html">cochranArmitageTrendTest</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">9</span>,<span class="fl">10</span>,<span class="fl">7</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">4</span><span class="op">)</span>,<span class="fl">0</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Cochran-Armitage test for trend</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data:  proportions 1, 0.9, 1, 0.7 at doses 0, 1, 2, 3</span></span>
<span><span class="co">#&gt; = -1.8856, p-value = 0.05935</span></span>
<span><span class="co">#&gt; alternative hypothesis: two.sided</span></span>
<span><span class="fu">DescTools</span><span class="fu">::</span><span class="fu"><a href="https://andrisignorell.github.io/DescTools/reference/CochranArmitageTest.html" class="external-link">CochranArmitageTest</a></span><span class="op">(</span><span class="va">test_data</span>,alternative <span class="op">=</span> <span class="st">"one.sided"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Cochran-Armitage test for trend</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data:  test_data</span></span>
<span><span class="co">#&gt; Z = -1.8856, dim = 4, p-value = 0.02967</span></span>
<span><span class="co">#&gt; alternative hypothesis: one.sided</span></span>
<span><span class="fu"><a href="../reference/cochranArmitageTrendTest.html">cochranArmitageTrendTest</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">9</span>,<span class="fl">10</span>,<span class="fl">7</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">4</span><span class="op">)</span>,<span class="fl">0</span><span class="op">:</span><span class="fl">3</span>,alternative <span class="op">=</span> <span class="st">"less"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Cochran-Armitage test for trend</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data:  proportions 1, 0.9, 1, 0.7 at doses 0, 1, 2, 3</span></span>
<span><span class="co">#&gt; = -1.8856, p-value = 0.02967</span></span>
<span><span class="co">#&gt; alternative hypothesis: less</span></span>
<span><span class="fu"><a href="../reference/cochranArmitageTrendTest.html">cochranArmitageTrendTest</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">9</span>,<span class="fl">10</span>,<span class="fl">7</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">4</span><span class="op">)</span>,<span class="fl">0</span><span class="op">:</span><span class="fl">3</span>,alternative <span class="op">=</span> <span class="st">"greater"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Cochran-Armitage test for trend</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data:  proportions 1, 0.9, 1, 0.7 at doses 0, 1, 2, 3</span></span>
<span><span class="co">#&gt; = -1.8856, p-value = 0.9703</span></span>
<span><span class="co">#&gt; alternative hypothesis: greater</span></span></code></pre></div>
<p>Note this is a bit different from the <code>independence_test</code>
in package <strong>coin</strong>.</p>
<div class="section level3">
<h3 id="an-example-with-clustered-data">An example with clustered data<a class="anchor" aria-label="anchor" href="#an-example-with-clustered-data"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Simulate a toxicity experiment with tank effects</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Experimental design</span></span>
<span><span class="va">doses</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">5</span>, <span class="fl">10</span><span class="op">)</span>  <span class="co"># Dose levels</span></span>
<span><span class="va">tanks_per_dose</span> <span class="op">&lt;-</span> <span class="fl">3</span>         <span class="co"># Replicate tanks per dose</span></span>
<span><span class="va">organisms_per_tank</span> <span class="op">&lt;-</span> <span class="fl">10</span>    <span class="co"># Organisms per tank</span></span>
<span></span>
<span><span class="co"># Create data frame</span></span>
<span><span class="va">experiment</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span></span>
<span>  dose <span class="op">=</span> <span class="va">doses</span>,</span>
<span>  tank <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">tanks_per_dose</span></span>
<span><span class="op">)</span></span>
<span><span class="va">experiment</span><span class="op">$</span><span class="va">tank_id</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">experiment</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add random tank effect (creates correlation within tanks)</span></span>
<span><span class="co"># Higher ICC_tank values create stronger clustering</span></span>
<span><span class="va">ICC_tank</span> <span class="op">&lt;-</span> <span class="fl">0.3</span>  <span class="co"># Intraclass correlation coefficient for tank effect</span></span>
<span><span class="va">tank_effect</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">experiment</span><span class="op">)</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">ICC_tank</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">ICC_tank</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate survival data with dose-response relationship and tank effect</span></span>
<span><span class="va">generate_survival</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dose</span>, <span class="va">tank_effect</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Base survival probability (decreases with dose)</span></span>
<span>  <span class="va">p_base</span> <span class="op">&lt;-</span> <span class="fl">0.9</span> <span class="op">-</span> <span class="fl">0.08</span> <span class="op">*</span> <span class="va">dose</span></span>
<span>  </span>
<span>  <span class="co"># Apply tank effect on logit scale</span></span>
<span>  <span class="va">logit_p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">p_base</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">p_base</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="va">tank_effect</span></span>
<span>  <span class="va">p_with_tank</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">logit_p</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">logit_p</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Generate binomial outcomes for each organism</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">organisms_per_tank</span>, size <span class="op">=</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="va">p_with_tank</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Generate data for each tank</span></span>
<span><span class="va">tank_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">experiment</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">survivors</span> <span class="op">&lt;-</span> <span class="fu">generate_survival</span><span class="op">(</span><span class="va">experiment</span><span class="op">$</span><span class="va">dose</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">tank_effect</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    dose <span class="op">=</span> <span class="va">experiment</span><span class="op">$</span><span class="va">dose</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,</span>
<span>    tank_id <span class="op">=</span> <span class="va">experiment</span><span class="op">$</span><span class="va">tank_id</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,</span>
<span>    tank <span class="op">=</span> <span class="va">experiment</span><span class="op">$</span><span class="va">tank</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,</span>
<span>    organism <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">organisms_per_tank</span>,</span>
<span>    survived <span class="op">=</span> <span class="va">survivors</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combine all data</span></span>
<span><span class="va">all_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">tank_data</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Summarize by tank (this is often how data is analyzed)</span></span>
<span><span class="va">tank_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="va">survived</span> <span class="op">~</span> <span class="va">dose</span> <span class="op">+</span> <span class="va">tank_id</span>, data <span class="op">=</span> <span class="va">all_data</span>, </span>
<span>                         FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>sum <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, total <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tank_summary</span><span class="op">$</span><span class="va">successes</span> <span class="op">&lt;-</span> <span class="va">tank_summary</span><span class="op">$</span><span class="va">survived</span><span class="op">[</span>,<span class="st">"sum"</span><span class="op">]</span></span>
<span><span class="va">tank_summary</span><span class="op">$</span><span class="va">totals</span> <span class="op">&lt;-</span> <span class="va">tank_summary</span><span class="op">$</span><span class="va">survived</span><span class="op">[</span>,<span class="st">"total"</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># View the summarized data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">tank_summary</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dose"</span>, <span class="st">"tank_id"</span>, <span class="st">"successes"</span>, <span class="st">"totals"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;    dose tank_id successes totals</span></span>
<span><span class="co">#&gt; 1     0       1         8     10</span></span>
<span><span class="co">#&gt; 2     1       2         9     10</span></span>
<span><span class="co">#&gt; 3     2       3         9     10</span></span>
<span><span class="co">#&gt; 4     5       4         5     10</span></span>
<span><span class="co">#&gt; 5    10       5         0     10</span></span>
<span><span class="co">#&gt; 6     0       6         9     10</span></span>
<span><span class="co">#&gt; 7     1       7        10     10</span></span>
<span><span class="co">#&gt; 8     2       8         5     10</span></span>
<span><span class="co">#&gt; 9     5       9         4     10</span></span>
<span><span class="co">#&gt; 10   10      10         1     10</span></span>
<span><span class="co">#&gt; 11    0      11         9     10</span></span>
<span><span class="co">#&gt; 12    1      12        10     10</span></span>
<span><span class="co">#&gt; 13    2      13         9     10</span></span>
<span><span class="co">#&gt; 14    5      14         7     10</span></span>
<span><span class="co">#&gt; 15   10      15         0     10</span></span>
<span></span>
<span><span class="co"># Aggregate by dose (ignoring tank structure - incorrect approach)</span></span>
<span><span class="va">dose_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">successes</span>, <span class="va">totals</span><span class="op">)</span> <span class="op">~</span> <span class="va">dose</span>, data <span class="op">=</span> <span class="va">tank_summary</span>, FUN <span class="op">=</span> <span class="va">sum</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">dose_summary</span><span class="op">)</span></span>
<span><span class="co">#&gt;   dose successes totals</span></span>
<span><span class="co">#&gt; 1    0        26     30</span></span>
<span><span class="co">#&gt; 2    1        29     30</span></span>
<span><span class="co">#&gt; 3    2        23     30</span></span>
<span><span class="co">#&gt; 4    5        16     30</span></span>
<span><span class="co">#&gt; 5   10         1     30</span></span>
<span></span>
<span><span class="co"># Test for overdispersion using the aggregated data (by dose)</span></span>
<span><span class="va">simple_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">successes</span>, <span class="va">totals</span> <span class="op">-</span> <span class="va">successes</span><span class="op">)</span> <span class="op">~</span> <span class="va">dose</span>, </span>
<span>                   family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">dose_summary</span><span class="op">)</span></span>
<span><span class="va">overdispersion_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/test_overdispersion.html">test_overdispersion</a></span><span class="op">(</span><span class="va">dose_summary</span><span class="op">$</span><span class="va">successes</span>, <span class="va">dose_summary</span><span class="op">$</span><span class="va">totals</span>, <span class="va">simple_model</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">overdispersion_result</span><span class="op">)</span></span>
<span><span class="co">#&gt; $dispersion</span></span>
<span><span class="co">#&gt; [1] 1.671489</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $p_value</span></span>
<span><span class="co">#&gt; [1] 0.170741</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $interpretation</span></span>
<span><span class="co">#&gt; [1] "Overdispersion detected"</span></span>
<span></span>
<span><span class="co"># Now compare standard Cochran-Armitage test vs. Rao-Scott corrected version</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bayer-group.github.io/drcHelper/index.html">drcHelper</a></span><span class="op">)</span>  <span class="co"># Assuming your package is installed</span></span>
<span></span>
<span><span class="co"># Standard test</span></span>
<span><span class="va">ca_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cochranArmitageTrendTest.html">cochranArmitageTrendTest</a></span><span class="op">(</span></span>
<span>  successes <span class="op">=</span> <span class="va">dose_summary</span><span class="op">$</span><span class="va">successes</span>,</span>
<span>  totals <span class="op">=</span> <span class="va">dose_summary</span><span class="op">$</span><span class="va">totals</span>,</span>
<span>  doses <span class="op">=</span> <span class="va">dose_summary</span><span class="op">$</span><span class="va">dose</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Rao-Scott corrected test</span></span>
<span><span class="va">ca_test_rs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cochranArmitageTrendTest.html">cochranArmitageTrendTest</a></span><span class="op">(</span></span>
<span>  successes <span class="op">=</span> <span class="va">dose_summary</span><span class="op">$</span><span class="va">successes</span>,</span>
<span>  totals <span class="op">=</span> <span class="va">dose_summary</span><span class="op">$</span><span class="va">totals</span>,</span>
<span>  doses <span class="op">=</span> <span class="va">dose_summary</span><span class="op">$</span><span class="va">dose</span>,</span>
<span>  rao_scott <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compare results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">ca_test</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Cochran-Armitage test for trend</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data:  proportions 0.867, 0.967, 0.767, 0.533, 0.033 at doses 0, 1, 2, 5, 10</span></span>
<span><span class="co">#&gt; = -8.3049, p-value &lt; 2.2e-16</span></span>
<span><span class="co">#&gt; alternative hypothesis: two.sided</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">ca_test_rs</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Rao-Scott corrected Cochran-Armitage test for trend</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data:  proportions 0.867, 0.967, 0.767, 0.533, 0.033 at doses 0, 1, 2, 5, 10</span></span>
<span><span class="co">#&gt; = -1.9646, p-value = 0.04947</span></span>
<span><span class="co">#&gt; alternative hypothesis: two.sided</span></span>
<span></span>
<span><span class="co"># Step-down tests</span></span>
<span><span class="va">step_down</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stepDownTrendTestBinom.html">stepDownTrendTestBinom</a></span><span class="op">(</span></span>
<span>  successes <span class="op">=</span> <span class="va">dose_summary</span><span class="op">$</span><span class="va">successes</span>,</span>
<span>  totals <span class="op">=</span> <span class="va">dose_summary</span><span class="op">$</span><span class="va">totals</span>,</span>
<span>  doses <span class="op">=</span> <span class="va">dose_summary</span><span class="op">$</span><span class="va">dose</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">step_down_rs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stepDownTrendTestBinom.html">stepDownTrendTestBinom</a></span><span class="op">(</span></span>
<span>  successes <span class="op">=</span> <span class="va">dose_summary</span><span class="op">$</span><span class="va">successes</span>,</span>
<span>  totals <span class="op">=</span> <span class="va">dose_summary</span><span class="op">$</span><span class="va">totals</span>,</span>
<span>  doses <span class="op">=</span> <span class="va">dose_summary</span><span class="op">$</span><span class="va">dose</span>,</span>
<span>  rao_scott <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">step_down</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Step-down Cochran-Armitage test for trend </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data: successes out of totals at doses 0, 1, 2, 5, 10 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Step-down results:</span></span>
<span><span class="co">#&gt;        Doses_Included Statistic      P_Value</span></span>
<span><span class="co">#&gt; Step 1 0, 1, 2, 5, 10 -8.304949 9.986261e-17</span></span>
<span><span class="co">#&gt; Step 2     0, 1, 2, 5 -3.908588 9.283697e-05</span></span>
<span><span class="co">#&gt; Step 3        0, 1, 2 -1.139332 2.545648e-01</span></span>
<span><span class="co">#&gt; Step 4           0, 1  1.401298 1.611249e-01</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Alternative hypothesis: two.sided </span></span>
<span><span class="co">#&gt; NOEC: 2 </span></span>
<span><span class="co">#&gt; LOEC: 5</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">step_down_rs</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Step-down Rao-Scott corrected Cochran-Armitage test for trend </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data: successes out of totals at doses 0, 1, 2, 5, 10 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Step-down results:</span></span>
<span><span class="co">#&gt;        Doses_Included  Statistic    P_Value</span></span>
<span><span class="co">#&gt; Step 1 0, 1, 2, 5, 10 -1.9645577 0.04946545</span></span>
<span><span class="co">#&gt; Step 2     0, 1, 2, 5 -1.5840507 0.11318218</span></span>
<span><span class="co">#&gt; Step 3        0, 1, 2 -0.7071068 0.47950012</span></span>
<span><span class="co">#&gt; Step 4           0, 1  1.0000000 0.31731051</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Alternative hypothesis: two.sided </span></span>
<span><span class="co">#&gt; NOEC: 5 </span></span>
<span><span class="co">#&gt; LOEC: 10</span></span></code></pre></div>
<p><strong>Visualize the tank effects</strong></p>
<p><img src="Quantal-Data_files/figure-html/unnamed-chunk-12-1.png" width="700"><img src="Quantal-Data_files/figure-html/unnamed-chunk-12-2.png" width="700"><img src="Quantal-Data_files/figure-html/unnamed-chunk-12-3.png" width="700"><img src="Quantal-Data_files/figure-html/unnamed-chunk-12-4.png" width="700"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Arrange all plots in a grid </span></span>
<span><span class="co"># Requires gridExtra package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gridExtra</span><span class="op">)</span></span>
<span><span class="va">combined_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, <span class="va">p3</span>, <span class="va">p4</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="st">"binomial_tank_effects_visualization.png"</span>, <span class="va">combined_plot</span>, width <span class="op">=</span> <span class="fl">12</span>, height <span class="op">=</span> <span class="fl">10</span>, dpi <span class="op">=</span> <span class="fl">300</span><span class="op">)</span></span></code></pre></div>
<p><img src="..%2Fassets%2Fbinomial_tank_effects_visualization.png"><!-- --></p>
<p>The plot on the upper left shows the survival proportions for each
tank (colored points) at each dose level. The black diamonds represent
the mean survival proportion at each dose level, and the dashed line
shows the theoretical dose-response relationship without tank effects.
The variation among tanks at the same dose level illustrates the tank
effect.</p>
<p>The plot on the upper right shows the dispersion factor (<span class="math inline">\(\phi\)</span>) at each dose level, calculated as
the ratio of observed variance to expected binomial variance. Values
greater than 1 indicate overdispersion. The red dashed line at <span class="math inline">\(\phi\)</span> = 1 represents what would be
expected under a pure binomial model with no tank effects.</p>
<p>The plot on the bottom left compares the expected variance under a
binomial model (green bars) with the observed variance (orange bars) at
each dose level. The difference between these values demonstrates the
additional variance introduced by the tank effects.</p>
<p>The plot on the bottom right shows the actual random effects assigned
to each tank in the simulation. Positive values increase survival
probability, while negative values decrease it. This visualization helps
understand how tank-specific conditions can influence the results.</p>
<p>From this plot, we can see even at the same dose level, there’s
considerable variation in survival proportions between tanks, which
wouldn’t be expected under a simple binomial model. The dispersion
factors (<span class="math inline">\(\phi\)</span>) are consistently
greater than 1, indicating overdispersion that should be accounted for
in the analysis. The observed variance is higher than what would be
expected under a binomial model, particularly at intermediate dose
levels where the binomial variance is naturally highest. The standard
Cochran-Armitage test produces a smaller p-value than the Rao-Scott
corrected version, potentially leading to different conclusions about
the significance of the dose-response relationship.</p>
<p>This example demonstrates why the Rao-Scott correction is important
when analyzing clustered binomial data. Without accounting for the
overdispersion caused by tank effects, the standard analysis would
<strong>underestimate the uncertainty</strong> in the results and
potentially lead to overly confident (and incorrect) conclusions about
the dose-response relationship.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run the Cochran-Armitage tests for comparison</span></span>
<span><span class="co"># Using the dose-level aggregated data (incorrect approach that ignores clustering)</span></span>
<span><span class="va">ca_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cochranArmitageTrendTest.html">cochranArmitageTrendTest</a></span><span class="op">(</span></span>
<span>  successes <span class="op">=</span> <span class="va">dose_summary</span><span class="op">$</span><span class="va">total_successes</span>,</span>
<span>  totals <span class="op">=</span> <span class="va">dose_summary</span><span class="op">$</span><span class="va">total_organisms</span>,</span>
<span>  doses <span class="op">=</span> <span class="va">dose_summary</span><span class="op">$</span><span class="va">dose</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># With Rao-Scott correction</span></span>
<span><span class="va">ca_test_rs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cochranArmitageTrendTest.html">cochranArmitageTrendTest</a></span><span class="op">(</span></span>
<span>  successes <span class="op">=</span> <span class="va">dose_summary</span><span class="op">$</span><span class="va">total_successes</span>,</span>
<span>  totals <span class="op">=</span> <span class="va">dose_summary</span><span class="op">$</span><span class="va">total_organisms</span>,</span>
<span>  doses <span class="op">=</span> <span class="va">dose_summary</span><span class="op">$</span><span class="va">dose</span>,</span>
<span>  rao_scott <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nStandard Cochran-Armitage Test:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Standard Cochran-Armitage Test:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">ca_test</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Cochran-Armitage test for trend</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data:  proportions 0.867, 0.967, 0.767, 0.533, 0.033 at doses 0, 1, 2, 5, 10</span></span>
<span><span class="co">#&gt; = -8.3049, p-value &lt; 2.2e-16</span></span>
<span><span class="co">#&gt; alternative hypothesis: two.sided</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nRao-Scott Corrected Cochran-Armitage Test:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Rao-Scott Corrected Cochran-Armitage Test:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">ca_test_rs</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Rao-Scott corrected Cochran-Armitage test for trend</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data:  proportions 0.867, 0.967, 0.767, 0.533, 0.033 at doses 0, 1, 2, 5, 10</span></span>
<span><span class="co">#&gt; = -1.9646, p-value = 0.04947</span></span>
<span><span class="co">#&gt; alternative hypothesis: two.sided</span></span>
<span></span>
<span><span class="co"># Calculate the estimated dispersion parameter</span></span>
<span><span class="va">phi_est</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">dose_summary</span><span class="op">$</span><span class="va">overdispersion</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nEstimated overall dispersion parameter:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">phi_est</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Estimated overall dispersion parameter: 3.77</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="modelling-approaches">Modelling Approaches<a class="anchor" aria-label="anchor" href="#modelling-approaches"></a>
</h2>
<p>Instead of these nonparametric tests (with options for clustered
binary and multinomial data), regression modelling using test
concentration as categorical variable can also be applied. We will fill
in this section in future.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Zhenglei Gao, Sean Ryan.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
