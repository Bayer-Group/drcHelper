<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>RSCABS • drcHelper</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="../deps/MathJax-3.2.2/tex-chtml.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="RSCABS">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">drcHelper</a>

    <small class="nav-text text-default me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-getting-started" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Getting Started</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-getting-started">
<li><a class="dropdown-item" href="../articles/Introduction.html">Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/Example_Analysis_Workflow.html">Example Analysis Workflow</a></li>
    <li><a class="dropdown-item" href="../articles/drcHelper.html">Example Helper Functions Usage</a></li>
    <li><a class="dropdown-item" href="../articles/Examples_drc.html">Using DRC and BMD</a></li>
    <li><a class="dropdown-item" href="../articles/Examples_oecd201.html">Example DRC - OECD 201</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-regulatory-stats" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Regulatory Stats</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-regulatory-stats">
<li><a class="dropdown-item" href="../articles/NOEC_Methods.html">NOEC Calculations</a></li>
    <li><a class="dropdown-item" href="../articles/Limit-Test.html">Limit Test Calculations</a></li>
    <li><a class="dropdown-item" href="../articles/EFSA-Criteria.html">EFSA Criteria and Other Reliability Criteria</a></li>
    <li><a class="dropdown-item" href="../articles/Example_RSCABS.html">RSCABS</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Quantal-Data.html">Quantal Data</a></li>
    <li><a class="dropdown-item" href="../articles/Ordinal-Data.html">Ordinal Data</a></li>
    <li><a class="dropdown-item" href="../articles/Examples%20using%20NLS.html">NLS</a></li>
    <li><a class="dropdown-item" href="../articles/Examples_using_drda.html">drda</a></li>
    <li><a class="dropdown-item" href="../articles/TSK_method.html">TSK method</a></li>
    <li><a class="dropdown-item" href="../articles/MQJT.html">MQJT</a></li>
    <li><a class="dropdown-item" href="../articles/Advanced_Fitting-a-biphasic-dose-reponse-model.html">Fitting A biphasic dose response model</a></li>
    <li><a class="dropdown-item" href="../articles/Count_Data.html">Count Data</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-validation" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Validation</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-validation">
<li><a class="dropdown-item" href="../articles/System_Testing.html">System Testing</a></li>
    <li><a class="dropdown-item" href="../articles/Test-Guidelines.html">Study Types and Templates</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Bayer-Group/drcHelper/issues/new?template=Blank+issue" aria-label="New Issue"><span class="fa fa-bug"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Bayer-Group/drcHelper" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>RSCABS</h1>
                        <h4 data-toc-skip class="author">Zhenglei
Gao</h4>
            
            <h4 data-toc-skip class="date">2023-04-11</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/Bayer-Group/drcHelper/blob/main/vignettes/articles/Example_RSCABS.Rmd" class="external-link"><code>vignettes/articles/Example_RSCABS.Rmd</code></a></small>
      <div class="d-none name"><code>Example_RSCABS.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="rscabs">RSCABS<a class="anchor" aria-label="anchor" href="#rscabs"></a>
</h2>
<p>RSCABS (Rao-Scott Cochran-Armitage by slice) is designed to analyze
histopathological results from standard toxicology experiments, for
example the MEOGRT.</p>
<p>Steps in the testing procedure:</p>
<p>1.The Cochran-Armitage (CA) trend test was used to test a set of
organisms for an increase in the presences (score <span class="math inline">\(&gt;\)</span> 0) or absence (score = 0) of an
effect with an increase in the dose concentration of the treatments. 2.
The Rao-Scott (RS) adjustment controls for the similarity in each
experiment unit / apparatus (<em>e.g.</em>, fish tank) by calculating an
adjustment to the CA test statistic from correlation of organisms within
each apparatuses. 3. The by slices (BS) part allows for testing at each
severity score (<em>e.g.</em>, from 1 to 5) instead of just presences or
absence. By slices works by splitting the severity scores associated
with an endpoint into <strong>two</strong> groups based on the severity
score being tested. The RSCA test statistic is calculated based on these
two groups. 4. Carry out a step-down procedure by excluding the highest
treatment level in the analysis and recalculate the RSCA test statistic
until the test stats is not significant or there is only control group
left.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bayer-group.github.io/drcHelper/index.html">drcHelper</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span></code></pre></div>
<ul>
<li>Take the subset of F2-females with 16 weeks of age, run RSCABS.</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"exampleHistData"</span><span class="op">)</span></span>
<span><span class="va">exampleHistData</span> <span class="op">&lt;-</span> <span class="va">exampleHistData</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="va">as_tibble</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html" class="external-link">where</a></span><span class="op">(</span><span class="va">is.integer</span><span class="op">)</span>,<span class="va">as.numeric</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span>
<span><span class="co">#Take the subset corresponding to F0-females of 16 weeks of age</span></span>
<span></span>
<span><span class="va">subIndex</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">exampleHistData</span><span class="op">$</span><span class="va">Generation</span><span class="op">==</span><span class="st">'F2'</span> <span class="op">&amp;</span></span>
<span>                  <span class="va">exampleHistData</span><span class="op">$</span><span class="va">Genotypic_Sex</span><span class="op">==</span><span class="st">'Female'</span> <span class="op">&amp;</span></span>
<span>                  <span class="va">exampleHistData</span><span class="op">$</span><span class="va">Age</span><span class="op">==</span><span class="st">'16_wk'</span> <span class="op">)</span></span>
<span><span class="va">exampleHistData.Sub</span><span class="op">&lt;-</span><span class="va">exampleHistData</span><span class="op">[</span><span class="va">subIndex</span>, <span class="op">]</span></span>
<span><span class="co">#Run RSCABS</span></span>
<span><span class="va">exampleResults</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/runRSCABS.html">runRSCABS</a></span><span class="op">(</span><span class="va">exampleHistData.Sub</span>,<span class="st">'Treatment'</span>,</span>
<span>                          <span class="st">'Replicate'</span>,test.type<span class="op">=</span><span class="st">'RS'</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">exampleResults</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">.</span>,digits<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="36%">
<col width="14%">
<col width="11%">
<col width="14%">
<col width="11%">
<col width="10%">
</colgroup>
<thead><tr class="header">
<th align="left">Effect</th>
<th align="right">Treatment</th>
<th align="right">R.Score</th>
<th align="right">Statistic</th>
<th align="right">P.Value</th>
<th align="left">Signif</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Gon_Incr_Oocyte_Atresia1</td>
<td align="right">5</td>
<td align="right">1</td>
<td align="right">1.330</td>
<td align="right">0.092</td>
<td align="left">.</td>
</tr>
<tr class="even">
<td align="left">Gon_Incr_Oocyte_Atresia2</td>
<td align="right">5</td>
<td align="right">2</td>
<td align="right">1.231</td>
<td align="right">0.109</td>
<td align="left">.</td>
</tr>
<tr class="odd">
<td align="left">Gon_Incr_Oocyte_Atresia3</td>
<td align="right">5</td>
<td align="right">3</td>
<td align="right">1.231</td>
<td align="right">0.109</td>
<td align="left">.</td>
</tr>
<tr class="even">
<td align="left">Gon_Incr_Oocyte_Atresia4</td>
<td align="right">5</td>
<td align="right">4</td>
<td align="right">1.231</td>
<td align="right">0.109</td>
<td align="left">.</td>
</tr>
<tr class="odd">
<td align="left">Gon_Proteinaceous_fluid1</td>
<td align="right">5</td>
<td align="right">1</td>
<td align="right">-1.410</td>
<td align="right">0.079</td>
<td align="left">.</td>
</tr>
<tr class="even">
<td align="left">Gon_Asynch_Dev1</td>
<td align="right">5</td>
<td align="right">1</td>
<td align="right">2.622</td>
<td align="right">0.004</td>
<td align="left">**</td>
</tr>
<tr class="odd">
<td align="left">Gon_Asynch_Dev2</td>
<td align="right">5</td>
<td align="right">2</td>
<td align="right">2.622</td>
<td align="right">0.004</td>
<td align="left">**</td>
</tr>
<tr class="even">
<td align="left">Kid_Tub_Mineralization1</td>
<td align="right">5</td>
<td align="right">1</td>
<td align="right">0.358</td>
<td align="right">0.360</td>
<td align="left">.</td>
</tr>
<tr class="odd">
<td align="left">Kid_Tub_Mineralization2</td>
<td align="right">5</td>
<td align="right">2</td>
<td align="right">-0.070</td>
<td align="right">0.472</td>
<td align="left">.</td>
</tr>
<tr class="even">
<td align="left">Kid_Tub_Dilation1</td>
<td align="right">5</td>
<td align="right">1</td>
<td align="right">-0.070</td>
<td align="right">0.472</td>
<td align="left">.</td>
</tr>
<tr class="odd">
<td align="left">Kid_Tub_Dilation2</td>
<td align="right">5</td>
<td align="right">2</td>
<td align="right">-0.049</td>
<td align="right">0.480</td>
<td align="left">.</td>
</tr>
<tr class="even">
<td align="left">Kid_Tub_Regeneration1</td>
<td align="right">5</td>
<td align="right">1</td>
<td align="right">-1.375</td>
<td align="right">0.085</td>
<td align="left">.</td>
</tr>
</tbody>
</table>
<p>Note that the R.score in the table only shows the scores occured in
the respective treatment groups.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">exampleHistData.Sub</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Treatment</span>,fill<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">Gon_Asynch_Dev</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_d</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title<span class="op">=</span><span class="st">"Example Data: Gon_Asynch_Dev"</span>,subtitle <span class="op">=</span> <span class="st">"subset: F2 generation, 16 week age and female"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Example_RSCABS_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">cids</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">exampleHistData.Sub</span><span class="op">[</span>,<span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span><span class="op">]</span>,<span class="fl">2</span>,<span class="va">max</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">responses</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cids</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">exampleHistData.Sub</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="fl">5</span><span class="op">+</span><span class="va">cids</span><span class="op">)</span><span class="op">]</span><span class="op"><a href="../reference/pipe.html">%&gt;%</a></span><span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>,values_to <span class="op">=</span> <span class="st">"Response"</span>,names_to <span class="op">=</span> <span class="st">"Endpoint"</span><span class="op">)</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Treatment</span>,fill<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">Response</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_d</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title<span class="op">=</span><span class="st">"Example Histopath Data"</span>,subtitle <span class="op">=</span> <span class="st">"subset: F2 generation, 15 week age and female"</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">Endpoint</span><span class="op">)</span></span></code></pre></div>
<p><img src="Example_RSCABS_files/figure-html/unnamed-chunk-4-2.png" width="700"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://scales.r-lib.org" class="external-link">scales</a></span><span class="op">)</span></span>
<span><span class="va">dat1</span> <span class="op">&lt;-</span> <span class="va">exampleHistData.Sub</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="fl">5</span><span class="op">+</span><span class="va">cids</span><span class="op">)</span><span class="op">]</span><span class="op"><a href="../reference/pipe.html">%&gt;%</a></span><span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>,values_to <span class="op">=</span> <span class="st">"Response"</span>,names_to <span class="op">=</span> <span class="st">"Endpoint"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Endpoint</span>,<span class="va">Treatment</span>,<span class="va">Response</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>counts<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Endpoint</span>,<span class="va">Treatment</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>total<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">counts</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">dat1</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Treatment</span>,fill<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">Response</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">counts</span><span class="op">/</span><span class="va">total</span><span class="op">)</span>,stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_d</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title<span class="op">=</span><span class="st">"Example Histopath Data"</span>,subtitle <span class="op">=</span> <span class="st">"subset: F2 generation, 15 week age and female"</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">Endpoint</span>,drop <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="va">percent</span><span class="op">)</span></span></code></pre></div>
<p><img src="Example_RSCABS_files/figure-html/unnamed-chunk-4-3.png" width="700">
## Using R’s prop.test instead</p>
</div>
<div class="section level2">
<h2 id="alternative-nonparametric-tests">Alternative Nonparametric Tests<a class="anchor" aria-label="anchor" href="#alternative-nonparametric-tests"></a>
</h2>
<p>The example below is taken from Hothorn’s paper.
<code>independence_test</code> function from the <code>coin</code>
package can be used to test the independence of two sets of variables
measured on arbitrary scales. Transformations can be done via
<code>trafo</code> so that various test statsitcs can be calculated,
including Pearson <span class="math inline">\(\chi^2\)</span> test, the
generalized Cochran-Mantel-Haenszel test, the Spearman correlation test,
the Fisher-Pitman permutation test, the Wilcoxon-Mann-Whitney test, the
Kruskal-Wallis test and the family of weighted logrank tests for
censored data.</p>
<p>However, the Williams’ contrast is not the same as Williams’ test,
just like in multcomp package.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ifcoin</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="http://coin.r-forge.r-project.org" class="external-link">coin</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">exampleHistData</span><span class="op">)</span></span>
<span><span class="va">subIndex</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">exampleHistData</span><span class="op">$</span><span class="va">Generation</span><span class="op">==</span><span class="st">"F1"</span> <span class="op">&amp;</span></span>
<span><span class="va">exampleHistData</span><span class="op">$</span><span class="va">Genotypic_Sex</span><span class="op">==</span><span class="st">"Male"</span> <span class="op">&amp;</span></span>
<span><span class="va">exampleHistData</span><span class="op">$</span><span class="va">Age</span><span class="op">==</span><span class="st">"8_wk"</span><span class="op">)</span></span>
<span><span class="va">LH</span><span class="op">&lt;-</span><span class="va">exampleHistData</span><span class="op">[</span><span class="va">subIndex</span>, <span class="op">]</span></span>
<span><span class="va">lh</span><span class="op">&lt;-</span><span class="va">LH</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">6</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">lh</span><span class="op">$</span><span class="va">Gon</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">lh</span><span class="op">$</span><span class="va">Gon_Phenotype</span><span class="op">)</span></span>
<span><span class="va">lh</span><span class="op">$</span><span class="va">EP1</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">lh</span><span class="op">$</span><span class="va">Gon</span> <span class="op">&gt;</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">lh</span><span class="op">$</span><span class="va">EP2</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">lh</span><span class="op">$</span><span class="va">Gon</span> <span class="op">&gt;</span><span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">lh</span><span class="op">$</span><span class="va">EP3</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">lh</span><span class="op">$</span><span class="va">Gon</span> <span class="op">&gt;</span><span class="fl">3</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">lh</span><span class="op">$</span><span class="va">treat</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">lh</span><span class="op">$</span><span class="va">Treatment</span><span class="op">)</span></span>
<span><span class="va">lhh</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="va">lh</span><span class="op">[</span><span class="va">lh</span><span class="op">$</span><span class="va">treat</span><span class="op">!=</span><span class="fl">6</span>, <span class="op">]</span><span class="op">)</span></span>
<span><span class="va">Lhh</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="va">lhh</span><span class="op">[</span><span class="va">lhh</span><span class="op">$</span><span class="va">treat</span><span class="op">!=</span><span class="fl">3</span>, <span class="op">]</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="http://coin.r-forge.r-project.org" class="external-link">"coin"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="http://multcomp.R-forge.R-project.org" class="external-link">"multcomp"</a></span><span class="op">)</span></span>
<span><span class="va">Co1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="fu">trafo</span><span class="op">(</span><span class="va">data</span>, factor_trafo <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="op">~</span><span class="va">x</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/multcomp/man/contrMat.html" class="external-link">contrMat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="st">"Dunnett"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Codu</span> <span class="op">&lt;-</span><span class="fu">independence_test</span><span class="op">(</span><span class="va">EP1</span> <span class="op">+</span><span class="va">EP2</span><span class="op">+</span><span class="va">EP3</span><span class="op">~</span> <span class="va">treat</span>, data <span class="op">=</span> <span class="va">Lhh</span>, teststat <span class="op">=</span> <span class="st">"maximum"</span>,</span>
<span>distribution <span class="op">=</span> <span class="st">"approximate"</span>, xtrafo<span class="op">=</span><span class="va">Co1</span>, alternative<span class="op">=</span><span class="st">"greater"</span><span class="op">)</span></span>
<span><span class="va">pvalCODU</span> <span class="op">&lt;-</span><span class="fu"><a href="https://scales.r-lib.org/reference/pvalue_format.html" class="external-link">pvalue</a></span><span class="op">(</span><span class="va">Codu</span>, method<span class="op">=</span><span class="st">"single-step"</span><span class="op">)</span></span>
<span><span class="va">pvalCODU</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CoW</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="fu">trafo</span><span class="op">(</span><span class="va">data</span>, factor_trafo <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="op">~</span><span class="va">x</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/multcomp/man/contrMat.html" class="external-link">contrMat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="st">"Williams"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Cowi</span> <span class="op">&lt;-</span><span class="fu">independence_test</span><span class="op">(</span><span class="va">EP1</span> <span class="op">+</span><span class="va">EP2</span><span class="op">+</span><span class="va">EP3</span><span class="op">~</span> <span class="va">treat</span>, data <span class="op">=</span> <span class="va">Lhh</span>, teststat <span class="op">=</span> <span class="st">"maximum"</span>,</span>
<span>distribution <span class="op">=</span> <span class="st">"approximate"</span>, xtrafo<span class="op">=</span><span class="va">CoW</span>, alternative<span class="op">=</span><span class="st">"greater"</span><span class="op">)</span></span>
<span><span class="va">pvalCOWI</span> <span class="op">&lt;-</span><span class="fu"><a href="https://scales.r-lib.org/reference/pvalue_format.html" class="external-link">pvalue</a></span><span class="op">(</span><span class="va">Cowi</span>, method<span class="op">=</span><span class="st">"single-step"</span><span class="op">)</span></span>
<span><span class="va">pvalCOWI</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="multi-quantile-jt">Multi-quantile JT<a class="anchor" aria-label="anchor" href="#multi-quantile-jt"></a>
</h2>
<p>From: John Green, personal communication.</p>
</div>
<div class="section level2">
<h2 id="function-notes">Function Notes<a class="anchor" aria-label="anchor" href="#function-notes"></a>
</h2>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">DependenciesGraphs</span><span class="op">)</span></span>
<span><span class="va">dep</span> <span class="op">&lt;-</span> <span class="fu">funDependencies</span><span class="op">(</span><span class="st">"package:drcHelper"</span>, <span class="st">"runRSCABS"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># visualization</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">dep</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="notes-on-rscabs-functions">Notes on RSCABS functions<a class="anchor" aria-label="anchor" href="#notes-on-rscabs-functions"></a>
</h3>
<ol style="list-style-type: decimal">
<li>Select responses maximum value should be &gt; 0 and smaller than 20
(limited ranks in response).</li>
<li>for each to be tested response/endpoints,
<em>convert2score</em>
</li>
<li>for each to be tested response/endpoints, <em>prepDataRSCABS</em>,
prepare the data into matrix/table format, treatment as column,
replicate as row</li>
<li>for each to be tested response/endpoints, <em>stepKRSCABS</em>.</li>
</ol>
<p>The results look like below:</p>
<pre><code>$Gon_Asynch_Dev
           Effect Treatment R.Score Statistic     P.Value Signif
1 Gon_Asynch_Dev1         5       1  2.622022 0.004370488     **
2 Gon_Asynch_Dev1         4       1       NaN 1.000000000      .
3 Gon_Asynch_Dev1         4       1       NaN 1.000000000      .
4 Gon_Asynch_Dev2         5       2  2.622022 0.004370488     **
5 Gon_Asynch_Dev2         4       2       NaN 1.000000000      .
6 Gon_Asynch_Dev2         4       2       NaN 1.000000000      .</code></pre>
<ol start="5" style="list-style-type: decimal">
<li>combine the results into a big matrix.</li>
</ol>
</div>
</div>
<div class="section level2">
<h2 id="validation-by-sas">Validation by SAS<a class="anchor" aria-label="anchor" href="#validation-by-sas"></a>
</h2>
<p>The RSCABS code in R written by is validated in SAS by Chen Meng and
also against the RSCABS procedure in the archived statCharrms
package.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ul>
<li><p>Green, John W. and Springer, Timothy A. and Saulnier, Amy N. and
Swintek, Joe, (2014) Statistical analysis of histopathological
endpoints. Environmental Toxicology and Chemistry, 33(5),
1108-1116</p></li>
<li><p>Hothorn, T., Hornik, K., van de Wiel, M. A. and Zeileis, A.
(2008). Implementing a class of permutation tests: The coin package.
Journal of Statistical Software 28(8), 1–23. doi:
10.18637/jss.v028.i08</p></li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Zhenglei Gao, Sean Ryan.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
