<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>RSCABS • drcHelper</title>
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="RSCABS">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">drcHelper</a>

    <small class="nav-text text-default me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.0.4.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-get-started" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Get Started</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-get-started">
<li><a class="dropdown-item" href="../articles/Introduction.html">Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/Example_Analysis_Workflow.html">Example Analysis Workflow</a></li>
    <li><a class="dropdown-item" href="../articles/drcHelper.html">Example ECx Helper Functions Usage</a></li>
    <li><a class="dropdown-item" href="../articles/Dunnetts_Test_for_Data_with_Hierarchical_Structure.html">Example NOEC Helper Functions Usage</a></li>
    <li><a class="dropdown-item" href="../articles/Examples_drc.html">Using DRC and BMD</a></li>
    <li><a class="dropdown-item" href="../articles/Examples_oecd201.html">Example DRC - OECD 201</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-regulatory-stats" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Regulatory Stats</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-regulatory-stats">
<li><a class="dropdown-item" href="../articles/NOEC_Methods.html">NOEC Calculations</a></li>
    <li><a class="dropdown-item" href="../articles/Limit-Test.html">Limit Test Calculations</a></li>
    <li><a class="dropdown-item" href="../articles/EFSA-Criteria.html">EFSA Criteria and Other Reliability Criteria</a></li>
    <li><a class="dropdown-item" href="../articles/Example_RSCABS.html">RSCABS</a></li>
    <li><a class="dropdown-item" href="../articles/Trend-Testing.html">Trend Testing</a></li>
    <li><a class="dropdown-item" href="../articles/NOEC_ECx_BMD.html">NOEC ECx and BMD</a></li>
  </ul>
</li>
<li class="nav-item"><h6 class="dropdown-header" data-toc-skip>Articles</h6></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-validation" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Validation</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-validation">
<li><a class="dropdown-item" href="../articles/System_Testing.html">System Testing</a></li>
    <li><a class="dropdown-item" href="../articles/val_ED_plus.html">ED Calculation Consistency</a></li>
    <li><a class="dropdown-item" href="../articles/TSK-and-Probit-Models.html">TSK and Probit Model</a></li>
    <li><a class="dropdown-item" href="../articles/Verification_which_JT.html">Which JT test to use</a></li>
    <li><a class="dropdown-item" href="../articles/Test-Guidelines.html">Study Types and Templates</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Bayer-Group/drcHelper/issues/new?template=Blank+issue" aria-label="New Issue"><span class="fa fa-bug"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Bayer-Group/drcHelper" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>RSCABS</h1>
                        <h4 data-toc-skip class="author">Zhenglei
Gao</h4>
            
            <h4 data-toc-skip class="date">2023-04-11</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/Bayer-Group/drcHelper/blob/main/vignettes/articles/Example_RSCABS.Rmd" class="external-link"><code>vignettes/articles/Example_RSCABS.Rmd</code></a></small>
      <div class="d-none name"><code>Example_RSCABS.Rmd</code></div>
    </div>

    
    
<p>In this article we illustrate how to conduct an RSCABS test and
compare results using the relevant RSCABS functions in this package and
those from the implementation in the archived package RSCABS. The steps
behind the RSCABS test are decsribed and explained.</p>
<div class="section level2">
<h2 id="example-usage-of-the-rscabs-functions-in-drchelper">Example Usage of the RSCABS functions in drcHelper<a class="anchor" aria-label="anchor" href="#example-usage-of-the-rscabs-functions-in-drchelper"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bayer-group.github.io/drcHelper/index.html">drcHelper</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span></code></pre></div>
<p>The function in <em>drcHelper</em> is <code>run_threshold_RSCA</code>
and <code>run_all_threshold_tests</code>. The latter performs the
Rao-Scott adjusted Cochran-Armitage trend test by slices (for multiple
injury thresholds) and providing a comprehensive analysis of
dose-response relationships at different severity levels. It also
outputs an invisible components including all the detailed interim
results for each tested threshold level. A step-down procedure can be
performed using <code>step_down_RSCABS</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example data with increasing trend in injury rates</span></span>
<span><span class="co"># Create the simulated fish data</span></span>
<span><span class="va">sim_data_1</span><span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  treatment <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Control"</span>, <span class="fl">8</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Low"</span>, <span class="fl">4</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Medium"</span>, <span class="fl">4</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"High"</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  tank <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"C"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"L"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"M"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"H"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  S0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  S1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>  S2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  S3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  total <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">4</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Ensure treatment is an ordered factor for proper plotting</span></span>
<span><span class="va">sim_data_1</span><span class="op">$</span><span class="va">treatment</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">sim_data_1</span><span class="op">$</span><span class="va">treatment</span>,</span>
<span>                                        levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Control"</span>, <span class="st">"Low"</span>, <span class="st">"Medium"</span>, <span class="st">"High"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Run two-sided test</span></span>
<span><span class="va">two_sided_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_threshold_RSCA.html">run_threshold_RSCA</a></span><span class="op">(</span><span class="va">sim_data_1</span>, threshold <span class="op">=</span> <span class="fl">2</span>,treatment_col <span class="op">=</span> <span class="st">"treatment"</span>,replicate_col <span class="op">=</span> <span class="st">"tank"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Two-sided p-value:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">two_sided_result</span><span class="op">$</span><span class="va">p_value</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Two-sided p-value: 0.0307"</span></span>
<span></span>
<span><span class="co"># Run one-sided test (greater)</span></span>
<span><span class="va">greater_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_threshold_RSCA.html">run_threshold_RSCA</a></span><span class="op">(</span><span class="va">sim_data_1</span>, threshold <span class="op">=</span> <span class="fl">2</span>, alternative <span class="op">=</span> <span class="st">"greater"</span>,treatment_col <span class="op">=</span> <span class="st">"treatment"</span>,replicate_col <span class="op">=</span> <span class="st">"tank"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"One-sided (greater) p-value:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">greater_result</span><span class="op">$</span><span class="va">p_value</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "One-sided (greater) p-value: 0.0153"</span></span>
<span></span>
<span><span class="co"># Run one-sided test (less)</span></span>
<span><span class="va">less_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_threshold_RSCA.html">run_threshold_RSCA</a></span><span class="op">(</span><span class="va">sim_data_1</span>, threshold <span class="op">=</span> <span class="fl">1</span>, alternative <span class="op">=</span> <span class="st">"less"</span>,treatment_col <span class="op">=</span> <span class="st">"treatment"</span>,replicate_col <span class="op">=</span> <span class="st">"tank"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"One-sided (less) p-value:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">less_result</span><span class="op">$</span><span class="va">p_value</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="co">#&gt; [1] "One-sided (less) p-value: 0.8276"</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/run_all_threshold_tests.html">run_all_threshold_tests</a></span><span class="op">(</span><span class="va">sim_data_1</span>,min_score <span class="op">=</span> <span class="fl">0</span>,max_score <span class="op">=</span> <span class="fl">2</span>,direction<span class="op">=</span><span class="st">"less"</span>,alternative <span class="op">=</span><span class="st">"less"</span>,treatment_col <span class="op">=</span> <span class="st">"treatment"</span>,replicate_col <span class="op">=</span> <span class="st">"tank"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; result table: </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Threshold Z_statistic    P_value Has_zero_counts Alternative      Method</span></span>
<span><span class="co">#&gt; 1       S≤0  -0.9445781 0.17243715           FALSE        less RSCA (less)</span></span>
<span><span class="co">#&gt; 2       S≤1  -2.1613671 0.01533349           FALSE        less RSCA (less)</span></span>
<span><span class="co">#&gt; 3       S≤2          NA         NA           FALSE        less RSCA (less)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Summarized Proportions: </span></span>
<span><span class="co">#&gt;   Treatment    S≤0    S≤1     S≤2</span></span>
<span><span class="co">#&gt; 1   Control 0.6250 0.9375 0.96875</span></span>
<span><span class="co">#&gt; 2       Low 0.7500 0.9375 1.00000</span></span>
<span><span class="co">#&gt; 3    Medium 0.5625 0.7500 0.93750</span></span>
<span><span class="co">#&gt; 4      High 0.5000 0.7500 0.87500</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Alternative Hypothesis: </span></span>
<span><span class="co">#&gt; [1] "less"</span></span>
<span><span class="fu"><a href="../reference/run_all_threshold_tests.html">run_all_threshold_tests</a></span><span class="op">(</span><span class="va">sim_data_1</span>,min_score <span class="op">=</span> <span class="fl">1</span>,max_score <span class="op">=</span> <span class="fl">3</span>,direction<span class="op">=</span><span class="st">"greater"</span>,alternative <span class="op">=</span><span class="st">"greater"</span>,treatment_col <span class="op">=</span> <span class="st">"treatment"</span>,replicate_col <span class="op">=</span> <span class="st">"tank"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; result table: </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Threshold Z_statistic    P_value Has_zero_counts Alternative</span></span>
<span><span class="co">#&gt; 1       S1+   0.9445781 0.17243715           FALSE     greater</span></span>
<span><span class="co">#&gt; 2       S2+   2.1613671 0.01533349           FALSE     greater</span></span>
<span><span class="co">#&gt; 3       S3+          NA 0.52574008            TRUE     greater</span></span>
<span><span class="co">#&gt;                          Method</span></span>
<span><span class="co">#&gt; 1                RSCA (greater)</span></span>
<span><span class="co">#&gt; 2                RSCA (greater)</span></span>
<span><span class="co">#&gt; 3 Fisher's Exact Test (greater)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Summarized Proportions: </span></span>
<span><span class="co">#&gt;   Treatment    S1+    S2+     S3+</span></span>
<span><span class="co">#&gt; 1   Control 0.3750 0.0625 0.03125</span></span>
<span><span class="co">#&gt; 2       Low 0.2500 0.0625 0.00000</span></span>
<span><span class="co">#&gt; 3    Medium 0.4375 0.2500 0.06250</span></span>
<span><span class="co">#&gt; 4      High 0.5000 0.2500 0.12500</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Alternative Hypothesis: </span></span>
<span><span class="co">#&gt; [1] "greater"</span></span>
<span><span class="fu"><a href="../reference/run_all_threshold_tests.html">run_all_threshold_tests</a></span><span class="op">(</span><span class="va">sim_data_1</span><span class="op"><a href="../reference/pipe.html">%&gt;%</a></span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">treatment</span><span class="op">!=</span><span class="st">"High"</span><span class="op">)</span><span class="op"><a href="../reference/pipe.html">%&gt;%</a></span><span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>,min_score <span class="op">=</span> <span class="fl">1</span>,max_score <span class="op">=</span> <span class="fl">3</span>,direction<span class="op">=</span><span class="st">"greater"</span>,alternative <span class="op">=</span><span class="st">"greater"</span>,treatment_col <span class="op">=</span> <span class="st">"treatment"</span>,replicate_col <span class="op">=</span> <span class="st">"tank"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; result table: </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Threshold Z_statistic   P_value Has_zero_counts Alternative</span></span>
<span><span class="co">#&gt; 1       S1+   0.2356454 0.4068539           FALSE     greater</span></span>
<span><span class="co">#&gt; 2       S2+   1.8130002 0.0349159           FALSE     greater</span></span>
<span><span class="co">#&gt; 3       S3+          NA 1.0000000            TRUE     greater</span></span>
<span><span class="co">#&gt;                          Method</span></span>
<span><span class="co">#&gt; 1                RSCA (greater)</span></span>
<span><span class="co">#&gt; 2                RSCA (greater)</span></span>
<span><span class="co">#&gt; 3 Fisher's Exact Test (greater)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Summarized Proportions: </span></span>
<span><span class="co">#&gt;   Treatment    S1+    S2+     S3+</span></span>
<span><span class="co">#&gt; 1   Control 0.3750 0.0625 0.03125</span></span>
<span><span class="co">#&gt; 2       Low 0.2500 0.0625 0.00000</span></span>
<span><span class="co">#&gt; 3    Medium 0.4375 0.2500 0.06250</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Alternative Hypothesis: </span></span>
<span><span class="co">#&gt; [1] "greater"</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run step-down procedure</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/step_down_RSCABS.html">step_down_RSCABS</a></span><span class="op">(</span></span>
<span>  <span class="va">sim_data_1</span>,</span>
<span>  treatment_col <span class="op">=</span> <span class="st">"treatment"</span>,replicate_col <span class="op">=</span> <span class="st">"tank"</span>,</span>
<span>  treatment_order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Control"</span>, <span class="st">"Low"</span>, <span class="st">"Medium"</span>, <span class="st">"High"</span><span class="op">)</span>,</span>
<span>  alternative <span class="op">=</span> <span class="st">"greater"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">result</span></span>
<span><span class="co">#&gt; Step-Down RSCABS Analysis</span></span>
<span><span class="co">#&gt; ========================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Parameters:</span></span>
<span><span class="co">#&gt;   Direction: greater </span></span>
<span><span class="co">#&gt;   Alternative hypothesis: greater </span></span>
<span><span class="co">#&gt;   Treatment levels: Control, Low, Medium, High </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Summary of findings:</span></span>
<span><span class="co">#&gt; Step 1 : Included treatments: Control, Low, Medium, High </span></span>
<span><span class="co">#&gt;   Significant thresholds: S2+ </span></span>
<span><span class="co">#&gt; Step 2 : Included treatments: Control, Low, Medium </span></span>
<span><span class="co">#&gt;   Significant thresholds: S2+ </span></span>
<span><span class="co">#&gt; Step 3 : Included treatments: Control, Low </span></span>
<span><span class="co">#&gt;   No significant findings</span></span>
<span><span class="va">summary_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">summary_result</span><span class="op">$</span><span class="va">summary_table</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Step        Included_Treatments Highest_Treatment Significant_Thresholds</span></span>
<span><span class="co">#&gt; 1    1 Control, Low, Medium, High              High                    S2+</span></span>
<span><span class="co">#&gt; 2    2       Control, Low, Medium            Medium                    S2+</span></span>
<span><span class="co">#&gt; 3    3               Control, Low               Low                   None</span></span>
<span><span class="co">#&gt;   Min_P_Value</span></span>
<span><span class="co">#&gt; 1  0.01533349</span></span>
<span><span class="co">#&gt; 2  0.03491590</span></span>
<span><span class="co">#&gt; 3          NA</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span></code></pre></div>
<p><img src="Example_RSCABS_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">result</span>,printLowest <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="co">#&gt; Step-Down RSCABS Analysis</span></span>
<span><span class="co">#&gt; ========================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Parameters:</span></span>
<span><span class="co">#&gt;   Direction: greater </span></span>
<span><span class="co">#&gt;   Alternative hypothesis: greater </span></span>
<span><span class="co">#&gt;   Treatment levels: Control, Low, Medium, High </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Summary of findings:</span></span>
<span><span class="co">#&gt; Step 1 : Included treatments: Control, Low, Medium, High </span></span>
<span><span class="co">#&gt;   Significant thresholds: S2+ </span></span>
<span><span class="co">#&gt; Step 2 : Included treatments: Control, Low, Medium </span></span>
<span><span class="co">#&gt;   Significant thresholds: S2+ </span></span>
<span><span class="co">#&gt; Step 3 : Included treatments: Control, Low </span></span>
<span><span class="co">#&gt;   No significant findings</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Lowest treatment level with significant findings:</span></span>
<span><span class="co">#&gt;   Treatment: Medium </span></span>
<span><span class="co">#&gt;   Threshold: S2+ </span></span>
<span><span class="co">#&gt;   P-value: 0.0349</span></span></code></pre></div>
<div class="section level3">
<h3 id="comparison-with-joes-implementation">Comparison with Joe’s Implementation<a class="anchor" aria-label="anchor" href="#comparison-with-joes-implementation"></a>
</h3>
<p>Note the p-values are the same for the critical treatment and score
combinations. I do think Joe’s implementation has some fault in terms of
alternative hypothesis and p-value calculation (It can return 1-p
sometimes, not sure why). But I haven’t tried to figured that out.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/convert_fish_data.html">convert_fish_data</a></span><span class="op">(</span><span class="va">sim_data_1</span>,direction<span class="op">=</span><span class="st">"to_individual"</span>,treatment_col <span class="op">=</span> <span class="st">"treatment"</span>,replicate_col <span class="op">=</span> <span class="st">"tank"</span> <span class="op">)</span></span>
<span><span class="va">dat1</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">dat1</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>score1<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">score</span><span class="op">)</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span>,score2<span class="op">=</span><span class="va">score1</span><span class="op">+</span><span class="fl">5</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">score</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="va">as.data.frame</span></span>
<span></span>
<span><span class="co">## Note runRSCABS expects more than one endpoints. </span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/runRSCABS.html">runRSCABS</a></span><span class="op">(</span><span class="va">dat1</span>,<span class="st">'treatment'</span>,<span class="st">'tank'</span>,test.type<span class="op">=</span><span class="st">'RS'</span><span class="op">)</span></span>
<span><span class="va">res</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="op">]</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Effect <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"score1"</span>,<span class="st">"S"</span>,<span class="va">Effect</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="co">#&gt;   Effect Treatment R.Score Statistic    P.Value Signif</span></span>
<span><span class="co">#&gt; 1     S1         4       1 0.9445781 0.17243715      .</span></span>
<span><span class="co">#&gt; 2     S2         4       2 2.1613671 0.01533349      *</span></span>
<span><span class="co">#&gt; 3     S2         3       2 1.8130002 0.03491590      *</span></span>
<span><span class="co">#&gt; 4     S2         2       2 0.0000000 0.50000000      .</span></span>
<span><span class="co">#&gt; 5     S3         4       3 1.4057798 0.07989476      .</span></span></code></pre></div>
<p>Note that you need to specify both direction and alternative
according to your test hypotheses. The drcHelper function provides
alternative specification by</p>
<ul>
<li><p>Two-sided test (alternative = “two.sided”): -Tests whether there
is any trend (increasing or decreasing) in the proportion of affected
fish across treatment groups - Null hypothesis (H0): No trend in
proportions - Alternative hypothesis (H1): There is a trend (either
increasing or decreasing) - P-value calculation: 2 * pnorm(-abs(Z)) -
Use when you have no prior expectation about the direction of the
effect</p></li>
<li><p>One-sided test (greater) (alternative = “greater”): - Tests
whether the proportion of affected fish increases with treatment level -
Null hypothesis (H0): No increasing trend - Alternative hypothesis (H1):
Proportion increases with treatment level - P-value calculation:
pnorm(-Z) - Use when you expect higher treatment levels to have more
affected fish</p></li>
<li>
<p>One-sided test (less) (alternative = “less”):</p>
<ul>
<li>Tests whether the proportion of affected fish decreases with
treatment level</li>
<li>Null hypothesis (H0): No decreasing trend</li>
<li>Alternative hypothesis (H1): Proportion decreases with treatment
level</li>
<li>P-value calculation: pnorm(Z)</li>
<li>Use when you expect higher treatment levels to have fewer affected
fish</li>
</ul>
</li>
</ul>
<p>In toxicology studies, alternative = “greater” in combination with
direction = “greater” is often most appropriate since higher treatment
levels are typically expected to cause more adverse effects.</p>
<p>In comparison with the conventional RSCABS test by
<code>runRSCABS</code>, the <code>run_all_threshold_tests</code>
provides:</p>
<ul>
<li>Flexible threshold direction: Supports both “greater than or equal
to” and “less than or equal to” thresholds</li>
<li>Automatic score column detection: Identifies score columns based on
naming pattern</li>
<li>Zero count handling: Provides warnings and alternative approaches
for thresholds with zero counts</li>
<li>Comprehensive results: Returns detailed information including
proportions, test statistics, and intermediate values</li>
<li>Fisher’s exact test fallback: Optionally uses Fisher’s exact test
when RSCA is not valid due to zero counts</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="visulaize-the-data">Visulaize the data<a class="anchor" aria-label="anchor" href="#visulaize-the-data"></a>
</h2>
<p><img src="Example_RSCABS_files/figure-html/unnamed-chunk-6-1.png" width="1440"></p>
<div class="section level3">
<h3 id="smmary-table-of-the-data">Smmary table of the data<a class="anchor" aria-label="anchor" href="#smmary-table-of-the-data"></a>
</h3>
<pre><code><span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 13</span></span></span>
<span><span class="co">#&gt;   treatment n_tanks total_fish s0_count s0_percent s1_count s1_percent s2_count</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Control         8         32       20       62.5       10       31.2        1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Low             4         16       12       75          3       18.8        1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Medium          4         16        9       56.2        3       18.8        3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> High            4         16        8       50          4       25          2</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 5 more variables: s2_percent &lt;dbl&gt;, s3_count &lt;dbl&gt;, s3_percent &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   any_injury &lt;dbl&gt;, any_injury_percent &lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 3</span></span></span>
<span><span class="co">#&gt;   treatment mean_severity sd_severity</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Control           0.469       0.364</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Low               0.312       0.315</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Medium            0.75        0.204</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> High              0.875       0.433</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="understanding-rscabs">Understanding RSCABS<a class="anchor" aria-label="anchor" href="#understanding-rscabs"></a>
</h2>
<p>RSCABS (Rao-Scott Cochran-Armitage by slice) is designed to analyze
histopathological results from standard toxicology experiments, for
example the MEOGRT.</p>
<p>Steps in the testing procedure:</p>
<p>1.The Cochran-Armitage (CA) trend test was used to test a set of
organisms for an increase in the presences (score <span class="math inline">\(&gt;\)</span> 0) or absence (score = 0) of an
effect with an increase in the dose concentration of the treatments.</p>
<ol start="2" style="list-style-type: decimal">
<li><p>The Rao-Scott (RS) adjustment controls for the similarity in each
experiment unit / apparatus (<em>e.g.</em>, fish tank) by calculating an
adjustment to the CA test statistic from correlation of organisms within
each apparatuses.</p></li>
<li><p>The by slices (BS) part allows for testing at each severity score
(<em>e.g.</em>, from 1 to 5) instead of just presences or absence. By
slices works by splitting the severity scores associated with an
endpoint into <strong>two</strong> groups based on the severity score
being tested. The RSCA test statistic is calculated based on these two
groups.</p></li>
<li><p>Carry out a step-down procedure by excluding the highest
treatment level in the analysis and recalculate the RSCA test statistic
until the test stats is not significant or there is only control group
left.</p></li>
</ol>
<p>Current implementation used Rao-Scott correction always, potential
inflating type-I error in slices with very low occurences. High
resolution of scoring system (many categories) could be less powerful
due to the violation of monotonicity.</p>
<p>The issue with zero or low counts in the RSCA test is a mathematical
limitation that occurs when one or more treatment group has zero
affected individuals at a particular threshold level. This leads to a
zero variance estimate for that group, then the design effect
calculation involves division by zero The Z-statistic calculation breaks
down. Possible solutions could be using alternative tests like Fisher’s
exact test or applying a continuity correction.</p>
<div class="section level3">
<h3 id="some-backgrounds">Some Backgrounds<a class="anchor" aria-label="anchor" href="#some-backgrounds"></a>
</h3>
<p>The Rao-Scott adjustment is a method to account for clustering in
binary data. Using a synthetic fish injury dataset as an example, fish
are clustered within tanks (replicates), which means observations within
the same tank may be correlated. Standard statistical tests assume
independent observations, which could lead to incorrect inference if
clustering is ignored.</p>
<p>The adjustment works by:</p>
<ol style="list-style-type: decimal">
<li>Calculating the observed variance within treatment groups,
accounting for clustering</li>
<li>Comparing this to the expected variance under a simple binomial
model</li>
<li>Computing a design effect (D) as the ratio of these variances</li>
<li>Adjusting the sample sizes and counts by dividing by D</li>
</ol>
<p><strong>What is the Cochran-Armitage Trend Test?</strong></p>
<p>The Cochran-Armitage trend test examines whether there is a linear
trend in proportions across ordered categories. In this context, it
tests whether the proportion of injured fish increases (or decreases)
systematically with treatment level.</p>
<p>The test assigns scores to treatment groups (typically 1, 2, 3, …)
and calculates a Z-statistic that measures the strength of the linear
trend.</p>
</div>
</div>
<div class="section level2">
<h2 id="example-1-synthetic-dataset">Example 1: synthetic dataset<a class="anchor" aria-label="anchor" href="#example-1-synthetic-dataset"></a>
</h2>
<p>I’ll create a simulated dataset with Control and 3 treatment groups
(T1, T2, T3), each with 4 tanks, and 6 fish per tank. The data will show
a trend where higher treatment groups have more severe injuries (higher
scores). Injury scores from S0 (no injury) to S4 (severe injury).</p>
<p>Treatment effects: - Control group has mostly healthy fish (S0) - As
treatment level increases, the proportion of higher injury scores
increases - T3 (highest treatment) has the most severe injuries</p>
<p>Variability:</p>
<ul>
<li>Small random variations in the probabilities for each tank</li>
<li>This simulates natural tank-to-tank variability within treatment
groups</li>
</ul>
<pre><code>[1] TRUE
       tmt tank total S0 S1 S2 S3 S4
1  Control   1A     6  3  2  1  0  0
2  Control   2A     6  2  3  0  1  0
3  Control   3A     6  6  0  0  0  0
4  Control   4A     6  6  0  0  0  0
5       T1   1B     6  4  1  1  0  0
6       T1   2B     6  3  3  0  0  0
7       T1   3B     6  5  1  0  0  0
8       T1   4B     6  3  3  0  0  0
9       T2   1C     6  2  1  3  0  0
10      T2   2C     6  2  3  0  1  0
11      T2   3C     6  3  2  1  0  0
12      T2   4C     6  2  1  2  1  0
13      T3   1D     6  1  1  1  2  1
14      T3   2D     6  1  2  2  1  0
15      T3   3D     6  1  1  4  0  0
16      T3   4D     6  1  1  3  1  0
[1] "Average proportion of each score by treatment:"
      tmt   S0   S1   S2   S3   S4
1 Control 0.71 0.21 0.04 0.04 0.00
2      T1 0.62 0.33 0.04 0.00 0.00
3      T2 0.38 0.29 0.25 0.08 0.00
4      T3 0.17 0.21 0.42 0.17 0.04
[1] "Average severity score by treatment:"
      tmt severity_score
1 Control      0.4166667
2      T1      0.4166667
3      T2      1.0416667
4      T3      1.7083333</code></pre>
<p><img src="Example_RSCABS_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot severity score</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">sim_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">tmt</span>, y <span class="op">=</span> <span class="va">severity_score</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html" class="external-link">geom_jitter</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.2</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Average Injury Severity by Treatment"</span>,</span>
<span>         x <span class="op">=</span> <span class="st">"Treatment Group"</span>,</span>
<span>         y <span class="op">=</span> <span class="st">"Severity Score (weighted average)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="Example_RSCABS_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>The dataset shows a clear trend of increasing injury severity across
treatment groups. This can be seen in both the distribution of scores
and the average severity score.</p>
<pre><code><span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 10</span></span></span>
<span><span class="co">#&gt;   grp         x     n     m p_hat       b       v     D n_tilde x_tilde</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Control     7    24     4 0.292 0.008<span style="text-decoration: underline;">61</span> 0.029<span style="text-decoration: underline;">5</span>   3.43       7    2.04</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> T1          9    24     4 0.375 0.009<span style="text-decoration: underline;">77</span> 0.006<span style="text-decoration: underline;">37</span>  1         24    9   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> T2         15    24     4 0.625 0.009<span style="text-decoration: underline;">77</span> 0.001<span style="text-decoration: underline;">74</span>  1         24   15   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> T3         20    24     4 0.833 0.005<span style="text-decoration: underline;">79</span> 0        1         24   20</span></span>
<span><span class="co">#&gt; [1] "Z-statistic: 3.566"</span></span>
<span><span class="co">#&gt; [1] "p-value: 4e-04"</span></span>
<span><span class="co">#&gt; [1] "Z-statistic (severe injuries): 4.693"</span></span>
<span><span class="co">#&gt; [1] "p-value (severe injuries): 0"</span></span></code></pre>
<p>RSCABS performs the Rao-Scott adjusted Cochran-Armitage trend test at
each injury threshold level, which will help identify at which severity
level the treatment effect becomes most significant.</p>
<div class="section level3">
<h3 id="rao-scott-adjusted-cochran-armitage-trend-test-results">Rao-Scott Adjusted Cochran-Armitage Trend Test Results<a class="anchor" aria-label="anchor" href="#rao-scott-adjusted-cochran-armitage-trend-test-results"></a>
</h3>
<table class="table">
<caption>RSCA Test Results by Injury Threshold</caption>
<colgroup>
<col width="9%">
<col width="11%">
<col width="7%">
<col width="15%">
<col width="11%">
<col width="31%">
<col width="12%">
</colgroup>
<thead><tr class="header">
<th align="left">Threshold</th>
<th align="right">Z_statistic</th>
<th align="right">P_value</th>
<th align="left">Has_zero_counts</th>
<th align="left">Alternative</th>
<th align="left">Method</th>
<th align="left">Significance</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">S1+</td>
<td align="right">3.566</td>
<td align="right">0.0004</td>
<td align="left">FALSE</td>
<td align="left">two.sided</td>
<td align="left">RSCA (two.sided)</td>
<td align="left">***</td>
</tr>
<tr class="even">
<td align="left">S2+</td>
<td align="right">4.693</td>
<td align="right">0.0000</td>
<td align="left">FALSE</td>
<td align="left">two.sided</td>
<td align="left">RSCA (two.sided)</td>
<td align="left">***</td>
</tr>
<tr class="odd">
<td align="left">S3+</td>
<td align="right">NA</td>
<td align="right">0.0750</td>
<td align="left">TRUE</td>
<td align="left">two.sided</td>
<td align="left">Fisher’s Exact Test (two.sided)</td>
<td align="left">.</td>
</tr>
<tr class="even">
<td align="left">S4+</td>
<td align="right">NA</td>
<td align="right">1.0000</td>
<td align="left">TRUE</td>
<td align="left">two.sided</td>
<td align="left">Fisher’s Exact Test (two.sided)</td>
<td align="left"></td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="proportion-of-fish-with-injuries-by-threshold-and-treatment">Proportion of Fish with Injuries by Threshold and Treatment<a class="anchor" aria-label="anchor" href="#proportion-of-fish-with-injuries-by-threshold-and-treatment"></a>
</h3>
<table class="table">
<caption>Proportion of Affected Fish</caption>
<thead><tr class="header">
<th align="left">Treatment</th>
<th align="right">S1+</th>
<th align="right">S2+</th>
<th align="right">S3+</th>
<th align="right">S4+</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Control</td>
<td align="right">0.292</td>
<td align="right">0.083</td>
<td align="right">0.042</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">T1</td>
<td align="right">0.375</td>
<td align="right">0.042</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">T2</td>
<td align="right">0.625</td>
<td align="right">0.333</td>
<td align="right">0.083</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">T3</td>
<td align="right">0.833</td>
<td align="right">0.625</td>
<td align="right">0.208</td>
<td align="right">0.042</td>
</tr>
</tbody>
</table>
<p><img src="Example_RSCABS_files/figure-html/unnamed-chunk-11-1.png" width="700"><img src="Example_RSCABS_files/figure-html/unnamed-chunk-11-2.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="design-effects-and-adjusted-sample-sizes">Design Effects and Adjusted Sample Sizes<a class="anchor" aria-label="anchor" href="#design-effects-and-adjusted-sample-sizes"></a>
</h3>
<table class="table">
<caption>Design Effects by Threshold and Treatment</caption>
<colgroup>
<col width="15%">
<col width="15%">
<col width="18%">
<col width="13%">
<col width="21%">
<col width="16%">
</colgroup>
<thead><tr class="header">
<th align="left">Threshold</th>
<th align="left">Treatment</th>
<th align="right">Sample_Size</th>
<th align="right">Affected</th>
<th align="right">Design_Effect</th>
<th align="right">Adjusted_n</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">S1+</td>
<td align="left">Control</td>
<td align="right">24</td>
<td align="right">7</td>
<td align="right">3.429</td>
<td align="right">7</td>
</tr>
<tr class="even">
<td align="left">S1+</td>
<td align="left">T1</td>
<td align="right">24</td>
<td align="right">9</td>
<td align="right">1.000</td>
<td align="right">24</td>
</tr>
<tr class="odd">
<td align="left">S1+</td>
<td align="left">T2</td>
<td align="right">24</td>
<td align="right">15</td>
<td align="right">1.000</td>
<td align="right">24</td>
</tr>
<tr class="even">
<td align="left">S1+</td>
<td align="left">T3</td>
<td align="right">24</td>
<td align="right">20</td>
<td align="right">1.000</td>
<td align="right">24</td>
</tr>
<tr class="odd">
<td align="left">S2+</td>
<td align="left">Control</td>
<td align="right">24</td>
<td align="right">2</td>
<td align="right">1.000</td>
<td align="right">24</td>
</tr>
<tr class="even">
<td align="left">S2+</td>
<td align="left">T1</td>
<td align="right">24</td>
<td align="right">1</td>
<td align="right">1.043</td>
<td align="right">23</td>
</tr>
<tr class="odd">
<td align="left">S2+</td>
<td align="left">T2</td>
<td align="right">24</td>
<td align="right">8</td>
<td align="right">1.000</td>
<td align="right">24</td>
</tr>
<tr class="even">
<td align="left">S2+</td>
<td align="left">T3</td>
<td align="right">24</td>
<td align="right">15</td>
<td align="right">1.000</td>
<td align="right">24</td>
</tr>
<tr class="odd">
<td align="left">S3+</td>
<td align="left">Control</td>
<td align="right">24</td>
<td align="right">1</td>
<td align="right">1.043</td>
<td align="right">23</td>
</tr>
<tr class="even">
<td align="left">S3+</td>
<td align="left">T1</td>
<td align="right">24</td>
<td align="right">0</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">S3+</td>
<td align="left">T2</td>
<td align="right">24</td>
<td align="right">2</td>
<td align="right">1.000</td>
<td align="right">24</td>
</tr>
<tr class="even">
<td align="left">S3+</td>
<td align="left">T3</td>
<td align="right">24</td>
<td align="right">5</td>
<td align="right">1.600</td>
<td align="right">15</td>
</tr>
<tr class="odd">
<td align="left">S4+</td>
<td align="left">Control</td>
<td align="right">24</td>
<td align="right">0</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">S4+</td>
<td align="left">T1</td>
<td align="right">24</td>
<td align="right">0</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">S4+</td>
<td align="left">T2</td>
<td align="right">24</td>
<td align="right">0</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">S4+</td>
<td align="left">T3</td>
<td align="right">24</td>
<td align="right">1</td>
<td align="right">1.043</td>
<td align="right">23</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="summary-of-findings">Summary of Findings<a class="anchor" aria-label="anchor" href="#summary-of-findings"></a>
</h3>
<p>This analysis examined the trend in fish injury rates across
treatment groups using the Rao-Scott adjusted Cochran-Armitage trend
test. The test was performed at multiple injury thresholds to identify
at which severity level the treatment effect is most pronounced.</p>
<p>The strongest trend was observed at the <strong>S2+</strong>
threshold (p = 0). This indicates that the treatment has the most
pronounced effect on injuries of severity 2 or higher.</p>
<p>Statistically significant trends were observed at the following
thresholds: S1+, S2+.</p>
<p>The average design effect across all analyses was 1.26, with a
maximum of 3.43. Design effects greater than 1 indicate clustering
within tanks, which the Rao-Scott adjustment accounts for.</p>
</div>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>The analysis provides evidence of a dose-response relationship
between treatment level and fish injury rates. The Rao-Scott adjustment
was applied to account for clustering of fish within tanks, ensuring
valid statistical inference despite the clustered data structure.</p>
<p>The significant findings at S1+, S2+ suggest that the treatment
primarily affects these specific injury severity levels.</p>
</div>
<div class="section level2">
<h2 id="example-2">Example 2:<a class="anchor" aria-label="anchor" href="#example-2"></a>
</h2>
<ul>
<li>Take the subset of F2-females with 16 weeks of age, run RSCABS.</li>
</ul>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"exampleHistData"</span><span class="op">)</span></span>
<span><span class="va">exampleHistData</span> <span class="op">&lt;-</span> <span class="va">exampleHistData</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="va">as_tibble</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html" class="external-link">where</a></span><span class="op">(</span><span class="va">is.integer</span><span class="op">)</span>,<span class="va">as.numeric</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span>
<span><span class="co">#Take the subset corresponding to F0-females of 16 weeks of age</span></span>
<span></span>
<span><span class="va">subIndex</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">exampleHistData</span><span class="op">$</span><span class="va">Generation</span><span class="op">==</span><span class="st">'F2'</span> <span class="op">&amp;</span></span>
<span>                  <span class="va">exampleHistData</span><span class="op">$</span><span class="va">Genotypic_Sex</span><span class="op">==</span><span class="st">'Female'</span> <span class="op">&amp;</span></span>
<span>                  <span class="va">exampleHistData</span><span class="op">$</span><span class="va">Age</span><span class="op">==</span><span class="st">'16_wk'</span> <span class="op">)</span></span>
<span><span class="va">exampleHistData.Sub</span><span class="op">&lt;-</span><span class="va">exampleHistData</span><span class="op">[</span><span class="va">subIndex</span>, <span class="op">]</span></span>
<span><span class="co">#Run RSCABS</span></span>
<span><span class="va">exampleResults</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/runRSCABS.html">runRSCABS</a></span><span class="op">(</span><span class="va">exampleHistData.Sub</span>,<span class="st">'Treatment'</span>,</span>
<span>                          <span class="st">'Replicate'</span>,test.type<span class="op">=</span><span class="st">'RS'</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">exampleResults</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">.</span>,digits<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="36%">
<col width="14%">
<col width="11%">
<col width="14%">
<col width="11%">
<col width="10%">
</colgroup>
<thead><tr class="header">
<th align="left">Effect</th>
<th align="right">Treatment</th>
<th align="right">R.Score</th>
<th align="right">Statistic</th>
<th align="right">P.Value</th>
<th align="left">Signif</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Gon_Incr_Oocyte_Atresia1</td>
<td align="right">5</td>
<td align="right">1</td>
<td align="right">1.330</td>
<td align="right">0.092</td>
<td align="left">.</td>
</tr>
<tr class="even">
<td align="left">Gon_Incr_Oocyte_Atresia2</td>
<td align="right">5</td>
<td align="right">2</td>
<td align="right">1.231</td>
<td align="right">0.109</td>
<td align="left">.</td>
</tr>
<tr class="odd">
<td align="left">Gon_Incr_Oocyte_Atresia3</td>
<td align="right">5</td>
<td align="right">3</td>
<td align="right">1.231</td>
<td align="right">0.109</td>
<td align="left">.</td>
</tr>
<tr class="even">
<td align="left">Gon_Incr_Oocyte_Atresia4</td>
<td align="right">5</td>
<td align="right">4</td>
<td align="right">1.231</td>
<td align="right">0.109</td>
<td align="left">.</td>
</tr>
<tr class="odd">
<td align="left">Gon_Proteinaceous_fluid1</td>
<td align="right">5</td>
<td align="right">1</td>
<td align="right">-1.410</td>
<td align="right">0.079</td>
<td align="left">.</td>
</tr>
<tr class="even">
<td align="left">Gon_Asynch_Dev1</td>
<td align="right">5</td>
<td align="right">1</td>
<td align="right">2.622</td>
<td align="right">0.004</td>
<td align="left">**</td>
</tr>
<tr class="odd">
<td align="left">Gon_Asynch_Dev2</td>
<td align="right">5</td>
<td align="right">2</td>
<td align="right">2.622</td>
<td align="right">0.004</td>
<td align="left">**</td>
</tr>
<tr class="even">
<td align="left">Kid_Tub_Mineralization1</td>
<td align="right">5</td>
<td align="right">1</td>
<td align="right">0.358</td>
<td align="right">0.360</td>
<td align="left">.</td>
</tr>
<tr class="odd">
<td align="left">Kid_Tub_Mineralization2</td>
<td align="right">5</td>
<td align="right">2</td>
<td align="right">-0.070</td>
<td align="right">0.472</td>
<td align="left">.</td>
</tr>
<tr class="even">
<td align="left">Kid_Tub_Dilation1</td>
<td align="right">5</td>
<td align="right">1</td>
<td align="right">-0.070</td>
<td align="right">0.472</td>
<td align="left">.</td>
</tr>
<tr class="odd">
<td align="left">Kid_Tub_Dilation2</td>
<td align="right">5</td>
<td align="right">2</td>
<td align="right">-0.049</td>
<td align="right">0.480</td>
<td align="left">.</td>
</tr>
<tr class="even">
<td align="left">Kid_Tub_Regeneration1</td>
<td align="right">5</td>
<td align="right">1</td>
<td align="right">-1.375</td>
<td align="right">0.085</td>
<td align="left">.</td>
</tr>
</tbody>
</table>
<p>Note that the R.score in the table only shows the scores occured in
the respective treatment groups.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">exampleHistData.Sub</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Treatment</span>,fill<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">Gon_Asynch_Dev</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_d</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title<span class="op">=</span><span class="st">"Example Data: Gon_Asynch_Dev"</span>,subtitle <span class="op">=</span> <span class="st">"subset: F2 generation, 16 week age and female"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Example_RSCABS_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">cids</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">exampleHistData.Sub</span><span class="op">[</span>,<span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span><span class="op">]</span>,<span class="fl">2</span>,<span class="va">max</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">responses</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cids</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">exampleHistData.Sub</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="fl">5</span><span class="op">+</span><span class="va">cids</span><span class="op">)</span><span class="op">]</span><span class="op"><a href="../reference/pipe.html">%&gt;%</a></span><span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>,values_to <span class="op">=</span> <span class="st">"Response"</span>,names_to <span class="op">=</span> <span class="st">"Endpoint"</span><span class="op">)</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Treatment</span>,fill<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">Response</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_d</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title<span class="op">=</span><span class="st">"Example Histopath Data"</span>,subtitle <span class="op">=</span> <span class="st">"subset: F2 generation, 15 week age and female"</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">Endpoint</span><span class="op">)</span></span></code></pre></div>
<p><img src="Example_RSCABS_files/figure-html/unnamed-chunk-14-2.png" width="700"></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://scales.r-lib.org" class="external-link">scales</a></span><span class="op">)</span></span>
<span><span class="va">dat1</span> <span class="op">&lt;-</span> <span class="va">exampleHistData.Sub</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="fl">5</span><span class="op">+</span><span class="va">cids</span><span class="op">)</span><span class="op">]</span><span class="op"><a href="../reference/pipe.html">%&gt;%</a></span><span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>,values_to <span class="op">=</span> <span class="st">"Response"</span>,names_to <span class="op">=</span> <span class="st">"Endpoint"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Endpoint</span>,<span class="va">Treatment</span>,<span class="va">Response</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>counts<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Endpoint</span>,<span class="va">Treatment</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>total<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">counts</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">dat1</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Treatment</span>,fill<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">Response</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">counts</span><span class="op">/</span><span class="va">total</span><span class="op">)</span>,stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_d</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title<span class="op">=</span><span class="st">"Example Histopath Data"</span>,subtitle <span class="op">=</span> <span class="st">"subset: F2 generation, 15 week age and female"</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">Endpoint</span>,drop <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="va">percent</span><span class="op">)</span></span></code></pre></div>
<p><img src="Example_RSCABS_files/figure-html/unnamed-chunk-14-3.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="alternative-nonparametric-tests">Alternative Nonparametric Tests<a class="anchor" aria-label="anchor" href="#alternative-nonparametric-tests"></a>
</h2>
<p>The example below is taken from Hothorn’s paper.
<code>independence_test</code> function from the <code>coin</code>
package can be used to test the independence of two sets of variables
measured on arbitrary scales. Transformations can be done via
<code>trafo</code> so that various test statsitcs can be calculated,
including Pearson <span class="math inline">\(\chi^2\)</span> test, the
generalized Cochran-Mantel-Haenszel test, the Spearman correlation test,
the Fisher-Pitman permutation test, the Wilcoxon-Mann-Whitney test, the
Kruskal-Wallis test and the family of weighted logrank tests for
censored data.</p>
<p>However, the Williams’ contrast is not the same as Williams’ test,
just like in multcomp package.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ifcoin</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="http://coin.r-forge.r-project.org" class="external-link">coin</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">exampleHistData</span><span class="op">)</span></span>
<span><span class="va">subIndex</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">exampleHistData</span><span class="op">$</span><span class="va">Generation</span><span class="op">==</span><span class="st">"F1"</span> <span class="op">&amp;</span></span>
<span><span class="va">exampleHistData</span><span class="op">$</span><span class="va">Genotypic_Sex</span><span class="op">==</span><span class="st">"Male"</span> <span class="op">&amp;</span></span>
<span><span class="va">exampleHistData</span><span class="op">$</span><span class="va">Age</span><span class="op">==</span><span class="st">"8_wk"</span><span class="op">)</span></span>
<span><span class="va">LH</span><span class="op">&lt;-</span><span class="va">exampleHistData</span><span class="op">[</span><span class="va">subIndex</span>, <span class="op">]</span></span>
<span><span class="va">lh</span><span class="op">&lt;-</span><span class="va">LH</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">6</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">lh</span><span class="op">$</span><span class="va">Gon</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">lh</span><span class="op">$</span><span class="va">Gon_Phenotype</span><span class="op">)</span></span>
<span><span class="va">lh</span><span class="op">$</span><span class="va">EP1</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">lh</span><span class="op">$</span><span class="va">Gon</span> <span class="op">&gt;</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">lh</span><span class="op">$</span><span class="va">EP2</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">lh</span><span class="op">$</span><span class="va">Gon</span> <span class="op">&gt;</span><span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">lh</span><span class="op">$</span><span class="va">EP3</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">lh</span><span class="op">$</span><span class="va">Gon</span> <span class="op">&gt;</span><span class="fl">3</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">lh</span><span class="op">$</span><span class="va">treat</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">lh</span><span class="op">$</span><span class="va">Treatment</span><span class="op">)</span></span>
<span><span class="va">lhh</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="va">lh</span><span class="op">[</span><span class="va">lh</span><span class="op">$</span><span class="va">treat</span><span class="op">!=</span><span class="fl">6</span>, <span class="op">]</span><span class="op">)</span></span>
<span><span class="va">Lhh</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="va">lhh</span><span class="op">[</span><span class="va">lhh</span><span class="op">$</span><span class="va">treat</span><span class="op">!=</span><span class="fl">3</span>, <span class="op">]</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="http://coin.r-forge.r-project.org" class="external-link">"coin"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="http://multcomp.R-forge.R-project.org" class="external-link">"multcomp"</a></span><span class="op">)</span></span>
<span><span class="va">Co1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="fu">trafo</span><span class="op">(</span><span class="va">data</span>, factor_trafo <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="op">~</span><span class="va">x</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/multcomp/man/contrMat.html" class="external-link">contrMat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="st">"Dunnett"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Codu</span> <span class="op">&lt;-</span><span class="fu">independence_test</span><span class="op">(</span><span class="va">EP1</span> <span class="op">+</span><span class="va">EP2</span><span class="op">+</span><span class="va">EP3</span><span class="op">~</span> <span class="va">treat</span>, data <span class="op">=</span> <span class="va">Lhh</span>, teststat <span class="op">=</span> <span class="st">"maximum"</span>,</span>
<span>distribution <span class="op">=</span> <span class="st">"approximate"</span>, xtrafo<span class="op">=</span><span class="va">Co1</span>, alternative<span class="op">=</span><span class="st">"greater"</span><span class="op">)</span></span>
<span><span class="va">pvalCODU</span> <span class="op">&lt;-</span><span class="fu"><a href="https://scales.r-lib.org/reference/pvalue_format.html" class="external-link">pvalue</a></span><span class="op">(</span><span class="va">Codu</span>, method<span class="op">=</span><span class="st">"single-step"</span><span class="op">)</span></span>
<span><span class="va">pvalCODU</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CoW</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="fu">trafo</span><span class="op">(</span><span class="va">data</span>, factor_trafo <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="op">~</span><span class="va">x</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/multcomp/man/contrMat.html" class="external-link">contrMat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="st">"Williams"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Cowi</span> <span class="op">&lt;-</span><span class="fu">independence_test</span><span class="op">(</span><span class="va">EP1</span> <span class="op">+</span><span class="va">EP2</span><span class="op">+</span><span class="va">EP3</span><span class="op">~</span> <span class="va">treat</span>, data <span class="op">=</span> <span class="va">Lhh</span>, teststat <span class="op">=</span> <span class="st">"maximum"</span>,</span>
<span>distribution <span class="op">=</span> <span class="st">"approximate"</span>, xtrafo<span class="op">=</span><span class="va">CoW</span>, alternative<span class="op">=</span><span class="st">"greater"</span><span class="op">)</span></span>
<span><span class="va">pvalCOWI</span> <span class="op">&lt;-</span><span class="fu"><a href="https://scales.r-lib.org/reference/pvalue_format.html" class="external-link">pvalue</a></span><span class="op">(</span><span class="va">Cowi</span>, method<span class="op">=</span><span class="st">"single-step"</span><span class="op">)</span></span>
<span><span class="va">pvalCOWI</span></span></code></pre></div>
<div class="section level3">
<h3 id="mqjt-and-jtbs">MQJT and JTBS<a class="anchor" aria-label="anchor" href="#mqjt-and-jtbs"></a>
</h3>
</div>
</div>
<div class="section level2">
<h2 id="function-notes">Function Notes<a class="anchor" aria-label="anchor" href="#function-notes"></a>
</h2>
<div class="section level3">
<h3 id="notes-on-rscabs-functions">Notes on RSCABS functions<a class="anchor" aria-label="anchor" href="#notes-on-rscabs-functions"></a>
</h3>
<ol style="list-style-type: decimal">
<li>Select responses maximum value should be &gt; 0 and smaller than 20
(limited ranks in response).</li>
<li>for each to be tested response/endpoints,
<em>convert2score</em>
</li>
<li>for each to be tested response/endpoints, <em>prepDataRSCABS</em>,
prepare the data into matrix/table format, treatment as column,
replicate as row</li>
<li>for each to be tested response/endpoints, <em>stepKRSCABS</em>.</li>
</ol>
<p>The results look like below:</p>
<pre><code>$Gon_Asynch_Dev
           Effect Treatment R.Score Statistic     P.Value Signif
1 Gon_Asynch_Dev1         5       1  2.622022 0.004370488     **
2 Gon_Asynch_Dev1         4       1       NaN 1.000000000      .
3 Gon_Asynch_Dev1         4       1       NaN 1.000000000      .
4 Gon_Asynch_Dev2         5       2  2.622022 0.004370488     **
5 Gon_Asynch_Dev2         4       2       NaN 1.000000000      .
6 Gon_Asynch_Dev2         4       2       NaN 1.000000000      .</code></pre>
<ol start="5" style="list-style-type: decimal">
<li>combine the results into a big matrix.</li>
</ol>
</div>
</div>
<div class="section level2">
<h2 id="validation-by-sas">Validation by SAS<a class="anchor" aria-label="anchor" href="#validation-by-sas"></a>
</h2>
<p>The RSCABS code in R written by is validated in SAS by Chen Meng and
also against the RSCABS procedure in the archived statCharrms
package.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ul>
<li><p>Green, John W. and Springer, Timothy A. and Saulnier, Amy N. and
Swintek, Joe, (2014) Statistical analysis of histopathological
endpoints. Environmental Toxicology and Chemistry, 33(5),
1108-1116</p></li>
<li><p>Hothorn, T., Hornik, K., van de Wiel, M. A. and Zeileis, A.
(2008). Implementing a class of permutation tests: The coin package.
Journal of Statistical Software 28(8), 1–23. doi:
10.18637/jss.v028.i08</p></li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Zhenglei Gao, Sean Ryan.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
