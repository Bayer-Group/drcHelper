% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/RSCABS_AO.R
\name{step_down_RSCABS}
\alias{step_down_RSCABS}
\title{Perform Step-Down Rao-Scott Adjusted Cochran-Armitage Trend Test Procedure}
\usage{
step_down_RSCABS(
  data,
  treatment_col = "tmt",
  treatment_order = NULL,
  max_score = NULL,
  min_score = 1,
  score_cols = NULL,
  replicate_col = "tank",
  total_col = "total",
  direction = "greater",
  alternative = "greater",
  include_fisher = TRUE
)
}
\arguments{
\item{data}{A data frame containing fish injury data}

\item{treatment_col}{Name of the column containing treatment groups (default: "tmt")}

\item{treatment_order}{Optional vector specifying the order of treatment groups from
lowest to highest dose. If NULL, alphabetical order is used (default: NULL)}

\item{max_score}{Maximum score value to consider (default: NULL, auto-detected)}

\item{min_score}{Minimum score value to consider (default: 1)}

\item{score_cols}{Character vector of column names containing injury scores (default: NULL, auto-detected)}

\item{replicate_col}{Name of the column containing tank/replicate IDs (default: "tank")}

\item{total_col}{Name of the column containing total counts (default: "total")}

\item{direction}{Character string indicating threshold direction: "greater" for \\ge threshold,
"less" for \\le threshold (default: "greater")}

\item{alternative}{Character string specifying the alternative hypothesis:
"two.sided", "greater" (proportion increases with treatment level),
or "less" (proportion decreases with treatment level) (default: "greater")}

\item{include_fisher}{Logical indicating whether to use Fisher's exact test when RSCA fails (default: TRUE)}
}
\value{
A list of class "StepDownRSCABS" containing:
\item{combined_results}{Data frame with test results for all steps and thresholds}
\item{step_results}{List of RSCABS objects for each step}
\item{summary}{Summary of significant findings by step}
\item{lowest_significant}{Information about the lowest significant treatment level}
\item{parameters}{List of parameters used for the analysis}
}
\description{
This function performs a step-down procedure using Rao-Scott adjusted Cochran-Armitage
trend tests (RSCABS). The procedure systematically excludes the highest treatment groups
to identify at which treatment level the dose-response relationship becomes significant.
}
\examples{
# Example data
fish_data <- data.frame(
  tmt = c(rep("Control", 8), rep("Low", 4), rep("Medium", 4), rep("High", 4)),
  tank = c(paste0("C", 1:8), paste0("L", 1:4), paste0("M", 1:4), paste0("H", 1:4)),
  S0 = c(3, 2, 3, 2, 2, 1, 2, 3, 3, 3, 4, 2, 2, 3, 2, 2, 2, 3, 1, 2),
  S1 = c(1, 2, 0, 1, 2, 2, 1, 1, 1, 1, 0, 1, 1, 0, 1, 1, 1, 1, 2, 0),
  S2 = c(0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 1, 1, 0, 1, 0, 0, 1, 1),
  S3 = c(0, 0, 1, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1),
  total = c(4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4)
)

# Run step-down procedure with default parameters
result <- step_down_RSCABS(fish_data, treatment_col = "tmt",
                          treatment_order = c("Control", "Low", "Medium", "High"))

# Print results
print(result)

# Plot results
plot(result)

}
