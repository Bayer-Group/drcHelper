% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/tests_wrapper.R
\name{SpearmanKarber_modified}
\alias{SpearmanKarber_modified}
\title{Spearman-Karber Estimation with Modified Handling for Control Mortality}
\usage{
SpearmanKarber_modified(
  conc,
  dead,
  total,
  conf.level = 0.95,
  retData = TRUE,
  showOutput = FALSE,
  showPlot = FALSE
)
}
\arguments{
\item{conc}{A numeric vector of doses or concentrations (must be >= 0 and in increasing order).}

\item{dead}{A numeric vector of the number of organisms that died or responded at each \code{conc} level.}

\item{total}{A numeric vector of the total number of organisms (population size) at each \code{conc} level. Can be a single value if all are the same.}

\item{conf.level}{A single numeric value specifying the confidence level for the interval estimation (e.g., 0.95 for a 95\% CI). Must be in (0, 1).}

\item{retData}{A logical value. If \code{TRUE}, the results are returned in a list. If \code{FALSE}, \code{invisible(NULL)} is returned.}

\item{showOutput}{A logical value. If \code{TRUE}, the input data table and estimation results (including log-scale values and CIs) are printed to the console.}

\item{showPlot}{A logical value. If \code{TRUE}, a plot is generated showing the observed and Abbott-corrected mortalities/responses, the estimated LC50, and its confidence interval.}
}
\value{
A list containing the estimation results if \code{retData} is \code{TRUE}, otherwise \code{invisible(NULL)}. The list includes:
\item{\code{log10LC50}}{Estimated log10 of the LC50.}
\item{\code{varianceOfLog10LC50}}{Estimated variance of log10LC50.}
\item{\code{StandardDeviationOfm}}{Estimated standard deviation of log10LC50.}
\item{\code{confidenceIntervalLog10}}{CI for log10LC50 (vector of two values).}
\item{\code{LC50}}{Estimated LC50 (10^log10LC50).}
\item{\code{confidenceIntervalLC50}}{CI for LC50 (vector of two values).}
\item{\code{conf.level}}{The confidence level used for the CIs.}
}
\description{
Estimates the LC50 (median lethal concentration) or ED50 (median effective dose)
and its confidence interval using the Spearman-Karber method. This version includes
robust handling for zero-dose (control) mortality and a Fieller-like approach for
confidence interval estimation when control mortality is non-zero.
}
\details{
The function operates in two branches:
\itemize{
\item If control mortality (p0) is near zero, the standard Spearman-Karber method is used on the log-transformed doses, assuming the first observed response is 0\%.
\item If p0 is non-zero, it estimates the background rate (c) by cumulative pooling, Abbott-corrects the proportions, prunes/pools low-dose groups, and uses a modified Spearman-Karber method on the scaled proportions. Confidence intervals are calculated using an approach inspired by Fieller's theorem to account for the background correction uncertainty.
}

All concentrations must be non-negative and in increasing order.
}
\examples{
# Example 1: Zero control mortality (standard Spearman-Karber)
x1 <- c(0, 0.2, 0.3, 0.375, 0.625, 2)
n1 <- c(30, 30, 30, 30, 30, 30)
r1 <- c(0, 1, 3, 16, 24, 30)
SpearmanKarber_modified(x1, r1, n1, showOutput = TRUE)

# Example 2: Non-zero control mortality (modified method)
x2 <- c(0, 15.54, 20.47, 27.92, 35.98, 55.52)
n2 <- c(40, 40, 40, 40, 40, 40)
r2 <- c(3, 2, 6, 11, 18, 33)
results <- SpearmanKarber_modified(x2, r2, n2, retData = TRUE,
                                   showOutput = TRUE, showPlot = TRUE)
print(results$LC50)
}
\references{
ART CARTER, WYETH-AYERST RESEARCH, CHAZY, NY (1994): Using the Spearman-Karber Method to Estimate the ED50.
Proceedings of the Nineteenth Annual SAS Users Group International Conference, Dallas, Texas, April, pp. 10-13.
\url{http://www.sascommunity.org/sugi/SUGI94/Sugi-94-195\%20Carter.pdf}.
}
\seealso{
\code{\link[drcHelper]{tsk_auto}}
}
\author{
Sarah Baumert, Harald Schulz, Zhenglei Gao
}
